[{"title":"XYCTF2025","url":"/2025/07/04/XYCTF2025/XYCTF2025RE/","content":"\n\n\n\n\n\n\n\n# å‰è¨€\n\nâ€‹\tå¤ç°äº†4ã€5ä¸ªé¢˜åï¼Œå°±æ„Ÿè§‰éš¾åº¦æœ‰ç‚¹å¤ªå¤§äº†ï¼Œå¥½å‡ ä¸ªé¢˜éƒ½æ¶‰åŠåˆ°æ²¡å­¦è¿‡çš„æŠ€æœ¯ï¼Œç”±äºæˆ‘çš„WindowsåŸºç¡€å¾ˆå·®ï¼Œæˆ‘çš„çŸ¥è¯†ä¸€ç›´å¾ˆçç¢ï¼Œåšé¢˜çš„æ—¶å€™æ„Ÿè§‰ä¹Ÿåªæ˜¯èƒ½è·‘ä¸ªè„šæœ¬ï¼Œæ€è·¯æ ¹æœ¬æ²¡æœ‰é¢†æ‚Ÿï¼Œè€Œä¸”æ²¡æœ‰æ·±å…¥çš„å­¦ä¹ çŸ¥è¯†ï¼Œæ²¡æœ‰æ”¶è·ï¼Œåªæ˜¯åœ¨åŠ¨æ‰‹èƒ½åŠ›æ–¹é¢å¼ºäº†ä¸€ç‚¹ç‚¹ï¼Œæ€§ä»·æ¯”å¤ªä½äº†ã€‚\n\nâ€‹\tå­¦ä¹ è·¯çº¿è¿˜æœªç¡®å®šï¼Œæ¯å¤©å°±åªæœ‰å¤ç°é¢˜ç›®ï¼Œå¾ˆéš¾å—ï¼Œçœ‹ä¸åˆ°å‰è¿›çš„æ–¹å‘ã€‚æˆ‘è€ƒé‡ç€ï¼Œæœ¬æ¥è¦è€ƒç ”å¤ä¹ äº†ï¼Œæœ‰å¾ˆå¤šäº‹æƒ…ç­‰ç€æˆ‘å»å¿™ï¼Œæˆ‘éƒ½æ˜¯æ¨äº†å…¶ä»–äº‹æƒ…ï¼Œæ‹¿å‡ºè€ƒè¯•å‘¨åçš„å‡ å¤©æ¥å…¨ç¥è´¯æ³¨çš„å­¦ä¹ åšé¢˜ï¼Œä½†æ˜¯è‡ªå·±è‡ªå­¦é€†å‘è¶Šå¾€åè¶Šéš¾äº†ï¼ŒåŸºç¡€å¤ªé‡è¦äº†ï¼Œå¼€å‘ç»éªŒä¹Ÿå¾ˆé‡è¦ã€‚æˆ‘æ˜¯ä¸æ˜¯éœ€è¦åˆç†çš„è®¡åˆ’ä¸€ä¸‹æˆ‘çš„å­¦ä¹ äº†ï¼Œå‡å°‘æ— è°“åˆ·é¢˜çš„æ—¶é—´ï¼Œä»¥è€ƒç ”å¤ä¹ ä¸ºä¸­å¿ƒï¼Œæœ‰ç©ºä½™å°±åšä¸€åšé¢˜ï¼Œè¿™æ ·ä¹Ÿè®¸å¿ƒæ€ä¼šå¥½å¾ˆå¤šã€‚æˆä¸ºé€†å‘å¤§ä½¬ä¹Ÿä¸æ˜¯ä¸€è¹´è€Œå°±çš„äº‹æƒ…ï¼Œä¸€å¹´ã€ä¸¤å¹´ç”šè‡³æ•°åå¹´ï¼Œè¿™æ˜¯ä¸€ä¸ªçˆ±å¥½ï¼Œæˆ‘è¦å°è¯•æ²¡æœ‰é€†å‘çš„æ—¶æœŸäº†ã€‚\n\nâ€‹\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tâ€”â€”2025 06 14\n\n\n\n------\n\n\n\n# WARMUP(é™„ä»¶VBS)\n\nâ€‹\tè¿™æ˜¯ä¸€ä¸ªvbsç¨‹åºï¼Œé€šè¿‡`wscript.echo`å‡½æ•°è¾“å‡ºä»£ç ï¼Œä½†æ˜¯è®¾ç½®çš„çª—å£å¤ªå¤§ï¼Œåˆä¸çŸ¥é“æ€ä¹ˆä¿®æ”¹ã€‚äºæ˜¯ä½¿ç”¨pythonè„šæœ¬æå–å‡ºchrå­—æ®µï¼Œåœ¨pythonä¸­è¿è¡Œè¾“å‡ºä»£ç ã€‚\n\n> å­¦ä¹ ä¸€ä¸‹`vbs`è¯­è¨€çš„åŸºç¡€çŸ¥è¯†ï¼šDimæ˜¯å£°æ˜å˜é‡çš„å…³é”®å­—ï¼Œæ•°ç»„æ ‡è¯†ä¸º`s(255)`å½¢å¼ï¼Œå­—ç¬¦ä¸²ä¸‹æ ‡æ˜¯ä»1å¼€å§‹çš„ã€‚å­—ç¬¦ä¸²æ‹¼æ¥æ˜¯ä½¿ç”¨&ç¬¦å·ï¼ŒRight(str,n)å‡½æ•°è¡¨ç¤ºå¯¹å­—ç¬¦ä¸²ä»å³å‘å·¦å–nä½ã€‚\n\n```python\nimport re\n\n\ndef decode_vbs_chr_obfuscation_and_output(input_vbs_file, output_txt_file):\n    \"\"\"\n    è¯»å– VBScript æ–‡ä»¶ï¼Œæå– chr() å½¢å¼çš„æ··æ·†å­—ç¬¦ï¼Œ\n    è®¡ç®—å‡ºå…¶å¯¹åº”çš„ ASCII ç å€¼å’Œå®é™…å­—ç¬¦ï¼Œ\n    å¹¶å°†è§£ç åçš„ç»“æœè¾“å‡ºåˆ°æŒ‡å®šçš„æ–‡æœ¬æ–‡ä»¶ã€‚\n\n    Args:\n        input_vbs_file (str): åŒ…å«æ··æ·† VBScript ä»£ç çš„è¾“å…¥æ–‡ä»¶è·¯å¾„ï¼ˆä¾‹å¦‚ 'chal.vbs'ï¼‰ã€‚\n        output_txt_file (str): å­˜å‚¨è§£ç ç»“æœçš„è¾“å‡ºæ–‡ä»¶è·¯å¾„ï¼ˆä¾‹å¦‚ 'code.txt'ï¼‰ã€‚\n    \"\"\"\n    decoded_string_parts = []\n\n    try:\n        with open(input_vbs_file, 'r', encoding='utf-8', errors='ignore') as f:\n            vbs_code = f.read()\n    except FileNotFoundError:\n        print(f\"é”™è¯¯: è¾“å…¥æ–‡ä»¶ '{input_vbs_file}' æœªæ‰¾åˆ°ã€‚è¯·ç¡®ä¿æ–‡ä»¶è·¯å¾„æ­£ç¡®ã€‚\")\n        return\n    except Exception as e:\n        print(f\"è¯»å–æ–‡ä»¶ '{input_vbs_file}' æ—¶å‘ç”Ÿé”™è¯¯: {e}\")\n        return\n\n    # æ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é… chr() ä¸­çš„æ•°å­¦è¡¨è¾¾å¼\n    # æ•è·ç»„ ([0-9\\s\\+\\-\\*\\/\\.]+) ä¼šæå– chr() æ‹¬å·å†…çš„å†…å®¹\n    chr_pattern = re.compile(r\"chr\\(\\s*([0-9\\s\\+\\-\\*\\/\\.]+)\\s*\\)\", re.IGNORECASE)\n\n    # æŸ¥æ‰¾æ‰€æœ‰åŒ¹é…é¡¹\n    matches = chr_pattern.findall(vbs_code)\n\n    if not matches:\n        print(f\"åœ¨ '{input_vbs_file}' ä¸­æœªæ‰¾åˆ° 'chr()' å½¢å¼çš„æ··æ·†è¡¨è¾¾å¼ã€‚\")\n        with open(output_txt_file, 'w', encoding='utf-8') as outfile:\n            outfile.write(\"æœªåœ¨ VBScript æ–‡ä»¶ä¸­æ‰¾åˆ°å¯è§£ç çš„ 'chr()' è¡¨è¾¾å¼ã€‚\\n\")\n        return\n\n    for expression_str in matches:\n        try:\n            # ä½¿ç”¨ eval() è®¡ç®—æ•°å­¦è¡¨è¾¾å¼\n            # æ³¨æ„ï¼ševal() å­˜åœ¨å®‰å…¨é£é™©ï¼Œä»…åœ¨ä¿¡ä»»è¾“å…¥æ¥æºæ—¶ä½¿ç”¨\n            ascii_value = int(eval(expression_str))\n\n            # å°† ASCII ç å€¼è½¬æ¢ä¸ºå­—ç¬¦\n            character = chr(ascii_value)\n\n            decoded_string_parts.append(character)\n        except Exception as e:\n            print(f\"è­¦å‘Š: è®¡ç®—è¡¨è¾¾å¼ '{expression_str}' æ—¶å‡ºé”™: {e}ã€‚è¯¥éƒ¨åˆ†å°†è¢«è·³è¿‡æˆ–æ˜¾ç¤ºä¸ºé”™è¯¯ã€‚\")\n\n    # å°†æ‰€æœ‰è§£ç å‡ºçš„å­—ç¬¦è¿æ¥èµ·æ¥å½¢æˆæœ€ç»ˆçš„å­—ç¬¦ä¸²\n    decoded_full_string = \"\".join(decoded_string_parts)\n\n    try:\n        with open(output_txt_file, 'w', encoding='utf-8') as outfile:\n            outfile.write(decoded_full_string)\n\n        print(f\"æˆåŠŸè§£ç å¹¶è¾“å‡ºç»“æœåˆ° '{output_txt_file}'ã€‚\")\n\n    except Exception as e:\n        print(f\"å†™å…¥æ–‡ä»¶ '{output_txt_file}' æ—¶å‘ç”Ÿé”™è¯¯: {e}\")\n\n\nif __name__ == \"__main__\":\n    # å®šä¹‰è¾“å…¥å’Œè¾“å‡ºæ–‡ä»¶å\n    input_file_name = r\"F:\\StudyFiles\\CTF\\Review_CTF\\XYCTF2025\\RE\\VBS\\chal.vbs\"\n    output_file_name = r\"F:\\StudyFiles\\CTF\\Review_CTF\\XYCTF2025\\RE\\VBS\\code.txt\"\n    # è°ƒç”¨å‡½æ•°æ‰§è¡Œè§£ç å’Œè¾“å‡º\n    decode_vbs_chr_obfuscation_and_output(input_file_name, output_file_name)\n\n    print(\"-\" * 40)\n    print(\"å¤„ç†å®Œæˆã€‚\")\n```\n\n```vbscript\nMsgBox \"Dear CTFER. Have fun in XYCTF 2025!\"\nflag = InputBox(\"Enter the FLAG:\", \"XYCTF\")\nwefbuwiue = \"90df4407ee093d309098d85a42be57a2979f1e51463a31e8d15e2fac4e84ea0df622a55c4ddfb535ef3e51e8b2528b826d5347e165912e99118333151273cc3fa8b2b3b413cf2bdb1e8c9c52865efc095a8dd89b3b3cfbb200bbadbf4a6cd4\"\nqwfe = \"rc4key\"\n\n\nFunction RunRC(sMessage, strKey)\n    Dim kLen, i, j, temp, pos, outHex\n    Dim s(255), k(255)\n    \n    kLen = Len(strKey)\n    For i = 0 To 255\n        s(i) = i\n        k(i) = Asc(Mid(strKey, (i Mod kLen) + 1, 1)) \n    Next\n    \n\n    j = 0\n    For i = 0 To 255\n        j = (j + s(i) + k(i)) Mod 256\n        temp = s(i)\n        s(i) = s(j)\n        s(j) = temp\n    Next\n    \n   \n    i = 0 : j = 0 : outHex = \"\"\n    For pos = 1 To Len(sMessage)\n        i = (i + 1) Mod 256\n        j = (j + s(i)) Mod 256\n        temp = s(i)\n        s(i) = s(j)\n        s(j) = temp\n        \n        \n        Dim plainChar, cipherByte\n        plainChar = Asc(Mid(sMessage, pos, 1)) \n        cipherByte = s((s(i) + s(j)) Mod 256) Xor plainChar\n        outHex = outHex & Right(\"0\" & Hex(cipherByte), 2)\n    Next\n    \n    RunRC = outHex\nEnd Function\n\n\nIf LCase(RunRC(flag, qwfe)) = LCase(wefbuwiue) Then\n    MsgBox \"Congratulations! Correct FLAG!\"\nElse\n    MsgBox \"Wrong flag.\"\nEnd If\n```\n\nâ€‹\tèµ›åšå¨å­ä¸€æŠŠæ¢­å“ˆRC4ï¼Œå°±è¡Œäº†ã€‚å¾—åˆ°`flag{We1c0me_t0_XYCTF_2025_reverse_ch@lleng3_by_th3_w@y_p3cd0wn's_chall_is_r3@lly_gr3@t_&_fuN!}`\n\næŒ‰è¦æ±‚å¾—åˆ°md5å€¼ã€‚\n\n\n\n\n\n\n\n# Moon\n\n\n\nâ€‹\tè¿™æ˜¯ä¸€ä¸ªpydæ–‡ä»¶çš„é€†å‘ï¼Œå¯¹æˆ‘æ¥è¯´ç›¸å½“éš¾ã€‚.pydæ–‡ä»¶æ˜¯PythonåŠ¨æ€æ¨¡å—çš„ä¸€ç§ï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªWindowsä¸‹çš„åŠ¨æ€é“¾æ¥åº“ï¼ˆDLLï¼‰æ–‡ä»¶ï¼Œä½†æ˜¯æ‰©å±•åä¸º.pydï¼Œä»¥ä¾¿Pythonèƒ½å¤Ÿè¯†åˆ«å’Œå¯¼å…¥ã€‚\n\nâ€‹\t.pydæ–‡ä»¶è¿è¡Œä½ ä½¿ç”¨cæˆ–c++ç­‰ç¼–è¯‘å‹è¯­è¨€ç¼–å†™Pythonæ¨¡å—ï¼Œç„¶åä½œä¸ºä¸€ä¸ªæ¨¡å—ä¾›pythonå¯¼å…¥å’Œè°ƒç”¨ï¼Œå°±åƒæ˜¯æ™®é€šçš„Pythonæ–‡ä»¶ä¸€æ ·ã€‚\n\nâ€‹\tpythonç‰ˆæœ¬å¤§å¤šæ•°æƒ…å†µä¸‹å¯ä»¥åœ¨IDAçš„å­—ç¬¦ä¸²ä¸­çœ‹åˆ°ã€‚\n\nâ€‹\tä¸çŸ¥é“è¯¥æ€ä¹ˆè§£ï¼Œç›´æ¥çœ‹æºç ä¹Ÿåªèƒ½ççŒœï¼Œè€Œä¸”æºç å®¡è®¡è¿˜å¾—ç†Ÿæ‚‰å¯¹åº”çš„å‡½æ•°æ‰å¥½è·Ÿè¸ªï¼Œæˆ‘éƒ½æ²¡ç»éªŒã€‚\n\n### å¤ç°\t\n\nâ€‹\tç›´æ¥å­¦ä¹ WPï¼Œçœ‹åˆ°äº†ï¼Œå¤šåŠä¹Ÿæ˜¯çŒœçš„ï¼Œæ²¡æœ‰å¾ˆé€»è¾‘æ€§çš„åˆ†æã€‚\n\n![image-20250609102034211](/pictures/XYCTF2025/image-20250609102034211.png)\n\nâ€‹\tçŒœæµ‹å°±æ˜¯éšæœºæ•°ç”Ÿæˆæµå¯†é’¥ï¼Œç„¶åå¼‚æˆ–åŠ å¯†ã€‚æ‰€ä»¥å»æ‰¾å¯†æ–‡å°±è¡Œã€‚\n\nâ€‹\tä½†æ˜¯å¼€å§‹æˆ‘ä½¿ç”¨Cå†™çš„è„šæœ¬ç”Ÿæˆçš„éšæœºæ•°ä¸å¯¹åŠ²ï¼Œç„¶åçœ‹äº†ä¸€çœ¼WPï¼Œæ˜¯pythonçš„éšæœºæ•°ç”Ÿæˆã€‚\n\nâ€‹\tç°åœ¨æˆ‘çš„è„šæœ¬åŸºæœ¬ä¸Šéƒ½æ˜¯AIå†™çš„äº†ï¼Œè™½ç„¶æ­£ç¡®ç‡é«˜ã€é€Ÿåº¦å¿«ï¼Œä½†æ˜¯æˆ‘è‡ªèº«çš„ä»£ç èƒ½åŠ›ä¸‹é™äº†å¾ˆå¤šã€‚\n\n```python\nimport random\n\ndef solve_xor_cipher():\n    seed = 1131796\n    random.seed(seed)\n\n    enflag = \"426b87abd0ceaa3c58761bbb0172606dd8ab064491a2a76af9a93e1ae56fa84206a2f7\"\n\n    decoded_bytes = bytearray()\n\n    for i in range(0, len(enflag), 2):\n        hex_byte_str = enflag[i:i + 2]\n\n        en_byte = int(hex_byte_str, 16)\n\n        random_num = random.randint(0, 255)\n\n        decoded_byte = en_byte ^ random_num\n\n        decoded_bytes.append(decoded_byte)\n\n    try:\n        flag = decoded_bytes.decode('ascii')\n        print(f\"Decoded Flag: {flag}\")\n    except UnicodeDecodeError:\n        print(\"Decoded Flag (might contain non-ASCII characters):\")\n        print(decoded_bytes.hex())\n\n\nif __name__ == \"__main__\":\n    solve_xor_cipher()\n```\n\nâ€‹\tä¸‹é¢æ˜¯æˆ‘å†™çš„ï¼ŒAIè¿˜æ˜¯å¤ªæ ¼å¼åŒ–äº†ã€‚\n\n```py\nimport random\nenflag = \"426b87abd0ceaa3c58761bbb0172606dd8ab064491a2a76af9a93e1ae56fa84206a2f7\"\nseed = 1131796\nrandom.seed(seed)\nfor i in range(0,len(enflag),2):\n    data = int(enflag[i:i+2], 16)\n    data = data ^ random.randint(0, 255)\n    print(chr(data), end='')\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n# Dragon\n\nâ€‹\tæ‹¿åˆ°ä¸€ä¸ª`bc`åç¼€æ–‡ä»¶ï¼Œå…ˆä½¿ç”¨è™šæ‹Ÿæœºä¸­çš„LLVMç¯å¢ƒå°†æ–‡ä»¶åæ±‡ç¼–ä¸º.llæ–‡ä»¶ï¼Œæ‰€ä½¿ç”¨å‘½ä»¤ä¸º`llvm -dis filename`ã€‚**.ll**æ–‡ä»¶æ˜¯LLVMçš„ä¸­é—´è¡¨ç¤ºè¯­è¨€ï¼Œæ˜¯ä¸€ç§ä½¿ç”¨æ–‡æœ¬æ–¹å¼å†™çš„LLVMä¸­é—´ä»£ç ï¼Œå¯è§†ä½œâ€œ**é«˜çº§æ±‡ç¼–**â€ã€‚\n\nâ€‹\tç„¶åä½¿ç”¨`sublime`æ‰“å¼€åæ±‡ç¼–æ–‡ä»¶ï¼Œçœ‹åˆ°mainå‡½æ•°ï¼Œ\n\nâ€‹\tè¿™æ˜¯`for`å¾ªç¯çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œå¾ªç¯å­—ç¬¦ä¸²é•¿åº¦é™¤ä»¥2æ¬¡ã€‚\n\n![image-20250609204824158](/pictures/XYCTF2025/image-20250609204824158.png)\n\nâ€‹\tçœ‹åˆ°forå¾ªç¯çš„ä¸»ä½“ï¼Œå…ˆè°ƒç”¨calculate_crc64_directå‡½æ•°ï¼Œç„¶åå°†è¿”å›å€¼å’Œå¯†æ–‡æ¯”å¯¹ï¼ŒæŒ‰ç…§encåç§°å³å¯æ‰¾åˆ°å¯†æ–‡ã€‚\n\n![image-20250609204928826](/pictures/XYCTF2025/image-20250609204928826.png)\n\n![image-20250609205043827](/pictures/XYCTF2025/image-20250609205043827.png)\n\nâ€‹\tä¸‹ä¸€æ­¥çœ‹ä¸€ä¸‹CRC64å‡½æ•°ï¼Œçœ‹çœ‹å…·ä½“çš„è®¡ç®—è¿‡ç¨‹ï¼Œå…¶å®å°±æ˜¯è¿™ä¸ªç®—æ³•ã€‚\n\n![image-20250609205917935](/pictures/XYCTF2025/image-20250609205917935.png)\n\nâ€‹\tå¾—åˆ°ç»éªŒï¼Œ`for.cond`è¡¨ç¤ºå¾ªç¯çš„åˆå§‹åŒ–ï¼Œ`for.body`ä»£è¡¨å¾ªç¯çš„ä¸»è¦é€»è¾‘ï¼Œ`for.inc`è¡¨ç¤ºç¨‹åºå¾ªç¯å‚æ•°çš„è‡ªåŠ ï¼Œ`for.end`è¡¨ç¤ºå¾ªç¯çš„è§£é‡Šï¼Œå¾ˆå¥½ç†è§£ã€‚\n\nâ€‹\tæ•´ä½“çš„æ€è·¯å°±æ˜¯ä½¿ç”¨åŒæ ·çš„è®¡ç®—CRC64çš„æ–¹æ³•ï¼Œå»çˆ†ç ´ç»“æœã€‚è¿™ä¸ªcrc64è®¡ç®—å‡½æ•°çš„æ±‡ç¼–ä»£ç éå¸¸ç®€å•ï¼Œçœ‹æ±‡ç¼–ä»£ç å®Œå…¨èƒ½ä¸€ç‚¹ç‚¹å†™å‡ºæ¥ï¼Œä¹Ÿä¸é•¿ã€‚\n\n```c\n#include<stdio.h>\n#include<stdlib.h>\n#include<stdint.h>\n\nuint64_t calculate_crc64(const uint8_t *data, int len)\n{\n    uint64_t crc = 0xFFFFFFFFFFFFFFFF;\n    for(int i = 0; i < len; i++)\n    {\n        crc ^= (uint64_t)(data[i]) << 56;\n        for(int j=0; j<8; j++)\n        {\n            if(crc & 0x8000000000000000)\n            {\n                crc = (crc << 1) ^ 0x42F0E1EBA9EA3693;\n            }else{\n                crc <<= 1;\n            }\n        }\n    }\n    return crc ^ 0xFFFFFFFFFFFFFFFF;\n}\n\nint main()\n{\n    uint64_t enc[] = {0xDC63E34E419F7B47,0x31EF8D4E7B2BFC6,0x12D62FBC625FD89E,0x83E8B6E1CC5755E8,0xfc7bb1eb2ab665cc,0x9382ca1b2a62d96b,0xb1fff8a07673c387,0xda81627388e05e1,0x9ef1e61ae8d0aab7,0x92783fd2e7f26145,0x63c97ca1f56fe60b,0x9bd3a8b043b73aab};\n    for(size_t i =0; i<sizeof(enc)/sizeof(enc[0]); i++)\n    {\n        for(uint16_t j=0x2020; j<0xffff; j++)\n        {\n            uint64_t crc = calculate_crc64((uint8_t*)&j, 2);\n            if(crc == enc[i])\n            {\n                printf(\"%c%c\", j&0xff, j>>8);\n            }\n        }\n    }\n    return 0;\n}\n```\n\n\n\n\n\n\n\n\n\n# Lake\n\nâ€‹\tæ— å£³ï¼ŒPascalè¯­è¨€ç¼–å†™ï¼ŒIDAåç¼–è¯‘å‡ºæ¥éƒ½æ˜¯æ— ç¬¦å·è§£æçš„ï¼Œåªèƒ½åŠ¨æ€åˆ†æäº†ã€‚\n\nâ€‹\tæ ¹æ®ç¨‹åºè¿è¡Œæ—¶çš„ç‰¹å®šï¼Œå¯ä»¥è·Ÿè¸ªsleepå‡½æ•°åˆ°ä¸»é€»è¾‘å‡½æ•°`sub_100001B70`ã€‚è°ƒè¯•æ—¶å¾ˆå®¹æ˜“å‘ç°`sub_10000C760`æ˜¯è¾“å‡ºè¯­å¥çš„åœ°æ–¹ï¼Œ`sub_10000CB90`æ˜¯è¾“å…¥flagçš„åœ°æ–¹ã€‚\n\n![image-20250610123522648](/pictures/XYCTF2025/image-20250610123522648.png)\n\nâ€‹\tç¬¬ä¸€æ¬¡åŠ å¯†ï¼Œæ˜¯åˆ©ç”¨ä¸€ä¸ªç±»ä¼¼è™šæ‹Ÿæœºä¸€æ ·çš„ä¸œè¥¿è¿›è¡Œå¤„ç†ï¼Œå–å‡ºæ“ä½œç å‘ç°ï¼Œåªæœ‰128ä¸‰ç§æ“ä½œï¼Œå…¶ä»–éƒ½æ²¡ä½¿ç”¨ã€‚\n\n![image-20250610123623209](/pictures/XYCTF2025/image-20250610123623209.png)\n\nâ€‹\tç¬¬äºŒæ¬¡åŠ å¯†å‡½æ•°`sub_1000019B0`ï¼Œé‡Œé¢å¾ˆæ¸…æ™°çš„ç§»ä½åŠ å¯†ï¼Œç­‰ä»·äº`v5[i] = (v3[i+1] << 3) | (v3[i+2] >> 5)`\n\n`v5[i+1] =  (v3[i+2]<<3) | (v3[i+3] >> 5)` `v5[i+2] =  (v3[i+3]<<3) | (v3[i] >> 5)` `v5[i+3] =  (v3[i]<<3) | (v3[i+1] >> 5)`ã€‚\n\n![image-20250610123756995](/pictures/XYCTF2025/image-20250610123756995.png)\n\nâ€‹\tæœ€åè¿›è¡Œå¯†æ–‡æ¯”å¯¹ï¼Œé€»è¾‘å¾ˆæ¸…æ™°äº†ï¼Œå†™è§£å¯†è„šæœ¬å°±è¡Œäº†ã€‚è¿™é¢˜å”¯ä¸€çš„éš¾ç‚¹å°±åœ¨äºæ— ç¬¦å·è§£æï¼Œå‡½æ•°åå’Œå˜é‡å·¨ä¸‘é™‹ï¼Œéœ€è¦è‡ªå·±åŠ¨è°ƒ+é™æ€åˆ†æï¼Œä½“åŠ›æ´»ã€‚\n\n![image-20250610124019036](/pictures/XYCTF2025/image-20250610124019036.png)\n\n\n\n\n\nâ€‹\tæˆ‘åˆå¤ä¹ åˆ°äº†Cè¯­è¨€çš„é•¿åº¦è®¡ç®—å‡½æ•°â€”â€”`sizeof`å‡½æ•°ã€‚\n\n> â€‹\t`sizeof`è¿”å›æ“ä½œæ•°æ‰€å ç”¨çš„å†…å­˜ç©ºé—´å¤§å°ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ï¼Œä¸€ä¸ªå­—èŠ‚é€šå¸¸æ˜¯8ä½ï¼Œä½†æ˜¯å…·ä½“ä½æ•°ç”±CHAR_BITå®å®šä¹‰ï¼ˆåœ¨limits.hä¸­ï¼‰ã€‚è¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ªæ— ç¬¦å·æ•´å‹ï¼Œé€šå¸¸æ˜¯size_tç±»å‹ï¼Œå®šä¹‰åœ¨`<stddef.h>`ï¼ˆä»¥åŠå…¶ä»–æ ‡å‡†å¤´æ–‡ä»¶ï¼‰ä¸­ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨`sizeof`çš„ç»“æœæ—¶ï¼Œæ¨èä½¿ç”¨`size_t`ç±»å‹å˜é‡æ¥å­˜å‚¨ã€‚\n>\n> â€‹\tå½“`sizeof`åº”ç”¨äºä¸€ä¸ªè¡¨è¾¾å¼æ—¶ï¼Œå®ƒåªä¼šåˆ†æè¡¨è¾¾å¼çš„ç±»å‹ï¼Œè€Œä¸ä¼šçœŸæ­£æ‰§è¡Œè¯¥è¡¨è¾¾å¼ã€‚ä¾‹å¦‚ï¼Œ`sizeof(x++)`ä¼šè¿”å›`x`çš„ç±»å‹å¤§å°ï¼Œä½†`x`çš„å€¼ä¸ä¼šå› æ­¤è€Œå¢åŠ ã€‚å”¯ä¸€çš„ä¾‹å¤–æ˜¯å½“æ“ä½œæ•°æ˜¯ä¸€ä¸ªå¯å˜é•¿åº¦æ•°ç»„ï¼ˆVLAï¼‰æ—¶ï¼Œå®ƒä¼šåœ¨è¿è¡Œæ—¶æ±‚å€¼ã€‚\n>\n> â€‹\t`sizeof(myArray)`: è¿”å›æ•´ä¸ªæ•°ç»„çš„æ€»å­—èŠ‚æ•°ï¼Œå³`å…ƒç´ æ•°é‡ * å•ä¸ªå…ƒç´ å¤§å°`ã€‚è®¡ç®—æ•°ç»„å…ƒç´ ä¸ªæ•°: `sizeof(myArray) / sizeof(myArray[0])` æ˜¯è®¡ç®—æ•°ç»„å…ƒç´ ä¸ªæ•°çš„å¸¸ç”¨æ–¹æ³•ã€‚\n>\n> â€‹\t`sizeof(myPointer)`: è¿”å›æŒ‡é’ˆæœ¬èº«åœ¨å†…å­˜ä¸­å ç”¨çš„å­—èŠ‚æ•°ï¼Œè€Œä¸æ˜¯å®ƒæ‰€æŒ‡å‘çš„æ•°æ®çš„å¤§å°ã€‚è¿™é€šå¸¸æ˜¯4æˆ–8å­—èŠ‚ï¼Œå–å†³äºç³»ç»Ÿæ¶æ„ï¼ˆ32ä½æˆ–64ä½ï¼‰ã€‚\n\n```c\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdint.h>\n\n\n//è¿™ä¸ªå‡½æ•°éœ€è¦ä¸»åŠ¨ä¼ å…¥opræ•°ç»„çš„å¤§å°ï¼Œå› ä¸ºåœ¨è¯¥å‡½æ•°é‡Œé¢sizeof(opr)åªèƒ½å¾—åˆ°8ï¼Œä¹Ÿå°±æ˜¯æŒ‡é’ˆçš„å†…å­˜ç©ºé—´å¤§å°ã€‚\nvoid decrypt1(uint8_t *enc, uint8_t *opr, int opr_len)\n{\n    uint8_t a,b,c;\n    for(int i=opr_len-3; i>=0 ;i-=3)\n    {\n        a = opr[i];\n        b = opr[i+1];\n        c = opr[i+2];\n        //è¿™é‡Œæ˜¯å› ä¸ºå·²ç»åˆ†æå‡ºäº†æ“ä½œç åªæœ‰1ã€2ã€8ä¸‰ç§ç±»å‹ã€‚\n        switch(a)\n        {\n            case 1:\n                enc[b] -= c;\n                break;\n            case 2:\n                enc[b] += c;\n                break;\n            case 8:\n                enc[b] ^= c;\n                break;\n            default:\n                printf(\"Error\\n\");\n                break;     \n        }\n    }\n}\n\nvoid decrypt2(uint8_t *enc, uint8_t *flag)\n{\n    for(int i=0;i<40;i+=4)\n    {\n        flag[i] = (enc[i+3]>>3) | (enc[i+2]<<5);\n        flag[i+1] = (enc[i]>>3) | (enc[i+3]<<5);\n        flag[i+2] = (enc[i+1]>>3) | (enc[i]<<5);\n        flag[i+3] = (enc[i+2]>>3) | (enc[i+1]<<5);\n    }\n}\n\n\nint main()\n{\n    uint8_t enc[] = {74, 171, 155, 27, 97, 177, 243, 50, 209, 139, 115, 235, 233, 115, 107, 34, 129, 131, 35, 49, 203, 27, 34, 251, 37, 194, 129, 129, 115, 34, 250, 3, 156, 75, 91, 73, 151, 135, 219, 81};\n    uint8_t opr_sequ[] = {2, 2, 12, 1, 26, 85, 1, 35, 12, 2, 14, 9, 1, 27, 6, 8, 6, 5, 8, 1, 5, 2, 27, 14, 2, 25, 3, 2, 26, 4, 8, 4, 8, 1, 3, 12, 2, 12, 10, 1, 37, 2, 1, 32, 2, 1, 9, 12, 8, 26, 5, 2, 4, 13, 8, 8, 15, 2, 10, 14, 1, 16, 7, 1, 12, 7, 8, 34, 8, 8, 21, 10, 1, 39, 126, 2, 7, 2, 8, 15, 3, 8, 10, 10, 1, 34, 11, 2, 18, 8, 2, 25, 9, 8, 14, 6, 8, 0, 5, 1, 10, 8, 8, 27, 7, 8, 13, 6, 8, 13, 4, 8, 23, 12, 8, 34, 14, 2, 18, 52, 1, 38, 119};\n    uint8_t flag[40] = {0};\n    decrypt2(enc,flag);\n    decrypt1(flag,opr_sequ,sizeof(opr_sequ));\n    for(int i=0;i<40;i++)\n    {\n        printf(\"%c\",flag[i]);\n    }\n    return 0;\n}\n```\n\n\n\n\n\n# CrackMe\n\nâ€‹\tIDAæŸ¥çœ‹ï¼ŒéMFCç¨‹åºï¼Œxspyæ‰¾ä¸åˆ°æŒ‰é”®å¯¹åº”çš„å‡½æ•°ã€‚è°ƒè¯•çš„æ—¶å€™ï¼Œæäº¤æŒ‰é”®è¢«ç¦æ­¢äº†ï¼Œéœ€è¦æ‰¾åˆ°å¯¹åº”çš„é€»è¾‘patchæ‰ã€‚\n\nâ€‹\tçœ‹WPï¼Œè€ƒå¯Ÿçš„æ–¹å‘æ˜¯win32çª—å£ç¨‹åºé€†å‘ã€åè°ƒè¯•å¯¹æŠ—ã€å¤šçº¿ç¨‹å’Œå¼‚æ­¥ã€‚\n\nâ€‹\tcsä¸œè¥¿ï¼Œx64dbgä¸€ç‚¹è°ƒè¯•ä¸æ˜ç™½ã€‚è‡ªå·±é‡æ–°å­¦win32çª—å£ç¨‹åºã€‚åšäº†ï¼Œä¹Ÿé€†ä¸äº†ï¼Œä»£ç æ··æ·†çš„å¤ªæ¶å¿ƒäº†ï¼Œidaçš„æ’ä»¶è¿˜è£…ä¸ä¸Šï¼Œx64dbgä¸€ç›´åˆ°ä¸äº†checkç‚¹ï¼Œä¸€ç‚¹ç‚¹æˆ‘å´©æºƒäº†ï¼ŒèŠ±å‡ å¤©éƒ½è§£å†³ä¸äº†çš„é¢˜ï¼Œè¯´æ˜è¿™æ ¹æœ¬ä¸æ˜¯æˆ‘è¿™ä¸ªé˜¶æ®µèƒ½æŒæ¡çš„é¢˜ã€‚è¿˜æ˜¯ä¸­ç­‰!\n\n------\n\nâ€‹\tæ—¢ç„¶æ— æ³•è‡ªå·±å®Œæ•´å¤ç°ï¼Œæ›´åˆ«æè‡ªå·±æ€è€ƒï¼Œé‚£ä¹ˆæˆ‘å°±è·Ÿç€å­¦ä¸€ä¸‹ç®—æ³•é€†å‘å§ï¼Œé”»ç‚¼ä¸€ä¸‹ä»£ç èƒ½åŠ›å¥½äº†ã€‚æ€»ä¸èƒ½ä¸€ç›´å¡ä½å§ï¼Œåé¢çš„è·¯è¿˜å¾ˆè¿œï¼Œæˆ‘ä¸èƒ½åœ¨è¿™é‡Œåœä¸‹ã€‚\n\n------\n\n### å¤ç°\n\nâ€‹\té‡Œé¢æœ‰ä¸ªç‰¹åˆ«æœ‰ç‰¹å¾çš„å‡½æ•°ï¼Œæˆ‘çœ‹ä¸æ‡‚ï¼Œç›´æ¥å…¨éƒ¨é—®AIã€‚\n\n> ### æ€»ç»“\n>\n> - **è¿™æ®µä»£ç æ˜¯ä¸€ä¸ªåŸºäºå¯¼å‡ºå‡½æ•°åå“ˆå¸Œçš„åŠ¨æ€APIè°ƒç”¨å™¨ã€‚**\n> - å®ƒé€šè¿‡å‚æ•°å†³å®šåŠ è½½å“ªä¸ªç³»ç»ŸDLLï¼Œä»è¯¥DLLå¯¼å‡ºè¡¨é‡Œç”¨å“ˆå¸ŒåŒ¹é…å‡½æ•°åï¼Œæ‰¾åˆ°å‡½æ•°æŒ‡é’ˆåè°ƒç”¨ï¼Œå¹¶è¿”å›ç»“æœã€‚\n> - ç»“åˆå‰é¢ä»£ç ï¼Œæ„Ÿè§‰æ•´ä½“ä»£ç æ˜¯ä¸ªå¤æ‚çš„â€œä¿æŠ¤å£³â€æˆ–â€œè‡ªå®šä¹‰APIè°ƒç”¨å±‚â€ï¼Œæœ‰é˜²è°ƒè¯•+åŠ¨æ€è°ƒç”¨æœºåˆ¶ã€‚\n\n![image-20250612220942036](/pictures/XYCTF2025/image-20250612220942036.png)\n\nâ€‹\tå› ä¸ºè¿™ä¸ªé˜²æŠ¤ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•é€šè¿‡å¯¼å…¥å‡½æ•°çš„äº¤å‰å¼•ç”¨æ¥åˆ‡å…¥ç¨‹åºï¼Œä½†æ˜¯æˆ‘ç†è§£äº†è¿™ä¸ªæ˜¯è°ƒç”¨å‡½æ•°çš„åœ°æ–¹ï¼ˆè€Œä¸”å¯åŒæ ·åŠŸèƒ½ï¼Œç›¸åŒçš„ä»£ç çš„è¿™ä¸ªå‡½æ•°æœ‰å¾ˆå¤šåç§°ï¼ŒIDAåœ¨ä¸åŒåœ°æ–¹éƒ½å–äº†ä¸åŒçš„åç§°ï¼Œä½†æ˜¯ç‚¹è¿›å»çœ‹æ˜¯æä¸ºç›¸ä¼¼çš„ï¼‰ï¼ŒçŸ¥é“äº†è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œæˆ‘ä»¥å‰ä¸äº†è§£ï¼Œåªä¼šæ„Ÿåˆ°å¤ªå¤æ‚ï¼Œå¤ªå¯æ€•ã€‚ç°åœ¨æˆ‘æ˜ç™½äº†ï¼Œå®ƒè°ƒç”¨å‡½æ•°çš„åŠŸèƒ½åï¼Œæˆ‘å°±æ¸…æ¥šç±»ä¼¼ä¸‹é¢è¿™ç§ä»£ç å°±æ˜¯å‡½æ•°è°ƒç”¨ï¼Œè°ƒç”¨çš„å°±æ˜¯`sub_7FF6D7FF1320`ã€‚\n\n![image-20250612222609678](/pictures/XYCTF2025/image-20250612222609678.png)\n\nâ€‹\tè€Œåƒè¿™ç§ï¼Œå°±ä¸æ˜¯ä»€ä¹ˆä¸»è¦æ“ä½œï¼Œå¤šåŠæ˜¯èµ‹å€¼å•Šç­‰ç­‰æ— å…³çš„åº•å±‚æ“ä½œã€‚\n\n![image-20250612222847321](/pictures/XYCTF2025/image-20250612222847321.png)\n\n\n\nâ€‹\tåƒ`_CheckForDebuggerJustMyCode`è¿™ç§å‡½æ•°ï¼Œæˆ‘å¼€å§‹ä»¥ä¸ºæ˜¯å‡ºé¢˜äººå†™çš„åè°ƒè¯•éƒ¨åˆ†ï¼Œæ£€ç´¢æ‰çŸ¥é“æ˜¯ç³»ç»Ÿä»£ç ï¼Œåº”è¯¥æ˜¯VSç¨‹åºè‡ªå¸¦çš„ä¸€ä¸ªå’Œè°ƒè¯•æœ‰å…³çš„ä¸œè¥¿ï¼Œæˆ‘è¿˜æ²¡æœ‰æ·±å…¥äº†è§£ï¼Œä½†æ˜¯ç¡®è®¤äº†è¿™ä¸ªå‡½æ•°å¯¹åšé¢˜æ— å½±å“ã€‚\n\n\n\nâ€‹\tæˆ‘ä¹Ÿæ‰¾åˆ°äº†PEBçš„åè°ƒè¯•ä»£ç ï¼Œæ˜¯åœ¨`TlsCallback_0`â€”â€”`sub_7FF6D7FF2370`â€”â€”`sub_7FF6D7FF1320`â€”â€”`sub_7FF6D7FEE7E0`â€”â€”`sub_7FF6D7FEF280`å¤„ï¼Œæ˜¯çœŸéš¾æ‰¾å•Šï¼Œæˆ‘è¿˜æ˜¯è·Ÿç€å¤§ä½¬ç¿»æºç æ‰¾åˆ°çš„ã€‚\n\n![image-20250612222252435](/pictures/XYCTF2025/image-20250612222252435.png)\n\n\n\nâ€‹\tæœ¬ä»¥ä¸ºç®€å•çš„ä¸‹ä¸ªæ–­ç‚¹ï¼Œæ”¹ä¸€æ¬¡æ ‡å¿—ä½å°±èƒ½ç»•è¿‡ï¼Œä½†æ˜¯æƒ…å†µå¹¶éå¦‚æ­¤ï¼ŒIDAç›´æ¥å¡æ­»äº†ï¼Œè¿é€€å‡ºå‘½ä»¤éƒ½æ²¡æœ‰æ•ˆæœäº†ï¼Œè°ƒè¯•å™¨ç›´æ¥ä¸èµ·ä½œç”¨äº†ã€‚çœ‹WPå­¦ä¹ åˆ°ï¼Œè¿™æ˜¯é¢˜ç›®ä½¿â½¤`NtSetInformationThread` è®¾ç½®çº¿ç¨‹å±æ€§ `ThreadHideFromDebugger` æ¥ä¸è®©è°ƒè¯•å™¨è°ƒè¯•ï¼Œæœ‰å…³çš„ç‰¹å¾å°±æ˜¯è¿™ä¸ª`0x11`æ•°ã€‚\n\n![image-20250613194110999](/pictures/XYCTF2025/image-20250613194110999.png)\n\nâ€‹\tè¿™æ¬¡çš„åè°ƒè¯•å¯¹æŠ—ï¼Œç»•è¿‡æŠ€å·§æ˜¯ä¿®æ”¹æ ‡å¿—0x11ä¸ºå…¶ä»–å€¼ï¼ŒåŒæ—¶ä¿®æ”¹å¯¹`BeingDebugded`çš„åˆ¤æ–­é€»è¾‘ï¼Œå¯ä»¥å°†ç­‰äº1æ”¹ä¸º0ï¼Œå¦‚ä¸‹å›¾å³å¯ã€‚\n\n![image-20250613195146488](/pictures/XYCTF2025/image-20250613195146488.png)\n\nâ€‹\t`sub_7FF65DFA1320`å‡½æ•°è¿˜æœ‰è°ƒç”¨`NtSetInformationThread`å‡½æ•°çš„åœ°æ–¹ï¼Œä¿®æ”¹ä¸ºå…¶ä»–å€¼ï¼Œå¦‚ä¸‹å›¾å³å¯ã€‚\n\n![image-20250613195106815](/pictures/XYCTF2025/image-20250613195106815.png)\n\n\n\nâ€‹\tä¿®æ”¹å¦‚ä¸Šä¸‰ä¸ªä½ç½®åï¼Œå°±èƒ½æˆåŠŸæ­£å¸¸è°ƒè¯•äº†ï¼ŒæŒ‰é”®ä¸ä¼šâ€œç°â€äº†ã€‚**(â‰§âˆ€â‰¦)ã‚**ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥æ„‰å¿«çš„è°ƒè¯•ç¨‹åºäº†ï¼ŒæŸ¥çœ‹åŠ å¯†éªŒè¯é€»è¾‘äº†ã€‚\n\n------\n\nâ€‹\t`sub_7FF65DF9E7E0`å‡½æ•°ç›¸å½“äº`WndProc`å‡½æ•°ï¼Œæ–­ç‚¹ä¸‹åœ¨è¿™ä¸ªå‡½æ•°å¤´å‡ è¡Œå³å¯ï¼Œè¾“å…¥åé¦–å…ˆè¿›å…¥case0ï¼Œè¿™é‡Œæ˜¯åˆå§‹åŒ–çª—å£ï¼Œç„¶åå†è¿›å…¥case4ï¼Œå†è¿›å…¥case5ï¼Œåé¢è¿˜å¾—å›case0éªŒè¯æœ€åä¸€æ­¥ï¼Œæ€»å…±åˆ†ä¸‰ä¸ªéƒ¨åˆ†éªŒè¯ã€‚\n\n\n\nâ€‹\tåœ¨case4é‡Œé¢ï¼Œå¼‚æˆ–åŠ å¯†éªŒè¯å˜›ï¼Œæ£€æŸ¥å‰5ä½çš„`flag{`ã€‚\n\n![image-20250613203657885](/pictures/XYCTF2025/image-20250613203657885.png)\n\nâ€‹\tçœ‹åˆ°case5é‡Œé¢è°ƒç”¨çš„å‡½æ•°ï¼Œå…ˆç”Ÿæˆä¸€ä¸ªå›ºå®šçš„æ•°ç»„ï¼Œä¹Ÿå°±æ˜¯æ›¿æ¢boxï¼Œç„¶åé€šè¿‡å¼‚æˆ–ã€æ›¿æ¢ç­‰æ“ä½œè¿›è¡ŒåŠ å¯†ï¼Œæœ€åè¿›è¡Œæ¯”è¾ƒã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥æ‹¿åˆ°è¿™ä¸ªæ›¿æ¢ç›’ï¼Œç„¶åçˆ†ç ´è¿™ä¸ƒä½ã€‚\n\n![image-20250613204251325](/pictures/XYCTF2025/image-20250613204251325.png)\n\nâ€‹\tæå–æ•°æ®IDAè„šæœ¬ã€‚\n\n```python\ndata = []\nbase = 0xF33A8FF0C0\nfor i in range(256):\n    addr = base + i * 4\n    data.append(get_wide_dword(addr))\n\nprint(data)\n```\n\nâ€‹\tçˆ†ç ´è„šæœ¬ï¼Œå¾—åˆ°ç¬¬äºŒæ®µæ˜¯`moshui_`ã€‚è¿˜è®©æˆ‘åˆå¤ä¹ äº†ä¸€épythonè¿ç®—ç¬¦çš„åŸºç¡€çŸ¥è¯†ï¼Œå¥½å¥½å¥½ï¼\n\n```python\nbox = [0, 3233442988, 1510334235, 2596254647, 3020668470, 1957810842, 3993919789, 783551873, 3009837615, 1943803523, 3915621684, 702138776, 124634137, 3352799413, 1567103746, 2647816110, 3183342109, 2097651377, 3887607046, 654459306, 162941995, 3373015175, 1404277552, 2466906012, 249268274, 3462522014, 1423857449, 2489596805, 3134207492, 2053790376, 3772115231, 544179635, 2685067897, 1622183637, 4195302754, 984961486, 335633487, 3569037539, 1308918612, 2394877944, 325883990, 3554079994, 1231636301, 2312317921, 2808555104, 1742555852, 4251122043, 1037604311, 498536548, 3708648648, 1202900863, 2265490387, 2847714898, 1762050814, 4089016649, 855842277, 2932959819, 1852507879, 4107580752, 879679996, 450548861, 3663771857, 1088359270, 2154129354, 2607071921, 1541320221, 3244367274, 31158534, 795835527, 4023717931, 1969922972, 3050360624, 671266974, 3904427058, 1913087877, 2998733609, 2617837224, 1555261956, 3322730931, 112637215, 651767980, 3865271296, 2094854071, 3160834843, 2463272602, 1382605366, 3369554305, 141376813, 2512341635, 1426400815, 3485111704, 251722036, 565507253, 3775830041, 2075208622, 3138078466, 997073096, 4224994404, 1634467795, 2714866559, 2405801726, 1340076626, 3579855333, 366619977, 2282248935, 1219638859, 3524101628, 314042704, 1006888145, 4240017533, 1711684554, 2797360998, 2262029013, 1181335161, 3705015758, 476864866, 853044451, 4066508879, 1759359992, 2825379668, 901097722, 4111451222, 1873836001, 2936675149, 2176718540, 1090812512, 3686517207, 453092731, 3988292385, 755167117, 3082640442, 1996959894, 1504918807, 2567524795, 62317068, 3272380064, 1591671054, 2657392034, 81470997, 3294710457, 3939845944, 711928724, 2966460451, 1886057615, 1342533948, 2428444048, 167816743, 3401237131, 3826175754, 615818150, 3188396049, 2125561021, 3814918931, 601450431, 3110523912, 2044508324, 1466479909, 2547177865, 225274430, 3453421202, 1303535960, 2366115316, 397917763, 3608007407, 4189708142, 956543938, 2747007093, 1661365465, 4275313527, 1047427035, 2765210732, 1684777152, 1256170817, 2321926637, 282753626, 3495958262, 4027552581, 817233897, 2852801630, 1789927666, 1141124467, 2227061215, 503444072, 3736837828, 1131014506, 2211677638, 426522225, 3654703837, 4150417244, 936918000, 2909243463, 1843258603, 1994146192, 3060149564, 752459403, 3965973031, 3268935590, 40735498, 2563907773, 1483230225, 3317316543, 83908371, 2680153252, 1594198024, 1907459465, 2970347813, 733239954, 3943577150, 3412177805, 198958881, 2439277718, 1373503546, 2137656763, 3218104599, 628085408, 3855990284, 2013776290, 3099436302, 570562233, 3803740693, 3423369108, 213261112, 2517215375, 1454621731, 3604390889, 376229701, 2362670322, 1281953886, 1658658271, 2724688243, 953729732, 4167216744, 1706088902, 2768942442, 1068828381, 4279200369, 3518719984, 285281116, 2344532203, 1258607687, 1802195444, 2882616664, 829329135, 4057260611, 3747672002, 534414190, 2238001369, 1172266101, 3624741851, 414664567, 2181625024, 1119000684, 1812370925, 2898065729, 906185462, 4139329114]\n\nenc = [0x46A95BAD,0x1CAC84B6,0xA67CB2B2,0x32188937,0x4872D39F,0xF2A2E59B,0x11B94D2]\n\nfor i in range(len(enc)):\n    for j in range(32, 127):\n        tmp = j ^ 0x79 & 0xff\n        \n        #æ›´å¥½çš„é€‰æ‹©æ˜¯ ((~box[tmp] ^ 0xB0E0E879) & 0xffffffff)ï¼Œä¸‹é¢è¿™ä¸ªæ˜¯ä¸ªæœ‰å†—ä½™çš„ä»£ç ã€‚\n        #å› ä¸ºpythonä¸­ä¼˜å…ˆçº§ï¼šå–å>ä¸>å¼‚æˆ–ï¼Œä½¿ç”¨ä¸‹é¢çš„ä»£ç æ˜¯å…ˆç®—æ‹¬å·ï¼Œç„¶åç®—åé¢çš„ä¸ï¼Œç„¶åæ‰ç®—å¼‚æˆ–çš„ã€‚\n        #ä¹Ÿå°±æ˜¯è¯´æœ€åçš„ä¸æ ¹æœ¬æ²¡èµ·ä½œç”¨ï¼Œé™åˆ¶ä¸äº†å‰é¢æ‹¬å·çš„æ•°ï¼Œå®ƒç›´æ¥å’Œ0xB0E0E879çˆ†äº†ã€‚\n        if ((~box[tmp] & 0xffffffff) ^ 0xB0E0E879 & 0xffffffff) == enc[i]:\n            print(chr(j), end='')\n            break\n```\n\nâ€‹\t\n\nâ€‹\tæœ€åä¸€æ®µï¼Œé€šè¿‡æ–­ç‚¹ï¼Œä¹Ÿå¯ä»¥å‘ç°ï¼Œæ˜¯åœ¨TLSå›è°ƒå‡½æ•°è¿™é‡Œçš„ä¸€ä¸ªçº¿ç¨‹é‡Œé¢ï¼Œå®ƒä¸€ç›´åœ¨while(1)å¾ªç¯ï¼Œç­‰å¾…å‰ä¸¤éƒ¨åˆ†éªŒè¯é€šè¿‡æ‰ä¼šè¿›å…¥è¿›å…¥ç¬¬ä¸‰éƒ¨åˆ†çš„éªŒè¯çš„ï¼Œè¿™é‡Œåº”è¯¥æ˜¯é€šè¿‡å…±äº«å…¨å±€å˜é‡æ ‡å¿—ä½å’Œifè¯­å¥æ¥å®ç°è¿™ä¸ªæ•ˆæœçš„ã€‚\n\n\n\n![image-20250613215606861](/pictures/XYCTF2025/image-20250613215606861.png)\n\n\n\nâ€‹\tä¸‹é¢ç”Ÿæˆäº†ä¸€ä¸ª128ä½çš„å¯†é’¥ï¼Œä¸€ä¸ªå¾ªç¯5ä¸€ä¸ªå¾ªç¯7ï¼Œå¯ä»¥çŒœåˆ°æ˜¯ä½¿ç”¨å‰ä¸¤æ®µflagæ¥ç”Ÿæˆå¯†é’¥å•Šã€‚ç›´æ¥æå–å°±å¯ä»¥äº†ã€‚\n\n![image-20250613220005888](/pictures/XYCTF2025/image-20250613220005888.png)\n\n![image-20250613220123411](/pictures/XYCTF2025/image-20250613220123411.png)\n\n\n\nâ€‹\tåé¢åˆåœ¨éªŒè¯æœ«å°¾æ˜¯ä¸æ˜¯}ç¬¦å·ï¼Œä¸æ˜¯å°±è¿›å…¥ifï¼Œå¤„ç†é”™è¯¯é€»è¾‘ã€‚åŒæ—¶æ ¹æ®+28è¿™ä¸ªåç§»ï¼Œæˆ‘ä»¬èƒ½å¤ŸçŒœåˆ°flagæ€»é•¿åº¦ä¸º29ä¸ªå­—èŠ‚ï¼Œå‰é¢12ä¸ªå·²ç»éªŒè¯ï¼Œåé¢å†éªŒè¯17ä¸ªå­—ç¬¦ï¼ˆåŒ…æ‹¬ç»“å°¾çš„}ï¼‰ã€‚\n\n![image-20250613220329827](/pictures/XYCTF2025/image-20250613220329827.png)\n\nâ€‹\tçœ‹åˆ°åé¢çš„åŠ å¯†å‡½æ•°å’ŒéªŒè¯ä»£ç ï¼Œv7å°±æ˜¯å¯†æ–‡ã€‚`sub_7FF65DFA1500`å‚æ•°æœ‰å¯†é’¥ã€è¾“å…¥çš„flagã€é•¿åº¦ã€è¾“å‡ºç¼“å†²åŒºã€‚\n\n![image-20250613220636641](/pictures/XYCTF2025/image-20250613220636641.png)\n\nâ€‹\té‡Œé¢åˆæœ‰ä¸€äº›å¯†é’¥æ“ä½œï¼Œç„¶ååŠ å¯†0x10000æ¬¡ï¼Œä½†æ˜¯å› ä¸ºåŠ å¯†çš„æ˜æ–‡å’Œå¯†æ–‡ä¿å­˜åœ¨ä¸¤ä¸ªä¸åŒçš„æ•°ç»„ï¼Œæ‰€ä»¥å…¶å®å’ŒåŠ å¯†ä¸€æ¬¡ä¸€æ ·ï¼Œæ¯æ¬¡éƒ½æ˜¯åŒæ ·çš„ç»“æœå†™å…¥å¯†æ–‡çš„ç¼“å†²åŒºã€‚\n\n![image-20250613220840974](/pictures/XYCTF2025/image-20250613220840974.png)\n\nâ€‹\tå­¦ä¹ å¤§ä½¬çš„WPï¼Œé‡Œé¢æ˜¯ä¸€ä¸ªIDEAåŠ å¯†ç®—æ³•ï¼Œæˆ‘æ˜¯èœé¸¡ï¼Œéƒ½æ²¡æœ‰ç¢°åˆ°è¿‡è¿™ä¸ªç®—æ³•ï¼Œå¥½å¥½å­¦å­¦ã€‚çƒ¦çš„ä¸€æ‰¹ï¼Œæ€ä¹ˆç°åœ¨è¿™ä¸ªAIè¿˜æ˜¯è¿™ä¹ˆç…ç¬”å•Šï¼Œç»™å‡ºçš„ä»£ç å…¨æ˜¯é”™çš„ï¼Œè¶Šæ”¹è¶Šå·®ï¼Œåƒåœ¾ç‹—å±AIã€‚\n\nâ€‹\tå­¦ä¹ ä¸‹å¤§ä½¬çš„ä»£ç å§ï¼Œæˆ‘ç°åœ¨è¿˜æ˜¯ä¸ä¼šå†™ä»£ç ï¼Œç®—æ³•éƒ½ä¸å¤ªèƒ½ç†è§£ï¼Œæ•°å­¦èƒ½åŠ›å¾ˆå·®äº†ï¼Œä»£ç èƒ½åŠ›ä¹Ÿå¾ˆå·®äº†ã€‚æˆ‘æ„Ÿè§‰æˆ‘è¦å»ç»ƒç®—æ³•é¢˜äº†ï¼Œå“ˆå“ˆï¼Œæœ‰æ—¶é—´ä¸€å®šå»ç»ƒå¥½å§ã€‚\n\n```c++\n#include <iostream>\n#include <bitset>\n#include <cmath>\n#include <windows.h>\n#include <algorithm>\nusing namespace std;\n\ntypedef bitset<16> code;\ntypedef bitset<128> key;\n\nbitset<16> sub_key[52];\nbitset<16> inv_sub_key[52];\n\ncode XOR(code code_1, code code_2)\n{\n    return code_1 ^ code_2;\n}\n\ncode Plus(code code_1, code code_2)\n{\n    int tmp = 0;\n    for (int i = 0; i < 16; i++)\n    {\n        tmp += code_1[i] * pow(2, i) + code_2[i] * pow(2, i);\n    }\n    tmp %= 65536;\n    return bitset<16>(tmp);\n}\n\ncode invPlus(code code_in)\n{\n    int tmp = 0;\n    for (int i = 0; i < 16; i++)\n        tmp += code_in[i] * pow(2, i);\n    tmp = 65536 - tmp;\n    return bitset<16>(tmp);\n}\n\ncode Times(code code_1, code code_2)\n{\n    long long tmp_1 = 0, tmp_2 = 0;\n    for (int i = 0; i < 16; i++)\n    {\n        tmp_1 += code_1[i] * pow(2, i);\n        tmp_2 += code_2[i] * pow(2, i);\n    }\n    if (tmp_1 == 0)\n        tmp_1 = 65536;\n    if (tmp_2 == 0)\n        tmp_2 = 65536;\n    long long tmp = (tmp_1 * tmp_2) % 65537;\n    return bitset<16>(tmp == 65536 ? 0 : tmp);\n}\n\nvoid Exgcd(int a, int b, int &x, int &y)\n{\n    if (!b)\n        x = 1, y = 0;\n    else\n        Exgcd(b, a % b, y, x), y -= a / b * x;\n}\n\ncode invTimes(code code_in)\n{\n    int tmp = 0;\n    for (int i = 0; i < 16; i++)\n        tmp += code_in[i] * pow(2, i);\n    int x, y;\n    int p = 65537;\n    Exgcd(tmp, p, x, y);\n    x = (x % p + p) % p;\n    return bitset<16>(x);\n}\n\nvoid subkeys_get(code keys_input[8])\n{\n    key keys;\n    for (int i = 0; i < 8; i++)\n        for (int j = 0; j < 16; j++)\n            keys[j + 16 * i] = keys_input[7 - i][j];\n\n    for (int i = 0; i < 8; i++)\n        for (int j = 0; j < 16; j++)\n            sub_key[i][15 - j] = keys[127 - (j + 16 * i)];\n\n    for (int i = 0; i < 5; i++)\n    {\n        key tmp_keys = keys >> 103;\n        keys = (keys << 25) | tmp_keys;\n        for (int j = (8 + 8 * i); j < (8 * (i + 2)); j++)\n            for (int k = 0; k < 16; k++)\n                sub_key[j][15 - k] = keys[127 - (k + 16 * (j - 8 - 8 * i))];\n    }\n\n    key tmp_keys = keys >> 103;\n    keys = (keys << 25) | tmp_keys;\n    for (int i = 48; i < 52; i++)\n        for (int j = 0; j < 16; j++)\n            sub_key[i][15 - j] = keys[127 - (j + 16 * (i - 48))];\n}\n\nvoid inv_subkeys_get(code sub_key[52])\n{\n    for (int i = 6; i < 48; i += 6)\n    {\n        inv_sub_key[i] = invTimes(sub_key[48 - i]);\n        inv_sub_key[i + 1] = invPlus(sub_key[50 - i]);\n        inv_sub_key[i + 2] = invPlus(sub_key[49 - i]);\n        inv_sub_key[i + 3] = invTimes(sub_key[51 - i]);\n    }\n\n    for (int i = 0; i < 48; i += 6)\n    {\n        inv_sub_key[i + 4] = sub_key[46 - i];\n        inv_sub_key[i + 5] = sub_key[47 - i];\n    }\n\n    inv_sub_key[0] = invTimes(sub_key[48]);\n    inv_sub_key[1] = invPlus(sub_key[49]);\n    inv_sub_key[2] = invPlus(sub_key[50]);\n    inv_sub_key[3] = invTimes(sub_key[51]);\n\n    inv_sub_key[48] = invTimes(sub_key[0]);\n    inv_sub_key[49] = invPlus(sub_key[1]);\n    inv_sub_key[50] = invPlus(sub_key[2]);\n    inv_sub_key[51] = invTimes(sub_key[3]);\n}\n\nbitset<64> dencrypt(bitset<64> cipher)\n{\n    bitset<16> I_1, I_2, I_3, I_4;\n    for (int i = 0; i < 16; i++)\n    {\n        I_1[15 - i] = cipher[63 - i];\n        I_2[15 - i] = cipher[47 - i];\n        I_3[15 - i] = cipher[31 - i];\n        I_4[i] = cipher[i];\n    }\n    for (int i = 0; i < 48; i += 6)\n    {\n        bitset<16> tmp_1 = Times(inv_sub_key[i], I_1);\n        bitset<16> tmp_2 = Plus(inv_sub_key[i + 1], I_2);\n        bitset<16> tmp_3 = Plus(inv_sub_key[i + 2], I_3);\n        bitset<16> tmp_4 = Times(inv_sub_key[i + 3], I_4);\n        bitset<16> tmp_5 = XOR(tmp_1, tmp_3);\n        bitset<16> tmp_6 = XOR(tmp_2, tmp_4);\n        bitset<16> tmp_7 = Times(inv_sub_key[i + 4], tmp_5);\n        bitset<16> tmp_8 = Plus(tmp_6, tmp_7);\n        bitset<16> tmp_9 = Times(tmp_8, inv_sub_key[i + 5]);\n        bitset<16> tmp_10 = Plus(tmp_7, tmp_9);\n        I_1 = XOR(tmp_1, tmp_9);\n        I_2 = XOR(tmp_3, tmp_9);\n        I_3 = XOR(tmp_2, tmp_10);\n        I_4 = XOR(tmp_4, tmp_10);\n    }\n    bitset<16> Y_1 = Times(I_1, inv_sub_key[48]);\n    bitset<16> Y_2 = Plus(I_3, inv_sub_key[49]);\n    bitset<16> Y_3 = Plus(I_2, inv_sub_key[50]);\n    bitset<16> Y_4 = Times(I_4, inv_sub_key[51]);\n\n    bitset<64> plaint;\n    for (int i = 0; i < 16; i++)\n    {\n        plaint[i] = Y_4[i];\n        plaint[i + 16] = Y_3[i];\n        plaint[i + 32] = Y_2[i];\n        plaint[i + 48] = Y_1[i];\n    }\n    return plaint;\n}\n\nint main()\n{\n    unsigned int box1[] = {\n        0x00000000, 0xC0BA6CAC, 0x5A05DF1B, 0x9ABFB3B7, 0xB40BBE36, 0x74B1D29A,\n        0xEE0E612D, 0x2EB40D81, 0xB3667A2F, 0x73DC1683, 0xE963A534, 0x29D9C998, 0x076DC419, 0xC7D7A8B5,\n        0x5D681B02, 0x9DD277AE, 0xBDBDF21D, 0x7D079EB1, 0xE7B82D06, 0x270241AA, 0x09B64C2B, 0xC90C2087,\n        0x53B39330, 0x9309FF9C, 0x0EDB8832, 0xCE61E49E, 0x54DE5729, 0x94643B85, 0xBAD03604, 0x7A6A5AA8,\n        0xE0D5E91F, 0x206F85B3, 0xA00AE279, 0x60B08ED5, 0xFA0F3D62, 0x3AB551CE, 0x14015C4F, 0xD4BB30E3,\n        0x4E048354, 0x8EBEEFF8, 0x136C9856, 0xD3D6F4FA, 0x4969474D, 0x89D32BE1, 0xA7672660, 0x67DD4ACC,\n        0xFD62F97B, 0x3DD895D7, 0x1DB71064, 0xDD0D7CC8, 0x47B2CF7F, 0x8708A3D3, 0xA9BCAE52, 0x6906C2FE,\n        0xF3B97149, 0x33031DE5, 0xAED16A4B, 0x6E6B06E7, 0xF4D4B550, 0x346ED9FC, 0x1ADAD47D, 0xDA60B8D1,\n        0x40DF0B66, 0x806567CA, 0x9B64C2B1, 0x5BDEAE1D, 0xC1611DAA, 0x01DB7106, 0x2F6F7C87, 0xEFD5102B,\n        0x756AA39C, 0xB5D0CF30, 0x2802B89E, 0xE8B8D432, 0x72076785, 0xB2BD0B29, 0x9C0906A8, 0x5CB36A04,\n        0xC60CD9B3, 0x06B6B51F, 0x26D930AC, 0xE6635C00, 0x7CDCEFB7, 0xBC66831B, 0x92D28E9A, 0x5268E236,\n        0xC8D75181, 0x086D3D2D, 0x95BF4A83, 0x5505262F, 0xCFBA9598, 0x0F00F934, 0x21B4F4B5, 0xE10E9819,\n        0x7BB12BAE, 0xBB0B4702, 0x3B6E20C8, 0xFBD44C64, 0x616BFFD3, 0xA1D1937F, 0x8F659EFE, 0x4FDFF252,\n        0xD56041E5, 0x15DA2D49, 0x88085AE7, 0x48B2364B, 0xD20D85FC, 0x12B7E950, 0x3C03E4D1, 0xFCB9887D,\n        0x66063BCA, 0xA6BC5766, 0x86D3D2D5, 0x4669BE79, 0xDCD60DCE, 0x1C6C6162, 0x32D86CE3, 0xF262004F,\n        0x68DDB3F8, 0xA867DF54, 0x35B5A8FA, 0xF50FC456, 0x6FB077E1, 0xAF0A1B4D, 0x81BE16CC, 0x41047A60,\n        0xDBBBC9D7, 0x1B01A57B, 0xEDB88321, 0x2D02EF8D, 0xB7BD5C3A, 0x77073096, 0x59B33D17, 0x990951BB,\n        0x03B6E20C, 0xC30C8EA0, 0x5EDEF90E, 0x9E6495A2, 0x04DB2615, 0xC4614AB9, 0xEAD54738, 0x2A6F2B94,\n        0xB0D09823, 0x706AF48F, 0x5005713C, 0x90BF1D90, 0x0A00AE27, 0xCABAC28B, 0xE40ECF0A, 0x24B4A3A6,\n        0xBE0B1011, 0x7EB17CBD, 0xE3630B13, 0x23D967BF, 0xB966D408, 0x79DCB8A4, 0x5768B525, 0x97D2D989,\n        0x0D6D6A3E, 0xCDD70692, 0x4DB26158, 0x8D080DF4, 0x17B7BE43, 0xD70DD2EF, 0xF9B9DF6E, 0x3903B3C2,\n        0xA3BC0075, 0x63066CD9, 0xFED41B77, 0x3E6E77DB, 0xA4D1C46C, 0x646BA8C0, 0x4ADFA541, 0x8A65C9ED,\n        0x10DA7A5A, 0xD06016F6, 0xF00F9345, 0x30B5FFE9, 0xAA0A4C5E, 0x6AB020F2, 0x44042D73, 0x84BE41DF,\n        0x1E01F268, 0xDEBB9EC4, 0x4369E96A, 0x83D385C6, 0x196C3671, 0xD9D65ADD, 0xF762575C, 0x37D83BF0,\n        0xAD678847, 0x6DDDE4EB, 0x76DC4190, 0xB6662D3C, 0x2CD99E8B, 0xEC63F227, 0xC2D7FFA6, 0x026D930A,\n        0x98D220BD, 0x58684C11, 0xC5BA3BBF, 0x05005713, 0x9FBFE4A4, 0x5F058808, 0x71B18589, 0xB10BE925,\n        0x2BB45A92, 0xEB0E363E, 0xCB61B38D, 0x0BDBDF21, 0x91646C96, 0x51DE003A, 0x7F6A0DBB, 0xBFD06117,\n        0x256FD2A0, 0xE5D5BE0C, 0x7807C9A2, 0xB8BDA50E, 0x220216B9, 0xE2B87A15, 0xCC0C7794, 0x0CB61B38,\n        0x9609A88F, 0x56B3C423, 0xD6D6A3E9, 0x166CCF45, 0x8CD37CF2, 0x4C69105E, 0x62DD1DDF, 0xA2677173,\n        0x38D8C2C4, 0xF862AE68, 0x65B0D9C6, 0xA50AB56A, 0x3FB506DD, 0xFF0F6A71, 0xD1BB67F0, 0x11010B5C,\n        0x8BBEB8EB, 0x4B04D447, 0x6B6B51F4, 0xABD13D58, 0x316E8EEF, 0xF1D4E243, 0xDF60EFC2, 0x1FDA836E,\n        0x856530D9, 0x45DF5C75, 0xD80D2BDB, 0x18B74777, 0x8208F4C0, 0x42B2986C, 0x6C0695ED, 0xACBCF941,\n        0x36034AF6, 0xF6B9265A, 0xCCCCCCCC, 0xCCCCCC00, 0x00000100, 0x00000000, 0xF6B9265A, 0xCCCCCCCC,\n        0x00000008, 0x00000000};\n\n    uint32_t enc1[]{\n        0x46A95BAD,\n        0x1CAC84B6,\n        0xA67CB2B2,\n        0x32188937,\n        0x4872D39F,\n        0xF2A2E59B,\n        0x011B94D2,\n    };\n\n    // çˆ†ç ´å‰7å­—èŠ‚\n    for (int i = 0; i < 7; i++)\n    {\n        for (int c = 28; c < 132; c++)\n        {\n            if ((~box1[(uint8_t)c ^ 0x79] ^ 0xB0E0E879) == enc1[i])\n            {\n                printf(\"%c\", c);\n                break;\n            }\n        }\n    }\n\n    // å16å­—èŠ‚è¿›è¡ŒIDEAè§£å¯†\n    unsigned char enc2[16] = {\n        0x5C, 0x2F, 0xD0, 0xEC, 0x82, 0x0E, 0x67, 0x57,\n        0x6A, 0x9F, 0x91, 0xF6, 0x95, 0xA4, 0xAC, 0x90};\n    // unsigned int key[4] = {\n    //     0x42B2986C, 0x12345678, 0x0D6D6A3E, 0x89ABCDEF};\n    unsigned int key[4] = {\n        0x6C98B242, 0x78563412, 0x3E6A6D0D, 0xEFCDAB89};\n\n    code keys_input[8];\n    for (int i = 0; i < 4; i++)\n    {\n        keys_input[2 * i + 1] = key[i] & 0xFFFF;\n        keys_input[2 * i] = (key[i] >> 16) & 0xFFFF;\n    }\n\n    unsigned char result[16];\n    bitset<64> cipher1, cipher2;\n    for (int i = 0; i < 8; i++)\n    {\n        for (int j = 0; j < 8; j++)\n        {\n            cipher1[63 - (i * 8 + j)] = (enc2[i] >> (7 - j)) & 1;\n            cipher2[63 - (i * 8 + j)] = (enc2[i + 8] >> (7 - j)) & 1;\n        }\n    }\n    subkeys_get(keys_input);\n    inv_subkeys_get(sub_key);\n\n    bitset<64> plain1 = dencrypt(cipher1);\n    bitset<64> plain2 = dencrypt(cipher2);\n\n    uint64_t plain1_val = plain1.to_ullong();\n    uint64_t plain2_val = plain2.to_ullong();\n\n    uint8_t dec2[16]{};\n    memcpy(dec2, &plain2_val, 8);\n    memcpy(dec2 + 8, &plain1_val, 8);\n    reverse(dec2, dec2 + 16);\n\n    printf(\"%.16s\\n\", dec2);\n    return 0;\n}\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n# ezVMï¼ˆé™„ä»¶chalï¼‰\n\n\n\nâ€‹\tæ— å£³64ä½ELFç¨‹åºï¼Œç¨‹åºæœ‰å¼‚å¸¸ï¼ŒIDAåˆ†æè›®ä¹…æ‰ç»“æŸã€‚\n\nâ€‹\tæ ¹æ®å­—ç¬¦ä¸²å¼•ç”¨æ‰¾åˆ°ä¸»é€»è¾‘ï¼Œå…ˆè¿›è¡Œé•¿åº¦æ¯”å¯¹ï¼Œç„¶ååŠ å¯†ï¼Œæœ€åcheckï¼Œå¯†æ–‡åœ¨`unk_1639E40`å¤„ã€‚\n\n![image-20250614130136465](/pictures/XYCTF2025/image-20250614130136465.png)\n\nâ€‹\té‡Œé¢çš„å‡½æ•°å‘¢ï¼Œå°±ç®—äº†ï¼Œåˆæ˜¯å¤ªæ— è¯­çš„ä»£ç ï¼Œä¸€å †åƒåœ¾ï¼Œçœ‹ä¸æ¸…æ¥šä¸€ç‚¹ã€‚å­¦ä¹ WPï¼Œåæ­£æ˜¯å­¦æ–°ä¸œè¥¿ã€‚\n\n\n\n### å¤ç°livå¤§ä½¬çš„WP\n\n\n\nâ€‹\tå­¦ä¹ çŸ¥é“è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨**unicorn**æ¡†æ¶æ‰§è¡Œè™šæ‹Ÿä»£ç çš„ç¨‹åºï¼Œæˆ‘ä»¬è¦ä½¿ç”¨**bindiff**æ¥æ¢å¤ä¸€äº›è¢«ä¸¢å¼ƒçš„å‡½æ•°ç¬¦å·ä¿¡æ¯ã€‚å…·ä½“æ“ä½œå°±æ˜¯ï¼Œå…ˆæåˆ°å¯¹åº”æ¶æ„çš„åŠ¨æ€åº“æ–‡ä»¶ï¼ˆWindowså°±æ˜¯dllæ–‡ä»¶ï¼‰ï¼Œç„¶åé€šè¿‡**bindiff**å¯ä»¥è¿›è¡Œå‡½æ•°çº§åˆ«çš„æ¯”è¾ƒï¼Œè¿™ä¼šå¸®åŠ©ä½ **è¯†åˆ«ç›®æ ‡ç¨‹åºä¸­å“ªäº›å‡½æ•°æ˜¯ Unicorn çš„å®ç°**ï¼Œå¹¶å¯ä»¥**å¯¼å…¥å‡½æ•°å**ã€‚\n\nâ€‹\tä½†æ˜¯åŠ¨æ€åº“æ–‡ä»¶éœ€è¦è‡ªå·±ç¼–è¯‘å•Šï¼Œå¾ˆéš¾æ‰¾åˆ°ç°æˆçš„ã€‚åˆæ‰“æ¶ˆäº†æˆ‘çš„ç§¯ææ€§å•Šã€‚\n\n\n\n------\n\nâ€‹\tåœ¨Ubuntu24è™šæ‹Ÿæœºä¸­å®‰è£…Unicornæ¡†æ¶ï¼Œå»ºè®®æ–¹å¼ï¼š\n\n- ä½¿ç”¨**python3-venv**è™šæ‹Ÿç¯å¢ƒï¼Œåœ¨å…¶ä¸­ä½¿ç”¨`pip install unicorn`ç›´æ¥ä¸‹è½½ã€‚ä¹‹åå¯ä»¥é€šè¿‡`from unicorn import *`ã€ `from unicorn.x86_const import *`çš„æ–¹å¼å¯¼å…¥æ¨¡å—ï¼Œä¸ç†Ÿæ‚‰çš„åŒå­¦å¯ä»¥é€šè¿‡`help(unicorn)`æŸ¥çœ‹å…¶æ¨¡å—ä¿¡æ¯ã€‚\n\n```python\n# unicorn_example.py\nfrom unicorn import *\nfrom unicorn.x86_const import *\n\n# åˆ›å»ºä¸€ä¸ª Unicorn å¼•æ“\nuc = Uc(UC_ARCH_X86, UC_MODE_64)\n\n# ä¸ºç¨‹åºåˆ†é…å†…å­˜ï¼ˆè¿™é‡Œé€‰æ‹©äº†0x1000åœ°å€èµ·å§‹çš„å†…å­˜åŒºï¼‰\nuc.mem_map(0x1000, 2 * 1024 * 1024)\n\n# å‘å†…å­˜å†™å…¥ä»£ç ï¼ˆç®€å•çš„æ±‡ç¼–ä»£ç ï¼‰\ncode = b\"\\x48\\x31\\xc0\"  # x86_64 æ±‡ç¼–ï¼šxor rax, rax\nuc.mem_write(0x1000, code)\n\n# è®¾ç½®ç¨‹åºçš„èµ·å§‹åœ°å€\nuc.reg_write(UC_X86_REG_RIP, 0x1000)\n\n# æ‰§è¡Œæ¨¡æ‹Ÿï¼ˆæœ€å¤šæ‰§è¡Œ 1 æ­¥ï¼‰\nuc.emu_start(0x1000, 0x1000 + len(code))\n\n# è·å–å¹¶è¾“å‡ºç»“æœï¼ˆæ­¤å¤„æˆ‘ä»¬æŸ¥è¯¢ RAX å¯„å­˜å™¨çš„å€¼ï¼‰\nresult = uc.reg_read(UC_X86_REG_RAX)\nprint(f\"RAX = {result}\")\n```\n\n\n\n- å¦‚æœæœ‰ç½‘è”é€šgithubï¼Œå¯ä»¥é€šè¿‡`git clone https://github.com/unicorn-engine/unicorn.git`å‘½ä»¤æ‹‰å–é¢„ç¼–è¯‘æ–‡ä»¶ï¼Œç„¶å`cd unicorn`ã€`mkdir build`ã€`cd build`ã€`cmake ..`ã€`make`ï¼Œç¼–è¯‘å¥½äº†ä¹‹åï¼Œ å¯ä»¥ç¼–å†™cppæ–‡ä»¶äº†ï¼Œç¼–å†™å®Œåï¼Œé€šè¿‡g++ç¼–è¯‘é“¾æ¥å‡ºå¯æ‰§è¡Œç¨‹åºã€‚å‘½ä»¤ç¤ºä¾‹å¦‚ä¸‹ï¼š`g++ -o unicorn_test /home/ubuntu/æ¡Œé¢/unicorn_test.cpp     -I/home/ubuntu/æ¡Œé¢/unicorn/include     -L/home/ubuntu/æ¡Œé¢/unicorn/build     -lunicorn`ã€‚æœ‰å¯èƒ½ä¼šæŠ¥é”™æ‰¾ä¸åˆ°å…±äº«åº“æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤`export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/home/ubuntu/æ¡Œé¢/unicorn/build`ï¼Œå…¶ä¸­çš„è·¯å¾„è‡ªè¡Œä¿®æ”¹ã€‚\n\n```c++\n#include <iostream>\n#include <unicorn/unicorn.h>\n\n#define ADDRESS 0x1000000  // èµ·å§‹åœ°å€\n\nint main() {\n    uc_engine *uc;\n    uc_err err;\n\n    // åˆå§‹åŒ– Unicorn æ¨¡æ‹Ÿå™¨\n    err = uc_open(UC_ARCH_X86, UC_MODE_64, &uc);\n    if (err != UC_ERR_OK) {\n        std::cerr << \"Failed to initialize Unicorn engine!\" << std::endl;\n        return -1;\n    }\n\n    // æ˜ å°„ 2MB çš„å†…å­˜åŒºåŸŸï¼Œè®¾ç½®å¯è¯»ã€å¯å†™ã€å¯æ‰§è¡Œæƒé™\n    err = uc_mem_map(uc, ADDRESS, 2 * 1024 * 1024, UC_PROT_READ | UC_PROT_WRITE | UC_PROT_EXEC);\n    if (err != UC_ERR_OK) {\n        std::cerr << \"Failed to map memory!\" << std::endl;\n        return -1;\n    }\n\n    // å°†ä¸€æ®µç®€å•çš„æœºå™¨ç å†™å…¥å†…å­˜ï¼ˆå¦‚ `int 0x80` ä¸­æ–­æŒ‡ä»¤ï¼‰\n    uint8_t code[] = { 0xCD, 0x80 }; // x86 ä¸­æ–­æŒ‡ä»¤\n    err = uc_mem_write(uc, ADDRESS, code, sizeof(code));\n    if (err != UC_ERR_OK) {\n        std::cerr << \"Failed to write code to memory!\" << std::endl;\n        return -1;\n    }\n\n    // æ‰§è¡Œè¯¥æ®µä»£ç \n    err = uc_emu_start(uc, ADDRESS, ADDRESS + sizeof(code), 0, 0); // æ·»åŠ timeoutå’Œcount\n    if (err != UC_ERR_OK) {\n        std::cerr << \"Failed to start emulation!\" << std::endl;\n        return -1;\n    }\n\n    // é‡Šæ”¾ Unicorn å¼•æ“\n    uc_close(uc);\n\n    std::cout << \"Emulation completed successfully!\" << std::endl;\n    return 0;\n}\n\n```\n\n------\n\nâ€‹\tå…¶å®ï¼Œåœ¨unicornç¼–è¯‘åï¼Œåœ¨buildç›®å½•ä¸‹é¢æœ‰å¾ˆå¤šæ¶æ„çš„ç¤ºä¾‹æ–‡ä»¶ï¼Œå¦‚sample_x86ã€sample_arm64ç­‰ç­‰ï¼Œå¦‚æœåªæ˜¯æ¢å¤ç¬¦å·çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨è¿™äº›ä¾‹å­ï¼Œä¸éœ€è¦è‡ªå·±ç äº†ã€‚ä½†æ˜¯ï¼Œåœ¨æˆ‘çš„ç¯å¢ƒä¸‹ç¼–è¯‘å‡ºæ¥çš„ELFç¨‹åºè¿›è¡Œbindiffï¼Œå®Œå…¨æ¯”å¯¹ä¸ä¸Šï¼Œæ¢å¤ä¸äº†å¯¹åº”çš„å‡½æ•°åã€‚å°±å…ˆè¿™æ ·å§ï¼Œç›´æ¥æŠ„å¤§ä½¬æ¢å¤çš„ç¬¦å·å§ã€‚\n\nâ€‹\t\n\n\n\nâ€‹\tç„¶åå°†ä»¥ä¸Šè°ƒç”¨writeå†™å…¥çš„æ•°æ®æå–ï¼ˆ5ä¸ªå…¨éƒ¨æå–ï¼‰ï¼Œéšä¾¿æ‰¾ä¸€ä¸ªARM64æ¡†æ¶ï¼ˆ**å› ä¸ºæ ¹æ®åç¼–è¯‘ä»£ç çœ‹å‡ºæ¥æ˜¯ä½¿ç”¨unicornæ¨¡æ‹Ÿæ‰§è¡ŒARM64çš„æŒ‡ä»¤**ï¼‰çš„.soï¼ˆ**å®‰å“appç¨‹åºéƒ½æœ‰è¿™ç§ARM64çš„soç¨‹åº**ï¼‰å¤åˆ¶åˆ°å¯¹åº”åœ°å€ï¼Œä»¥ä¾¿åç¼–è¯‘çœ‹ä»£ç ã€‚\n\n![image-20250627220457369](/pictures/XYCTF2025/image-20250627220457369.png)\n\nâ€‹\tokï¼Œå†™å…¥è¿™ä¸ªå››ä¸ªæ•°æ®åï¼Œå°±å¯ä»¥åç¼–è¯‘å‡ºæ¥äº†ã€‚æ³¨æ„ï¼Œdata_2æ˜¯ä¼šé‡æ–°è¦†ç›–Code_Armä¸­çš„ï¼Œå¿…é¡»è¦†ç›–æ‰é‚£ä¸€éƒ¨åˆ†ã€‚æˆ‘ä¹Ÿæ˜¯ç»ˆäºçœ‹åˆ°è¿™ä¸ªå‡½æ•°äº†ï¼ï¼ˆ**è¿˜æ˜¯æœ‰ä¸ªé—®é¢˜ï¼Œæˆ‘çš„MEMORY[]åœ°å€å’Œå¤§ä½¬çš„è¿˜ä¸ä¸€æ ·ï¼Œæ˜¯å“ªé‡Œé”™äº†å—ï¼Ÿ**ï¼‰\n\nâ€‹\tå¤§ä½¬è¯´è¿™æ˜¯è™šæ‹Ÿæœºæ‰§è¡Œå‡½æ•°ï¼Œæœ€åè¿˜æ˜¯é€šè¿‡hookæ¨¡æ‹Ÿæ‰§è¡Œï¼Œçœ‹æ±‡ç¼–åˆ†æé€»è¾‘ã€‚\n\n![image-20250627220713636](/pictures/XYCTF2025/image-20250627220713636.png)\n\nâ€‹\tåœ¨Hookæ¨¡æ‹Ÿæ—¶ï¼Œç”±äºåœ¨ubuntuç³»ç»Ÿä¸‹ï¼Œ æˆ‘å°æ”¹äº†ä¸€ä¸‹ç¨‹åºï¼Œä¿®æ”¹äº†ä¸€ä¸‹windows.hçš„æ›¿ä»£ï¼Œç»“æœç¼–è¯‘å‡ºæ¥å°±æ­»å¾ªç¯äº†ğŸ˜¥ã€‚çœŸéš¾å—ã€‚æ”¹Windowsçš„python-unicornï¼Œè¿˜æ˜¯æ­»å¾ªç¯ï¼Œå¼€åœ¨å¯åŠ¨æ¨¡æ‹Ÿçš„è¾“å‡ºå°±æ²¡äº†ï¼Œå¸Œæœ›å“ªä¸ªå¸ˆå‚…èƒ½å¤ŸæŒ‡ç‚¹ä¸€ä¸‹ã€‚\n\nâ€‹\tç»è¿‡é‡æ–°å°è¯•ï¼Œæˆ‘å°†codeçš„å­—èŠ‚ä¿å­˜åˆ°äº†ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œç„¶ååœ¨ç¨‹åºä¸­è¯»å–ï¼Œè¿™æ ·å°±èƒ½å¤Ÿæ­£å¸¸è·‘äº†ã€‚å¥½ç„å­¦ï¼Œæ˜¯ä¸æ˜¯è¿™ç§æ–‡æœ¬å¤ªé•¿äº†ï¼Œ**Typora**ä¿å­˜å‡ºé”™å•Šï¼Œè¿˜æ˜¯é£æ°´é—®é¢˜ï¼Œè¿™ä¸ªå–æ•°æ®çš„æ“ä½œï¼Œæˆ‘é‡å¤äº†è‡³å°‘äº”æ¬¡ï¼\n\nâ€‹\tä¹Ÿæœ‰å¯èƒ½æ˜¯**010Editor**çš„é—®é¢˜ï¼Œå¤§é‡å­—èŠ‚æ•°æ®å¤åˆ¶ç²˜è´´æ—¶å°±ç»™æˆ‘å¼ºè¡Œæ¢æˆæ–‡æœ¬æ¨¡å¼ï¼Œéå¾—å…ˆä¿å­˜äºŒè¿›åˆ¶æ•°æ®åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œç„¶åå†é€šè¿‡â€œæ–‡ä»¶æ’å…¥â€åŠŸèƒ½ï¼ŒæŠŠå­—èŠ‚æ•°æ®æ”¾è¿›å»ã€‚\n\nâ€‹\tä¸‹é¢çš„ç»ˆäºèƒ½è·‘äº†ï¼\n\n```python\n#demo_2\nData1 = [0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x06,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x05,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x05,0x00,0x00,0x00,0x50,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xe4,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xe4,0xff,0xff,0xff,0x04,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xd8,0xff,0xff,0xff,0x02,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xe4,0xff,0xff,0xff,0x02,0x00,0x00,0x00,0x06,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x05,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xe4,0xff,0xff,0xff,0x01,0x00,0x00,0x00,0x09,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x0a,0x00,0x00,0x00,0x29,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xe4,0xff,0xff,0xff,0x03,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xd8,0xff,0xff,0xff,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xd4,0xff,0xff,0xff,0x02,0x00,0x00,0x00,0x09,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xd4,0xff,0xff,0xff,0x20,0x00,0x00,0x00,0x0f,0x00,0x00,0x00,0x5b,0x00,0x00,0x00,0x11,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xe0,0xff,0xff,0xff,0x03,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xb0,0xff,0xff,0xff,0x53,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xb1,0xff,0xff,0xff,0x68,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xb2,0xff,0xff,0xff,0x6f,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xb3,0xff,0xff,0xff,0x77,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xb4,0xff,0xff,0xff,0x6d,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xb5,0xff,0xff,0xff,0x61,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xb6,0xff,0xff,0xff,0x6b,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xb7,0xff,0xff,0xff,0x65,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xb8,0xff,0xff,0xff,0x72,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xb9,0xff,0xff,0xff,0x5f,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xba,0xff,0xff,0xff,0x6d,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xbb,0xff,0xff,0xff,0x61,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xbc,0xff,0xff,0xff,0x64,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xbd,0xff,0xff,0xff,0x65,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xbe,0xff,0xff,0xff,0x69,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xbf,0xff,0xff,0xff,0x74,0x00,0x00,0x00,0x06,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xb0,0xff,0xff,0xff,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xf4,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x07,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xd0,0xff,0xff,0xff,0x19,0x19,0xa0,0xa0,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x12,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xf4,0xff,0xff,0xff,0x02,0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xcc,0xff,0xff,0xff,0x02,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xf4,0xff,0xff,0xff,0x02,0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xc8,0xff,0xff,0xff,0x02,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xf4,0xff,0xff,0xff,0x02,0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xc4,0xff,0xff,0xff,0x02,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x12,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xf4,0xff,0xff,0xff,0x02,0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xc0,0xff,0xff,0xff,0x03,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x07,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xf8,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x0c,0x00,0x00,0x00,0x37,0x01,0x00,0x00,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xf8,0xff,0xff,0xff,0x04,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xf8,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x09,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xf8,0xff,0xff,0xff,0x08,0x00,0x00,0x00,0x13,0x00,0x00,0x00,0x68,0x02,0x00,0x00,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xf8,0xff,0xff,0xff,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xe0,0xff,0xff,0xff,0x02,0x00,0x00,0x00,0x09,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xec,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xf8,0xff,0xff,0xff,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xe0,0xff,0xff,0xff,0x02,0x00,0x00,0x00,0x0a,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xe8,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x07,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xf0,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x07,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xdc,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x0c,0x00,0x00,0x00,0x83,0x01,0x00,0x00,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xdc,0xff,0xff,0xff,0x04,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xdc,0xff,0xff,0xff,0x02,0x00,0x00,0x00,0x09,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xdc,0xff,0xff,0xff,0x48,0x00,0x00,0x00,0x14,0x00,0x00,0x00,0x3b,0x02,0x00,0x00,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xe8,0xff,0xff,0xff,0x07,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x05,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xe8,0xff,0xff,0xff,0x08,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x06,0x00,0x00,0x00,0x05,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xe8,0xff,0xff,0xff,0x05,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x44,0x33,0x22,0x11,0x04,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xf0,0xff,0xff,0xff,0x0d,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xf4,0xff,0xff,0xff,0x02,0x00,0x00,0x00,0x09,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xf0,0xff,0xff,0xff,0x05,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x12,0x12,0xab,0xab,0x05,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xec,0xff,0xff,0xff,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xec,0xff,0xff,0xff,0x03,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xf0,0xff,0xff,0xff,0x03,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xd0,0xff,0xff,0xff,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xf0,0xff,0xff,0xff,0x03,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xec,0xff,0xff,0xff,0x07,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xec,0xff,0xff,0xff,0x08,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x00,0x00,0x00,0x05,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xec,0xff,0xff,0xff,0x05,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x88,0x77,0x66,0x55,0x04,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xf0,0xff,0xff,0xff,0x07,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0b,0x00,0x00,0x00,0x0d,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xf4,0xff,0xff,0xff,0x02,0x00,0x00,0x00,0x09,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xf0,0xff,0xff,0xff,0x05,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x66,0x55,0x23,0x23,0x05,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xe8,0xff,0xff,0xff,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xe8,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x0c,0x00,0x00,0x00,0x75,0x01,0x00,0x00,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xf8,0xff,0xff,0xff,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xe0,0xff,0xff,0xff,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xec,0xff,0xff,0xff,0x02,0x00,0x00,0x00,0x0b,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xf8,0xff,0xff,0xff,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xe0,0xff,0xff,0xff,0x02,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0xe8,0xff,0xff,0xff,0x02,0x00,0x00,0x00,0x0c,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x0c,0x00,0x00,0x00,0x29,0x01,0x00,0x00,0x02,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x05,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00]\nData2 = [0x00,0x00,0x00,0x00,0x81,0x08,0x00,0x00,0x4d,0x00,0x00,0x00,0x07,0x04,0x00,0x00,0x14,0x03,0x00,0x00,0x7c,0x04,0x00,0x00,0x29,0x07,0x00,0x00,0x97,0x07,0x00,0x00,0x0b,0x08,0x00,0x00,0xdd,0x05,0x00,0x00,0xa5,0x06,0x00,0x00,0x7f,0x08,0x00,0x00,0xe5,0x06,0x00,0x00,0x68,0x05,0x00,0x00,0x7f,0x08,0x00,0x00,0xc5,0x06,0x00,0x00,0x11,0x07,0x00,0x00,0x24,0x07,0x00,0x00,0x60,0x07,0x00,0x00,0xf3,0x06,0x00,0x00,0x8a,0x06,0x00,0x00]\nData3 = [0x28,0x4a,0x1,0,0,0,0,0]\n```\n\n```python\nfrom unicorn import *\nfrom unicorn.arm64_const import *\nimport demo_2\n\nBase = 0x1000000\nStack = 0x7F0000\nInputAddr = 0x14C28\nInput = b'XYCTF{fun_un1c0rn_with_4rm64_VM}'\n\n\ndef hook_code(uc, address, size, user_data):\n    if address == 0x1FAC:\n        w1 = uc.reg_read(UC_ARM64_REG_W1)\n        w0 = uc.reg_read(UC_ARM64_REG_W0)\n        print(f\"W3 = W1 ^ W0 --- {w1:#x} ^ {w0:#x} = {w1 ^ w0:#x}\")\n    elif address == 0x2054:\n        w3 = uc.reg_read(UC_ARM64_REG_W3)\n        w0 = uc.reg_read(UC_ARM64_REG_W0)\n        print(f\"W2 = W0 ^ W3 --- {w0:#x} ^ {w3:#x} = {w3 ^ w0:#x}\")\n    elif address == 0x2180:\n        w1 = uc.reg_read(UC_ARM64_REG_W1)\n        w4 = uc.reg_read(UC_ARM64_REG_W4)\n        print(f\"W1 = W1 ^ W4 --- {w1:#x} ^ {w4:#x} = {w1 ^ w4:#x}\")\n    elif address == 0x2238:\n        w3 = uc.reg_read(UC_ARM64_REG_W3)\n        w0 = uc.reg_read(UC_ARM64_REG_W0)\n        print(f\"W2 = W0 ^ W3 --- {w0:#x} ^ {w3:#x} = {w3 ^ w0:#x}\")\n    elif address == 0x2BE4:\n        w1 = uc.reg_read(UC_ARM64_REG_W1)\n        w0 = uc.reg_read(UC_ARM64_REG_W0)\n        print(f\"W3 = W1 >> W0 --- {w1:#x} >> {w0:#x} = {(w1 >> w0):#x}\")\n    elif address == 0x2CD4:\n        w1 = uc.reg_read(UC_ARM64_REG_W1)\n        w0 = uc.reg_read(UC_ARM64_REG_W0)\n        print(f\"W2 = W1 >> W0 --- {w1:#x} >> {w0:#x} = {(w1 >> w0):#x}\")\n    elif address == 0x2EA4:\n        w1 = uc.reg_read(UC_ARM64_REG_W1)\n        w0 = uc.reg_read(UC_ARM64_REG_W0)\n        print(f\"W2 = W1 << W0 --- {w1:#x} << {w0:#x} = {(w1 << w0):#x}\")\n    elif address == 0x2DB4:\n        w1 = uc.reg_read(UC_ARM64_REG_W1)\n        w0 = uc.reg_read(UC_ARM64_REG_W0)\n        print(f\"W2 = W1 << W0 --- {w1:#x} << {w0:#x} = {(w1 << w0):#x}\")\n    elif address == 0x232C:\n        w3 = uc.reg_read(UC_ARM64_REG_W3)\n        w0 = uc.reg_read(UC_ARM64_REG_W0)\n        print(f\"W2 = W0 & W3 --- {w0:#x} & {w3:#x} = {w0 & w3:#x}\")\n    elif address ==0x241C:\n        w1 = uc.reg_read(UC_ARM64_REG_W1)\n        w0 = uc.reg_read(UC_ARM64_REG_W0)\n        print(f\"W2 = W0 & W1 --- {w0:#x} & {w1:#x} = {w0 & w1:#x}\")\n    elif address == 0x1CC4:\n        w0 = uc.reg_read(UC_ARM64_REG_W0)\n        w1 = uc.reg_read(UC_ARM64_REG_W1)\n        print(f\"W2 = W1 + W0 --- {w1:#x} + {w0:#x} = {w1 + w0:#x}\")\n    elif address == 0x1A0C:\n        w0 = uc.reg_read(UC_ARM64_REG_W0)\n        w1 = uc.reg_read(UC_ARM64_REG_W1)\n        print(f\"W2 = W1 + W0 --- {w1:#x} + {w0:#x} = {w1 + w0:#x}\")\n    elif address == 0x1AB4:\n        w0 = uc.reg_read(UC_ARM64_REG_W0)\n        w3 = uc.reg_read(UC_ARM64_REG_W3)\n        print(f\"W2 = W0 + W3 --- {w0:#x} + {w3:#x} = {w0 + w3:#x}\")\n    elif address == 0x1BE0:\n        w1 = uc.reg_read(UC_ARM64_REG_W1)\n        w4 = uc.reg_read(UC_ARM64_REG_W4)\n        print(f\"W1 = W1 + W4 --- {w1:#x} + {w4:#x} = {w1 + w4:#x}\")\n    elif address == 0x1E98:\n        w0 = uc.reg_read(UC_ARM64_REG_W0)\n        w1 = uc.reg_read(UC_ARM64_REG_W1)\n        print(f\"W2 = W1 - W0 --- {w1:#x} - {w0:#x} = {w1 - w0:#x}\")\n    elif address == 0x1DA8:\n        w0 = uc.reg_read(UC_ARM64_REG_W0)\n        w3 = uc.reg_read(UC_ARM64_REG_W3)\n        print(f\"W2 = W0 - W3 --- {w0:#x} - {w3:#x} = {w0 - w3:#x}\")\n\n        \ndef main():\n    try:\n        with open('code', 'rb') as f:\n            Code = f.read()\n        Data1 = bytes(demo_2.Data1)\n        Data2 = bytes(demo_2.Data2)\n        Data3 = bytes(demo_2.Data3)\n        mu = Uc(UC_ARCH_ARM64, UC_MODE_ARM)  # æ¶æ„+æ¨¡å¼\n\n        #æ˜ å°„å†…å­˜\n        mu.mem_map(0,Base,UC_PROT_ALL)\n        #mu.mem_map(Stack-4096,0x4000,UC_PROT_ALL)\n\n        mu.hook_add(UC_HOOK_CODE, hook_code)\n\n        mu.mem_write(InputAddr,Input)\n        mu.mem_write(0xC70,Code)\n        mu.mem_write(0x14010,Data1)\n        mu.mem_write(0x30F0,Data2)\n        mu.mem_write(0x149E8,Data3)\n\n        mu.reg_write(UC_ARM64_REG_X0, InputAddr)\n        mu.reg_write(UC_ARM64_REG_SP, Stack)\n\n        mu.emu_start(0x0C70,0x2EF4)\n\n        result = mu.mem_read(InputAddr,48)\n        for i in range(32):\n            print(f\"{result[i]:02x} \", end='')\n        print()\n    except UcError as e:\n        print(\"Unicorn error: %s\" % e)\n\nif __name__ == '__main__':\n    main()\n```\n\nâ€‹\tç°åœ¨çš„é—®é¢˜è¿˜æœ‰ä¸¤ä¸ªï¼šä¸€å°±æ˜¯è¿™ä¸ª**å…³é”®è®¡ç®—åœ°å€ç©¶ç«Ÿæ˜¯æ€ä¹ˆç­›é€‰å‡ºæ¥çš„**ï¼Œè¿˜æœ‰å…¶ä»–çš„è®¡ç®—å¤„æ²¡æœ‰æ·»åŠ è¿›å»å•Šï¼Ÿå…¶äºŒå°±æ˜¯çœ‹è¾“å‡ºçš„**è®¡ç®—è¿‡ç¨‹åˆ†æåŠ å¯†ç®—æ³•**äº†ã€‚\n\nâ€‹\tä¹Ÿæ²¡æœ‰äººèƒ½å›ç­”ï¼Œæˆ‘çŒœå°±æ˜¯éšä¾¿æŒ‘äº†ä¸€äº›è®¡ç®—å‡ºæ¥ï¼Œæ‡’å¾—å…¨å†™ã€‚ä¸Šé¢æˆ‘å·²ç»è¡¥å…¨äº†æ‰€æœ‰çš„è®¡ç®—æŒ‡ä»¤åœ°å€ï¼Œæ›´ç¾å‘³çš„äº«å—å§ã€‚\n\nâ€‹\téšä¾¿çœ‹çœ‹è¿™ä¸ªè®¡ç®—è¿‡ç¨‹ï¼Œå¾ˆæ˜æ˜¾æ˜¯æœ‰è§„å¾‹çš„ï¼Œå¾ˆåƒæ˜¯ä¸ªå¾ªç¯ï¼Œå¾ªç¯å¤šå°‘è½®å‘¢ï¼Œè€å®æ•°å§ã€‚\n\n![image-20250704183341268](/pictures/XYCTF2025/image-20250704183341268.png)\n\nâ€‹\tå…ˆä»æœ€åŸºç¡€çš„ä¸€è½®å¼€å§‹çœ‹èµ·ï¼Œå¯ä»¥å…ˆçœ‹ä¸¤è½®ï¼Œç¡®å®šå…¶ä¸­çš„å¸¸æ•°é¡¹ï¼Œç„¶åç”±å‚æ•°å¼€å§‹é€æ¸å®šä¹‰å˜é‡æ¥è¿˜åŸè®¡ç®—è¿‡ç¨‹ï¼Œå¹¶ä¸”å¤šæ¬¡éªŒè¯ã€‚å”¯ä¸€çš„ç¼ºç‚¹å°±æ˜¯ï¼Œè½®æ•°å¤ªğŸ”å„¿å¤šï¼Œè®©äººæœ›è€Œç”Ÿç•ï¼Œä¸æ˜¯æœ‰flagçš„è¯±æƒ‘ï¼Œè°å¹²è¿™ä¹ˆè‹¦é€¼çš„æ´»ï¼Œå½“ç„¶æˆ‘ä»¬REâœŒæ˜¯ä¸ä¼šè¿™ä¹ˆåƒäºçš„ï¼Œæ¯ä¸€è½®çš„é•¿åº¦æ˜¯22è¡Œï¼ŒåŠ ä¸Šè®¡æ•°çš„ä¸€è¡Œï¼Œæˆ‘ä»¬å¯ä»¥å¤åˆ¶åˆ°å¦ä¸€ä¸ªå¼ºå¤§çš„æ–‡æœ¬ç¼–è¾‘å™¨å»å¿«é€Ÿè®¡ç®—è½®æ•°ã€‚\n\nâ€‹\tçœ‹è§„å¾‹çš„ä¸œè¥¿è¿˜æ˜¯å¤ªé¸¡å„¿ä¸çˆ½äº†ï¼Œå¤ªæŠ˜ç£¨æ²¡æœ‰è€å¿ƒçš„æˆ‘å•Šã€‚\n\n```python\nW3 = W1 >> W0 --- 0x75667b46 >> 0x5 = 0x3ab33da\t\t\t\t\t#v1 >> 5\nW2 = W1 << W0 --- 0x75667b46 << 0x6 = 0x1d599ed180\t\t\t\t#v1 << 6\nW3 = W1 ^ W0 --- 0x3ab33da ^ 0x599ed180 = 0x5a35e25a \t\t\t#(v1>>5) ^ (v1 << 6 & 0xfffffffff)\nW2 = W0 ^ W3 --- 0x75667b46 ^ 0x11223344 = 0x64444802\t\t\t#v1 ^ key0\nW2 = W1 + W0 --- 0x5a35e25a + 0x64444802 = 0xbe7a2a5c\t\t\t#t1 = ((v1>>5) ^ ...) + (v1 ^ key0)\nW2 = W0 & W3 --- 0x0 & 0x3 = 0x0\t\t\t\t\t\t\t\nW2 = W1 + W0 --- 0x776f6853 + 0x0 = 0x776f6853\t\t\t\t\nW2 = W0 ^ W3 --- 0x776f6853 ^ 0xabab1212 = 0xdcc47a41\t\t\t#t2\nW3 = W1 ^ W0 --- 0xbe7a2a5c ^ 0xdcc47a41 = 0x62be501d\t\t\t#t1 ^ t2\nW2 = W1 + W0 --- 0x62be501d + 0x54435958 = 0xb701a975\t\t\t#v0 = t2 + ?\nW2 = W1 - W0 --- 0x0 - 0xa0a01919 = -0xa0a01919\t\t\t\t\t#sum-=delta ,  =0x5f5fe6e7\nW3 = W1 >> W0 --- 0xb701a975 >> 0x4 = 0xb701a97\t\t\t\t\nW2 = W1 << W0 --- 0xb701a975 << 0x7 = 0x5b80d4ba80\nW3 = W1 ^ W0 --- 0xb701a97 ^ 0x80d4ba80 = 0x8ba4a017\t\t\t#t3 = (v0>>4)+(v0<<7)\nW2 = W0 ^ W3 --- 0xb701a975 ^ 0x55667788 = 0xe267defd\t\t\t#t4 = v0^key1\nW2 = W1 + W0 --- 0x8ba4a017 + 0xe267defd = 0x16e0c7f14\t\t\t#t3 + (v0^key1)\nW3 = W1 >> W0 --- 0x5f5fe6e7 >> 0xb = 0xbebfc\t\t\t\t\t#sum>>11\nW2 = W0 & W3 --- 0xbebfc & 0x3 = 0x0\t\t\t\t\t\t\t#(sum>>11)&3\nW2 = W1 + W0 --- 0x776f6853 + 0x5f5fe6e7 = 0xd6cf4f3a\t\t\t\nW2 = W0 ^ W3 --- 0xd6cf4f3a ^ 0x23235566 = 0xf5ec1a5c\t\t\t#t2\nW3 = W1 ^ W0 --- 0xf5ec1a5c ^ 0x6e0c7f14 = 0x9be06548 \t\t\t#t5 = t2^(t3 + (v0^key1))\nW2 = W1 + W0 --- 0x9be06548 + 0x75667b46 = 0x11146e08e\t\t\t#v1= t5 + v1\nW2 = W0 + W3 --- 0x0 + 0x1 = 0x1\t\t\t\t\t\t\t#-------------------------------------è®¡æ•°ï¼Œåˆ†è§£çº¿\nW3 = W1 >> W0 --- 0x1146e08e >> 0x5 = 0x8a3704 \t\t\t\t\t#v1>>5\nW2 = W1 << W0 --- 0x1146e08e << 0x6 = 0x451b82380\nW3 = W1 ^ W0 --- 0x8a3704 ^ 0x51b82380 = 0x51321484\nW2 = W0 ^ W3 --- 0x1146e08e ^ 0x11223344 = 0x64d3ca\nW2 = W1 + W0 --- 0x51321484 + 0x64d3ca = 0x5196e84e\nW2 = W0 & W3 --- 0x5f5fe6e7 & 0x3 = 0x3\nW2 = W1 + W0 --- 0x74696564 + 0x5f5fe6e7 = 0xd3c94c4b\nW2 = W0 ^ W3 --- 0xd3c94c4b ^ 0xabab1212 = 0x78625e59\nW3 = W1 ^ W0 --- 0x5196e84e ^ 0x78625e59 = 0x29f4b617\nW2 = W1 + W0 --- 0x29f4b617 + 0xb701a975 = 0xe0f65f8c\nW2 = W1 - W0 --- 0x5f5fe6e7 - 0xa0a01919 = -0x41403232\nW3 = W1 >> W0 --- 0xe0f65f8c >> 0x4 = 0xe0f65f8\nW2 = W1 << W0 --- 0xe0f65f8c << 0x7 = 0x707b2fc600\nW3 = W1 ^ W0 --- 0xe0f65f8 ^ 0x7b2fc600 = 0x7520a3f8\nW2 = W0 ^ W3 --- 0xe0f65f8c ^ 0x55667788 = 0xb5902804\nW2 = W1 + W0 --- 0x7520a3f8 + 0xb5902804 = 0x12ab0cbfc\nW3 = W1 >> W0 --- 0xbebfcdce >> 0xb = 0x17d7f9\nW2 = W0 & W3 --- 0x17d7f9 & 0x3 = 0x1\nW2 = W1 + W0 --- 0x656b616d + 0xbebfcdce = 0x1242b2f3b\nW2 = W0 ^ W3 --- 0x242b2f3b ^ 0x23235566 = 0x7087a5d\nW3 = W1 ^ W0 --- 0x7087a5d ^ 0x2ab0cbfc = 0x2db8b1a1\nW2 = W1 + W0 --- 0x2db8b1a1 + 0x1146e08e = 0x3eff922f\nW2 = W0 + W3 --- 0x1 + 0x1 = 0x2 \t\t\t\t\t\t#-------------------------------------è®¡æ•°ï¼Œåˆ†è§£çº¿\nW3 = W1 >> W0 --- 0x3eff922f >> 0x5 = 0x1f7fc91\nW2 = W1 << W0 --- 0x3eff922f << 0x6 = 0xfbfe48bc0\n```\n\nâ€‹\tå¤§ä½¬æ€»ç»“å‡ºæ¥äº†åŠ å¯†ä»£ç ã€‚\n\n```c\nvoid encipher(uint32_t v[2], const uint32_t key[4])\n{\n    unsigned int i;\n    uint32_t v0 = v[0], v1 = v[1], sum = 0, delta = 0x5f5fe6e7;\n    for (i = 0; i < 72; i++)\n    {\n        auto tmp = (((v1 << 6) ^ (v1 >> 5)) + (v1 ^ 0x11223344));\n        auto tmp2 = (((key[sum & 3] + sum) ^ 0xabab1212) ^ tmp);\n        v0 += tmp2;\n        sum += delta;\n        auto tmp3 = (((v0 << 7) ^ (v0 >> 4)) + (v0 ^ 0x55667788));\n        auto tmp4 = ((key[(sum >> 11) & 3] + sum) ^ 0x23235566 ^ tmp3);\n        v1 += tmp4;\n    }\n    v[0] = v0;\n    v[1] = v1;\n}\n```\n\nâ€‹\tç„¶åå†™è§£å¯†è„šæœ¬å³å¯ã€‚\n\n\n\n\n\n\n\n\n\n# EzObf\n\nâ€‹\tè¿™ç§é€†å‘é¢˜å°±æ˜¯ç¬¬ä¸€æ¬¡æ²¡å¤´ç»ªï¼Œå°±å®Œå…¨ä¸æƒ³åšäº†ã€‚ã€‚\n\n### å¤ç°WP\n\nâ€‹\té¦–å…ˆç†Ÿæ‚‰ä¸€ä¸‹ä¸ç†Ÿæ‚‰çš„æ±‡ç¼–æŒ‡ä»¤ã€‚\n\n> **pushfq**\n>\n> **ä½œç”¨**ï¼šå°† **RFLAGSï¼ˆ64ä½ï¼‰/EFLAGSï¼ˆ32ä½ï¼‰å¯„å­˜å™¨çš„å€¼å‹å…¥æ ˆä¸­**ã€‚\n>\n> **ç”¨é€”**ï¼šä¿å­˜å½“å‰çš„æ ‡å¿—å¯„å­˜å™¨çŠ¶æ€ï¼Œå¸¸ç”¨äºå‡½æ•°è°ƒç”¨å‰ä¿å­˜çŠ¶æ€ï¼Œæˆ–è€…å¤„ç†ä¸­æ–­ã€ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶ä¿æŠ¤æ ‡å¿—å¯„å­˜å™¨ã€‚\n>\n> \n>\n> **popfq**å°±æ˜¯å¯¹åº”æ¢å¤çš„æŒ‡ä»¤ã€‚\n>\n> **call    $+5** å…¶ä¸­$ä»£è¡¨å½“å‰æŒ‡ä»¤çš„åœ°å€ï¼Œä½œç”¨å°±æ˜¯ï¼šè·³è½¬åˆ°å½“å‰æŒ‡ä»¤åœ°å€å¾€å5å­—èŠ‚å¤„æ‰§è¡Œä»£ç ï¼ŒåŒæ—¶æŠŠè¿”å›åœ°å€å‹å…¥æ ˆã€‚\n>\n> **rol**æŒ‡ä»¤æ˜¯å¾ªç¯å·¦ç§»ã€‚\n\n\n\nâ€‹\tå¯ä»¥çœ‹åˆ°pushfqå’Œpopfqæ˜¯å¯¹ç§°çš„ï¼Œç­‰ä»·äºéƒ½ä¸èµ·ä½œç”¨ã€‚pushå’Œpopä¹Ÿæ˜¯å¯¹ç§°çš„ï¼Œä¹Ÿå¯ä»¥nopæ‰ï¼ŒçœŸå®æœ‰æ•ˆæ‰§è¡ŒæŒ‡ä»¤åªæœ‰ä¸€æ¡ã€‚\n\n![image-20250628142121006](/pictures/XYCTF2025/image-20250628142121006.png)\n\nâ€‹\tåŸç†æ¯”è¾ƒæ¸…æ™°äº†ï¼Œçœ‹åˆ°å¤§æ‰‹å­å¸ˆå‚…ç»™çš„IDCè„šæœ¬ï¼Œç›´æ¥è‡ªåŠ¨åŒ–nopæ‰å¹¶ä¸”è®¡ç®—å‡ºæ–°çš„è·³è½¬æŒ‡ä»¤ï¼Œtqlï¼**Ïˆ(ï½€âˆ‡Â´)Ïˆ**\n\n![image-20250628144934914](/pictures/XYCTF2025/image-20250628144934914.png)\n\nâ€‹\tè‡ªå·±å†æ‰‹åŠ¨nopæ‰ä¸Šé¢çš„å‡ è¡Œpushï¼Œç„¶å**apply patches to input files**ï¼Œä¸ä¿å­˜**i64**æ–‡ä»¶ï¼Œé‡æ–°å¯¼å…¥IDAåˆ†æï¼ŒF5å°±èƒ½åç¼–è¯‘å‡ºæ¥äº†ã€‚å¸ˆå‚…å¤ªå¼ºäº†ï¼Œè†œæ‹œï¼\n\nâ€‹\tå¥½å¥½å­¦ä¹ æ¬£èµä¸€ä¸‹å¸ˆå‚…çš„IDCè„šæœ¬ï¼Œå…¶å®åé¢çœŸå®æ±‡ç¼–æ··æ·†çš„æ ¼å¼éƒ½ä¸€æ ·ï¼Œåªæœ‰ç¬¬ä¸€ä¸ªç‰¹æ®Šä¸€ç‚¹ï¼Œéœ€è¦æ‰‹åŠ¨patchæ‰ä¸€éƒ¨åˆ†ã€‚ä¸‹æ¬¡ç¢°åˆ°å°±å¯ä»¥è¾¹ç ”ç©¶è¾¹æ¨¡ä»¿å†™äº†ã€‚\n\n```cpp\n//ä»addrå¼€å§‹nopæ‰é•¿åº¦ä¸ºlengthä¸ªå­—èŠ‚\nstatic NopCode(Addr, Length)\n{\n    auto i;\n    for (i = 0; i < Length; i++)\n    {\n        PatchByte(Addr + i, 0x90);\n    }\n}\n\n//è®¡ç®—å¾ªç¯ç§»ä½\nstatic rol(value, count, bits = 32)\n{\n    count = count % bits;\n    return ((value << count) | (value >> (bits - count))) & ((1 << bits) - 1);\n}\n\n// æœç´¢çœŸå®æ±‡ç¼–ä»£ç çš„ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€\nstatic FindEnd(Addr)\n{\n    auto i;\n    for (i = 0; i < 0x90; i++)\n    {\n        auto v = Dword(Addr + i);\n        if (v == 0x5153509C)\n        {\n            return Addr + i;\n        }\n    }\n    return 0;\n}\n\n// æœç´¢æœ€åçš„jmp raxæŒ‡ä»¤\nstatic FindJmpRax(Addr)\n{\n    auto i;\n    for (i = 0; i < 0x90; i++)\n    {\n        auto v = Word(Addr + i);\n        if (v == 0xE0FF)\n        {\n            return Addr + i;\n        }\n    }\n    return 0;\n}\n\n// æœç´¢call $+5\nstatic FindCall(Addr)\n{\n    auto i;\n    for (i = 0; i < 0x90; i++)\n    {\n        auto v = Dword(Addr + i);\n        if (v == 0xE8)\n        {\n            return Addr + i;\n        }\n    }\n    return 0;\n}\n\nstatic main()\n{\n    auto StartAddr = 0x1401F400D;\n    while (1)\n    {\n        // æœç´¢çœŸå®æ±‡ç¼–ä»£ç çš„ä¸‹ä¸€ä¸ªæŒ‡ä»¤åœ°å€\n        auto EndAddr = FindEnd(StartAddr);\n        if (EndAddr == 0)\n        {\n            break;\n        }\n        // çœŸå®æ±‡ç¼–ä»£ç çš„å­—èŠ‚é•¿åº¦\n        auto CodeLength = EndAddr - StartAddr - 13;\n        // æœç´¢Call $+5\n        auto CallAddr = FindCall(StartAddr + 13 + CodeLength);\n        if (CallAddr == 0)\n        {\n            break;\n        }\n        // call $+5çš„ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€ï¼Œå³callæ—¶pushåˆ°æ ˆçš„è¿”å›åœ°å€\n        auto CalcAddr = CallAddr + 5;\n        auto ebx = Dword(CalcAddr + 2);\n        auto rol_Value = Byte(CalcAddr + 8);\n        auto Mode = Dword(CalcAddr + 9);\n        ebx = rol(ebx, rol_Value);\n\n        // æœç´¢æœ€å°¾éƒ¨çš„jmp raxæŒ‡ä»¤åœ°å€\n        auto JmpRaxAddr = FindJmpRax(StartAddr);\n        if (JmpRaxAddr == 0)\n        {\n            break;\n        }\n        // ç¬¬ä¸€éƒ¨åˆ†åƒåœ¾æŒ‡ä»¤é•¿åº¦\n        auto TrushCodeLength_1 = CallAddr - (StartAddr + 13 + CodeLength);\n        // ç¬¬äºŒéƒ¨åˆ†åƒåœ¾æŒ‡ä»¤é•¿åº¦\n        auto TrushCodeLength_2 = JmpRaxAddr - CallAddr + 2;\n        // Nopæ‰æ— ç”¨çš„æ‰€æœ‰ä»£ç \n        \n        NopCode(StartAddr, 13);\n       \n        NopCode(StartAddr + 13 + CodeLength, TrushCodeLength_1);\n        \n        NopCode(CallAddr, TrushCodeLength_2);\n        // ä¸€å…±ä¸¤ç§åœ°å€è®¡ç®—ï¼ŒåŠ å’Œå‡\n        if (Mode == 0xffC32B48)\n        {\n            CalcAddr = CalcAddr - ebx;\n        }\n        if (Mode == 0xffC30348)\n        {\n            CalcAddr = CalcAddr + ebx;\n        }\n        auto JmpCodeAddr = EndAddr;\n        // è®¡ç®—ç›¸å¯¹è·³è½¬åœ°å€\n        auto JmpOffset = CalcAddr - JmpCodeAddr + 5;\n        // å†™å…¥jmpæŒ‡ä»¤\n        PatchByte(JmpCodeAddr, 0xE9);\n        PatchDword(JmpCodeAddr + 1, JmpOffset);\n        // jmpçš„åœ°å€ä¸ºä¸‹ä¸€æ¬¡deobfèµ·å§‹åœ°å€\n        StartAddr = CalcAddr;\n    }\n}\n```\n\nâ€‹\tä¸‹é¢ç¬¬næ¬¡é‡æ–°å­¦ä¹ xxteaç®—æ³•ï¼ŒğŸ½ï¼Œè¿Ÿæ—©æˆ‘è¦å‡ºä¸€ç¯‡ç®—æ³•çš„ä¸“æ ï¼Œæ”¶é›†åˆ°è¾ƒä¸°å¯Œçš„pythonè„šæœ¬ï¼Œä»¥åç›´æ¥æ¢­å“ˆï¼\n\n```c\n//æ ‡å‡†åŠ è§£å¯†ä»£ç \n#include <stdio.h>\n#include <stdint.h>\n#define DELTA 0x9e3779b9\n#define MX (((z>>5^y<<2) + (y>>3^z<<4)) ^ ((sum^y) + (key[(p&3)^e] ^ z)))\n \nvoid btea(uint32_t *v, int n, uint32_t const key[4])\n{\n    uint32_t y, z, sum;\n    unsigned p, rounds, e;\n    if (n > 1)            /* Coding Part */\n    {\n        rounds = 6 + 52/n;\n        sum = 0;\n        z = v[n-1];\n        do\n        {\n            sum += DELTA;\n            e = (sum >> 2) & 3;\n            for (p=0; p<n-1; p++)\n            {\n                y = v[p+1];\n                z = v[p] += MX;\n            }\n            y = v[0];\n            z = v[n-1] += MX;\n        }\n        while (--rounds);\n    }\n    else if (n < -1)      /* Decoding Part */\n    {\n        n = -n;\n        rounds = 6 + 52/n;\n        sum = rounds*DELTA;\n        y = v[0];\n        do\n        {\n            e = (sum >> 2) & 3;\n            for (p=n-1; p>0; p--)\n            {\n                z = v[p-1];\n                y = v[p] -= MX;\n            }\n            z = v[n-1];\n            y = v[0] -= MX;\n            sum -= DELTA;\n        }\n        while (--rounds);\n    }\n}\n \n \nint main()\n{\n    uint32_t v[2]= {1,2};\n    uint32_t const k[4]= {2,2,3,4};\n    int n= 2; //nçš„ç»å¯¹å€¼è¡¨ç¤ºvçš„é•¿åº¦ï¼Œå–æ­£è¡¨ç¤ºåŠ å¯†ï¼Œå–è´Ÿè¡¨ç¤ºè§£å¯†\n    // vä¸ºè¦åŠ å¯†çš„æ•°æ®æ˜¯ä¸¤ä¸ª32ä½æ— ç¬¦å·æ•´æ•°\n    // kä¸ºåŠ å¯†è§£å¯†å¯†é’¥ï¼Œä¸º4ä¸ª32ä½æ— ç¬¦å·æ•´æ•°ï¼Œå³å¯†é’¥é•¿åº¦ä¸º128ä½\n    printf(\"åŠ å¯†å‰åŸå§‹æ•°æ®ï¼š%u %u\\n\",v[0],v[1]);\n    btea(v, n, k);\n    printf(\"åŠ å¯†åçš„æ•°æ®ï¼š%u %u\\n\",v[0],v[1]);\n    btea(v, -n, k);\n    printf(\"è§£å¯†åçš„æ•°æ®ï¼š%u %u\\n\",v[0],v[1]);\n    return 0;\n}\n```\n\nâ€‹\tåç¼–è¯‘çš„ä»£ç ï¼Œéœ€è¦ä»”ç»†çœ‹ï¼Œä¸€è¡Œè¡Œåˆ†æã€‚\n\n```c\nint __fastcall main_0(int argc, const char **argv, const char **envp)\n{\n  __int64 i; // rcx\n  int result; // eax\n  _DWORD *v5; // rdi\n  HANDLE CurrentProcess; // rax\n  __int64 v7; // [rsp-20h] [rbp-468h] BYREF\n  _DWORD v8[2]; // [rsp+0h] [rbp-448h] BYREF\n  _BYTE v9[64]; // [rsp+8h] [rbp-440h] BYREF\n  _BYTE *v10; // [rsp+48h] [rbp-400h]\n  unsigned int v11; // [rsp+64h] [rbp-3E4h]\n  int v12; // [rsp+84h] [rbp-3C4h]\n  unsigned int v13; // [rsp+A4h] [rbp-3A4h]\n  int v14; // [rsp+C4h] [rbp-384h]\n  int v15; // [rsp+E4h] [rbp-364h]\n  unsigned int k; // [rsp+104h] [rbp-344h]\n  int v17; // [rsp+124h] [rbp-324h]\n  int v18; // [rsp+144h] [rbp-304h]\n  int v19; // [rsp+164h] [rbp-2E4h]\n  _DWORD v20[11]; // [rsp+188h] [rbp-2C0h] BYREF\n  unsigned __int16 v21; // [rsp+1B4h] [rbp-294h]\n  BOOL v22; // [rsp+1D4h] [rbp-274h] BYREF\n  unsigned __int64 j; // [rsp+1F8h] [rbp-250h]\n  unsigned __int64 v24; // [rsp+218h] [rbp-230h]\n  _DWORD v25[16]; // [rsp+238h] [rbp-210h]\n  unsigned __int64 m; // [rsp+278h] [rbp-1D0h]\n  int v27; // [rsp+404h] [rbp-44h]\n  unsigned int v28; // [rsp+408h] [rbp-40h]\n  int v29; // [rsp+40Ch] [rbp-3Ch]\n  __int64 v30; // [rsp+410h] [rbp-38h]\n  int v31; // [rsp+418h] [rbp-30h]\n  unsigned __int64 v32; // [rsp+420h] [rbp-28h]\n\n  v5 = v8;\n  for ( i = 174LL; i; --i )\n    *v5++ = 0xCCCCCCCC;\n  v32 = (unsigned __int64)v8 ^ 0x1401D9000LL;\n  j___CheckForDebuggerJustMyCode(0x1401ED101LL);\n  memset(v9, 0, 0x20uLL);\n  sub_140087C02(0x1401A1190LL);\n  if ( !IsDebuggerPresent() )\n  {\n    sub_1400868E3();\n    v10 = v9;\n    memset(v20, 0, 0x10uLL);\n    v21 = 8;\n    v27 = 8;\n    v18 = 12;\n    v13 = 0;\n    v14 = 0x61C88646;\n    v19 = 0x95664B48;\n    v17 = 7;\t\t\t\t\t\t//å¾ªç¯è½®æ•°æ”¹ä¸ºäº†7\n    v22 = 0;\n    CurrentProcess = GetCurrentProcess();\n    CheckRemoteDebuggerPresent(CurrentProcess, &v22);\n    if ( !v22 )\n    {\n      j_srand(0xAABBu);\n      for ( j = 0LL; j < 4; ++j )\n        v20[j] = j_rand();\t\t\t\t//å¯†é’¥æ˜¯128ä½ï¼Œ4*32\n      while ( 1 )\n      {\n        v27 = v17--;\n        v28 = v27 != 0;\n        if ( !v28 )\n          break;\n        v13 += v14;\t\t\t\t\t\t//deltaæ˜¯v14ï¼Œsumæ˜¯v13\n        v15 = (v13 >> 2) & 3;\t\t\t//å‚æ•°e\n        for ( k = 0; k < v21; ++k )\t\t//å¯¹åº”çš„æ˜¯æ˜æ–‡é•¿åº¦ï¼Œæ˜æ–‡æ¯32ä½ä¸ºä¸€ä¸ªå…ƒç´ ï¼Œä¸»è¦å°±æ˜¯è®¡ç®—MXçš„è¿‡ç¨‹\n        {\n          v24 = __rdtsc();\t\t\t//è·å–CPUçš„æ—¶é—´æˆ³è®¡æ•°\n          v11 = *(_DWORD *)&v10[4 * ((k + 1) % v21)];\t\t//å–åˆ°v[p+1]\n          v27 = (4 * v11) ^ (*(_DWORD *)&v10[4 * ((k + v21 - 1) % v21)] >> 5);\t//v[p+1]<<2 ^ v[p-1]>>5\n          v28 = k + v21 - 1;\t\t\t\t\t//p-1\n          v29 = ((16 * *(_DWORD *)&v10[4 * (v28 % v21)]) ^ (v11 >> 3)) + v27;\t//v[p-1]<<4 ^ v[p+1]>>3 + v27\n          v30 = ((unsigned __int8)v15 ^ (unsigned __int8)k) & 3;\t\t//(e^p)&3 \n            //key[(p&3)^e] ^  v[p-1]    +   (sum^v[p+1])   + v[p]\n          v31 = (((*(_DWORD *)&v10[4 * (v28 % v21)] ^ v20[v30]) + (v11 ^ v13)) ^ v29) + *(_DWORD *)&v10[4 * k];\n          *(_DWORD *)&v10[4 * k] = v31;\t//v[p] = ...\n          v12 = v31;\n          if ( __rdtsc() - v24 > 0x83C0 )\t\t//åŸºäºæ—¶é—´çš„åè°ƒè¯•\n            goto LABEL_21;\n        }\n      }\n      v25[0] = 0xA9934E2F;\n      v25[1] = 0x30B90FA;\n      v25[2] = 0xDCBF1D3;\n      v25[3] = 0x328B5BDE;\n      v25[4] = 0x44FAB4E;\n      v25[5] = 0x1DCF0051;\n      v25[6] = 0x85EBBE55;\n      v25[7] = 0x93AA773A;\n      for ( m = 0LL; m < 4; ++m )\n      {\n        if ( v25[m] != v8[m + 2] )\t\t//éªŒè¯flag\n        {\n          sub_140087C02(0x1401A11A8LL);\n          j_system(byte_1401A11A0);\n          goto LABEL_21;\n        }\n      }\n      sub_140087C02(0x1401A11C0LL);\n      j_system(byte_1401A11A0);\n    }\n  }\nLABEL_21:\n  j__RTC_CheckStackVars(&v7, (_RTC_framedesc *)&unk_1401A1140);\n  j___security_check_cookie((unsigned __int64)v8 ^ v32);\n  return result;\n}\n```\n\nâ€‹\tæ”¹å‚æ•°çš„xxTeaï¼ŒåŠ è§£å¯†é€»è¾‘ä¸€æ ·ã€‚\n\n```c++\n//å¤§ä½¬çš„è§£å¯†è„šæœ¬\n#include <iostream>\n#define DELTA 0x61C88646\n#define MX (((z >> 5 ^ y << 2) + (y >> 3 ^ z << 4)) ^ ((sum ^ y) + (key[(p & 3) ^ e] ^ z)))\n\nvoid xxtea(uint32_t *v, int n, uint32_t const key[4])\n{\n    uint32_t y, z, sum;\n    unsigned p, rounds, e;\n    if (n > 1) /* Coding Part */\n    {\n        rounds = 7;\n        sum = 0;\n        z = v[n - 1];\n        do\n        {\n            sum += DELTA;\n            e = (sum >> 2) & 3;\n            for (p = 0; p < n - 1; p++)\n            {\n                y = v[p + 1];\n                z = v[p] += MX;\n                if (z == 0xA4F41487)\n                    printf(\"11\\n\");\n                if (y == 0xA4F41487)\n                    printf(\"11\\n\");\n            }\n            y = v[0];\n            z = v[n - 1] += MX;\n\n        } while (--rounds);\n    }\n    else if (n < -1) /* Decoding Part */\n    {\n        n = -n;\n        rounds = 7;\n        sum = rounds * DELTA;\n        y = v[0];\n        do\n        {\n            e = (sum >> 2) & 3;\n            for (p = n - 1; p > 0; p--)\n            {\n                z = v[p - 1];\n                y = v[p] -= MX;\n            }\n            z = v[n - 1];\n            y = v[0] -= MX;\n            sum -= DELTA;\n        } while (--rounds);\n    }\n}\n\nint main()\n{\n    srand(0xAABB);\n    uint32_t key[4]{};\n    uint32_t Enc[]{\n        0xa9934e2f, 0x30b90fa, 0xdcbf1d3, 0x328b5bde,\n        0x44fab4e, 0x1dcf0051, 0x85ebbe55, 0x93aa773a};\n\n    for (int i = 0; i < 4; i++)\n    {\n        key[i] = rand();\n    }\n    xxtea(Enc, -8, key);\n    printf(\"%.32s\\n\", Enc);\n    return 0;\n}\n\n```\n\n\n\n\n\n\n\n\n\n\n\n# Summer\n\n### å¤ç°WP\n\nâ€‹\tHaskellè¯­è¨€ç¼–å†™ï¼Œä¸çœ‹äº†ï¼Œå»æ‰¾å¤§ä½¬çš„WPå­¦ä¹ å§ï¼Œå¤ªé›·äººäº†ï¼Œæˆ‘è¦å¿«ç‚¹ç»“æŸè¿™ä¸€partã€‚ç»å…¸é¢˜ä»¥åå†åšä¹Ÿæ²¡äº‹ï¼Œç°åœ¨å°±å¸å–ä¸€ä¸‹ç»éªŒã€‚\n\n\n\n\n\n\n\n\n\n\n\n# MDriverï¼ˆæ— è§£ï¼Œæˆ‘ä¹Ÿä¸çœ‹äº†ï¼‰\n","tags":["å¤ç°WP","Reverse"],"categories":["CTF"]},{"title":"DSBCTF2024","url":"/2025/06/29/DSBCTF2024/DSBCTF/","content":"\n# DSBCTFå•èº«æ¯\n\nâ€‹\t[å®˜æ–¹WP](https://ctf-show.feishu.cn/docx/R6udd58bxoQGQMxFphncZq8rn5e)\n\n## easyRE\n\nâ€‹\t`jar`ç¨‹åºï¼Œç¬¬ä¸€æ¬¡è§åˆ°ï¼Œå¥½å¥½å­¦ä¹ ä¸€ä¸‹ã€‚[æœ‰ä¸ªå…¥é—¨æ–‡ç« ](https://www.skfwe.cn/p/%E9%80%86%E5%90%91-jar-e.g-dvt/)ï¼Œçœ‹çœ‹ã€‚\n\nâ€‹\tç¬¬ä¸€æ­¥ä½¿ç”¨JD-GUIæ‰“å¼€jarç¨‹åºï¼Œçœ‹åˆ°Applicationç±»ï¼Œé‡Œé¢æœ‰ä¸ªé•¿æ®µçš„base64ï¼Œè§£ç å¾—åˆ°ç¨‹åºä¸»è¦é€»è¾‘å‡½æ•°ã€‚\n\n![image-20250612163448413](/pictures/DSBCTF2024/image-20250612163448413.png)\n\n```java\nimport javax.crypto.Cipher;\nimport javax.crypto.spec.SecretKeySpec;\nimport java.nio.charset.StandardCharsets;\nimport java.security.SecureRandom;\nimport java.util.*;\n\npublic class D8yDSBCTF {\n\n    private static final String P3WSSK = \"AES/ECB/PKCS5Padding\";\n    private static final String C89SYS__ = \"abcdefghijklmnopqrstuvwxyz\";\n    private static final String C7yyfggl = C89SYS__.toUpperCase();\n    private static final String N9SSCRT = \"0123456789\";\n    private static final String D9UUSACR = C89SYS__ + C7yyfggl + N9SSCRT;\n    private static SecureRandom rf3ffc = new SecureRandom();\n    public  void start() throws Exception {\n        String key =  b3f7a__0x337f2a(a98fac77f__3c2a(1<<4)).get(1);\n        String e3yfbbglsk = b3f7a__0x337f2a(a98fac77f__3c2a(1<<4)).get(0);\n        Scanner scanner = new Scanner(System.in);\n        System.out.println(\"please input password:\");\n        String i3clscwyt = scanner.nextLine();\n        if (e3c7go_to(i3clscwyt,key).equals(e3yfbbglsk)) {\n            System.out.println(\"Login Successful\");\n        } else {\n            System.out.println(\"Login Failed\");\n        }\n    }\n    private  List<String> b3f7a__0x337f2a(String a783c_7fxf__) {\n        final String f37xcrxedrd_ = \"jvjeTQVGcDGPgFeC+E90Pz6wYzjcBK49YDx2W+6YFTjk/wma7Oa5J3O2ns8OptbxyNgIvYJf/J4BRJOat0LY2A==\";\n        StringBuilder c0fybbg = new StringBuilder();\n        List<String> l2crsys = new ArrayList<String>();\n        char[] f117xc = f37xcrxedrd_.toCharArray();\n        for (char c : f117xc) {\n            c0fybbg.append((char)(((c >>> 4 ^ (c << 4) ^ (c >>> 4))) >> 4));\n        }\n        l2crsys.add(c0fybbg.substring(0,c0fybbg.length()-24));\n        l2crsys.add(c0fybbg.substring(l2crsys.get(0).length(),c0fybbg.length()));\n        return l2crsys;\n    }\n    public  String a98fac77f__3c2a(int length) {\n        if (length < 1) throw new IllegalArgumentException(\"Length must be positive\");\n\n        StringBuilder s7cyscrs = new StringBuilder(length);\n        for (int i = 0; i < length; i++) {\n            int randomIndex = rf3ffc.nextInt(D9UUSACR.length());\n            s7cyscrs.append(D9UUSACR.charAt(randomIndex));\n        }\n        return s7cyscrs.toString();\n    }\n    public  String e3c7go_to(String coysc21k, String k89csbbv) throws Exception {\n        while (k89csbbv.getBytes(StandardCharsets.UTF_8).length < 16) {\n            k89csbbv += k89csbbv;\n        }\n        byte[] keyBytes = k89csbbv.substring(0, 16).getBytes(StandardCharsets.UTF_8);\n        SecretKeySpec s88vfy = new SecretKeySpec(keyBytes, \"AES\");\n        Cipher c1ppy = Cipher.getInstance(P3WSSK);\n        c1ppy.init(Cipher.ENCRYPT_MODE, s88vfy);\n        byte[] encryptedBytes = c1ppy.doFinal(coysc21k.getBytes(StandardCharsets.UTF_8));\n        return Base64.getEncoder().encodeToString(encryptedBytes);\n    }\n}\n```\n\nâ€‹\tå¹¸å¥½å­¦è¿‡ä¸€ç‚¹ç‚¹JAVAè¯­æ³•ï¼Œå¹¶ä¸”æœ‰Chatgptçš„è¾…åŠ©ï¼Œæˆ‘å¾ˆé¡ºåˆ©çš„ç†è§£äº†å‡½æ•°é€»è¾‘ã€‚`a98fac77f__3c2a`æ˜¯ç”ŸæˆæŒ‡å®šé•¿åº¦çš„éšæœºå­—ç¬¦ä¸²ï¼Œå­—ç¬¦è¡¨å°±æ˜¯`D9UUSACR`ï¼›`b3f7a__0x337f2a`å°±æ˜¯å¯¹`f37xcrxedrd_`å­—ç¬¦ä¸²è¿›è¡Œåˆ†å‰²ï¼Œåé¢24ä½ä¸ºæ•°ç»„ç¬¬äºŒä¸ªå…ƒç´ ï¼Œå‰é¢çš„å­—ç¬¦ä¸²ä¸ºæ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä¹Ÿå°±æ˜¯å¯†æ–‡ï¼›`e3c7go_to`åŠ å¯†æ–¹å¼å°±æ˜¯å°†keyå–å‰16ä½ï¼Œç„¶åå¯¹è¾“å…¥è¿›è¡ŒAESåŠ å¯†ï¼Œå¯¹åº”æ¨¡å¼å¦‚`P3WSSK`ï¼Œæœ€åè½¬base64è¡¨ç¤ºã€‚\n\nâ€‹\tæ‰€ä»¥å’Œéšæœºæ•°ä¸€ç‚¹å…³ç³»æ²¡æœ‰ï¼Œåªæ˜¯ä¸ªè¿·æƒ‘é¡¹ï¼Œèµ›åšå¨å­ä¸€æŠŠæ¢­ã€‚\n\n![image-20250612171208129](/pictures/DSBCTF2024/image-20250612171208129.png)\n\n\n\n\n\n\n\n\n\n\n\n## é€å•èº«çš„è‡ªå·±ä¸€æŸï¼ˆ64æœµï¼‰èŠ±\n\nâ€‹\tç†Ÿæ‚‰çš„exeé»‘æ¡†æ¡†ç¨‹åºï¼Œå›½é™…æƒ¯ä¾‹å…ˆæŸ¥å£³ï¼Œæ— å£³ç™½èŒ¶ã€‚**(ã‚âˆ€ï½¥)**\n\nâ€‹\tç¨‹åºè¡¨é¢çœ‹ä¸Šå»æ¯”è¾ƒç®€å•ï¼Œå¾ˆå®¹æ˜“è¿½è¸ªåˆ°ä¸»è¦é€»è¾‘ï¼Œä½†æ˜¯å°±æ˜¯åŠ å¯†è¿‡ç¨‹çœ‹çš„å¾ˆéš¾å—ï¼Œå‡½æ•°é‡Œé¢å¥—å¥½å‡ ä¸ªå‡½æ•°ï¼Œè¿˜éƒ½æ²¡æœ‰æ­£ç»åç§°ï¼ŒåŠŸèƒ½åˆ†æå¤ªéº»çƒ¦äº†ã€‚**(â•¥ï¹â•¥)**\n\nâ€‹\tå¤ªéš¾äº†ï¼ŒåŠ¨è°ƒéƒ½çœ‹ä¸å‡ºæ¥ï¼ŒçœŸçš„æ˜¯æ— è¯­ä½äº†ã€‚æˆ‘å¥½åƒä¸å¤ªé€‚åˆå¤©å¤©åšé¢˜äº†ï¼Œéƒ½åšä¸å‡ºæ¥ï¼Œå®Œå…¨éƒ½æ²¡æ€è·¯ï¼Œå’Œæˆ‘çš„èƒ½åŠ›éƒ½ä¸åœ¨ä¸€ä¸ªæ°´å¹³ä¸Šå•Šã€‚\n\nâ€‹\t\n\n\n\nâ€‹\tè¿˜æ˜¯æ…¢æ…¢æ¥å§ï¼Œæˆ‘å®šäº†ä¸€ä¸ªç­–ç•¥ï¼šç¢°åˆ°ä¸€ä¸ªé¢˜åï¼Œå¦‚æœæ˜¯æ–°é¢˜å‹ï¼ˆæ–°è¯­è¨€æˆ–è€…æ˜¯æ–°æŠ€æœ¯ï¼‰ï¼Œä¸€å®šå°½é‡è‡ªå·±å…ˆå†™ä¸€ä¸ªdemoå‡ºæ¥çœ‹ä¸€çœ‹ç†Ÿæ‚‰ä¸€ä¸‹å…¶é€†å‘ï¼Œç„¶åä¼šäº‹åŠåŠŸå€ã€‚\n\n\n\nâ€‹\tçœ‹åˆ°checké‡Œé¢çš„é•¿åº¦æ¯”è¾ƒï¼Œå¯†æ–‡é•¿åº¦æ˜¯**0x38**ï¼Œè€Œä¸”æˆ‘ä»¬è¾“å…¥å­—ç¬¦ä¸²é•¿åº¦39ä¸ªæ—¶ä¸º0x34ï¼Œ40å¯¹åº”0x38ï¼Œ42å¯¹åº”0x38ï¼Œ43å¯¹åº”0x3Cã€‚æ ¹æ®è¿™ä¸ªç‰¹å¾ï¼Œæˆ‘ä»¬æ¨æ–­å‡ºï¼Œå…¶ä¸­å¾ˆå¯èƒ½æœ‰base64çš„å˜æ¢ã€‚\n\nâ€‹\t**å°ä¼™ç±½ï¼Œå¦‚æœæ— æ³•æ‰¾åˆ°å“ªäº›æ˜¯ç”¨æˆ·ä»£ç ï¼Œå°±åŠ¨è°ƒå§ï¼Œåˆ«æ€•ï¼Œè¿™é¢˜å¤§å¤šæ•°æ˜¯ç³»ç»Ÿä»£ç ã€‚**ğŸ˜‚\n\n![image-20250626161812242](/pictures/DSBCTF2024/image-20250626161812242.png)\n\nâ€‹\t![image-20250626162116531](/pictures/DSBCTF2024/image-20250626162116531.png)\n\n\n\nâ€‹\tæˆ‘ä»¬çš„è¾“å…¥é•¿åº¦å°±æ˜¯40ã€41å’Œ42äº†ï¼Œå¯†æ–‡æ˜¯`[121, 84, 114, 67, 35, 83, 42, 76, 36, 84, 74, 116, 122, 119, 86, 65, 120, 82, 65, 77, 36, 120, 106, 80, 122, 119, 78, 67, 120, 82, 110, 70, 37, 104, 114, 86, 120, 81, 121, 77, 36, 120, 106, 94, 114, 67, 77, 77, 36, 83, 118, 79, 35, 84, 81, 97]`ï¼Œå³**yTrC#S*L$TJtzwVAxRAM$xjPzwNCxRnF%hrVxQyM$xj^rCMM$SvO#TQa**ã€‚\n\nâ€‹\tæ›¿æ¢è¡¨ä¸º**abcdefghijklmnopqrstuvwxyz!@#$%^&*()ABCDEFGHIJKLMNOPQRSTUVWXYZ<>a**ã€‚\n\n\n\nâ€‹\tçœ‹äº†åŠå¤©å°±ä¸€ä¸ªæ¢è¡¨çš„base64åŠ å¯†ï¼Œä¸­é—´ä¸€å †ä¸çŸ¥é“æ˜¯å•¥çš„ä¸œè¥¿ï¼Œæœ‰è‡ªåŠ¨è¡¥**\\0**ç»“æŸç¬¦çš„ï¼Œæœ‰éªŒè¯ä¸‹æ ‡çš„ã€‚æˆ‘ç›´æ¥è¢«å“é€€äº†ï¼\n\nâ€‹\tæœ‰ç‚¹æè‡ªå·±å¿ƒæ€äº†ã€‚\n\n![image-20250626161332933](/pictures/DSBCTF2024/image-20250626161332933.png)\n\nâ€‹\tåŸæ¥å¼€å¤´è¿˜æœ‰ä¸€ä¸ªç®€å•çš„èŠ±æŒ‡ä»¤å•Šã€‚\n\n\n\n\n\n\n\n\n\n\n\n\n\n## ç ´è§£é£æœºå¤§æˆ˜\n\nâ€‹\tæœ‰ä¸€ä¸ªæ–°é¢–çš„åè°ƒè¯•æŠ€æœ¯ï¼Œå½“åœ¨è°ƒè¯•æ—¶ï¼Œa1=1ï¼Œä¼šé™¤ä»¥0ï¼Œå¯¼è‡´ç¨‹åºå´©æºƒï¼›æ²¡æœ‰è°ƒè¯•æ—¶ï¼Œa1=0, è®¡ç®— (a1 - 1) = -1ï¼Œè½¬æ¢ä¸ºæ— ç¬¦å·åæ˜¯å¾ˆå¤§çš„æ•°ï¼ˆ0xFFFFFFFFï¼‰ï¼Œ0 é™¤ä»¥ä»»ä½•éé›¶æ•°éƒ½æ˜¯ 0 â†’ è¿”å› 0ï¼Œç¨‹åºæ­£å¸¸è¿è¡Œã€‚\n\n```c\nint __usercall sub_4120A0@<eax>(unsigned __int64 a1@<edx:eax>)\n{\n  LODWORD(a1) = NtCurrentPeb()->BeingDebugged;\n  LODWORD(a1) = a1 / (unsigned int)(a1 - 1);\n  return a1;\n}\n```\n\nâ€‹\tå…¨éƒ¨æ‰‹åŠ¨nopä¹Ÿå¤ªéº»çƒ¦äº†ï¼Œå­¦ä¹ WPä¸­ç›´æ¥NOPæ‰è¿™ä¸ªå‡½æ•°çš„æ–¹æ³•ã€‚\n\n```python\ndebugfun = b\"\\x64\\xA1\\x30\\x00\\x00\\x00\\x0F\\xB6\\x40\\x02\\x89\\xC3\\x83\\xEB\\x01\\xF7\\xF3\"\t#è¿™ä¸ªå‡½æ•°æ‰€æœ‰çš„å­—èŠ‚\n\nwith open(\"a.exe\", \"rb\") as f:\n    data = f.read()\n\n# æ›¿æ¢å¹¶æ¥ä½è¿”å›å€¼\npatched_data = data.replace(debugfun, b\"\\x90\" * len(debugfun))\n\nwith open(\"b.exe\", \"wb\") as f2:\n    f2.write(patched_data)\n```\n\n\n\nâ€‹\tIDAæ‰“å¼€åï¼Œæ­£å¸¸ä»**_main**å‡½æ•°å¼€å§‹åˆ†æï¼Œå…ˆçœ‹åˆ°ä¸‰ä¸ªå‡½æ•°ï¼Œ**sub_416900**åº”è¯¥æ˜¯åˆå§‹åŒ–éƒ¨åˆ†ã€‚\n\n```c\nint sub_416900()\n{\n  int i; // ebx\n  int result; // eax\n\n  result = dword_432038;\t\t//é™æ€å˜é‡é˜²æ­¢é‡å¤æ‰§è¡Œ\n  if ( !dword_432038 )\n  {\n    dword_432038 = 1;\n    for ( i = 0; dword_418B30[i + 1]; ++i )\n      ;\n    for ( ; i; --i )\n      ((void (*)(void))dword_418B30[i])();\t\t//å€’åºéå†å‡½æ•°æŒ‡é’ˆæ•°ç»„å¹¶è°ƒç”¨\n    result = sub_4014C0(sub_416870);\t\t//è°ƒç”¨æ³¨å†Œç±»å‡½æ•°\n  }\n  return result;\n}\n```\n\n------\n\n\n\n> `RegisterClassA` æ˜¯ Windows API æä¾›çš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äº**å‘æ“ä½œç³»ç»Ÿæ³¨å†Œä¸€ä¸ªçª—å£ç±»ï¼ˆWindow Classï¼‰**ï¼Œä»¥ä¾¿åç»­è°ƒç”¨ `CreateWindow` æˆ– `CreateWindowEx` åˆ›å»ºè¯¥ç±»çš„çª—å£ã€‚\n\n> ğŸ§  ä¸ºä»€ä¹ˆè¿™ä¹ˆåšï¼Ÿå®ƒçš„ç”¨é€”æ˜¯ä»€ä¹ˆï¼Ÿ\n>\n> è¿™æ˜¯æ‰€è°“çš„ **å‡½æ•°æŒ‡é’ˆä¼ é€’**ï¼Œç›®çš„æ˜¯ï¼š\n>\n> - **å»¶è¿Ÿè°ƒç”¨**ï¼šæˆ‘å…ˆå‘Šè¯‰ä½ è¯¥è°ƒç”¨å“ªä¸ªå‡½æ•°ï¼Œä»¥åå†æ‰§è¡Œï¼›\n> - **å›è°ƒæœºåˆ¶ï¼ˆcallbackï¼‰**ï¼šæˆ‘æŠŠä½ å‘Šè¯‰æˆ‘çš„å‡½æ•°è®°ä¸‹æ¥ï¼Œç­‰äº‹ä»¶è§¦å‘æ—¶è‡ªåŠ¨è°ƒç”¨ï¼›\n> - **æ¨¡å—åŒ–è®¾è®¡**ï¼šè®©ç¨‹åºçš„æŸä¸ªéƒ¨åˆ†ï¼ˆæ¯”å¦‚åˆå§‹åŒ–ã€æ¸…ç†ã€å“åº”æŸä¸ªçŠ¶æ€ï¼‰èƒ½è¢«â€œçµæ´»æ›¿æ¢â€ã€‚\n\nä¾‹å¦‚ï¼š\n\n```c\nvoid callLater(void (*func)(void)) {\n    printf(\"å‡†å¤‡è°ƒç”¨ä½ ç»™æˆ‘çš„å‡½æ•°ï¼\\n\");\n    func();  // è°ƒç”¨ä¼ å…¥çš„å‡½æ•°\n}\n\nvoid sayHello() {\n    printf(\"ä½ å¥½ï¼Œæˆ‘æ˜¯ä½ ä¼ å…¥çš„å‡½æ•°ï¼\\n\");\n}\n\ncallLater(sayHello);\n```\n\n------\n\nâ€‹\tçœ‹åˆ°**sub_415291**ï¼Œæ˜æ˜¾çš„win32çª—å£ç¨‹åºä»£ç ï¼Œå…¶ä½œç”¨å°±æ˜¯åˆ›å»ºä¸»çª—å£ï¼ŒåŠ è½½èµ„æºï¼ˆå›¾ç‰‡ï¼‰ï¼Œè®¾ç½®æ§ä»¶ï¼Œåˆå§‹åŒ–ä¸€äº›é€»è¾‘ç»„ä»¶ã€‚\n\n\n\n![image-20250629145153137](/pictures/DSBCTF2024/image-20250629145153137.png)\n\n\n\nâ€‹\t**sub_41677B**å‡½æ•°æ˜¯Windowsæ¶ˆæ¯å¾ªç¯å¤„ï¼Œæ˜¯ç¨‹åºçš„â€œä¸»å¾ªç¯â€ã€‚**sub_415D40**å‡½æ•°è¿›å…¥çœ‹åˆ°å‡ ç™¾è¡Œå‡½æ•°è°ƒç”¨ï¼Œç»å¤§å¤šæ•°éƒ½æ˜¯è¢«nopæ‰çš„åè°ƒè¯•å‡½æ•°ï¼Œä¸è¿‡ä¹Ÿå‡ ä¸ªå…¶ä»–å…³é”®å‡½æ•°ï¼Œå¤ªæ‡’äº†ï¼Œå°±ä¸è¦ä¸€ä¸ªä¸ªç¿»äº†ã€‚\n\n```c\nint sub_41677B()\n{\n  int result; // eax\n\n  while ( 1 )\n  {\n    result = dword_42F98C;\t\t//è¿è¡Œæ§åˆ¶å¼€å…³å˜é‡\n    if ( !dword_42F98C )\n      break;\n    result = sub_414BC5();\n    if ( result > 9999 )\n      break;\n    if ( PeekMessageA(&Msg, 0, 0, 0, 1u) )\t\t//æŸ¥è¯¢æ¶ˆæ¯ï¼ˆéé˜»å¡ï¼‰\n    {\n      TranslateMessage(&Msg);\t\t//å¤„ç†æŒ‰é”®ç­‰\n      sub_415BEA();\n      sub_41574F();\n      DispatchMessageA(&Msg);\t\t//åˆ†å‘ç»™çª—å£è¿‡ç¨‹\n    }\n    sub_415D40();\t\t//è‡ªå®šä¹‰æ¯å¸§é€»è¾‘\n  }\n  return result;\n}\n```\n\nâ€‹\tæ ¹æ®å°æ¸¸æˆçš„æç¤ºï¼Œå¾—åˆ†ä¸º10000å³å¯é€šå…³ï¼Œå¯è§**sub_414BC5**å‡½æ•°æ˜¯è¿”å›å¾—åˆ†äº†ï¼Œè¿›å»çœ‹çœ‹ã€‚\n\n```C\nint sub_414BC5()\n{\n  return 12345 - dword_42F99C;\t\t//è¯¥é™æ€å˜é‡æœ¬èº«åˆå§‹åŒ–ä¸º12345ï¼Œä¿è¯èµ·å§‹å¾—åˆ†ä¸º0.\n}\n```\n\nâ€‹\tä½†æ˜¯é€šè¿‡äº¤å‰å¼•ç”¨ï¼Œå¯ä»¥å‘ç°æœ‰å…¶ä»–å‡½æ•°åœ¨è°ƒç”¨å®ƒæŸ¥è¯¢åˆ†æ•°ï¼Œè·Ÿè¿‡å»çœ‹çœ‹**sub_415C43**ï¼ŒæŸ¥çœ‹äº¤å‰å¼•ç”¨ï¼Œå‘ç°è¯¥å‡½æ•°åˆšå¥½åœ¨æ¶ˆæ¯å¾ªç¯çš„**sub_415D40**å‡½æ•°é‡Œé¢ï¼Œå¯ä»¥çŒœæµ‹è¿™æ˜¯é€šå…³åé€»è¾‘çš„ä»£ç ã€‚\n\nâ€‹\tå®ƒåœ¨å¹²å˜›å‘¢ï¼Ÿå…ˆè¯»å–ç”¨æˆ·è¾“å…¥å¯†é’¥ï¼Œç„¶åå¯¹åŠ å¯†ä»£ç è¿›è¡Œå¼‚æˆ–è§£å¯†ï¼Œç„¶åé€šè¿‡`VirtualProtect` å°†è¿™å—å†…å­˜åŒºåŸŸçš„ä¿æŠ¤å±æ€§æ”¹æˆ `0x40`ï¼Œä¹Ÿå°±æ˜¯ `PAGE_EXECUTE_READWRITE`ï¼Œå…è®¸ä»£ç æ‰§è¡Œï¼Œæœ€åè°ƒç”¨è§£å¯†åçš„å‡½æ•°ã€‚å¯†é’¥æ˜¯å¤šå°‘å‘¢ï¼Ÿæ ¹æ®å‡½æ•°ç»“å°¾æ˜¯**retn**æŒ‡ä»¤ï¼ˆ**C3**ï¼‰çš„ç‰¹å¾ï¼ŒæŸ¥çœ‹åˆ°æœ€åä¸€ä¸ªåŠ å¯†å­—èŠ‚æ˜¯**0Fh**ï¼Œæˆ‘ä»¬å¾—å‡ºå¯†é’¥æ˜¯**204**ã€‚\n\nâ€‹\tç”±äºä¸»å¾ªç¯é‡Œé¢æ¯å½“åˆ°10000äº†ç¨‹åºå°±ç›´æ¥é€€å‡ºäº†ï¼Œæ ¹æœ¬æ— æ³•åˆ°è¿™ä¸€å—ï¼Œæ‰€ä»¥æˆ‘ä»¬IDAæ‰‹åŠ¨æ”¹å˜ä¸€ä¸‹è·³è½¬ï¼Œè®©è¿™ä¸ªå‡½æ•°æ‰§è¡Œä¸€ä¸‹ã€‚\n\n```c\nint sub_415C43()\n{\n  void *v1; // eax\n  int v2; // [esp+4h] [ebp-34h]\n  int v3; // [esp+8h] [ebp-30h]\n  int v4; // [esp+Ch] [ebp-2Ch]\n  int v5; // [esp+10h] [ebp-28h]\n  DWORD flOldProtect; // [esp+14h] [ebp-24h] BYREF\n  int v7[3]; // [esp+18h] [ebp-20h] BYREF\n  int v8; // [esp+28h] [ebp-10h]\n  unsigned int i; // [esp+2Ch] [ebp-Ch]\n  int v10; // [esp+30h] [ebp-8h]\n  int v11; // [esp+34h] [ebp-4h]\n  int savedregs; // [esp+38h] [ebp+0h]\n\n  if ( sub_414BC5() == 10000 )\n  {\n    scanf(\"%d\", v7);\n    HIBYTE(v8) = v7[0];\n    for ( i = 0; i <= 0x16917; ++i )\n      *((_BYTE *)sub_419060 + i) ^= HIBYTE(v8);\n    VirtualProtect(sub_419060, 0x16918u, 0x40u, &flOldProtect);\n    v1 = malloc(0x100000u);\n    sub_419060(v1, v2, v3, v4, v5, flOldProtect, v7[0], v7[1], v7[2], v1, v8, i, v10, v11, savedregs);\n  }\n  return 0;\n}\n```\n\nâ€‹\tæ‰§è¡Œå®Œä¹‹åå°±å‡ºç°äº†ä¸€ä¸ª**res.jpg**å›¾ç‰‡ï¼Œå¾—åˆ°**ctfshow{162dfd79-b4bf-455a-9065-16105e421687}**ã€‚\n\n![res.jpg](/pictures/DSBCTF2024/res.jpg)\n\n\n\n\n\n## æ²¡æ—¶é—´å¥½å¥½çˆ±ä½ ï¼Œæ‰€ä»¥é€‰æ‹©å•èº«\n\nâ€‹\tå›½é™…æƒ¯ä¾‹ï¼Œå…ˆæŸ¥å£³ã€‚æ— å£³ï¼Œ64ä½ç¨‹åºã€‚\n\nâ€‹\tIDAç©¶æå¥½è¯»ä»£ç ï¼Œç¬¬ä¸€ä¸ªè¿·å®«**sddssdsssdd**ï¼Œç¬¬äºŒä¸ªæ˜¯åšæ•°ç‹¬ï¼ˆå¼€å§‹è¿˜çœ‹ä¸å‡ºæ¥ï¼‰ï¼Œçœ‹åˆ°ç¬¬ä¸‰ä¸ªç»·ä¸ä½äº†ï¼Œåˆtmè€ƒé­”æ–¹ï¼Œæˆ‘è¿™é­”æ–¹å°±è¿‡ä¸å»äº†å‘—ã€‚**RRuFFRRFFUUFFRRFFuRR**ã€‚ï¼ˆå¯ä»¥å»[ç½‘ç«™](https://rubiks-cube-solver.com/)æŸ¥ï¼‰\n\n![image-20250629164104513](/pictures/DSBCTF2024/image-20250629164104513.png)\n\nâ€‹\tæœ€åçš„ç­”æ¡ˆæ˜¯**sddssdsssdd513749862RRuFFRRFFUUFFRRFFuRR**ã€‚\n\nâ€‹\tæ‰“å¼€å‹ç¼©åŒ…é‡Œé¢çš„txtæ–‡ä»¶ï¼Œçœ‹åˆ°æœ€ä¸‹é¢çš„**ctfshow{After_all_I'm_t0o_busy_to h@ve_t1me_to_l0ve_y0u_we11}**ã€‚\n\n\n\n> â€‹\tè¿™é‡Œä¸å¾—ä¸è¡¥ä¸€ç‚¹é­”æ–¹çš„åŸºç¡€çŸ¥è¯†äº†ï¼Œå›½é™…æ¯”èµ›æ ‡å‡†é­”æ–¹æ˜¯ï¼š**ä¸Šé¢ç™½è‰²ï¼Œå‰é¢ç»¿è‰²ï¼Œä¸‹é¢é»„è‰²ï¼Œåé¢è“è‰²ï¼Œå³é¢çº¢è‰²ï¼Œå·¦é¢æ©™è‰²**ã€‚\n>\n> â€‹\té­”æ–¹é€‰æ‹©ç¬¦å·ï¼Œ**Rè¡¨ç¤ºå³é¢é¡ºæ—¶é’ˆ**ï¼Œ**Fè¡¨ç¤ºå‰é¢é¡ºæ—¶é’ˆ**ï¼Œ**Uè¡¨ç¤ºä¸Šé¢é¡ºæ—¶é’ˆ**ï¼Œ**r(R')è¡¨ç¤ºå³é¢é€†æ—¶é’ˆ**ï¼Œ**f(F')è¡¨ç¤ºå‰é¢é€†æ—¶é’ˆ**ï¼Œ**u(U')è¡¨ç¤ºä¸Šé¢é€†æ—¶é’ˆ**ã€‚\n\n![image-20250629162655820](/pictures/DSBCTF2024/image-20250629162655820.png)\n\nâ€‹\tå¯ä»¥çœ‹ä¸€ä¸ªâ€œFâ€å¯¹åº”çš„ä»£ç ï¼Œå…ˆä¿å­˜å‰é¢çš„æ•°ç»„æ•°æ®ï¼Œç„¶åè¿›è¡Œé‡æ–°èµ‹å€¼ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªä»£ç é«˜ä½æœ‰ç‚¹é—®é¢˜å•Šï¼Œå› ä¸ºå®ƒåªä¿®æ”¹äº†å‰é¢ï¼Œæ²¡æœ‰ç»™å‘¨å›´çš„å››ä¸ªé¢æ›´æ–°ï¼Œä¸èƒ½è¡¨ç¤ºå®Œæ•´çš„Fæ“ä½œå•Šï¼Œæ‰€ä»¥è¯´è¿™ä¸ªå‡½æ•°åº”è¯¥åªèƒ½è¯´æ˜¯èµ·ä¸€ä¸ªâ€œæç¤ºâ€çš„ä½œç”¨ã€‚ï¼ˆåæ­£è¾“å…¥æ­£ç¡®ä¸å¦éƒ½æ˜¯ä¸€æ ·çš„æç¤ºä¿¡æ¯ï¼Œå®ƒä¹Ÿæ²¡æ£€æŸ¥ï¼‰\n\n```c\n__int64 __fastcall rotateFaceClockwise(int a1)\t\t//a1å¯èƒ½å€¼ä¸º0ã€1ã€2ï¼Œå› ä¸ºFRUæ“ä½œä¸»è¦\n{\n  __int64 result; // rax\n  _DWORD v2[12]; // [rsp+0h] [rbp-40h]\n  int m; // [rsp+30h] [rbp-10h]\n  int k; // [rsp+34h] [rbp-Ch]\n  int j; // [rsp+38h] [rbp-8h]\n  int i; // [rsp+3Ch] [rbp-4h]\n\n  for ( i = 0; i <= 2; ++i )\n  {\n    for ( j = 0; j <= 2; ++j )\n    {\n      result = j + 3LL * i;\n      v2[result] = cube[9 * a1 + 3 * i + j];\n    }\n  }\n  for ( k = 0; k <= 2; ++k )\n  {\n    for ( m = 0; m <= 2; ++m )\n    {\n      result = m + 9LL * a1 + 3LL * k;\n      cube[result] = v2[3 * (2 - m) + k];\n    }\n  }\n  return result;\n}\n```\n\n","tags":["å¤ç°WP","Reverse"],"categories":["CTF"]},{"title":"XYCTF2024","url":"/2025/06/29/XYCTF2024/XYCTF2024/","content":"\n# èªæ˜çš„ä¿¡ä½¿\n\n```python\nenc = \"oujp{H0d_TwXf_Lahyc0_14_e3ah_Rvy0ac@wc!}\"\n\nfor i in range(len(enc)):\n    if enc[i].isalpha():\n        if ord(enc[i]) >= 97 and ord(enc[i]) <= 122:\n            print(chr((ord(enc[i]) - 97 - 9) % 26 + 97), end=\"\")\n        else:\n            print(chr((ord(enc[i]) - 65 - 9) % 26 + 65), end=\"\")\n    else:\n        print(enc[i], end=\"\")\n```\n\n\n\n# easy language\n\nâ€‹\tè‡ªå·±åˆ†æä¸å‡ºæ¥ï¼ŒWPè¯´è¿˜æ˜¯å¾—ä¸‹æ’ä»¶ã€‚\n\nâ€‹\tä»Šå¤©æ™šä¸Šæœ€å¤§çš„æ”¶è·ï¼šä¸‹è½½å¥½äº†`IDA PRO 7.5`ç»¿è‰²ç‰ˆæœ¬ï¼Œå…å®‰è£…çš„ï¼Œä¸‹è½½å³ç”¨ï¼Œè¿˜èƒ½é€‚é…æ˜“è¯­è¨€åç¼–è¯‘å™¨æ’ä»¶ï¼Œè¿˜é…ç½®å¥½äº†è®¾ç½®ä¸­æ–‡å‡½æ•°åçš„é…ç½®æ–‡ä»¶é—®é¢˜å’ŒDLLæ–‡ä»¶é—®é¢˜ï¼ˆç”¨å¤§ä½¬çš„ï¼‰ï¼Œéƒ½èƒ½ç”¨ï¼Œå¤ªé€‚é…äº†ï¼Œæ²¡æœ‰å¥‡æ€ªçš„ç¯å¢ƒé—®é¢˜ï¼Œæˆ‘å¤ªçˆ±äº†ï¼Œè¿˜é¡ºå¸¦é‡åˆ°ä¸€ä¸ªåˆ†äº«IDAâ€œçš®è‚¤â€çš„å¤§ä½¬ï¼Œæˆ‘çš„IDAåˆå‡çº§äº†ï¼Œå¤ªçˆ½äº†ï¼\n\nâ€‹\tIDA9.0ä¹Ÿä¸‹è½½äº†ä¸€ä¸ªååˆ¶æ§åˆ¶æµå¹³å¦åŒ–çš„æ’ä»¶ï¼Œä¹Ÿå¤ªæ£’äº†ï¼\n\nâ€‹\tç®€å•è®°å½•ä¸€ä¸‹æˆ‘çš„åˆ†æï¼Œå…ˆæ ¹æ®æ˜“è¯­è¨€æ’ä»¶åç¼–è¯‘çš„å‡½æ•°åæ‰¾åˆ°çœŸæ­£çš„è¾“å…¥æ¡†æ‰€åœ¨çš„é€»è¾‘å‡½æ•°ã€‚è¿™é‡Œå…ˆæ˜¯é€šè¿‡è¯»å–ç»„ä»¶çš„å±æ€§æ¥è·å–æ–‡æœ¬æ¡†çš„å†…å®¹ï¼Œç„¶åä½¿ç”¨AES-ECBåŠ å¯†ä¸€æ¬¡ï¼Œ\n\n![image-20250604094838934](/pictures/XYCTF2024/image-20250604094838934.png)\n\nâ€‹\tåœ¨SUB_403E67å‡½æ•°ä¸­è°ƒç”¨äº†SUB_403EE7å‡½æ•°ï¼Œè¿›è¡Œäº†ä¼¼äºbase64çš„ç§»ä½ã€ä¸æˆ–æ“ä½œã€‚\n\n![image-20250604095033633](/pictures/XYCTF2024/image-20250604095033633.png)\n\nâ€‹\tå›åˆ°åŸå‡½æ•°ï¼Œåé¢è¿›è¡Œäº†å­—ç¬¦æ¯”å¯¹å’Œæç¤ºä¿¡æ¯è¾“å‡ºã€‚è™½ç„¶ä»£ç æ²¡æœ‰è¿‡å¤šçš„æ··æ·†ï¼Œä½†æ˜¯è¿˜æ˜¯å¤ªéš¾çœ‹äº†ï¼ŒWPä¸Šéƒ½æ˜¯çŒœå‡ºæ¥çš„ã€‚æˆ‘åªèƒ½å…ˆå°±è¿™æ ·äº†ï¼Œå–å¯†æ–‡base64å’ŒAES-ECBè§£å¯†å³å¯ï¼Œå»æ‰¾å­—ç¬¦ä¸²å³å¯ã€‚\n\n![image-20250604095318810](/pictures/XYCTF2024/image-20250604095318810.png)\n\nâ€‹\tèµ›åšå¨å­è§£å¯†å¦‚ä¸‹ã€‚\n\n![image-20250604100537143](/pictures/XYCTF2024/image-20250604100537143.png)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n# å–µå–µå–µçš„flagç¢äº†ä¸€åœ°\n\n`flag{My_fl@g_h4s_br0ken_4parT_Bu7_Y0u_c@n_f1x_1t!}`\n\n\n\n\n\n# ç»™é˜¿å§¨å€’ä¸€æ¯å¡å¸ƒå¥‡è¯º\n\nâ€‹\té€»è¾‘å¾ˆæ¸…æ™°ï¼Œæ²¡ä»€ä¹ˆæ–°çŸ¥è¯†ï¼Œå°±æ˜¯åˆé‡æ–°ç†Ÿæ‚‰äº†ä¸€èˆ¬teaçš„é€†å‘ç®—æ³•ã€‚\n\nâ€‹\tè‡³äºè€é—®é¢˜ï¼ŒIDAï¼Œå¤§å°ç«¯çš„é—®é¢˜ï¼Œæˆ‘çš„è®¤è¯†æ˜¯ï¼šå…ˆåšï¼Œéƒ½è¯•ä¸€éã€‚\n\n```c\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdint.h>\n\n//é­”æ”¹tea\nvoid detea(uint32_t *v, uint32_t *k, int i);\n//uint32_t data1 = 0x7472795f;\nuint32_t data1 = 0x5F797274;\nuint32_t data2 = 0x64726168;\n//uint32_t data2 = 0x68617264;\nint main()\n{\n    uint32_t enc[8] = {0x9B28ED45, 0x145EC6E9, 0x5B27A6C3, 0xE59E75D5, 0xE82C2500,0xA4211D92,0xCD8A4B62,0xA668F440};\n    //uint32_t enc[8] = {0x45ed289b, 0xe9c65e14, 0xc3a6275b, 0xd5759ee5,0x00252ce8,0x921d21a4,0x624b8acd,0x40f468a6};\n    char key[16] = \"give_you_cup_tea\";\n    for(int i=6; i>=0; i=i-2)\n    {\n        detea(enc, (uint32_t*)key, i);\n    }\n\n    char *flag = (char*)enc;\n    for(int i=0; i<32; i++)\n    {\n        printf(\"%c\", flag[i]);\n    }\n\n    return 0;\n}\n\nvoid detea(uint32_t *v, uint32_t *k, int i)\n{\n    uint32_t v0 = v[i], v1 = v[i+1];\n    uint32_t delta = 0x6E75316C;\n    uint32_t sum = delta * 32;\n    for(int i =31; i >= 0; i--)\n    {\n        v1 -= ((v0 >> 5) + k[3]) ^ (v0 + sum) ^ ((v0 << 4) + k[2]) ^ (sum + i);\n        v0 -= ((v1 >> 5) + k[1]) ^ (v1 + sum) ^ ((v1 << 4) + k[0]) ^ (sum + i);\n        sum = sum - delta;\n    }\n\n    if(i != 0)\n    {\n        v0 ^= v[i-2];\n        v1 ^= v[i-1];\n    }else{\n        v0 ^= data1;\n        v1 ^= data2;\n    }\n    v[i] = v0;\n    v[i+1] = v1;\n}\n```\n\n\n\n\n\n# ä½ æ˜¯çœŸçš„å¤§å­¦ç”Ÿå—ï¼Ÿ\n\nâ€‹\tç¬¬ä¸€æ¬¡è§è¿™ç§ä¸œè¥¿ï¼Œè®°å½•ä¸€ä¸‹ã€‚è¿™ä¸ªä»£ç æ˜¯ä¸€ä¸ªä½¿ç”¨ **8086å®æ¨¡å¼** å’Œ **MS-DOSä¸­æ–­** ç¼–å†™çš„å¯æ‰§è¡Œç¨‹åºï¼Œç»“æ„ä¸Šå¾ˆå…¸å‹ã€‚\n\næ–‡ä»¶æå°ï¼Œåªæœ‰1kbä¸åˆ°ï¼Œç¬¬ä¸€æ¬¡çœ‹è¿™ç§è¿˜æ²¡å¾ˆé€‚åº”ï¼Œæœ‰ç‚¹é æ³¨é‡Šå’ŒçŒœã€‚IDAåç¼–è¯‘æºç å¦‚ä¸‹ã€‚\n\n```assembly\ndseg:0000 ;\ndseg:0000 ; +-------------------------------------------------------------------------+\ndseg:0000 ; |      This file was generated by The Interactive Disassembler (IDA)      |\ndseg:0000 ; |           Copyright (c) 2024 Hex-Rays, <support@hex-rays.com>           |\ndseg:0000 ; |                      License info: 48-FCB4-5471-8F                      |\ndseg:0000 ; |                                 TOM_RUS                                 |\ndseg:0000 ; +-------------------------------------------------------------------------+\ndseg:0000 ;\ndseg:0000 ; Input SHA256 : DE9713F39D770A61E966FDA9C0A9DDF6C3EF5B4037FF5AD4C7ABB962123AFEA3\ndseg:0000 ; Input MD5    : B64AACBF6ED401B5AE4EB32A63A8E65F\ndseg:0000 ; Input CRC32  : DF414641\ndseg:0000 ; Compiler     : Visual C++ (guessed)\ndseg:0000\ndseg:0000 ; File Name   : F:\\StudyFiles\\CTF\\Review_CTF\\XYCTF2024\\RE\\ä½ æ˜¯çœŸçš„å¤§å­¦ç”Ÿå—ï¼Ÿ.EXE\ndseg:0000 ; Format      : MS-DOS executable (EXE)\ndseg:0000 ; Base Address: 1000h Range: 10000h-100AEh Loaded length: AEh\ndseg:0000 ; Entry Point : 1005:0\ndseg:0000\ndseg:0000                 .686p\ndseg:0000                 .mmx\ndseg:0000                 .model large\ndseg:0000\ndseg:0000 ; ===========================================================================\ndseg:0000\ndseg:0000 ; Segment type: Pure data\ndseg:0000 dseg            segment para stack 'DATA' use16\ndseg:0000                 assume cs:dseg\ndseg:0000 unk_10000       db  0Dh                 ; DATA XREF: start+5â†“o\ndseg:0001                 db  0Ah\ndseg:0002                 db  69h ; i\ndseg:0003                 db  6Eh ; n\ndseg:0004                 db  70h ; p\ndseg:0005                 db  75h ; u\ndseg:0006                 db  74h ; t\ndseg:0007                 db  20h\ndseg:0008                 db  73h ; s\ndseg:0009                 db  74h ; t\ndseg:000A                 db  72h ; r\ndseg:000B                 db  69h ; i\ndseg:000C                 db  6Eh ; n\ndseg:000D                 db  67h ; g\ndseg:000E                 db  3Ah ; :\ndseg:000F                 db  24h ; $\ndseg:0010 unk_10010       db  0Dh                 ; DATA XREF: start+15â†“o\ndseg:0011                 db  0Ah\ndseg:0012                 db  24h ; $\ndseg:0013 unk_10013       db  0Dh                 ; DATA XREF: start+52â†“o\ndseg:0014                 db  0Ah\ndseg:0015                 db  59h ; Y\ndseg:0016                 db  65h ; e\ndseg:0017                 db  73h ; s\ndseg:0018                 db  24h ; $\ndseg:0019 unk_10019       db  76h ; v             ; DATA XREF: start+3Dâ†“o\ndseg:001A                 db  0Eh\ndseg:001B                 db  77h ; w\ndseg:001C                 db  14h\ndseg:001D                 db  60h ; `\ndseg:001E                 db    6\ndseg:001F                 db  7Dh ; }\ndseg:0020                 db    4\ndseg:0021                 db  6Bh ; k\ndseg:0022                 db  1Eh\ndseg:0023                 db  41h ; A\ndseg:0024                 db  2Ah ; *\ndseg:0025                 db  44h ; D\ndseg:0026                 db  2Bh ; +\ndseg:0027                 db  5Ch ; \\\ndseg:0028                 db    3\ndseg:0029                 db  3Bh ; ;\ndseg:002A                 db  0Bh\ndseg:002B                 db  33h ; 3\ndseg:002C                 db    5\ndseg:002D unk_1002D       db  15h                 ; DATA XREF: start+Dâ†“o\ndseg:002E byte_1002E      db 0                    ; DATA XREF: start+21â†“r\ndseg:002F unk_1002F       db    0                 ; DATA XREF: start+39â†“o\ndseg:0030                 db    0\ndseg:0031                 db    0\ndseg:0032                 db    0\ndseg:0033                 db    0\ndseg:0034                 db    0\ndseg:0035                 db    0\ndseg:0036                 db    0\ndseg:0037                 db    0\ndseg:0038                 db    0\ndseg:0039                 db    0\ndseg:003A                 db    0\ndseg:003B                 db    0\ndseg:003C                 db    0\ndseg:003D                 db    0\ndseg:003E                 db    0\ndseg:003F                 db    0\ndseg:0040                 db    0\ndseg:0041                 db    0\ndseg:0042                 db    0\ndseg:0043                 db    0\ndseg:0044                 db    0\ndseg:0045                 db    0\ndseg:0046                 db    0\ndseg:0047                 db    0\ndseg:0048                 db    0\ndseg:0049                 db    0\ndseg:004A                 db    0\ndseg:004B                 db    0\ndseg:004C                 db    0\ndseg:004D                 db    0\ndseg:004E                 db    0\ndseg:004F                 db    0\ndseg:004F dseg            ends\ndseg:004F\nseg001:0000 ; ===========================================================================\nseg001:0000\nseg001:0000 ; Segment type: Pure code\nseg001:0000 seg001          segment byte public 'CODE' use16\nseg001:0000                 assume cs:seg001\nseg001:0000                 assume es:nothing, ss:dseg, ds:nothing, fs:nothing, gs:nothing\nseg001:0000\nseg001:0000 ; =============== S U B R O U T I N E =======================================\nseg001:0000\nseg001:0000 ; Attributes: noreturn\nseg001:0000\nseg001:0000                 public start\nseg001:0000 start           proc near\nseg001:0000                 mov     ax, seg dseg\nseg001:0003                 mov     ds, ax\nseg001:0005                 assume ds:dseg\nseg001:0005                 lea     dx, unk_10000\nseg001:0009                 mov     ah, 9\nseg001:000B                 int     21h             ; DOS - PRINT STRING\nseg001:000B                                         ; DS:DX -> string terminated by \"$\"\nseg001:000D                 lea     dx, unk_1002D\nseg001:0011                 mov     ah, 0Ah\nseg001:0013                 int     21h             ; DOS - BUFFERED KEYBOARD INPUT\nseg001:0013                                         ; DS:DX -> buffer\nseg001:0015                 lea     dx, unk_10010\nseg001:0019                 mov     ah, 9\nseg001:001B                 int     21h             ; DOS - PRINT STRING\nseg001:001B                                         ; DS:DX -> string terminated by \"$\"\nseg001:001D                 xor     cx, cx\nseg001:001F                 xor     ax, ax\nseg001:0021                 mov     cl, byte_1002E\nseg001:0025                 mov     si, 2Fh ; '/'\nseg001:0028                 mov     al, [si]\nseg001:002A                 add     si, cx\nseg001:002C\nseg001:002C loc_1007C:                              ; CODE XREF: start+37â†“j\nseg001:002C                 sub     si, 1\nseg001:002F                 xor     [si], al\nseg001:0031                 mov     al, [si]\nseg001:0033                 dec     cx\nseg001:0034                 cmp     cx, 0\nseg001:0037                 jnz     short loc_1007C\nseg001:0039                 lea     si, unk_1002F\nseg001:003D                 lea     di, unk_10019\nseg001:0041\nseg001:0041 loc_10091:                              ; CODE XREF: start+50â†“j\nseg001:0041                 mov     al, [si]\nseg001:0043                 mov     bl, [di]\nseg001:0045                 add     si, 1\nseg001:0048                 inc     di\nseg001:0049                 cmp     al, bl\nseg001:004B                 jnz     short loc_100AA\nseg001:004D                 cmp     cx, 0\nseg001:0050                 jnz     short loc_10091\nseg001:0052                 lea     dx, unk_10013\nseg001:0056                 mov     ah, 9\nseg001:0058                 int     21h             ; DOS - PRINT STRING\nseg001:0058                                         ; DS:DX -> string terminated by \"$\"\nseg001:005A\nseg001:005A loc_100AA:                              ; CODE XREF: start+4Bâ†‘j\nseg001:005A                 mov     ah, 4Ch\nseg001:005C                 int     21h             ; DOS - 2+ - QUIT WITH EXIT CODE (EXIT)\nseg001:005C start           endp                    ; AL = exit code\nseg001:005C\nseg001:005C seg001          ends\nseg001:005C\nseg001:005C\nseg001:005C                 end start\n```\n\n```python\ndata = [0x76,0xe,0x77,0x14,0x60,0x6,0x7d,0x4,0x6b,0x1e,0x41,0x2a,0x44,0x2b,0x5c,0x3,0x3b,0xb,0x33,0x5,0x15]\nfor i in range(len(data),0):\n\tprint(chr(data[i] ^ data[i+1]), end='')\n```\n\n\n\n# ç ¸æ ¸æ¡ƒ\n\nâ€‹\tæ–°å£³ï¼ŒNsPacK3.xï¼Œå›½äº§å£³ï¼ŒåŒ—æ–—ï¼Œé€šå¸¸æ˜¯ç—…æ¯’ä½¿ç”¨çš„å£³ã€‚è¿˜ä»¥ä¸ºç½‘ä¸Šèƒ½æ‰¾åˆ°ç°æˆçš„è„±å£³å·¥å…·ï¼Œç»è¿‡åªæœ‰ä¸€ä¸ª08å¹´çš„è€ä¸œè¥¿ï¼Œè¿˜ç”¨ä¸äº†äº†ã€‚çœ‹WPä¹Ÿæ˜¯æ‰‹åŠ¨è„±å£³ï¼Œæˆ‘ä¹Ÿæ‰‹æ’•å§ã€‚è¿˜ä»¥ä¸ºèƒ½å’Œè·å¾—æ–°å·¥å…·äº†ï¼Œå“ï¼Œè¿™ä¹Ÿæ˜¯ä¸ªå‹ç¼©å£³ï¼Œå †æ ˆå¹³è¡¡åŒæ ·é€‚ç”¨ã€‚\n\nâ€‹\t32ä½ç¨‹åºï¼Œå¾ˆæ˜æ˜¾çš„`pushfd`ã€`pushad`ã€`popfd`ã€`popad`æŒ‡ä»¤ã€‚\n\nâ€‹\tç„¶åå°±æ˜¯æœ€åŸºç¡€çš„å¼‚æˆ–åŠ å¯†ï¼Œç›´æ¥çœ‹è„šæœ¬ã€‚\n\n```python\nxor = \"this_is_not_flag\"\nenc = [0x12,0x4,0x8,0x14,0x24,0x5c,0x4a,0x3d,0x56,0xa,0x10,0x67,0x0,0x41,0x0,0x1,0x46,0x5a,0x44,0x42,0x6e,0xc,0x44,0x72,0xc,0xd,0x40,0x3e,0x4b,0x5f,0x2,0x1,0x4c,0x5e,0x5b,0x17,0x6e,0xc,0x16,0x68,0x5b,0x12]\nfor i in range(len(enc)):\n    print(chr(enc[i] ^ ord(xor[i % len(xor)])), end='')\n```\n\n\n\n\n\n# DebugMeï¼ˆAPKï¼‰\n\nâ€‹\tapké€†å‘ï¼Œå…ˆæ”¾ä¸€è¾¹ã€‚\n\nâ€‹\tJADXæ‰“å¼€ï¼Œæ²¡æœ‰å¯ä»¥çœ‹çš„ä»£ç ï¼Œä¸çŸ¥é“æ€ä¹ˆå›äº‹ï¼Œå¾ˆå¤šä¹±ç ã€‚æˆ‘ä¹‹å‰çš„æ–‡ä»¶éƒ½èƒ½æ˜¾ç¤ºï¼Œå·¥å…·æ²¡æœ‰é—®é¢˜ï¼Œé‚£å°±æ˜¯æœ‰é˜²æŠ¤æ‰‹æ®µäº†ã€‚ä¸ä¼šï¼Œä¸æƒ³å»æœäº†ï¼Œç›´æ¥çœ‹WPå­¦ä¹ ã€‚\n\nâ€‹\tå…ˆæ‰¾èµ„æºä¸‹è½½JEBï¼Œä»˜è´¹è½¯ä»¶ï¼Œå¾—ç ´è§£ç‰ˆã€‚\n\nâ€‹\tä¸‹è½½å¥½äº†ï¼Œä½¿ç”¨å’ŒJADXå·®ä¸å¤šï¼Œç”Ÿæˆçš„é¡¹ç›®æ–‡ä»¶éƒ½æ˜¯å’ŒåŸæ–‡ä»¶ä¿å­˜åœ¨ä¸€èµ·ï¼Œè¿™ä¸€ç‚¹ç‰¹åˆ«å¥½ï¼Œä¸éœ€è¦æˆ‘ä»¬è‡ªå·±å»è®¾ç½®è·¯å¾„äº†ï¼Œä¹Ÿä¸å®¹æ˜“Cç›˜çˆ†äº†ã€‚\n\nâ€‹\téœ€è¦ä¿®æ”¹mainfestä¸­çš„å¯è°ƒå¼å±æ€§ã€‚ä½¿ç”¨`apktool d DebugMe.apk -o out`è§£åŒ…ï¼Œä¿®æ”¹å¥½åï¼Œä½¿ç”¨å‘½ä»¤`apktool b out -o target_debug.apk`é‡æ–°æ‰“åŒ…ã€‚ä½†æ˜¯å¥½åƒæ²¡æœ‰è¿™ä¹ˆç®€å•ã€‚\n\n\n\nâ€‹\tæœ€åæˆåŠŸäº†ï¼Œè®°å½•ä¸€ä¸‹ç¯å¢ƒé…ç½®çš„è¿‡ç¨‹ã€‚\n\nâ€‹\té¦–å…ˆï¼Œè¦ä½¿ç”¨MTç®¡ç†å™¨ç›´æ¥åœ¨æ¨¡æ‹Ÿå™¨ä¸­ä¿®æ”¹`Android.mainfest.xml`æ–‡ä»¶ï¼Œæ·»åŠ `android:debuggable=\"true\"`ï¼Œä¿®æ”¹ä¹‹åä¿å­˜æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨MTè‡ªåŠ¨æ‰“åŒ…æˆæ–°çš„APKã€‚\n\nâ€‹\tå°†æ–°çš„APKé€šè¿‡æ¨¡æ‹Ÿå™¨çš„å…±äº«æ–‡ä»¶å¤¹ä¼ å›åˆ°ç”µè„‘ä¸Šï¼Œä½¿ç”¨JEBæ‰“å¼€åç¼–è¯‘ã€‚ä¹‹åå°±æ˜¯å¼€å§‹è°ƒè¯•APKäº†ï¼Œæ³¨æ„ï¼šå…ˆè¦å°†`adb`æ·»åŠ åˆ°ç¯å¢ƒå˜é‡é‡Œé¢ï¼ŒJEBå°±æ˜¯é€šè¿‡adbæ¥æ‰¾åˆ°æ¨¡æ‹Ÿå™¨è®¾å¤‡çš„ã€‚ç„¶åä½¿ç”¨ `adb devices`å‘½ä»¤æŸ¥çœ‹è®¾å¤‡ï¼Œç„¶åä½¿ç”¨å‘½ä»¤`adb shell am start -D -n com.xyctf.ezapk/.MainActivity`å¯åŠ¨å¾…è°ƒè¯•çš„è¿›ç¨‹ï¼Œå…¶ä¸­-nåé¢æ˜¯å¾…è°ƒè¯•çš„åŒ…åç­‰ç­‰ã€‚\n\nâ€‹\tå†åœ¨JEBä¸­æ‰“å¼€è°ƒè¯•å™¨ï¼Œé€‰æ‹©å¥½å¯¹åº”çš„æ¨¡æ‹Ÿå™¨å’Œè¿›ç¨‹ï¼Œå°±å¯ä»¥æˆåŠŸè°ƒè¯•äº†ã€‚æ­£å¸¸è°ƒè¯•æ³¨æ„åŠ æ–­ç‚¹å†è¿æ¥ç¨‹åºã€‚\n\n![image-20250603173505598](/pictures/XYCTF2024/image-20250603173505598.png)\n\nâ€‹\t`XYCTF{d3bugg3r_15_v3ry_u53ful}`\n\n\n\n\n\n\n\n\n\n# èˆ”ç‹—å››éƒ¨æ›²--ç®€çˆ±\n\nâ€‹\tä¸€å¼€å§‹å§ï¼ŒDIEåˆ†ææ˜¯ELFç¨‹åºï¼Œå°±ç›´æ¥IDAæ‰“å¼€ã€‚ï¼ˆä½†å®é™…ä¸Šæ˜¯.oæ–‡ä»¶ï¼Œä½¿ç”¨gccé“¾æ¥ï¼Œå½“ç„¶IDAåç¼–è¯‘å‡ºæ¥ä»£ç éƒ½å·®ä¸å¤šï¼‰ã€‚\n\nâ€‹\tæœ€åæ˜¯å¯¹srcæ•°ç»„å’Œsæ•°ç»„è¿›è¡Œæ¯”è¾ƒï¼Œä½†æ˜¯å¾ˆå¥‡æ€ªçš„æ˜¯ï¼Œsrcæ•°æ®å°±æ˜¯æ²¡æœ‰å˜åŒ–ï¼Œè¿™é‡Œæ˜¯å¯¹sæ•°ç»„åŠ å¯†ä¸¤æ¬¡åå†ä½¿ç”¨howtoloveå‡½æ•°åŠ å¯†ï¼Œæ‰€ä»¥æ­£å¸¸çš„é€†å‘é€»è¾‘ä¹Ÿåº”è¯¥æ˜¯ä¸‰æ¬¡é€†å‘å‡½æ•°è§£å¯†ã€‚![image-20250602201458975](/pictures/XYCTF2024/image-20250602201458975.png)\n\nâ€‹\tä½†æ˜¯ï¼Œçœ‹WPå¯ä»¥åˆ†æçŸ¥ï¼Œç¨‹åºçš„æºç å°±æ˜¯å¯¹å¯†æ–‡å’Œè¾“å…¥çš„ï¼Œéƒ½è¿›è¡Œäº†åŠ å¯†ï¼Œç„¶åè°ƒç”¨howtoloveï¼Œç„¶åæ‰æ¯”å¯¹ï¼Œæ¯”å¯¹å¯¹è±¡æ˜¯`user_input_int`å’Œ`plaintext_int`ã€‚è€ŒhowtoloveåŠ å¯†çš„æ˜¯`loveletter`ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯”å¯¹å°±æ˜¯å‡æ¯”å¯¹ï¼Œé‚£ä¸€å±‚encipheråŠ å¯†å®Œå…¨æ²¡æœ‰å¿…è¦ï¼Œå°±ç›¸å½“äºåœ¨è¾“å…¥å­—ç¬¦ä¸²å’Œå‡flagè¿›è¡Œæ˜æ–‡æ¯”å¯¹ã€‚è¿™ä¸ªç¨‹åºä¸­çš„æ¯”å¯¹å°±ä¸æ˜¯æ­£å¸¸çš„ï¼Œæˆ‘ä»¬ä¸èƒ½æŒ‰ç…§æ­£å¸¸çš„é€»è¾‘å–é¢„æœŸæˆ‘ä»¬è¾“å…¥æ­£ç¡®flagå°±ä¼šè¾“å‡ºæ­£ç¡®çš„æç¤ºä¿¡æ¯ã€‚ä¸éš¾çŒœå‡ºï¼Œä½œè€…æƒ³è¦å‘Šè¯‰æˆ‘ä»¬ï¼Œhowtoloveå‡½æ•°æ‰æ˜¯åŠ å¯†çš„é€»è¾‘ã€‚\n\nâ€‹\tç®—äº†ï¼Œä¸æƒ³å¤šè¯´äº†ï¼Œæˆ‘æ€€ç–‘æºç å°±æ˜¯é”™çš„ç‰ˆæœ¬ï¼Œæ€ä¹ˆèƒ½è¿™æ ·éªŒè¯å•Šã€‚\n\n![image-20250602201907424](/pictures/XYCTF2024/image-20250602201907424.png)\n\n![image-20250602201956024](/pictures/XYCTF2024/image-20250602201956024.png)\n\n\n\nâ€‹\tåˆ†æåŠå¤©ï¼Œä¸€è°ƒè¯•å°±å‘ç°ï¼Œdestæ˜¯tmæŒ‡å‘srcçš„å‰¯æœ¬ï¼Œv14æ˜¯æŒ‡å‘å’ŒsåŒæ ·å†…å®¹çš„ï¼Œä½†æ˜¯v14æ˜¯æŒ‡å‘sçš„å‰¯æœ¬çš„ï¼Œåé¢çš„sæ‰æ˜¯çœŸæ­£å¯¹sæ•°ç»„è¿›è¡ŒåŠ å¯†çš„ï¼Œæ‰€ä»¥å®é™…ä¸Šæœ€åæ¯”å¯¹å°±æ˜¯srcæ•°ç»„å’Œhowtolove(s)å¾—åˆ°çš„æ•°ç»„ã€‚\n\nâ€‹\tç‹—æ—¥çš„åç¼–è¯‘ä¸€ç‚¹çœ‹ä¸å‡ºæ¥ï¼Œçœ‹ç€å°±æ˜¯å¯¹æŒ‡é’ˆè¿›è¡Œæ“ä½œï¼ŒæŒ‡å‘çš„å°±æ˜¯åŒä¸€ä¸ªæ•°ç»„å•Šï¼Œå†ä¹Ÿä¸ä¿¡åç¼–è¯‘çš„ä¼ªä»£ç äº†ã€‚\n\nâ€‹\tå½“ç„¶ï¼Œåé¢é—®AIåˆæƒ³åˆ°ä¸€äº›ï¼šmemcpyå‡½æ•°ä¸€èˆ¬æ˜¯å¯¹ä¸¤ä¸ªä¸åŒåœ°å€çš„æ•°ç»„è¿›è¡Œå¤åˆ¶æ“ä½œï¼Œå¦‚æœv14å’ŒsæŒ‡é’ˆç›¸åŒçš„è¯ï¼Œé‚£å¤„ç†çš„å°±æ˜¯åŒä¸€å—å†…å­˜äº†ï¼Œé‚£å¤åˆ¶è¿˜æœ‰ä»€ä¹ˆæ„ä¹‰å‘¢ï¼è¿™é‡Œå¯èƒ½èƒ½getåˆ°ä¸€äº›å¼‚å¸¸ä¹‹å¤„ï¼Œå¼€å§‹æ²¡æœ‰è¿™ä¸ªç†è§£ã€‚\n\nâ€‹\tä¸‹é¢è‡ªå·±å†™çš„ä»£ç é™„ä¸Šã€‚\n\n```c\n#include <stdio.h>\n#include <stdlib.h> \n#include <stdint.h>\n#include <string.h>\n\nvoid re_howtolove(char *a1)\n{\n    int v2[1802] = {0};\n    //memset(v2, 0, sizeof(v2));\n    v2[32] = 2;\n    v2[65] = 2;\n    v2[66] = 4;\n    v2[98] = 2;\n    v2[99] = 5;\n    v2[185] = 2;\n    v2[186] = 2;\n    v2[187] = 1;\n    v2[188] = 1;\n    v2[189] = 1;\n    v2[190] = 1;\n    v2[191] = 1;\n    v2[192] = 1;\n    v2[193] = 1;\n    v2[194] = 1;\n    v2[195] = 1;\n    v2[196] = 1;\n    v2[197] = 1;\n    v2[198] = 1;\n    v2[199] = 1;\n    v2[200] = 1;\n    v2[201] = 1;\n    v2[202] = 1;\n    v2[203] = 1;\n    v2[204] = 1;\n    v2[205] = 1;\n    v2[206] = 1;\n    v2[207] = 1;\n    v2[208] = 1;\n    v2[209] = 1;\n    v2[210] = 1;\n    v2[211] = 1;\n    v2[212] = 1;\n    v2[213] = 1;\n    v2[214] = 1;\n    v2[215] = 1;\n    v2[216] = 1;\n    v2[217] = 1;\n    v2[218] = 1;\n    v2[219] = 1;\n    v2[220] = 1;\n    v2[221] = 1;\n    v2[222] = 1;\n    v2[223] = 1;\n    v2[224] = 1;\n    v2[225] = 1;\n    v2[226] = 1;\n    v2[227] = 1;\n    v2[228] = 1;\n    v2[229] = 2;\n    v2[232] = 2;\n    v2[256] = 2;\n    v2[257] = 5;\n    v2[303] = 1;\n    v2[304] = 1;\n    v2[305] = 1;\n    v2[306] = 1;\n    v2[307] = 2;\n    v2[308] = 5;\n    v2[328] = 1;\n    v2[329] = 1;\n    v2[330] = 1;\n    v2[331] = 1;\n    v2[332] = 1;\n    v2[333] = 1;\n    v2[334] = 1;\n    v2[335] = 1;\n    v2[336] = 1;\n    v2[337] = 1;\n    v2[338] = 1;\n    v2[339] = 1;\n    v2[340] = 1;\n    v2[341] = 1;\n    v2[342] = 2;\n    v2[353] = 2;\n    v2[354] = 5;\n    v2[430] = 2;\n    v2[431] = 2;\n    v2[432] = 5;\n    v2[523] = 2;\n    v2[524] = 5;\n    v2[564] = 2;\n    v2[565] = 5;\n    v2[627] = 2;\n    v2[628] = 1;\n    v2[629] = 1;\n    v2[630] = 1;\n    v2[631] = 1;\n    v2[632] = 1;\n    v2[633] = 1;\n    v2[634] = 1;\n    v2[635] = 1;\n    v2[636] = 1;\n    v2[637] = 1;\n    v2[638] = 1;\n    v2[639] = 1;\n    v2[640] = 1;\n    v2[641] = 1;\n    v2[642] = 1;\n    v2[643] = 1;\n    v2[644] = 1;\n    v2[645] = 1;\n    v2[646] = 1;\n    v2[647] = 2;\n    v2[648] = 4;\n    v2[649] = 1;\n    v2[650] = 1;\n    v2[651] = 1;\n    v2[652] = 1;\n    v2[653] = 2;\n    v2[680] = 2;\n    v2[687] = 2;\n    v2[688] = 4;\n    v2[698] = 2;\n    v2[766] = 2;\n    v2[767] = 5;\n    v2[818] = 2;\n    v2[819] = 1;\n    v2[820] = 2;\n    v2[827] = 2;\n    v2[828] = 5;\n    v2[846] = 2;\n    v2[847] = 5;\n    v2[890] = 2;\n    v2[891] = 1;\n    v2[892] = 1;\n    v2[893] = 1;\n    v2[894] = 1;\n    v2[895] = 1;\n    v2[896] = 1;\n    v2[897] = 1;\n    v2[898] = 1;\n    v2[899] = 1;\n    v2[900] = 1;\n    v2[901] = 1;\n    v2[902] = 1;\n    v2[903] = 1;\n    v2[904] = 1;\n    v2[905] = 1;\n    v2[906] = 1;\n    v2[907] = 1;\n    v2[908] = 1;\n    v2[909] = 1;\n    v2[910] = 1;\n    v2[911] = 1;\n    v2[912] = 1;\n    v2[913] = 1;\n    v2[914] = 1;\n    v2[915] = 1;\n    v2[916] = 1;\n    v2[917] = 1;\n    v2[918] = 1;\n    v2[919] = 1;\n    v2[920] = 1;\n    v2[921] = 1;\n    v2[922] = 1;\n    v2[923] = 1;\n    v2[924] = 1;\n    v2[925] = 1;\n    v2[926] = 1;\n    v2[927] = 1;\n    v2[928] = 1;\n    v2[929] = 1;\n    v2[930] = 1;\n    v2[931] = 1;\n    v2[932] = 1;\n    v2[933] = 2;\n    v2[934] = 5;\n    v2[989] = 2;\n    v2[994] = 2;\n    v2[995] = 1;\n    v2[996] = 1;\n    v2[997] = 1;\n    v2[998] = 1;\n    v2[999] = 1;\n    v2[1000] = 1;\n    v2[1001] = 1;\n    v2[1002] = 1;\n    v2[1003] = 1;\n    v2[1013] = 1;\n    v2[1014] = 1;\n    v2[1015] = 1;\n    v2[1016] = 1;\n    v2[1017] = 1;\n    v2[1018] = 1;\n    v2[1019] = 1;\n    v2[1020] = 1;\n    v2[1021] = 1;\n    v2[1022] = 1;\n    v2[1023] = 1;\n    v2[1024] = 1;\n    v2[1025] = 1;\n    v2[1026] = 1;\n    v2[1027] = 2;\n    v2[1028] = 3;\n\n    int v3 =1027,v4 =31;\n    \n    // for(; v3>=0; --v3)\n    // {\n    //     switch(v2[v3])\n    //     {\n    //         case 0:\n    //             --crypted[v4];\n    //             break;\n    //         case 1:\n    //             ++crypted[v4];\n    //             break;\n    //         case 2:\n    //             v4--;\n    //             break;\n    //         case 4:\n    //             crypted[v4] -= crypted[v4+1] + 70 ;\t\tè¿™é‡Œå°±æ˜¯é”™è¯¯ä¹‹å¤„ï¼Œè¿™ä¸ªé”™è¯¯è¯­å¥ç­‰ä»·äº-(crypted[v4+1]+70)ï¼Œæ˜¯é”™è¯¯çš„å•Šï¼Œæˆ‘ä»¬è¦çš„å®é™…ä¸Šæ˜¯-crypted[v4+1]-70ã€‚\n    //             break;\n    //         case 5:\n    //             crypted[v4] += crypted[v4+1] - 70 ;\t\t\tè¿™é‡ŒåŒç†ã€‚\n    //             break;\n    //         default:\n    //             break;\n    //     }\n    // }\n    \n    for(; v3>=0; --v3)\n    {\n        switch(v2[v3])\n        {\n            case 0:\n                --a1[v4];\n                break;\n            case 1:\n                ++a1[v4];\n                break;\n            case 2:\n                v4--;\n                break;\n            case 4:\n                a1[v4] = a1[v4] - a1[v4+1] + 70 ;\n                break;\n            case 5:\n                a1[v4] = a1[v4] + a1[v4+1] - 70 ;\n                break;\n            default:\n                break;\n        }\n    }\n}\n\n//æ— ç”¨çš„tea\nvoid detea(uint32_t *v, uint32_t *k)\n{\n    int rounds = 52;\n    uint32_t v0 = v[0];\n    uint32_t v1 = v[1];\n    uint32_t delta = 0x9E3779B9;\n    uint32_t sum = delta * rounds;\n    for(int i=0;i<rounds;i++)\n    {\n        v1 -= (((v0 >> 4)^(v0<<5)) + v0) ^ (k[(sum >> 11) & 3] + sum);\n        sum -= delta;\n        v0 -= (((v1 >> 4)^(v1<<5)) + v1) ^ (k[sum & 3] + sum);\n    }\n    v[0] = v0;\n    v[1] = v1;\n}\n\n\nint main()\n{\n    char crypted[32] = \"flag{Love_is_not_one_sided_Love}\";\n    re_howtolove(crypted);\n    //uint32_t key[4] = {0x12345678,0x9ABCDEF0,0x9AB111F0,0x9A323EF0};\n    //detea((uint32_t *)crypted, key);\n    //detea((uint32_t *)crypted, key);\n    for(int i=0;i<32;i++)\n    {\n        printf(\"%c\",crypted[i]);\n    }\n    return 0;\n}\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n# ä½•é¡»ç›¸æ€ç…®ä½™å¹´\n\nâ€‹\tç»™äº†ä¸ªçº¯æ–‡æœ¬ï¼Œ6ï¼Œçœ‹ç€åº”è¯¥æ˜¯æœºå™¨ç å’Œå¯†æ–‡ã€‚ç»“æœè·ªäº†ï¼Œ32ã€64ä½éƒ½ä¸è¡Œã€‚\n\nâ€‹\tçœ‹WPä½¿ç”¨äº†ä¸€ä¸ªpythonåº“ï¼Œæ¥è¿›è¡Œåæ±‡ç¼–ï¼Œæ˜¯x86-32çš„ã€‚\n\nâ€‹\tä¸‹é¢æ˜¯åæ±‡ç¼–çš„ä»£ç ã€‚\n\n```python\nfrom capstone import *\n\ncode = \"\"\"\n0x55  0x8b  0xec  0x81  0xec  0xa8  0x0  0x0  0x0  0xa1  0x0  0x40  0x41  0x0  0x33  0xc5  0x89  0x45  0xfc  0x68  0x9c  0x0  0x0  0x0  0x6a  0x0  0x8d  0x85  0x60  0xff  0xff  0xff  0x50  0xe8  0x7a  0xc  0x0  0x0  0x83  0xc4  0xc  0xc7  0x85  0x58  0xff  0xff  0xff  0x27  0x0  0x0  0x0  0xc7  0x85  0x5c  0xff  0xff  0xff  0x0  0x0  0x0  0x0  0xeb  0xf  0x8b  0x8d  0x5c  0xff  0xff  0xff  0x83  0xc1  0x1  0x89  0x8d  0x5c  0xff  0xff  0xff  0x83  0xbd  0x5c  0xff  0xff  0xff  0x27  0xf  0x8d  0xed  0x0  0x0  0x0  0x8b  0x95  0x5c  0xff  0xff  0xff  0x81  0xe2  0x3  0x0  0x0  0x80  0x79  0x5  0x4a  0x83  0xca  0xfc  0x42  0x85  0xd2  0x75  0x25  0x8b  0x85  0x5c  0xff  0xff  0xff  0x8b  0x8c  0x85  0x60  0xff  0xff  0xff  0x3  0x8d  0x5c  0xff  0xff  0xff  0x8b  0x95  0x5c  0xff  0xff  0xff  0x89  0x8c  0x95  0x60  0xff  0xff  0xff  0xe9  0xac  0x0  0x0  0x0  0x8b  0x85  0x5c  0xff  0xff  0xff  0x25  0x3  0x0  0x0  0x80  0x79  0x5  0x48  0x83  0xc8  0xfc  0x40  0x83  0xf8  0x1  0x75  0x22  0x8b  0x8d  0x5c  0xff  0xff  0xff  0x8b  0x94  0x8d  0x60  0xff  0xff  0xff  0x2b  0x95  0x5c  0xff  0xff  0xff  0x8b  0x85  0x5c  0xff  0xff  0xff  0x89  0x94  0x85  0x60  0xff  0xff  0xff  0xeb  0x73  0x8b  0x8d  0x5c  0xff  0xff  0xff  0x81  0xe1  0x3  0x0  0x0  0x80  0x79  0x5  0x49  0x83  0xc9  0xfc  0x41  0x83  0xf9  0x2  0x75  0x23  0x8b  0x95  0x5c  0xff  0xff  0xff  0x8b  0x84  0x95  0x60  0xff  0xff  0xff  0xf  0xaf  0x85  0x5c  0xff  0xff  0xff  0x8b  0x8d  0x5c  0xff  0xff  0xff  0x89  0x84  0x8d  0x60  0xff  0xff  0xff  0xeb  0x38  0x8b  0x95  0x5c  0xff  0xff  0xff  0x81  0xe2  0x3  0x0  0x0  0x80  0x79  0x5  0x4a  0x83  0xca  0xfc  0x42  0x83  0xfa  0x3  0x75  0x20  0x8b  0x85  0x5c  0xff  0xff  0xff  0x8b  0x8c  0x85  0x60  0xff  0xff  0xff  0x33  0x8d  0x5c  0xff  0xff  0xff  0x8b  0x95  0x5c  0xff  0xff  0xff  0x89  0x8c  0x95  0x60  0xff  0xff  0xff  0xe9  0xf7  0xfe  0xff  0xff  0x33  0xc0  0x8b  0x4d  0xfc  0x33  0xcd  0xe8  0x4  0x0  0x0  0x0  0x8b  0xe5  0x5d  0xc3\n\"\"\"\n\nopcode = []\ncode = code.split()\nfor i in range(0, len(code), 1):\n    opcode.append(int(code[i][2:], 16))\n    print(hex(opcode[i]), end=' ')\n\n\nopcode = bytes(opcode)\n\nBaseAddr = 0\n\nmd = Cs(CS_ARCH_X86, CS_MODE_32)\nfor x in md.disasm(opcode, 0):\n    addr = x.address + BaseAddr\n    print(hex(addr)[2:],x.mnemonic,x.op_str)\n```\n\nâ€‹\tè¿™ä¸ªé¢˜è¿˜æ˜¯ä¸€ç‚¹éš¾åº¦çš„ï¼Œéœ€è¦æ“…é•¿æ±‡ç¼–ä»£ç ï¼Œæˆ–è€…æ“…é•¿chatgptï¼ˆå“ˆå“ˆï¼‰ã€‚\n\n```assembly\n1 mov ebp, esp\n3 sub esp, 0xa8\n9 mov eax, dword ptr [0x414000]\ne xor eax, ebp\n10 mov dword ptr [ebp - 4], eax\n13 push 0x9c\n18 push 0\n1a lea eax, [ebp - 0xa0]\n20 push eax\n21 call 0xca0\n26 add esp, 0xc\n29 mov dword ptr [ebp - 0xa8], 0x27\n33 mov dword ptr [ebp - 0xa4], 0\n3d jmp 0x4e\n3f mov ecx, dword ptr [ebp - 0xa4]\n45 add ecx, 1\n48 mov dword ptr [ebp - 0xa4], ecx\t\t\t;i++\n4e cmp dword ptr [ebp - 0xa4], 0x27\t\t\t;i<0x27\n55 jge 0x148\n5b mov edx, dword ptr [ebp - 0xa4]\n61 and edx, 0x80000003\t\t\t\t\t\t;å–ç¬¦å·ä½å’Œæœ€ä½2ä½\n67 jns 0x6e\t\t\t\t\t\t\t\t\t;ç»“æœéè´Ÿè·³è½¬\n69 dec edx\n6a or edx, 0xfffffffc\n6d inc edx\n6e test edx, edx\t\t\t\t\t;æŒ‰ä½ä¸ï¼Œä½†ä¸ä¿å­˜ç»“æœï¼Œåªè®¾ç½®æ ‡å¿—ä½Z\n70 jne 0x97\t\t\t\t\t\t\t\t;edx!=0è·³è½¬\n72 mov eax, dword ptr [ebp - 0xa4]\n78 mov ecx, dword ptr [ebp + eax*4 - 0xa0]\t\t;æ•°ç»„å–å€¼ï¼Œè®¾æ•°ç»„æ˜¯s\n7f add ecx, dword ptr [ebp - 0xa4]\t\t\t;s[i]+i\n85 mov edx, dword ptr [ebp - 0xa4]\n8b mov dword ptr [ebp + edx*4 - 0xa0], ecx    ;s[i]=s[i]+i\n92 jmp 0x143\n97 mov eax, dword ptr [ebp - 0xa4]\n9d and eax, 0x80000003\na2 jns 0xa9\t\t\t\t\t\t\t;ç¬¦å·ä½ä¸º0è·³è½¬\na4 dec eax\na5 or eax, 0xfffffffc\na8 inc eax\na9 cmp eax, 1\t\t\t\t\nac jne 0xd0\nae mov ecx, dword ptr [ebp - 0xa4]\nb4 mov edx, dword ptr [ebp + ecx*4 - 0xa0]\nbb sub edx, dword ptr [ebp - 0xa4]\t\t\t;s[i]-i\nc1 mov eax, dword ptr [ebp - 0xa4]\nc7 mov dword ptr [ebp + eax*4 - 0xa0], edx\t\t;s[i]=s[i]-i\nce jmp 0x143\nd0 mov ecx, dword ptr [ebp - 0xa4]\nd6 and ecx, 0x80000003\ndc jns 0xe3\nde dec ecx\ndf or ecx, 0xfffffffc\ne2 inc ecx\ne3 cmp ecx, 2\ne6 jne 0x10b\ne8 mov edx, dword ptr [ebp - 0xa4]\nee mov eax, dword ptr [ebp + edx*4 - 0xa0]\nf5 imul eax, dword ptr [ebp - 0xa4]\t\t;s[i] * i\nfc mov ecx, dword ptr [ebp - 0xa4]\n102 mov dword ptr [ebp + ecx*4 - 0xa0], eax\n109 jmp 0x143\n10b mov edx, dword ptr [ebp - 0xa4]\n111 and edx, 0x80000003\n117 jns 0x11e\n119 dec edx\n11a or edx, 0xfffffffc\n11d inc edx\n11e cmp edx, 3\n121 jne 0x143\n123 mov eax, dword ptr [ebp - 0xa4]\n129 mov ecx, dword ptr [ebp + eax*4 - 0xa0]\n130 xor ecx, dword ptr [ebp - 0xa4]\t\t\t;s[i] ^ i\n136 mov edx, dword ptr [ebp - 0xa4]\n13c mov dword ptr [ebp + edx*4 - 0xa0], ecx\n143 jmp 0x3f\n148 xor eax, eax\n14a mov ecx, dword ptr [ebp - 4]\n14d xor ecx, ebp\n14f call 0x158\n154 mov esp, ebp\n156 pop ebp\n157 ret \n```\n\n```python\nenc = [88,88,134,87,74,118,318,101,59,92,480,60,65,41,770,110,73,31,918,39,120,27,1188,47,77,24,1352,44,81,23,1680,46,85,15,1870,66,91,16,4750]\n\nfor i in range(len(enc)):\n    if i % 4 == 0:\n        print(chr(enc[i]-i), end='')\n        continue\n    if i % 4 == 1:\n        print(chr(enc[i]+i), end='')\n        continue\n    if i % 4 == 2:\n        print(chr(enc[i]//i), end='')\t\t\t#éœ€è¦æ˜¯æ•´é™¤ï¼Œå‘ä¸‹å–æ•´\n        continue\n    if i % 4 == 3:\n        print(chr(enc[i]^i), end='')\n        continue\n```\n\n\n\n\n\n# ez_enc\n\nâ€‹\t\n\n```python\nenc = [0x27,0x24,0x17,0xb,0x50,0x3,0xc8,0xc,0x1f,0x17,0x36,0x55,0xcb,0x2d,0xe9,0x32,0xe,0x11,0x26,0x2,0xc,0x7,0xfc,0x27,0x3d,0x2d,0xed,0x35,0x59,0xeb,0x3c,0x3e,0xe4,0x7d]\n\nkey = \"IMouto\"\n\nfor i in range(len(enc)-2, 0, -1):\n    enc[i] = enc[i] ^ ord(key[i%6])\n    enc[i] = enc[i] - enc[i+1]\n\t\n    #ç”¨ä¸Šä¸€ä¸ªå­—ç¬¦æ±‚å‡ºæ¥çš„tmpå¿…æ»¡è¶³åœ¨0åˆ°20ä¹‹é—´çš„é™åˆ¶\n    tmp = enc[i-1] ^ ord(key[(i-1)%6])\n    tmp = tmp - enc[i]\n    enc[i] += tmp // 20 * 20\n\nprint(\"f\", end=\"\")\t\t#ç¬¬ä¸€ä¸ªå°±ä¸ç”¨ç®—äº†\nfor i in range(1,len(enc)):\n    print(chr(enc[i]), end=\"\")\n```\n\n\n\n\n\n# baby unity\n\nâ€‹\tæ¸¸æˆæ˜¯unityåšçš„è¾“å…¥éªŒè¯æ–‡æœ¬æ¡†ï¼Ÿå“ˆï¼Œè¿™ä¹ˆææ˜¯å§ï¼Œå°æ¸¸æˆéƒ½ä¸ç»™ç©ï¼Œä¸ä¼šé€†ï¼Œç›´æ¥å­¦WPã€‚\n\nâ€‹\tGameAssembly.dllå’Œbaby unity.exeéƒ½è¢«upxå‹ç¼©äº†ä¸€ä¸‹ï¼Œå¸ˆå‚…è¯´å•çº¯ä¸ºäº†å‡å°‘é™„ä»¶çš„å¤§å°ï¼Œå“ˆï¼Œè¿˜å¾—å…ˆå»å£³ã€‚\n\nâ€‹\tå…ˆä½¿ç”¨Il2CppDumper.exeæ¢å¤ç¬¦å·ä¿¡æ¯ï¼Œå…ˆé€‰.dllæ–‡ä»¶ï¼Œå†é€‰.batæ–‡ä»¶ã€‚ç„¶åä½¿ç”¨IDAæ‰“å¼€DLLæ–‡ä»¶ï¼Œä½¿ç”¨pythonè„šæœ¬ida_with_struct_py3.pyåŠ è½½åˆšåˆšå¾—åˆ°çš„script.jsonå’Œil2cpp.hæ–‡ä»¶ã€‚\n\nâ€‹\tå†ä½¿ç”¨dnSpyå»æŸ¥çœ‹Assembly-CSharp.dllæ–‡ä»¶ï¼Œçœ‹å…¶ä¸­å¯ç–‘çš„ç±»åã€æ–¹æ³•åï¼Œä½†æ˜¯é‡Œé¢æ˜¯æ²¡åŠæ³•çœ‹æºç çš„ï¼Œæ‰€ä»¥è¦å›åˆ°IDAä¸­æŸ¥çœ‹åç¼–è¯‘çš„æºç ï¼Œç”±äºæ¢å¤äº†ç¬¦å·ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨IDAç›´æ¥æœç´¢å‡½æ•°åå°±è¡Œäº†ã€‚\n\n![image-20250605150220575](/pictures/XYCTF2024/image-20250605150220575.png)\n\n![image-20250605150236561](/pictures/XYCTF2024/image-20250605150236561.png)\n\nâ€‹\tçœ‹åˆ°IDAï¼Œæˆ‘ä»¬æ¢ä¸ªä¸»é¢˜é¢œè‰²ï¼Œä¹‹å‰çš„æœ‰ç‚¹çœ‹è…»äº†ã€‚çœ‹åˆ°æ˜æ˜¾çš„base64å’Œå¼‚æˆ–0xFï¼Œæ¯”è¾ƒå¥‡æ€ªçš„æ˜¯å¯†æ–‡å±…ç„¶æ˜¯åœ¨æ³¨é‡Šé‡Œï¼Œéš¾ä¸æˆè¿™ä¸ª8å­—èŠ‚ä¿å­˜çš„æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘å…¶ä»–æ–‡ä»¶ä¸­çš„å­—ç¬¦ä¸²ï¼Œè¿™é‡Œèƒ½çœ‹åˆ°æ˜¯å› ä¸ºæ¢å¤äº†ç¬¦å·ä¿¡æ¯ï¼Œè¿™é‡Œè‡ªåŠ¨æŠŠå­—ç¬¦ä¸²å–å‡ºæ”¾åœ¨è¿™é‡Œäº†ï¼Ÿ\n\nâ€‹\tä¹‹åèµ›åšå¨å­è§£å¯†å°±å¥½ã€‚\n\n![image-20250605151110999](/pictures/XYCTF2024/image-20250605151110999.png)\n\n![image-20250605151155177](/pictures/XYCTF2024/image-20250605151155177.png)\n\n\n\n\n\n\n\n\n\n# ez unityï¼ˆæœªåšï¼Œç¯å¢ƒä¸è¡Œï¼‰\n\nâ€‹\tè¿™ç§il2cppçš„unityé€†å‘å®Œå…¨æ²¡æœ‰æ¥è§¦è¿‡ï¼Œç°åœ¨éƒ½æ˜¯å®è¡ŒWPå­¦ä¹ å¤§æ³•ï¼Œé…ç¯å¢ƒå°±èŠ±äº†å¥½é•¿æ—¶é—´ï¼Œä¸‹é¢è®°å½•ä¸€ä¸‹æˆ‘è¸©çš„å‘ã€‚\n\nâ€‹\té¦–å…ˆå°†èƒ½å¤Ÿç”Ÿæˆhook.jsè„šæœ¬çš„æ–¹æ³•ï¼Œå…ˆé€šè¿‡pipä¸‹è½½å¥½fridaå’Œfrida-toolså·¥å…·ï¼Œç„¶åé€šè¿‡`npm i frida-il2cpp-bridge`å‘½ä»¤ä¸‹è½½ä¸‹æ¥æ¡†æ¶ï¼Œç„¶åé…ç½®package.jsonæ–‡ä»¶ï¼Œå…·ä½“å†…å®¹æ ¹æ®éœ€è¦é…ç½®ï¼ˆå½“ç„¶å»æŠ„ï¼‰ï¼Œ[è¯¦ç»†çš„æ•™ç¨‹](https://blog.csdn.net/weixin_44292683/article/details/132125663)æ–‡ç« å°±æ˜¯è¿™ä¸ªï¼Œå°±æ˜¯å…¶ä¸­çš„æ–¹æ³•2ã€‚\n\nâ€‹\tåœ¨ä¸€åˆ‡å‡†å¤‡å°±ç»ªåï¼Œæˆ‘æ‰§è¡Œç¬¬ä¸€ä¸ªæ³¨å…¥å‘½ä»¤å°±æŠ¥é”™äº†ï¼Œæˆ‘åå¤æ›´æ¢æ–‡ä»¶ï¼Œæ›´æ¢fridaç¯å¢ƒåˆ°16.2.1å’Œ17.1.0ï¼Œä¹Ÿé‡ä¸‹äº†é¢˜ç›®é™„ä»¶ï¼Œåœ¨è™šæ‹ŸæœºCTFOSå’Œæœ¬æœºä¸Šéƒ½è¯•è¿‡äº†ï¼Œä½†æ˜¯éƒ½æ˜¯æŠ¥å‡ºåŒæ ·ä¸€ä¸ªé”™è¯¯ï¼Œæˆ‘å®Œå…¨ä¸ç†è§£æ˜¯ä¸ºä»€ä¹ˆã€‚\n\n![image-20250606202411829](/pictures/XYCTF2024/image-20250606202411829.png)\n\nâ€‹\tåé¢ä½¿ç”¨æ•™ç¨‹çš„ç¬¬ä¸€ç§æ–¹æ³•ç¼–è¯‘frida-il2cpp-bridgeé¡¹ç›®åï¼Œä¹Ÿæ˜¯æ²¡èƒ½è§£å†³é—®é¢˜ã€‚\n\n![image-20250606204030666](/pictures/XYCTF2024/image-20250606204030666.png)\n\nâ€‹\t\n\n\n\n\n\n\n\n\n\n\n\n# ezmath\n\nâ€‹\tpythoné€†å‘ï¼Œä¸€ä¸ªäºŒæ¬¡å¤šé¡¹å¼æ±‚è§£é—®é¢˜ï¼Œå­¦ä¹ z3æ±‚è§£å™¨ã€‚è§£åŒ…å‡ºæ¥ï¼Œæ˜¯ä»¥è¿™ç§å½¢å¼æ¥è¡¨ç¤ºä¹˜ç§¯çš„ï¼š`sum( (lambda .0: [ flag[23] for _ in .0 ])(range(flag[23])) )`ã€‚\n\nâ€‹\tå¼ºè¡Œä½¿ç”¨z3ç ´è§£ï¼Œè€—æ—¶å¾ˆé•¿ï¼Œæˆ‘ç­‰äº†åå‡ åˆ†é’Ÿéƒ½æ²¡ç»“æœï¼Œä¸çŸ¥é“è¿˜è¦ç®—å¤šä¹…ï¼Œç›´æ¥çœ‹WPï¼Œæœ‰ä¸€ä¸ªå¾ˆå·§å¦™çš„æ€è·¯ï¼Œå› ä¸ºè¿™ä¸ªäºŒæ¬¡å¤šé¡¹å¼=0ï¼Œè€Œä¸”å¼å­ä¸­æ¯ä¸ªäºŒæ¬¡é¡¹çš„ç³»æ•°éƒ½æ˜¯1ï¼Œæˆ‘ä»¬çŸ¥é“(x_i - ord(flag[i]))**2 = 0ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„è¿™äº›å¼å­å±•å¼€å°±ä¼šå¾—åˆ°è¯¥é¢˜çš„çš„å¼å­ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œé™„ä»¶ä¸­ç»™å‡ºçš„äºŒæ¬¡å¤šé¡¹å¼å°±æ˜¯å°†äºŒæ¬¡å¹³æ–¹é¡¹å±•å¼€çš„ç»“æœã€‚è¿™æ ·å°±æœ‰ä¸€ä¸ªè§„å¾‹äº†ï¼Œæ‰€æœ‰çš„ä¸€æ¬¡é¡¹ç³»æ•°é™¤ä»¥2å°±æ˜¯å¯¹åº”çš„å¸¸æ•°å€¼ï¼ˆå¯¹åº”flagçš„ASCIIç å€¼ï¼‰ã€‚\n\nâ€‹\tåº”è¯¥è¯´è¿™æ˜¯ä¸€ä¸ªæ•°å­¦æ¨å¯¼æŠ€å·§ï¼Œåœ¨æ•°å­¦é¢˜ä¸­ä¹Ÿä¼šä½¿ç”¨çš„æŠ€å·§ã€‚åˆä¸­ç”Ÿéƒ½ä¼šï¼Œå¤§å­¦ç”Ÿæƒ³ä¸åˆ°ä¸€ç‚¹ã€‚\n\n```python\nimport re\nstr = \"\"\"\nflag = (lambda .0: [ ord(i) for i in .0 ])(input('flag:'))\nif len(flag) == 32 and (((((((((((((((((((((sum((lambda .0: [ flag[23] for _ in .0 ])(range(flag[23]))) + sum((lambda .0: [ flag[12] for _ in .0 ])(range(flag[12]))) + sum((lambda .0: [ flag[1] for _ in .0 ])(range(flag[1]))) - sum((lambda .0: [ flag[24] for _ in .0 ])(range(222)))) + sum((lambda .0: [ flag[22] for _ in .0 ])(range(flag[22]))) + sum((lambda .0: [ flag[31] for _ in .0 ])(range(flag[31]))) + sum((lambda .0: [ flag[26] for _ in .0 ])(range(flag[26]))) - sum((lambda .0: [ flag[9] for _ in .0 ])(range(178))) - sum((lambda .0: [ flag[29] for _ in .0 ])(range(232)))) + sum((lambda .0: [ flag[17] for _ in .0 ])(range(flag[17]))) - sum((lambda .0: [ flag[23] for _ in .0 ])(range(150))) - sum((lambda .0: [ flag[6] for _ in .0 ])(range(226))) - sum((lambda .0: [ flag[7] for _ in .0 ])(range(110)))) + sum((lambda .0: [ flag[19] for _ in .0 ])(range(flag[19]))) + sum((lambda .0: [ flag[2] for _ in .0 ])(range(flag[2]))) - sum((lambda .0: [ flag[0] for _ in .0 ])(range(176)))) + sum((lambda .0: [ flag[10] for _ in .0 ])(range(flag[10]))) - sum((lambda .0: [ flag[12] for _ in .0 ])(range(198)))) + sum((lambda .0: [ flag[24] for _ in .0 ])(range(flag[24]))) + sum((lambda .0: [ flag[9] for _ in .0 ])(range(flag[9]))) - sum((lambda .0: [ flag[3] for _ in .0 ])(range(168)))) + sum((lambda .0: [ flag[8] for _ in .0 ])(range(flag[8]))) - sum((lambda .0: [ flag[2] for _ in .0 ])(range(134)))) + sum((lambda .0: [ flag[14] for _ in .0 ])(range(flag[14]))) - sum((lambda .0: [ flag[13] for _ in .0 ])(range(170)))) + sum((lambda .0: [ flag[4] for _ in .0 ])(range(flag[4]))) - sum((lambda .0: [ flag[10] for _ in .0 ])(range(142)))) + sum((lambda .0: [ flag[27] for _ in .0 ])(range(flag[27]))) + sum((lambda .0: [ flag[15] for _ in .0 ])(range(flag[15]))) - sum((lambda .0: [ flag[15] for _ in .0 ])(range(224)))) + sum((lambda .0: [ flag[16] for _ in .0 ])(range(flag[16]))) - sum((lambda .0: [ flag[11] for _ in .0 ])(range(230))) - sum((lambda .0: [ flag[1] for _ in .0 ])(range(178)))) + sum((lambda .0: [ flag[28] for _ in .0 ])(range(flag[28]))) - sum((lambda .0: [ flag[5] for _ in .0 ])(range(246))) - sum((lambda .0: [ flag[17] for _ in .0 ])(range(168)))) + sum((lambda .0: [ flag[30] for _ in .0 ])(range(flag[30]))) - sum((lambda .0: [ flag[21] for _ in .0 ])(range(220))) - sum((lambda .0: [ flag[22] for _ in .0 ])(range(212))) - sum((lambda .0: [ flag[16] for _ in .0 ])(range(232)))) + sum((lambda .0: [ flag[25] for _ in .0 ])(range(flag[25]))) - sum((lambda .0: [ flag[4] for _ in .0 ])(range(140))) - sum((lambda .0: [ flag[31] for _ in .0 ])(range(250))) - sum((lambda .0: [ flag[28] for _ in .0 ])(range(150)))) + sum((lambda .0: [ flag[11] for _ in .0 ])(range(flag[11]))) + sum((lambda .0: [ flag[13] for _ in .0 ])(range(flag[13]))) - sum((lambda .0: [ flag[14] for _ in .0 ])(range(234)))) + sum((lambda .0: [ flag[7] for _ in .0 ])(range(flag[7]))) - sum((lambda .0: [ flag[8] for _ in .0 ])(range(174)))) + sum((lambda .0: [ flag[3] for _ in .0 ])(range(flag[3]))) - sum((lambda .0: [ flag[25] for _ in .0 ])(range(242)))) + sum((lambda .0: [ flag[29] for _ in .0 ])(range(flag[29]))) + sum((lambda .0: [ flag[5] for _ in .0 ])(range(flag[5]))) - sum((lambda .0: [ flag[30] for _ in .0 ])(range(142))) - sum((lambda .0: [ flag[26] for _ in .0 ])(range(170))) - sum((lambda .0: [ flag[19] for _ in .0 ])(range(176)))) + sum((lambda .0: [ flag[0] for _ in .0 ])(range(flag[0]))) - sum((lambda .0: [ flag[27] for _ in .0 ])(range(168)))) + sum((lambda .0: [ flag[20] for _ in .0 ])(range(flag[20]))) - sum((lambda .0: [ flag[20] for _ in .0 ])(range(212)))) + sum((lambda .0: [ flag[21] for _ in .0 ])(range(flag[21]))) + sum((lambda .0: [ flag[6] for _ in .0 ])(range(flag[6]))) + sum((lambda .0: [ flag[18] for _ in .0 ])(range(flag[18]))) - sum((lambda .0: [ flag[18] for _ in .0 ])(range(178)))) + 297412 == 0:\n    print('yes')\n    return None\n\"\"\"\n\n#æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œ]ä¸éœ€è¦è½¬ä¹‰å•Šã€‚\npattern = r\"sum\\(\\(lambda .0: \\[ flag\\[(\\d+)] for _ in .0 ]\\)\\(range\\((\\d+)\\)\\)\\)\"\n\nmatches = re.findall(pattern, str)\n\nflag = [0] * 32\n\nfor match in matches:\n    flag[int(match[0])] = int(match[1])//2\n\nfor i in range(32):\n    print(chr(flag[i]), end='')\n```\n\n\n\n\n\n\n\n# èˆ”ç‹—å››éƒ¨æ›²--ç›¸é€¢å·²æ˜¯ä¸Šä¸Šç­¾\n\nâ€‹\tåˆæ˜¯8086+DOSç³»åˆ—ï¼ŒIDAç›´æ¥æ‰“å¼€è¿˜ä¸è¡Œã€‚ç®—äº†ï¼Œä¹±ä¸ƒå…«ç³Ÿçš„ï¼Œç›´æ¥çœ‹WPã€‚\n\nâ€‹\tæœ‰æ ‡å¿—ä½è¢«ä¿®æ”¹äº†ï¼Œå¦‚ä¸‹å›¾ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸Šé¢çš„çº¢æ¡†åº”è¯¥æ˜¯ä¸‹é¢çš„PEå¤´çš„åœ°å€ï¼Œè¿™é‡Œè¢«æ”¹äº†ï¼Œè¦æ”¹å›0x100ï¼Œä¹Ÿå°±æ˜¯0001ã€‚ä¹‹åå°±èƒ½IDAæ­£å¸¸è¯†åˆ«äº†ã€‚\n\n![image-20250601115228908](/pictures/XYCTF2024/image-20250601115228908.png)\n\n```python\n#z3ç ´è§£key\nfrom z3 import *\n\n# å®šä¹‰å˜é‡ï¼Œå‡è®¾æ˜¯æ•´æ•°\nbyte = [Int(f'byte_{i}') for i in range(6)]\n\ns = Solver()\n\n# å˜é‡èŒƒå›´å‡è®¾ï¼šæ¯”å¦‚å­—èŠ‚å¯æ‰“å°å­—ç¬¦èŒƒå›´(32~126)ï¼Œæˆ–è€…0~255\nfor b in byte:\n    s.add(b >= 32, b <= 126)\n\n# æ·»åŠ æ–¹ç¨‹\ns.add(\n    532 * byte[5] + 829 * byte[4] + 258 * byte[3] + 811 * byte[2] + 997 * byte[1] + 593 * byte[0] == 292512,\n    576 * byte[5] + 695 * byte[4] + 602 * byte[3] + 328 * byte[2] + 686 * byte[1] + 605 * byte[0] == 254496,\n    580 * byte[5] + 448 * byte[4] + 756 * byte[3] + 449 * byte[2] + 512 * byte[1] + 373 * byte[0] == 222479,\n    597 * byte[5] + 855 * byte[4] + 971 * byte[3] + 422 * byte[2] + 635 * byte[1] + 560 * byte[0] == 295184,\n    524 * byte[5] + 324 * byte[4] + 925 * byte[3] + 388 * byte[2] + 507 * byte[1] + 717 * byte[0] == 251887,\n    414 * byte[5] + 495 * byte[4] + 518 * byte[3] + 884 * byte[2] + 368 * byte[1] + 312 * byte[0] == 211260\n)\n\nif s.check() == sat:\n    model = s.model()\n    solution = [model[b].as_long() for b in byte]\n    for i in range(6):\n        print(chr(solution[i]), end='')\nelse:\n    print(\"No solution found.\")\n#XYCTF!\n```\n\nâ€‹\tè¿™ä¸ªå¸é¢˜æœ‰æ€ªä¸œè¥¿ï¼Œè„šæœ¬ç»å¯¹æœ‰æ€ªä¸œè¥¿ã€‚ä»Šå¤©å°±è®©æˆ‘ç¢°ä¸Šäº†ï¼ŒçœŸtmæ™¦æ°”ã€‚ã€‚\n\nâ€‹\tä¸‹é¢æ˜¯æˆ‘ç…§ç€WPæ”¹äº†ä¸€ç‚¹èƒ½è·‘çš„è„šæœ¬ã€‚\n\n```c\n//xxteaè§£å¯†\n#include<stdio.h>\n#include<stdlib.h>\n#include<stdint.h>\n#define DELTA 0x9E3779B9\n#define MX (((z ^ key[e ^ (p & 5)]) + (y ^ sum)) ^ (((z << 4) ^(y >> 3)) + ((y << 2) ^ (z >> 5))))\n\nvoid dexxtea(uint32_t *v, int n, char *key)\n{\n    uint32_t e = 0;\n    uint32_t rounds = 6 + 52 / n;\n    uint32_t sum = DELTA * rounds;\n    uint32_t y = 0, z = 0;\n    uint32_t p;\n    do{\n        e = (sum >> 2) & 5;\n        for(p=n-1; p>0; p--)\n        {\n            y = v[(p+1)%n];     //ä¿å­˜åŠ å¯†ä½çš„åä¸€ä½\n            z = v[(p-1)%n];         //ä¿å­˜åŠ å¯†ä½çš„å‰ä¸€ä½\n            v[p] -= MX;\n        }\n        y = v[(p+1)%n];     //ä¿å­˜åŠ å¯†ä½çš„åä¸€ä½\n        z = v[(p-1)%n];         //ä¿å­˜åŠ å¯†ä½çš„å‰ä¸€ä½\n        v[p] -= MX;\n        sum -= DELTA;\n    }while(--rounds);\n}\n\nint main()\n{\n    uint32_t enc[8] = {0x66697271,0x896E2285,0xC5188C1B,0x72BCFD03,0x538011CA,0x4DA146AC,0x86630D6B,0xF89797F0};\n    char *key = \"XYCTF!\";\n    dexxtea(enc, 8, key);\n    char *flag = (char*)enc;\n    for(int i=0;i < 32;i++)\n    {\n        printf(\"%c\",flag[i]);\n    }\n    return 0;\n}\n```\n\nâ€‹\tç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œçœ‹è¿™ä¸ªå¾ªç¯ä½“çš„å†…å®¹ï¼Œä¸Šé¢èƒ½è·‘ï¼Œä¸‹é¢å°±æ˜¯é”™çš„ã€‚å·®åˆ«å°±åœ¨äºp=0çš„æƒ…å†µï¼Œæ˜¯æ”¾åœ¨å¾ªç¯ä½“å†…éƒ¨ï¼Œè¿˜æ˜¯æ”¾åœ¨å¾ªç¯ä½“å¤–éƒ¨äº†ã€‚ç»“æœè¯¦ç»†ä¿¡æ¯åˆ†æï¼Œæˆ‘å¾—åˆ°ä¸€ç§å¯èƒ½è§£é‡Šï¼šå› ä¸ºpæ˜¯æ— ç¬¦å·32ä½æ•´æ•°ï¼Œæ°¸è¿œå¤§äºç­‰äº0ï¼Œæ‰€ä»¥ä¸‹é¢çš„æƒ…å†µåº”è¯¥æ˜¯æ— é™å¾ªç¯ï¼Œåœ¨ç¼–è¯‘å™¨ä¼˜åŒ–çš„æƒ…å†µåï¼Œè¿™ä¸ªåœ°æ–¹åº”è¯¥è¢«è¯†åˆ«å‡ºæ˜¯æ— é™å¾ªç¯ï¼Œç›´æ¥ä¸­æ–­ç¨‹åºäº†ï¼Œåœ¨forå¾ªç¯é‡Œé¢æ’å…¥printfæ ¹æœ¬ä¸è¾“å‡ºå•Šã€‚\n\n```c\ndo{\n        e = (sum >> 2) & 5;\n        for(p=n-1; p>0; p--)\n        {\n            y = v[(p+1)%n];     //ä¿å­˜åŠ å¯†ä½çš„åä¸€ä½\n            z = v[(p-1)%n];         //ä¿å­˜åŠ å¯†ä½çš„å‰ä¸€ä½\n            v[p] -= MX;\n        }\n        y = v[(p+1)%n];     //ä¿å­˜åŠ å¯†ä½çš„åä¸€ä½\n        z = v[(p-1)%n];         //ä¿å­˜åŠ å¯†ä½çš„å‰ä¸€ä½\n        v[p] -= MX;\n        sum -= DELTA;\n}while(--rounds);\n    \n    \ndo{\n        e = (sum >> 2) & 5;\n        for(p=n-1; p>=0; p--)\n        {\n            y = v[(p+1)%n];     //ä¿å­˜åŠ å¯†ä½çš„åä¸€ä½\n            z = v[(p-1)%n];         //ä¿å­˜åŠ å¯†ä½çš„å‰ä¸€ä½\n            v[p] -= MX;\n        }\n        sum -= DELTA;\n}while(--rounds);\n```\n\nâ€‹\tç¬¬äºŒä¸ªé—®é¢˜æ¥äº†ï¼ŒæŒ‰ç…§ç¬¬ä¸€ä¸ªèƒ½è·‘çš„ç‰ˆæœ¬ï¼Œæˆ‘å°†pçš„ç±»å‹æ”¹ä¸ºintå‹ï¼Œä¸ºä»€ä¹ˆå°±åˆä¸è¡Œäº†ï¼Ÿ\n\nâ€‹\tç¬¬äºŒä¸ªé—®é¢˜ä¹Ÿæœ‰äº†ç­”æ¡ˆï¼šçœ‹åˆ°è¿™ä¸ªå‚æ•°zçš„ä»£ç `z = v[(p-1)%n];` ã€‚æ— è®ºpæ˜¯æœ‰ç¬¦å·32ä½æ•´æ•°ï¼Œè¿˜æ˜¯æ— ç¬¦å·ï¼Œ`p-1ï¼ˆp=0ï¼‰`åœ¨æœºå™¨å†…çš„è¡¨ç¤ºéƒ½æ˜¯`FFFFFFFF`ï¼Œé€šè¿‡æ ¼å¼åŒ–å­—ç¬¦`%x`è¾“å‡ºéƒ½æ˜¯è¿™æ ·çš„ã€‚è€Œåˆ†åˆ«é€šè¿‡`%d %u`è¾“å‡ºï¼Œå´æ˜¯`-1`å’Œ`4294967295`ã€‚å†çœ‹ï¼Œ`(p-1)%8`åœ¨é€šè¿‡`%08x`è¾“å‡ºçš„æ—¶å€™å´åˆ†åˆ«æ˜¯`ffffffff` `00000007`ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨æœ‰ç¬¦å·æ•°ä¸­`-1%8=-1`ã€‚æ— ç¬¦å·æ•°`FFFFFFFF`ï¼ˆ`4294967295`ï¼‰æ¨¡8æ˜¯ç­‰äº7çš„ã€‚æ‰€ä»¥ä¼šå¯¼è‡´zçš„å–å€¼æ—¶çš„ç´¢å¼•å€¼ä¸ä¸€æ ·ã€‚\n\nâ€‹\t\n\nâ€‹\tç»¼ä¸Šï¼Œæ€»ç»“å‡ºæ— ç¬¦å·æ•°å½“ç´¢å¼•å€¼ï¼Œè¦ç‰¹æ®Šå¤„ç†ç­‰äº0çš„æƒ…å†µï¼›æœ‰ç¬¦å·æ•°çš„æ¨¡è¿ç®—ä¸­ï¼Œè´Ÿæ•°æ¨¡æ­£æ•°è¿˜æ˜¯è´Ÿæ•°ã€‚\n\n\n\n\n\n\n\n# Trustmeï¼ˆAPKï¼‰\n\nâ€‹\tåˆæ˜¯apkï¼Œæ”¾ä¸€è¾¹ã€‚è¿˜æ˜¯å­¦ä¹ WPã€‚\n\nâ€‹\tè¿™ä¸ªå€’æ˜¯æŒºæ­£å¸¸ï¼Œå¯ä»¥ä½¿ç”¨JADXæ‰“å¼€åˆ†æã€‚MainActivityä¸­æœ‰å‡çš„åˆ¤æ–­ï¼Œå¯¹å…¶è¿›è¡Œè§£å¯†å‡ºæ¥å¾—åˆ°ç”¨æˆ·åã€‚\n\n```python\ndef rc4(data: bytes, key: bytes) -> bytes:\n    S = list(range(256))\n    j = 0\n    out = []\n\n    # KSA: Key Scheduling Algorithm\n    for i in range(256):\n        j = (j + S[i] + key[i % len(key)]) % 256\n        S[i], S[j] = S[j], S[i]\n\n    # PRGA: Pseudo-Random Generation Algorithm\n    i = j = 0\n    for char in data:\n        i = (i + 1) % 256\n        j = (j + S[i]) % 256\n        S[i], S[j] = S[j], S[i]\n        out.append(char ^ S[(S[i] + S[j]) % 256])\n    return bytes(out)\n\n# è¾“å…¥å¯†æ–‡ï¼ˆåå…­è¿›åˆ¶ï¼‰å’Œå¯†é’¥\ncipher_hex = \"5a3c46e0228b444decc7651c8a7ca93ba4cb35a46f7eb589bef4\"\ncipher_bytes = bytes.fromhex(cipher_hex)\nkey = b\"XYCTF\"\n\n# è§£å¯†\nplaintext_bytes = rc4(cipher_bytes, key)\nprint(\"åŸæ–‡å¯†ç æ˜¯:\", plaintext_bytes.decode())\n#åŸæ–‡å¯†ç æ˜¯: The Real username is admin\n```\n\nâ€‹\tä½†æ˜¯æ²¡æœ‰å…¶ä»–ä¿¡æ¯äº†ï¼Œæˆ‘ä»¬ç¿»çœ‹åˆ°Proxyç±»ï¼Œçœ‹åˆ°å…¶ä¸­åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„shell.apkï¼Œæ˜¯å¯¹class.dexä¸­çš„æ•°æ®è¿›è¡Œæå–æ“ä½œçš„ã€‚\n\n```python\nimport struct\n\ndef decrypt(data: bytes) -> bytes:\n    # å¯¹æ¯ä¸ªå­—èŠ‚å¼‚æˆ– 0xFF\n    return bytes(b ^ 0xFF for b in data)\n\ndef split_payload_from_dex(bArr: bytes, apkFileName: str):\n    # å– dex æœ«å°¾4ä¸ªå­—èŠ‚ï¼Œè¯»å–payloadé•¿åº¦ï¼ˆintï¼Œ4å­—èŠ‚ï¼‰\n    readInt = struct.unpack(\">I\", bArr[-4:])[0]  # å¤§ç«¯ï¼Œè·ŸJavaé»˜è®¤DataInputStream.readIntä¸€æ ·\n    print(f\"Payload length: {readInt}\")\n\n    # å–å‡ºpayloadæ•°æ®\n    payload_encrypted = bArr[-4 - readInt : -4]\n\n    # è§£å¯†\n    payload_decrypted = decrypt(payload_encrypted)\n\n    # å†™å…¥è§£å¯†åçš„ APK æ–‡ä»¶\n    with open(apkFileName, \"wb\") as f:\n        f.write(payload_decrypted)\n    print(f\"Decrypted payload saved to {apkFileName}\")\n\n# ç¤ºä¾‹è°ƒç”¨\nif __name__ == \"__main__\":\n    # å‡è®¾ dex.bin æ˜¯ä½ æ•´ä¸ª dex æ–‡ä»¶\n    with open(r\"F:\\StudyFiles\\CTF\\Review_CTF\\XYCTF2024\\RE\\Trustme\\classes.dex\", \"rb\") as f:\n        dex_bytes = f.read()\n\n    split_payload_from_dex(dex_bytes, \"shell.apk\")\n```\n\nâ€‹\tå¾—åˆ°shell.apkåï¼Œçœ‹åˆ°äº†å¯†æ–‡æ¯”å¯¹çš„é€»è¾‘ï¼Œå°±æ˜¯ä½¿ç”¨sqlè¯­å¥éªŒè¯ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦æ­£ç¡®ã€‚ä½†æ˜¯ï¼Œapkè§£å‹åå¾—åˆ°çš„/assets/mydb.dbæ–‡ä»¶æ˜¯æ— æ³•æ­£å¸¸è¯»å–çš„ï¼Œä»”ç»†è¯»æºç ï¼Œçœ‹åˆ°MoveSQLiteUtilç±»ä¸­æœ‰åˆ›å»ºdbæ–‡ä»¶çš„æ–¹æ³•ï¼Œæ˜¯å¯¹mydb.dbæ–‡ä»¶å¼‚æˆ–0xffè§£å¯†å¾—åˆ°çš„ã€‚\n\n```python\nwith open(r\"F:\\StudyFiles\\CTF\\Review_CTF\\XYCTF2024\\RE\\Trustme\\assets\\mydb.db\", \"rb\") as f:\n    data = f.read()\n    new_data = bytearray(data)\n    for i in range(len(data)):\n        new_data[i] = data[i] ^ 0xff\n\n    with open(r\"F:\\StudyFiles\\CTF\\Review_CTF\\XYCTF2024\\RE\\Trustme\\assets\\mydb_decrypted.db\", \"wb\") as f2:\n        f2.write(new_data)\n```\n\nâ€‹\tæ‰“å¼€è§£å¯†æ–‡ä»¶ï¼Œå°±çœ‹åˆ°äº†flagã€‚\n\nâ€‹\tè¿™é¢˜è¿˜æœ‰SQLæ³¨å…¥æ¼æ´ï¼Œå¯†ç ä¸º`' or 1=1 --`å°±èƒ½å¾—åˆ°flagã€‚\n\n\n\n\n\n\n\n# \té¦’å¤´\n\nâ€‹\tæ— å£³ï¼ŒIDAæ‰“å¼€ï¼Œä»£ç å¾ˆæ¸…æ™°ï¼Œè€ƒå¯Ÿçš„æ˜¯`å“ˆå¤«æ›¼æ ‘`æ•°æ®ç»“æ„ï¼Œå¥½ä¹…ä¹‹å‰å­¦çš„æ•°æ®ç»“æ„äº†ï¼Œç°åœ¨éƒ½å¿˜äº†ï¼Œé‡æ–°æ¸©ä¹ ä¸€ä¸‹ã€‚çœ‹ä¸æ‡‚å•Šï¼ŒçœŸçš„éš¾ã€‚è¿™é¢˜å°±è®¤çœŸåˆ†æä¸€éï¼Œå®Œæ•´å†™æ€è·¯ï¼Œå½“ä½œæ˜¯å­¦ä¹ æ–°çŸ¥è¯†äº†ã€‚\n\nâ€‹\té€šè¿‡å­¦ä¹ ï¼ŒçŸ¥é“äº†IDAä¸­é€šè¿‡`add type`è‡ªå®šä¹‰ç»“æ„ä½“ï¼Œç„¶åé€šè¿‡`Y`é”®ä¿®æ”¹åç¼–è¯‘çš„å‡½æ•°å‚æ•°ç±»å‹ä¸ºè‡ªå®šä¹‰çš„ç»“æ„ä½“æŒ‡é’ˆï¼Œè¿™æ ·IDAå°±èƒ½è‡ªåŠ¨è¯†åˆ«äº†ã€‚\n\nâ€‹\tå…ˆçœ‹ç»“æ„åˆå§‹åŒ–å‡½æ•°ï¼Œè¿™é‡Œå“ˆå¤«æ›¼æ ‘æ˜¯é€šè¿‡`æ•°ç»„`ä¿å­˜çš„å•Šï¼Œè€Œa1å°±æ˜¯è¿™ä¸ªæŒ‡å‘è¿™ä¸ªæ•°ç»„çš„æŒ‡é’ˆï¼Œè¿™ä¸ªæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œè¿™é‡Œå¹¶ä¸æ˜¯æŒ‡é’ˆæ•°ç»„ï¼Œè€Œæ˜¯ç»“æ„ä½“æ•°ç»„ã€‚`(*a1)[i]`å°±æ˜¯ç¬¬iä¸ªèŠ‚ç‚¹ï¼Œè€Œå…¶indexå°±æ˜¯å…¶åœ¨åŸå­—ç¬¦ä¸²ä¸­çš„ä¸‹æ ‡ã€‚\n\n![image-20250603135741772](/pictures/XYCTF2024/image-20250603135741772.png)\n\nâ€‹\tçœ‹åˆ°createå‡½æ•°æ˜¯æ„å»ºå“ˆå¤«æ›¼æ ‘çš„ã€‚\n\n![image-20250603140500857](/pictures/XYCTF2024/image-20250603140500857.png)\n\nâ€‹\tçœ‹åˆ°checkå‡½æ•°ï¼Œè¿™é‡Œå¾ˆå·§å¦™çš„å¯¹å·¦å¶å­èŠ‚ç‚¹è¿›è¡Œäº†å€¼å’Œä¸‹æ ‡çš„æ¯”å¯¹ï¼Œè€Œå¯¹å³å¶å­èŠ‚ç‚¹åªè¿›è¡Œäº†ä¸‹æ ‡çš„æ¯”å¯¹ï¼Œè¿™æ ·å°±ä¸å¿…æŠŠæ‰€æœ‰flagçš„å­—ç¬¦å€¼å…¨ä¿å­˜åœ¨å˜é‡ä¸­ï¼Œæ˜¾çš„å¤ªç®€å•ã€‚åŒæ—¶ä¹Ÿå¯ä»¥æ ‡æ³¨å­—ç¬¦åœ¨flagä¸­çš„ä½ç½®ã€‚\n\n![image-20250603140650890](/pictures/XYCTF2024/image-20250603140650890.png)\n\n\n\nâ€‹\tç†æ¸…é€»è¾‘åï¼Œæˆ‘å¼€å§‹æ˜¯æ‰‹åŠ¨è§£å¯†ï¼Œå°±åƒæ˜¯ä¸‹é¢è¿™æ ·ï¼Œåœ¨æ‰‹åŠ¨æ“ä½œçš„è¿‡ç¨‹ä¸­æˆ‘æ‰¾åˆ°äº†è§„å¾‹ã€‚\n\nâ€‹\tå°±æ˜¯å¯æ‰“å°å­—ç¬¦çš„æ•°å­—åœ¨32åˆ°126ä¹‹é—´ï¼Œé‚£ä¹ˆä»1åˆ°24çš„æ•°å­—ä¸€å®šæ˜¯è¡¨ç¤ºä¸‹æ ‡çš„ï¼Œå¹¶ä¸”ç”±äºå“ˆå¤«æ›¼æ ‘æ˜¯æ»¡äºŒå‰æ ‘ï¼Œå³é™¤å¶å­èŠ‚ç‚¹å¤–çš„å…¶ä»–èŠ‚ç‚¹éƒ½æœ‰ä¸¤ä¸ªå­©å­èŠ‚ç‚¹ã€‚\n\nâ€‹\tæˆ‘ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾Aæœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œä¸”éƒ½æ˜¯å¶å­èŠ‚ç‚¹ï¼Œå·¦å³å­©å­åˆ†åˆ«ä¸ºBã€Cã€‚é‚£ä¹ˆæ‰«æåˆ°Açš„æ—¶å€™ï¼Œæ ¹æ®ç¨‹åºå°±ä¼šåˆ¤æ–­ä¸€ä¸‹Bçš„æƒå€¼ï¼ˆå­—ç¬¦å€¼ï¼‰ï¼Œç„¶åé€’å½’è¿›å…¥åˆ°BèŠ‚ç‚¹ï¼Œè¿™æ—¶å€™åˆä¼šæ¯”è¾ƒä¸€æ¬¡ä¸‹æ ‡å€¼ï¼Œç„¶åä»å¶å­èŠ‚ç‚¹Bè¿”å›ï¼Œæ¥ç€åˆ°å³å¶å­èŠ‚ç‚¹Cï¼Œç»§ç»­æ¯”è¾ƒä¸‹æ ‡ï¼Œç„¶åè¿”å›åˆ°Açš„å…„å¼ŸèŠ‚ç‚¹å»æ¯”å¯¹ã€‚\n\nâ€‹\tæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥æ ¹æ®å¾ªç¯æ•°ç»„çš„å€¼ï¼Œæ£€æµ‹åˆ°ä¸‹æ ‡ï¼Œå°±å¯ä»¥åˆ©ç”¨å‰å‡ ä½çš„æƒå€¼è®¡ç®—å‡ºåŸå­—ç¬¦ä¸²ä¸­è¯¥ä¸‹æ ‡å¯¹äºçš„ASCIIç å€¼æ˜¯å¤šå°‘ã€‚\n\n```python\ndata = [2270, 917, 446, 217, 106, 51, 20, 15, 17, 229, 114, 16, 11, 471, 233, 116, 14, 13, 238, 118, 12, 7, 1353, 557, 248, 123, 6, 24, 309, 137, 67, 3, 5, 172, 84, 4, 1, 796, 383, 186, 89, 2, 8, 197, 97, 48, 23, 10, 21, 413, 203, 101, 22, 9, 210, 104, 19, 18]\n\nflag = [0] * 25\nflag[20] = 51\nflag[15] = 106 -51\nflag[17] = 217 - 106\nflag[16] = 114\nflag[11] = 229 - 114\nflag[14] = 116\nflag[13] = 233 - 116\nflag[12] = 118\nflag[7] = 238 - 118\nflag[6] = 123\nflag[24] = 248 - 123\nflag[3] = 67\nflag[5] = 137 - 67\nflag[4] = 84\nflag[1] = 172 - 84\nflag[2] = 89\nflag[8] = 186 - 89\nflag[23] = 48\nflag[10] = 97 - 48\nflag[21] = 197 - 97\nflag[22] = 101\nflag[9] = 203 - 101\nflag[19] = 104\nflag[18] = 210 - 104\n\nfor i in range(1,25):\n    print(chr(flag[i]), end='')\n```\n\nâ€‹\tä¸‹é¢æ˜¯è‡ªåŠ¨å¤„ç†çš„è„šæœ¬ã€‚\n\n```python\ndata = [2270, 917, 446, 217, 106, 51, 20, 15, 17, 229, 114, 16, 11, 471, 233, 116, 14, 13, 238, 118, 12, 7, 1353, 557, 248, 123, 6, 24, 309, 137, 67, 3, 5, 172, 84, 4, 1, 796, 383, 186, 89, 2, 8, 197, 97, 48, 23, 10, 21, 413, 203, 101, 22, 9, 210, 104, 19, 18]\nflag = [0] * 25\ni = 0\nwhile i < len(data):\n    if data[i] > 0 and data[i] < 25:\n        n = 1\n        tmp = i\n        while i < len(data) and data[i] > 0 and data[i] < 25:\n            if n == 1:\n                flag[data[i]] = data[tmp-n]\n            else:\n                flag[data[i]] = data[tmp-n] - data[tmp-n+1]\n            i += 1\n            n += 1\n    else:\n        i += 1\n\nfor i in range(1,25):\n    print(chr(flag[i]), end='')\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n# What's this\n\nâ€‹\tæ–°ä¸œè¥¿ï¼Œç¬¬ä¸€æ¬¡ç¢°è§ï¼Œæ–‡ä»¶å¤´æ˜¯`1B 4C 75 61 51`ã€‚èŠ‚çº¦æ—¶é—´ï¼Œå­¦ä¹ WPã€‚\n\nâ€‹\tChatgptçš„è§£é‡Šæ˜¯ï¼š`1B 4C 75 61 51` æ˜¯ä¸€ä¸ª **Luaå­—èŠ‚ç æ–‡ä»¶ï¼ˆç¼–è¯‘åçš„Luaæ–‡ä»¶ï¼‰çš„æ–‡ä»¶å¤´**ï¼Œå³ä¸æ˜¯æ™®é€šçš„ `.lua` æºä»£ç æ–‡ä»¶ï¼Œè€Œæ˜¯å·²ç»ç¼–è¯‘æˆLuaè™šæ‹Ÿæœºå¯æ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚æ‰€ä»¥æˆ‘ä»¬è¦åç¼–è¯‘ï¼Œçœ‹æºä»£ç ã€‚\n\nâ€‹\tWPä¸­ç»™å‡ºäº†åœ¨çº¿å·¥å…·ï¼Œæˆ‘ä»¬ä¸Šç½‘ç«™åç¼–è¯‘å¥½äº†ã€‚ä¹Ÿæ˜¯æœ‰å¹¸æ¥è§¦åˆ°äº†ä¸€ä¸‹LUAè„šæœ¬ï¼Œè¿™æ˜¯æ¸¸æˆå¼€å‘éå¸¸æµè¡Œçš„è¯­è¨€ã€‚\n\n```python\nimport base64\nflag = \"==AeuFEcwxGPuJ0PBNzbC16ctFnPB5DPzI0bwx6bu9GQ2F1XOR1U\"\nflag = flag.replace(\"6\", \"W\")\nflag = flag.replace(\"4\", \"H\")\nflag = flag.replace(\"3\", \"g\")\nflag = flag[::-1]\nflag = base64.b64decode(flag).decode()\nfor i in range(len(flag)):\n    tmp = ord(flag[i]) - 3\n    tmp = (tmp ^ 8) % 256\n    print(chr(tmp), end=\"\")\n```\n\n\n\n\n\n# ez_rand\n\nâ€‹\tåˆæ˜¯åƒåœ¾é¢˜ï¼Œæ€è·¯å¾ˆç®€å•ï¼Œçˆ†ç ´å°±è¡Œäº†ï¼Œå¯¹åº”å¥½å‚æ•°ç±»å‹ã€‚\n\nâ€‹\tsbçš„WPä¸­ï¼Œç›´æ¥rand()%255ï¼Œæ— è¯­äº†ã€‚tmçš„ï¼Œæˆ‘åˆä¸€ç›´çˆ†ç ´ä¸å‡ºæ¥ï¼Œæ˜æ˜æ˜¯ç…§ç€å˜é‡ç±»å‹æŠ„çš„ã€‚è¿ç®—å¼éƒ½æ˜¯ç…§ç€æŠ„çš„ã€‚\n\nâ€‹\téº»ç—¹çš„ï¼Œæ”¹äº†ä¸€ä¸‹å¼‚æˆ–å€¼çš„è®¡ç®—å°±å¥½äº†ï¼Œè¿˜å¿˜äº†ä¹‹å‰é”™çš„æ˜¯ä»€ä¹ˆæ ·å­çš„äº†ï¼Œç°åœ¨æ€ä¹ˆæ”¹éƒ½æ˜¯å¯¹çš„ã€‚çœŸçš„æ˜¯ç„å­¦ï¼Œé”™è¯¯æ¶ˆå¤±äº†ï¼Œå®Œå…¨æ‰¾ä¸åˆ°ä¹‹å‰é”™çš„æ˜¯ä»€ä¹ˆæ ·å­çš„äº†ã€‚\n\nâ€‹\tæ— è¯­é€†å¤©äº†ï¼Œå†ä¹Ÿä¸æƒ³ç¢°è¿™ä¸ªç…ç¬”Cè¯­è¨€äº†ã€‚\n\n![image-20250601171908123](/pictures/XYCTF2024/image-20250601171908123.png)\n\n```c++\n//åˆ«äººçš„è„šæœ¬\n#include<iostream>\n#include<cstring>\n#include<algorithm>\n#include<cstdio>\n#include<cstdlib>\n#include<ctime>\nusing namespace std;\nunsigned char cipher[50] = {0x5D, 0x0C, 0x6C, 0xEA, 0x46, 0x19, 0xFC, 0x34,0xB2, 0x62, 0x23, 0x07, 0x62, 0x22, 0x6E, 0xFB, 0xB4, 0xE8, 0xF2, 0xA9, 0x91,0x12, 0x21, 0x86, 0xDB, 0x8E, 0xE9, 0x43, 0x4D};\nint v7;\nbool cmp(char s[])\n{\n\tif(strstr(s,\"XYCTF\")||strstr(s,\"flag\"))\n\t{\n\t\treturn true;\n\t}\n\treturn false;\n}\nchar ans[50];\nint _round=-5;\nsigned main()\n{\n\tfor(unsigned int v4=0;v4<65536;v4++)\n\t{\n\t\tsrand(v4);\n\t\tfor(int i=0;i<29;i++)\n\t\t{\n\t\t\tv7=rand();\n\t\t\tunsigned long long temp=((2155905153*1LL*v7)>>32);\n\t\t\tunsigned char num=v7+(int)((temp&0x80000000)!=0)+((int)temp>>7);\n\t\t\tans[i]=num^cipher[i];\n\t\t}\n\t\tif(cmp(ans))\n\t\t{\n\t\t\t_round=v4;\n\t\t\tbreak;\n\t\t}\n\t}\n\tprintf(\"%s %d\",ans,_round);\n\t//XYCTF{R@nd_1s_S0_S0_S0_easy!} 21308\n}\n```\n\n\n\n\n\n# èˆ”ç‹—å››éƒ¨æ›²--è®°å¿†çš„æ—¶å…‰æœº\n\nâ€‹\tokï¼Œé«˜çº§çš„åç¼–è¯‘ï¼Œç±»ä¼¼èŠ±æŒ‡ä»¤ä¸€æ ·çš„åç¼–è¯‘æ–¹å¼ã€‚æ–¹æ³•ä¸ºå…ˆæŠŠè¦è·³è½¬çš„åœ°å€ä¿å­˜åˆ°å¯„å­˜å™¨ä¸Šï¼Œç„¶åé€šè¿‡å¯„å­˜å™¨è·³è½¬ï¼›æˆ–è€…æä¸ª`endbr64`æŒ‡ä»¤ï¼Œå½±å“åç¼–è¯‘ã€‚\n\nâ€‹\tç›´æ¥å­¦ä¹ WPã€‚è¯´æ˜¯å¯ä»¥é€šè¿‡è·³è½¬è¡¨ï¼Œä¿®å¤åç¼–è¯‘ï¼Œä½†æ˜¯æ²¡æ¼”ç¤ºå…·ä½“æ“ä½œï¼Œå¯¹å°ç™½å¤ªä¸å‹å¥½äº†ã€‚å…¶ä»–äººä¹Ÿéƒ½æ˜¯çœ‹æ±‡ç¼–æˆ–è€…åŠ¨è°ƒçš„ï¼Œé‚£å°±å¹²å§ï¼ŒåŠ¨è°ƒçœ‹çœ‹ã€‚\n\nâ€‹\té¦–å…ˆä¸€ä¸ªcmpï¼Œé•¿åº¦æ£€éªŒï¼Œ0x30ï¼Œ48ä½ã€‚ç„¶åæ¯ä¸€ä½åŠ å¯†åå’Œå¯†æ–‡æ¯”å¯¹ï¼Œ48ä¸ªå­—ç¬¦å…¨éƒ¨ç›¸åŒå°±æ˜¯æˆåŠŸã€‚\n\nâ€‹\tencå‡½æ•°ï¼Œé¦–å…ˆæœ‰ä¸ªxorå˜åŒ–å€¼ï¼ˆi+6ï¼Œiä»0å¼€å§‹çš„ï¼‰ï¼Œå†xorå›ºå®šå€¼0x66ï¼Œå†å‡6ï¼Œç„¶åxorå¯†æ–‡çš„å¯¹åº”ä½ã€‚\n\n```python\nenc = [105, 88, 97, 99, 103, 76, 77, 50, 152, 32, 77, 81, 123, 37, 117, 81, 163, 88, 96, 114, 66, 98, 103, 102, 55, 108, 48, 70, 102, 79, 93, 3, 93, 164, 102, 1, 67, 104, 125, 124, 85, 79, 122, 63, 108, 18, 33, 9]\nkey = \"i_have_get_shell_but_where_is_you_my_dear_baby!!\"\n\nfor i in range(len(enc)):\n    tmp = (enc[i] ^ ord(key[i])) % 256\n    tmp = (tmp + 6) % 256\n    tmp = (tmp ^ 0x66) % 256\n    tmp = (tmp ^ (i+6)) % 256\n    print(chr(tmp), end='')\n```\n\nâ€‹\tè¿™é¢˜ä¼šåŠ¨è°ƒå…¶å®å¾ˆç®€å•ï¼Œåªæ˜¯åç¼–è¯‘åšåšæ ·å­ï¼Œæœ‰ç‚¹å“äººç½¢äº†ã€‚\n\n\n\n\n\n# ez_cube\n\nâ€‹\tIDAæ‰“å¼€ï¼ŒçœŸæ˜¯ä¸ªåšé­”æ–¹çš„é¢˜ï¼Œè¿˜å¾—æœ‰ç‚¹ç©ºé—´æƒ³è±¡åŠ›æ‰è¡Œã€‚åˆå§‹çŠ¶æ€å¦‚ä¸‹ã€‚\n\nâ€‹\tWPç»™å‡ºçš„åœ¨çº¿ç½‘ç«™ï¼Œæ²¡åŠæ³•åšåˆ°é™åˆ¶æ—‹è½¬ï¼Œå°±æ— æ³•æŒ‰ç…§é¢˜ç›®ä¸­çš„æ–¹å¼è§£å‡ºã€‚å¯ä»¥ä½¿ç”¨pythonå†™ä¸€ä¸ªæ±‚è§£è„šæœ¬ï¼Œåªä½¿ç”¨å››ç§ç›®æ ‡æ—‹è½¬ï¼Œé™åˆ¶æ­¥æ•°ï¼ŒBFSå°±æ˜¯å¾ˆå¯è¡Œçš„ã€‚\n\nâ€‹\tä½†æ˜¯æˆ‘ä¸æƒ³åœ¨è¿™æ ·ä¸€ä¸ªéä¸“ä¸šé€†å‘çš„é¢˜ç›®è€—è¿™ä¹ˆå¤šæ—¶é—´ï¼Œæ‰€ä»¥ç›´æ¥è¿‡äº†ã€‚é™„ä¸Šåˆ«äººçš„è„šæœ¬ã€‚\n\n![image-20250601205219843](/pictures/XYCTF2024/image-20250601205219843.png)\n\n```python\nfrom itertools import *\nimport tqdm\ndef f(x):\n\tA=[\"R\"]*9\n\tB=[\"B\"]*9\n\tC=[\"G\"]*9\n\tD=[\"O\"]*9\n\tE=[\"Y\"]*9\n\tF=[\"W\"]*9\n\tB[1]='R'\n\tA[1]='G'\n\tC[1]='B'\n\tfor i in x:\n\t\tif i=='R':\n\t\tv0 = A[2]\n\t\tv1 = A[5]\n\t\tv2 = A[8]\n\t\tA[2] = F[2]\n\t\tA[5] = F[5]\n\t\tA[8] = F[8]\n\t\tF[2] = D[6]\n\t\tF[5] = D[3]\n\t\tF[8] = D[0]\n\t\tD[0] = E[8]\n\t\tD[3] = E[5]\n\t\tD[6] = E[2]\n\t\tE[2] = v0\n\t\tE[5] = v1\n\t\tE[8] = v2\n\t\tv3 = C[1]\n\t\tC[1] = C[3]\n\t\tC[3] = C[7]\n\t\tC[7] = C[5]\n\t\tC[5] = v3\n\t\tv4 = C[0]\n\t\tC[0] = C[6]\n\t\tC[6] = C[8]\n\t\tC[8] = C[2]\n\t\tC[2] = v4\n\tif i=='U':\n\t\tv0 = A[0]\n\t\tv1 = A[1]\n\t\tv2 = A[2]\n\t\tA[0] = C[0]\n\t\tA[1] = C[1]\n\t\tA[2] = C[2]\n\t\tC[0] = D[0]\n\t\tC[1] = D[1]\n\t\tC[2] = D[2]\n\t\tD[0] = B[0]\n\t\tD[1] = B[1]\n\t\tD[2] = B[2]\n\t\tB[0] = v0\n\t\tB[1] = v1\n\t\tB[2] = v2\n\t\tv3 = E[1]\n\t\tE[1] = E[3]\n\t\tE[3] = E[7]\n\t\tE[7] = E[5]\n\t\tE[5] = v3\n\t\tv4 = E[0]\n\t\tE[0] = E[6]\n\t\tE[6] = E[8]\n\t\tE[8] = E[2]\n\t\tE[2] = v4\n\tif i=='r':\n\t\tv0 = A[2]\n\t\tv1 = A[5]\n\t\tv2 = A[8]\n\t\tA[2] = E[2]\n\t\tA[5] = E[5]\n\t\tA[8] = E[8]\n\t\tE[2] = D[6]\n\t\tE[5] = D[3]\n\t\tE[8] = D[0]\n\t\tD[0] = F[8]\n\t\tD[3] = F[5]\n\t\tD[6] = F[2]\n\t\tF[2] = v0\n\t\tF[5] = v1\n\t\tF[8] = v2\n\t\tv3 = C[1]\n\t\tC[1] = C[5]\n\t\tC[5] = C[7]\n\t\tC[7] = C[3]\n\t\tC[3] = v3\n\t\tv4 = C[0]\n\t\tC[0] = C[2]\n\t\tC[2] = C[8]\n\t\tC[8] = C[6]\n\t\tC[6] = v4\n\tif i=='u':\n\t\tv0 = A[0]\n\t\tv1 = A[1]\n\t\tv2 = A[2]\n\t\tA[0] = B[0]\n\t\tA[1] = B[1]\n\t\tA[2] = B[2]\n\t\tB[0] = D[0]\n\t\tB[1] = D[1]\n\t\tB[2] = D[2]\n\t\tD[0] = C[0]\n\t\tD[1] = C[1]\n\t\tD[2] = C[2]\n\t\tC[0] = v0\n\t\tC[1] = v1\n\t\tC[2] = v2\n\t\tv3 = E[1]\n\t\tE[1] = E[5]\n\t\tE[5] = E[7]\n\t\tE[7] = E[3]\n\t\tE[3] = v3\n\t\tv4 = E[0]\n\t\tE[0] = E[2]\n\t\tE[2] = E[8]\n\t\tE[8] = E[6]\n\t\tE[6] = v4\n\tif A==[\"R\"]*9 and B==[\"B\"]*9 and C==[\"G\"]*9 and D==[\"O\"]*9 and E==[\"Y\"]*9 and F==[\"W\"]*9:\n\t\treturn 1\n\telse:\n\t\treturn 0\n\n    \nflag=[]\nfor j in range(13):\n\tfor i in tqdm.tqdm(list(product('RUru',repeat=j))):\n\t\tx=''.join(i)\n\t\tif f(x):\n\t\t\tflag.append(x)\n[print(\"flag{%s}\"%x) for x in flag]\n```\n\n\n\n\n\n# ä»Šå¤•æ˜¯ä½•å¹´\n\nâ€‹\tIDAæ‰“å¼€ï¼Œå“‡ï¼Œéƒ½åç¼–è¯‘ä¸äº†ï¼Œç¬¬ä¸€æ¬¡ç¢°è§è¿™ç§ï¼ŒæŸ¥å£³è¿˜æ²¡æœ‰å£³ï¼Œåˆæ˜¯RUSTè¯­è¨€å†™çš„ã€‚\n\nâ€‹\tå­¦ä¹ WPï¼ŒåŸæ¥è¿™æ˜¯LoongArchæ¶æ„çš„ELFäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªLoongArchæ¶æ„çš„ç¯å¢ƒæ¥è¿è¡Œè¿™ä¸ªç¨‹åºã€‚\n\nâ€‹\tæŒ‰ç…§WPçš„å‘½ä»¤åœ¨kaliä¸Šé¢ä¸‹è½½å¥½äº†qemu-userï¼Œå‘½ä»¤ä¸º`sudo apt install qemu-user`ã€‚ç„¶åå°±å¯ä»¥ç›´æ¥è¿è¡Œmainç¨‹åºäº†ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆä¾¿æ·å•Šï¼Ÿ\n\n> èƒŒåçš„æœºåˆ¶ï¼š`binfmt_misc`\n>\n> - Linux æœ‰ä¸ªå†…æ ¸åŠŸèƒ½å«åš **`binfmt_misc`**ï¼Œå®ƒèƒ½è®©ç³»ç»Ÿè¯†åˆ«ä¸åŒæ ¼å¼çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚\n> - å½“ä½ è¿è¡Œä¸€ä¸ªéæœ¬æœºæ¶æ„çš„å¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œå†…æ ¸é€šè¿‡ `binfmt_misc` æ‰¾åˆ°å¯¹åº”çš„è§£é‡Šå™¨ï¼ˆæ¯”å¦‚ `qemu-arm`ï¼‰ï¼Œè‡ªåŠ¨è°ƒç”¨å®ƒæ¥è¿è¡Œç¨‹åºã€‚\n> - è¿™æ ·ä½ å°±æ„Ÿè§‰â€œç›´æ¥è¿è¡Œï¼Œä¸ç”¨é¢å¤–å‘½ä»¤â€ï¼Œå…¶å®æ˜¯ç³»ç»Ÿå¸®ä½ è‡ªåŠ¨è½¬å‘äº†ã€‚\n\nâ€‹\tå¹¸å¥½æœ‰æ•™ç¨‹ï¼Œä¸ç„¶æˆ‘å»ç½‘ä¸Šæ‰¾åˆå¾—èŠ±å¤§æŠŠæ—¶é—´ï¼Œé”™è¯¯ç‡è¿˜é«˜ï¼Œå„ç§ç¯å¢ƒé—®é¢˜ã€‚\n\n\n\n\n\n\n\n\n\n# Findme\n\nâ€‹\tç»™äº†ä¸‰ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸çŸ¥é“æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼ŒDIEä¹ŸæŸ¥ä¸å‡ºæ¥ã€‚æ–°ä¸œè¥¿ï¼Œè¿˜æ˜¯ç›´æ¥çœ‹WPã€‚6ï¼ŒåŸæ¥æ˜¯æœ‰éšè—çš„ï¼Œæˆ‘è¿˜ä»¥ä¸ºè¿™å‡ ä¸ªæ–‡ä»¶æ˜¯ä¸€æ ·çš„ä¸œè¥¿ï¼Œç»“æœä¸€çœ‹ï¼Œæ–‡ä»¶`Doraemon1` `Doraemon2`ç¡®å®æ¯”è¾ƒè¿·ï¼Œä½†æ˜¯`Doraemon4`å°±æ˜¯exeæ–‡ä»¶æ–‡ä»¶å•Šï¼Œ æ–‡ä»¶å¤´å°±èƒ½çœ‹å‡ºæ¥ï¼Œè¿˜å»æ‰äº†åç¼€åã€‚\n\nâ€‹\tå…ˆçœ‹exeç¨‹åºï¼Œå…ˆæ˜¯ä¸€ä¸ªRC4ç±»çš„KSAï¼Œåˆå§‹åŒ–Sç›’å¹¶ç”¨å¯†é’¥æ‰“ä¹±ï¼Œå¯†é’¥ä¸ºï¼š`Find_Doraemon`ã€‚\n\n![image-20250602111610021](/pictures/XYCTF2024/image-20250602111610021.png)\n\nâ€‹\tç„¶åæ˜¯PRGAï¼Œä¼ªéšæœºæ•°æµåŠ å¯†ã€‚å¯¹Doraemon3æ–‡ä»¶è¯»å–å­—ç¬¦ï¼Œå¼‚æˆ–åŠ å¯†åå†™å…¥Doraemon1æ–‡ä»¶ï¼Œå¹¶ä¸”è·Ÿç€è‹¥å¹²ä¸ªéšæœºæ•°ã€‚\n\n![image-20250602111920780](/pictures/XYCTF2024/image-20250602111920780.png)\n\nâ€‹\tæ‰€ä»¥æˆ‘ä»¬å¯¹Doraemon1æ–‡ä»¶è¿›è¡Œè¯»å–é€†å‘å¤„ç†å°±è¡Œï¼Œå…ˆé€ å‡ºSç›’ï¼Œç„¶åå†æ¬¡å¼‚æˆ–å³å¯ï¼Œå¹¶ä¸”ä½¿ç”¨Sç›’ä¸­çš„æ•°è¿›è¡Œä¼ªéšæœºç”Ÿæˆï¼Œå»æ‰ä¸­é—´çš„è‹¥å¹²å­—ç¬¦åï¼Œåˆ°è¾¾ä¸‹ä¸€ä¸ªåŠ å¯†å­—ç¬¦ï¼Œç›´è‡³æ–‡ä»¶è¯»å–å®Œã€‚\n\nâ€‹\tæˆ‘ç°åœ¨å†™ä»£ç çš„èƒ½åŠ›æœ‰ç‚¹å·®ï¼Œç»å¸¸æœ‰é—å¿˜çš„ç‚¹ï¼Œæ”¹èµ·æ¥èŠ±å¾ˆå¤šæ—¶é—´ã€‚è¿˜å¾—ç»ƒã€‚\n\n```c\n#include <stdio.h>  \n#include <stdlib.h>\n#include <stdint.h>\n\nFILE *fp = NULL;\n\nvoid KSA(uint8_t *S, uint8_t *K)\n{\n    uint32_t i;\n    int j = 0;\n    for( i=0; i<512;i++)\n    {\n        S[i] = -(char)i;\n    }\n    i = 0;\n    while(i<512)\n    {\n        j = (K[i%13] + S[i] + j) % 512;\n        uint8_t temp = S[i];\n        S[i] = S[j];\n        S[j] = temp;\n        i++;\n    }\n}\n\nvoid PRGA(uint8_t *S)\n{\n    int i = 0, j = 0, v8=0 , v9 = 0 ;\n    uint8_t temp, k;\n    uint8_t b;\n    fp = fopen(\"F:\\\\StudyFiles\\\\CTF\\\\Review_CTF\\\\XYCTF2024\\\\RE\\\\Findme\\\\Doraemon1\", \"rb\");\n    FILE *stream = fopen(\"./Doraemon3\",\"wb\");\n    if (fp == NULL) {\n        perror(\"Error opening file\");\n        exit(1);\n    }\n    if(stream == NULL) {\n        perror(\"Error opening file\");\n        exit(1);\n    }\n    while(!feof(fp))\n    {\n        i = (i + 1) % 512;\n        j = (S[i] + j) % 512;\n        temp = S[i];\n        S[i] = S[j];\n        S[j] = temp;\n        k = S[(uint8_t)((S[i] + S[j]) % 512)];\n        b = fgetc(fp);\n        fputc(b^k, stream);\n        srand(S[v8 %512]);\n        v9 = rand() % 4;\n        for(int t=0; t<v9; t++)\n        {\n            rand();\n            fgetc(fp);\n        }\n        v8++;\n    }\n}\n\nint main()\n{\n    char *key = \"Find_Doraemon\";\n    uint8_t S[512] = {0};\n\n    KSA(S, (uint8_t *)key);\n    PRGA(S);\n    return 0;\n}\n```\n\nâ€‹\tå¾—åˆ°3æ–‡ä»¶åï¼ŒæŸ¥çœ‹æºç ï¼Œæ˜¯å¯¹2æ–‡ä»¶è¿›è¡Œè§£å¯†ï¼Œä½†æ˜¯è¦è¾“å…¥å¯†é’¥ã€‚å“ˆå“ˆï¼Œå®Œå•¦ï¼Œæ²¡æœ‰ç›´æ¥çš„æç¤ºï¼Œåˆæ˜¯è„‘æ´ï¼Œæˆ‘æ²¡æƒ³åˆ°ã€‚çœ‹äº†WPæ‰çŸ¥é“æ˜¯`Doraemon`ï¼Œçœ‹æ¥æˆ‘åšé¢˜å¤ªå¤šäº†ï¼Œéƒ½æœ‰ç‚¹è¿Ÿé’äº†ã€‚\n\nâ€‹\tå¾—åˆ°çš„è§£å¯†æ–‡ä»¶æ˜¯ä¸€ä¸ªgifå›¾ç‰‡ï¼Œæ‰“å¼€å°±å¾—åˆ°äº†flagã€‚\n\n\n\n\n\n\n\n# èˆ”ç‹—å››éƒ¨æ›²--æˆ‘çš„ç™½æœˆå…‰\n\nâ€‹\tè¿™ä¸ªæˆ‘çœŸæ‰¾ä¸åˆ°äº†ï¼ŒåŠ¨è°ƒå’Œæ—¶å…‰æœºä¸€æ ·çš„é€»è¾‘ï¼Œä¸€æ ·çš„flagã€‚ä½†è‚¯å®šä¸æ˜¯è¿™æ ·çš„ï¼Œä½†ä¹Ÿæ²¡æœ‰debugæ£€æµ‹ï¼Œç›´æ¥è¿è¡Œç¨‹åºä¹Ÿæ˜¯é‚£æ ·å­çš„å•Šã€‚æœ‰ç‚¹è¿·äº†ã€‚\n\nâ€‹\tçœ‹WPå§ï¼Œè‰ï¼ŒåŸæ¥æ˜¯å¹³å°é™„ä»¶é”™äº†......ã€‚æ–°çš„é™„ä»¶æ˜¯chall.exeã€‚\n\nâ€‹\tè¿è¡Œç¨‹åºå¾—åˆ°ç¬¬ä¸€æ®µflagï¼š`flag{L0v3_`ã€‚\n\nâ€‹\tè¿™é¢˜C++å†™çš„ï¼Œåç¼–è¯‘æœ‰ç‚¹ä¸å¥½çœ‹ï¼Œä¸»è¦æ˜¯éš¾ä»¥æ‰¾åˆ°å…¥æ‰‹ç‚¹ï¼Œè¿˜æ˜¯å­¦ä¹ WPå§ï¼Œå¢é•¿ç»éªŒã€‚\n\nâ€‹\té€šè¿‡åœ¨æç¤ºä¿¡æ¯å‰ä¸‹æ–­ç‚¹ï¼Œæ•è·åˆ°æ–­ç‚¹å‰é¢ä¸€ç›´åœ¨æ“ä½œçš„å†…å­˜æ•°æ®ï¼Œæå–å‡ºæ¥å¾—åˆ°è¿™æ ·çš„å­—ç¬¦ä¸²ï¼Œå°±æœ‰äº†ç¬¬äºŒæ®µflagã€‚\n\n```python\ndata = [112, 108, 101, 97, 115, 101, 32, 100, 111, 32, 110, 111, 116, 32, 116, 114, 121, 32, 116, 111, 32, 102, 105, 110, 100, 32, 104, 101, 114, 32, 115, 104, 101, 32, 100, 111, 32, 110, 111, 116, 32, 98, 101, 108, 111, 110, 103, 32, 116, 111, 32, 97, 103, 111, 32, 109, 101, 109, 111, 114, 105, 101, 115, 32, 105, 32, 119, 105, 108, 108, 32, 103, 105, 118, 101, 32, 121, 111, 117, 32, 115, 111, 109, 101, 32, 102, 108, 97, 103, 115, 58, 105, 56, 95, 97, 95, 107, 51, 121, 95, 97, 110, 100, 32, 110, 111, 119, 32, 103, 111, 32, 98, 97, 99, 107, 32, 112, 108, 101, 97, 115, 101, 33]\n\nfor i in range(len(data)):\n    print(chr(data[i]), end='')\n```\n\n`please do not try to find her she do not belong to ago memories i will give you some flags:i8_a_k3y_and now go back please!`\n\nâ€‹\tç¨‹åºè¿™ä¸ªåœ°æ–¹åŸæœ¬æ˜¯Hookæ‰äº†Messageå‡½æ•°ï¼Œå¯¼è‡´æˆ‘ä»¬ä¸€ç›´åœ¨å¾ªç¯çœ‹å¼¹çª—ã€‚è¦æŠŠè¿™é‡Œnopæ‰ã€‚\n\n![image-20250602165959876](/pictures/XYCTF2024/image-20250602165959876.png)\n\n![image-20250602170024249](/pictures/XYCTF2024/image-20250602170024249.png)\n\nâ€‹\tç„¶åè°ƒè¯•çš„æ—¶å€™ï¼Œè¿™é‡Œv24å¾ˆå¤§ï¼Œå¯¼è‡´æˆ‘ä»¬å¾ªç¯åŠå¤©ï¼Œè¦æ‰‹åŠ¨æ”¹æ ‡å¿—ä½è·³å‡ºã€‚\n\n![image-20250602170144586](/pictures/XYCTF2024/image-20250602170144586.png)\n\nâ€‹\tå†çœ‹ä¸‹é¢1290å‡½æ•°æ˜¯åŠ å¯†éƒ¨åˆ†ï¼ŒåŠ å¯†æ•°æ®æ˜¯ç¨‹åºå†™å¥½çš„ï¼ˆå½“ç„¶æ˜¯é”™çš„ï¼‰ï¼Œæ‰€ä»¥æ²¡æœ‰ç”¨æˆ·è¾“å…¥çš„åœ°æ–¹ã€‚ä¸‹é¢å°±æ˜¯å­—ç¬¦ä¸²æ¯”å¯¹ï¼Œç„¶åå¼¹å‡ºæç¤ºä¿¡æ¯ã€‚æ‰€ä»¥å¯ä»¥çŒœå‡ºè¿™ä¸ªå°±æ˜¯å¯†æ–‡ï¼Œæˆ‘ä»¬è¦å¯¹åŠ å¯†ç®—æ³•é€†å‘ã€‚![image-20250602170236930](/pictures/XYCTF2024/image-20250602170236930.png)\n\nâ€‹\tåŠ å¯†å‡½æ•°é‡Œé¢æœ‰ä¸€ä¸ªè‡ªå®šä¹‰çš„base64ï¼ˆåç¼–è¯‘æ ¹æœ¬çœ‹ä¸å‡ºæ¥å•Šï¼Œåªèƒ½é çœ‹æ±‡ç¼–å’ŒåŠ¨æ€è°ƒè¯•çœ‹ï¼‰ï¼Œå…¶ç®—æ³•æ˜¯å¯¹äºä¸‰ä½ä¸€ç»„çš„ABCï¼Œå…¶å¯†æ–‡åˆ†åˆ«æ˜¯base[A&0x3f]ã€base[((B&0xf)<<2)|(A>>6)&3]ã€base[(B>>4)&0xf | (C&3)<<4]ã€base[(C>>2)0x3f]ã€‚\n\n> â€‹\tç›¸å½“äºå¯¹åŸå­—ç¬¦ABCï¼Œå…¶éƒ½æœ‰å…«ä½ã€‚åŠ å¯†æ—¶æ˜¯ï¼š\n>\n> ç¬¬ä¸€ä½å¯¹åº”ï¼šA[6] A[5] A[4] A[3] A[2] A[1]\n>\n> ç¬¬äºŒä½å¯¹åº”ï¼šB[4] B[3] B[2] B[1] A[8] A[7]\n>\n> ç¬¬ä¸‰ä½å¯¹åº”ï¼šC[2] C[1] B[8] B[7] B[6] B[5]\n>\n> ç¬¬å››ä½å¯¹åº”ï¼šC[8] C[7] C[6] C[5] C[4] C[3]\n\n```python\ndef decode_custom_base64(data: str, base: str = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\") -> bytes:\n    \"\"\"\n    è‡ªå®šä¹‰ Base64 è§£ç å‡½æ•°ï¼Œè¿”å›è§£ç åçš„å­—èŠ‚ä¸²ã€‚\n\n    è§„åˆ™å¯¹åº”ï¼š\n    - è¾“å…¥4ä¸ªå­—ç¬¦ä¸€ç»„ï¼Œæ˜ å°„åˆ°3ä¸ªå­—èŠ‚ABC\n    - è§£ç ç®—æ³•æ ¹æ®ä½ ç»™å‡ºçš„å¯¹åº”å…³ç³»é€†å‘å®ç°\n    \"\"\"\n    decoded_bytes = bytearray()\n    base_index = {ch: i for i, ch in enumerate(base)}\n\n    length = len(data)\n    i = 0\n    while i < length:\n        # å–4ä¸ªå­—ç¬¦ï¼Œå¡«å……ä¸º'='åé¢è¡¥0\n        chunk = data[i:i+4]\n        if len(chunk) < 4:\n            chunk += '=' * (4 - len(chunk))\n\n        vals = []\n        for ch in chunk:\n            if ch == '=':\n                vals.append(0)\n            else:\n                vals.append(base_index[ch])\n\n        # æ ¹æ®ç¼–ç è§„åˆ™ï¼Œé€†æ¨ ABC ä¸‰å­—èŠ‚ï¼š\n        # è®¾ç¼–ç å­—ç¬¦å¯¹åº”çš„6ä½æ•°åˆ†åˆ«æ˜¯v0,v1,v2,v3\n        v0, v1, v2, v3 = vals\n\n        # è§£ç å…¬å¼ï¼ˆåæ¨ä½ ç»™å‡ºçš„ç¼–ç æ–¹å¼ï¼‰ï¼š\n        A = (v0 & 0x3F) | ((v1 & 0x03) << 6)\n        B = ((v1 >> 2) & 0x0F) | ((v2 & 0x0F) << 4)\n        C = ((v2 >> 4) & 0x03) | ((v3 & 0x3F) << 2)\n\n        decoded_bytes.append(A)\n        if chunk[2] != '=':\n            decoded_bytes.append(B)\n        if chunk[3] != '=':\n            decoded_bytes.append(C)\n\n        i += 4\n\n    return bytes(decoded_bytes)\n\n\ndef decode_custom_base64_to_str(data: str, base: str = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\", encoding='utf-8') -> str:\n    \"\"\"\n    è°ƒç”¨è‡ªå®šä¹‰è§£ç å‡½æ•°ï¼Œå°†ç»“æœè½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚\n    \"\"\"\n    decoded_bytes = decode_custom_base64(data, base)\n    return decoded_bytes.decode(encoding, errors='ignore')\n\n\n# ç¤ºä¾‹\nif __name__ == \"__main__\":\n    custom_base = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\"\n    encoded = \"1YmNkZTN2QmNmdjM3kTNmZTZ2UzN2YTN3ITNmZzN2YWNmZDN2YmNlZTN1YmN2YTO2UmNxYzY2M2N5UjZ3QjN4YTM2UmNidTO2Y2N1UjZ3gjN5YTM2Y2N3YTM2UmN3cDN2YmNlZzN3gzN1YTN3QG=\"  \n    decoded = decode_custom_base64_to_str(encoded, custom_base)\n    for i in range(0,len(decoded), 2):\n        print(chr(int(decoded[i:i+2], 16)), end='')\n        \n   #_memory_never_go_done_finally_thankyou_xiaowangtongxue}\n```\n\nåˆåœ¨ä¸€èµ·å°±æ˜¯flag{L0v3_i8_a_k3y_and_memory_never_go_done_finally_thankyou_xiaowangtongxue}\n\n\n\nâ€‹\tæœ€ååŠ¨è°ƒçœ‹ä¸€çœ‹æ•…äº‹æœ€åçš„ç»“å±€ï¼Œçœ‹ä¸€çœ‹ä½œè€…æœ€åçš„æ„Ÿæ‚Ÿã€‚\n\n![image-20250602170833655](/pictures/XYCTF2024/image-20250602170833655.png)\n","tags":["å¤ç°WP","Reverse"],"categories":["CTF"]},{"title":"åˆè¯†Unicorn","url":"/2025/06/29/XYCTF2025/åˆè¯†Unicorn/","content":"\n\n\n# Unicornæ¡†æ¶\n\n## å‰è¨€\n\nâ€‹\tç¯å¢ƒæ­å»ºæ•™ç¨‹å¯ä»¥çœ‹XYCTF2025ä¸­çš„ezVMï¼Œåªæœ‰ubuntuè™šæ‹Ÿæœºç‰ˆæœ¬çš„ï¼Œæœ‰pythonè¯­è¨€ã€C++è¯­è¨€å’ŒCè¯­è¨€ç‰ˆæœ¬ã€‚\n\n\n\n## ä»‹ç»\n\nâ€‹\t**unicorn**æ˜¯ä¸€ä¸ªè·¨å¹³å°ã€è½»é‡çº§çš„CPUæŒ‡ä»¤é›†ä»¿çœŸæ¡†æ¶ï¼Œç”¨äºæ¨¡ä»¿CPUæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ï¼Œä¸éœ€è¦çœŸå®ç¡¬ä»¶æˆ–å®Œæ•´æ“ä½œç³»ç»Ÿæ”¯æŒã€‚Unicorn æ˜¯ç”±è‘—åçš„é€†å‘å·¥å…· QEMU çš„ä»£ç è¡ç”Ÿè€Œæ¥ï¼Œä½†å°è£…æˆäº†ä¸€ä¸ªç®€å•çš„åº“ï¼Œæ”¯æŒå¤šè¯­è¨€è°ƒç”¨ï¼Œé‡ç‚¹åœ¨äºæ¨¡æ‹Ÿ CPU æ‰§è¡Œè€Œä¸æ˜¯å®Œæ•´ç³»ç»Ÿè™šæ‹ŸåŒ–ã€‚\n\nâ€‹\tæ”¯æŒæ¡†æ¶ã€‚\n\n| æ¶æ„åç§° | è¯´æ˜                     |\n| -------- | ------------------------ |\n| x86      | 32ä½æ¶æ„                 |\n| x86_64   | 64ä½æ¶æ„ï¼ˆamd64ï¼‰        |\n| ARM      | 32ä½ ARM æ¶æ„            |\n| ARM64    | 64ä½ ARM æ¶æ„ï¼ˆAArch64ï¼‰ |\n| MIPS     | åŒ…æ‹¬ MIPS32 å’Œ MIPS64    |\n| PowerPC  | Power æ¶æ„çš„ä¸€éƒ¨åˆ†       |\n| SPARC    | è¾ƒå°‘ä½¿ç”¨ï¼Œä½†æ”¯æŒ         |\n| RISC-V   | è¾ƒæ–°çš„å¼€æºæ¶æ„           |\n\nâ€‹\t\n\n> â€‹\tUnicorn ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹æ¨¡å—ï¼š\n>\n> 1. **å†…å­˜ç®¡ç†ï¼ˆMemory Mapï¼‰**ï¼šæ˜ å°„ç¨‹åºè¿è¡Œæ‰€éœ€çš„åœ°å€ç©ºé—´\n> 2. **å¯„å­˜å™¨æ¥å£**ï¼šè®¾ç½®æˆ–è¯»å–è™šæ‹Ÿ CPU çš„å¯„å­˜å™¨å€¼\n> 3. **ä»¿çœŸå™¨æ¥å£ï¼ˆEmulatorï¼‰**ï¼šæ§åˆ¶æ‰§è¡Œå¼€å§‹/åœæ­¢/æ­¥è¿›ç­‰\n> 4. **é’©å­æœºåˆ¶ï¼ˆHooksï¼‰**ï¼šç”¨æˆ·å¯æ’å…¥å›è°ƒï¼Œæ‹¦æˆªæŒ‡ä»¤ã€å†…å­˜ã€å¼‚å¸¸äº‹ä»¶\n> 5. **é”™è¯¯å¤„ç†ä¸çŠ¶æ€ç **\n\n\n\n```c\n//ä½¿ç”¨æµç¨‹ï¼Œä»¥Cã€C++ä¸ºä¾‹\nuc_engine *uc;\nuc_open(UC_ARCH_X86, UC_MODE_32, &uc);\nuc_mem_map(uc, addr, size, UC_PROT_ALL);\nuc_mem_write(uc, addr, code, code_size);\nuc_reg_write(uc, UC_X86_REG_EIP, &addr);\nuc_emu_start(uc, addr, addr + code_size, 0, 0);\nuc_reg_read(uc, UC_X86_REG_EAX, &result);\nuc_close(uc);\n\n\n\nuc_open(...)         // åˆå§‹åŒ–å¼•æ“\nuc_mem_map(...)      // åˆ†é…æ¨¡æ‹Ÿå†…å­˜\nuc_mem_write(...)    // å†™å…¥æŒ‡ä»¤æˆ–æ•°æ®\nuc_reg_write(...)    // è®¾ç½®å¯„å­˜å™¨çŠ¶æ€\nuc_emu_start(...)    // å¯åŠ¨æ¨¡æ‹Ÿæ‰§è¡Œ\nuc_reg_read(...)     // è¯»å–å¯„å­˜å™¨ç»“æœ\nuc_close(...)        // å…³é—­å¼•æ“é‡Šæ”¾èµ„æº\n```\n\n\n\n\n\n### ä¸»è¦å‡½æ•°\n\nâ€‹\t`uc_err uc_open(uc_arch arch, uc_mode mode, uc_engine **uc);`\n\nâ€‹\t**åŠŸèƒ½**ï¼šåˆå§‹åŒ–Unicornå¼•æ“ã€‚\n\nâ€‹\t**å‚æ•°**ï¼šarchâ€”â€”æ¶æ„ç±»å‹ï¼Œmodeâ€”â€”æ¨¡å¼ï¼Œå¦‚32ä½ã€64ä½ï¼Œucâ€”â€”è¾“å‡ºå‚æ•°ï¼ŒæŒ‡å‘æ–°åˆ›å»ºçš„å¼•æ“å¥æŸ„ã€‚\n\nâ€‹\t**è¿”å›å€¼**ï¼šé”™è¯¯ç ï¼ˆ`UC_ERR_OK` è¡¨ç¤ºæˆåŠŸï¼‰\n\nâ€‹\t\n\nâ€‹\t`uc_err uc_close(uc_engine *uc);`\n\nâ€‹\t**åŠŸèƒ½**ï¼šå…³é—­å¹¶ä¸”é‡Šæ”¾Unicornèµ„æºã€‚\n\nâ€‹\t**å‚æ•°**ï¼šå¼•æ“å¥æŸ„ã€‚\n\nâ€‹\t**è¿”å›å€¼**ï¼šé”™è¯¯ç ã€‚\n\nâ€‹\t\n\nâ€‹\t`uc_err uc_mem_map(uc_engine *uc, uint64_t address, size_t size, uint32_t perms);`\n\nâ€‹\t**åŠŸèƒ½**ï¼šç»™æ¨¡æ‹Ÿå™¨åˆ†é…ä¸€å—å†…å­˜ã€‚\n\nâ€‹\t**å‚æ•°**ï¼šaddressâ€”â€”è™šæ‹Ÿå†…å­˜èµ·å§‹åœ°å€ï¼Œsizeâ€”â€”æ˜ å°„å¤§å°ï¼Œpermsâ€”â€”å†…å­˜æƒé™æ ‡å¿—ï¼Œå¦‚**UC_PROT_READ | UC_PROT_WRITE | UC_PROT_EXEC**ã€‚\n\nâ€‹\t**è¿”å›å€¼**ï¼šé”™è¯¯ç ã€‚\n\nâ€‹\t**æ³¨è§£**ï¼šæ¨¡æ‹Ÿå™¨æ‰§è¡Œä»£ç å’Œè¯»å†™æ•°æ®çš„å†…å­˜éƒ½éœ€è¦å…ˆæ˜ å°„ã€‚\n\n\n\nâ€‹\t`uc_err uc_mem_write(uc_engine *uc, uint64_t address, const void *buffer, size_t size);`\n\nâ€‹\t**åŠŸèƒ½**ï¼šå¾€æ¨¡æ‹Ÿå†…å­˜å†™æ•°æ®ï¼ˆä»£ç æˆ–å˜é‡ï¼‰ã€‚\n\nâ€‹\t**å‚æ•°**ï¼šaddessâ€”â€”å†™å…¥å†…å­˜çš„èµ·å§‹åœ°å€ï¼Œbufferâ€”â€”æ•°æ®ç¼“å†²åŒºï¼Œå¾…å†™å…¥æ•°æ®çš„åœ°å€ï¼Œsizeâ€”â€”æ•°æ®é•¿åº¦ã€‚\n\nâ€‹\t**æ³¨è§£**ï¼šå¸¸ç”¨æ¥å†™å…¥æœºå™¨ç æˆ–æ¨¡æ‹Ÿæ•°æ®ã€‚\n\n\n\nâ€‹\t`uc_err uc_mem_read(uc_engine *uc, uint64_t address, void *buffer, size_t size);`\n\nâ€‹\t**åŠŸèƒ½**ï¼šä»æ¨¡æ‹Ÿå†…å­˜è¯»å–æ•°æ®ã€‚\n\nâ€‹\t**å‚æ•°**ï¼šåŒ uc_mem_writeï¼Œä½† buffer ç”¨æ¥å­˜æ”¾è¯»å‡ºçš„æ•°æ®\n\nâ€‹\t**æ³¨è§£**ï¼šæ‰§è¡Œåè¯»å–å†…å­˜ä¸­çŠ¶æ€ï¼Œæˆ–è€…è·å¾—è®¡ç®—ç»“æœã€‚\n\n\n\nâ€‹\t`uc_err uc_reg_write(uc_engine *uc, int regid, const void *value);`\n\nâ€‹\t**åŠŸèƒ½**ï¼šè®¾ç½®æ¨¡æ‹Ÿ CPU å¯„å­˜å™¨çš„å€¼ã€‚\n\nâ€‹\t**å‚æ•°**ï¼šregidâ€”â€”å¯„å­˜å™¨ IDï¼Œå¦‚ `UC_X86_REG_EAX`ï¼Œvalueâ€”â€”æŒ‡å‘åŒ…å«å¯„å­˜å™¨å€¼çš„å˜é‡çš„æŒ‡é’ˆï¼ˆä¼ å¾…ä¼ æ•°æ®çš„åœ°å€ï¼‰ã€‚\n\nâ€‹\t**æ³¨è§£**ï¼šå¯åŠ¨æ‰§è¡Œå‰è®¾ç½®å¯„å­˜å™¨çŠ¶æ€ï¼Œå¦‚ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰ã€å †æ ˆæŒ‡é’ˆï¼ˆSPï¼‰ç­‰ã€‚\n\n\n\nâ€‹\t`uc_err uc_reg_read(uc_engine *uc, int regid, void *value);`\n\nâ€‹\t**åŠŸèƒ½**ï¼šè¯»å–æ¨¡æ‹Ÿ CPU å¯„å­˜å™¨çš„å€¼ã€‚\n\nâ€‹\t**å‚æ•°**ï¼šç±»ä¼¼ `uc_reg_write`ï¼Œå°†å¯„å­˜å™¨å€¼å†™å…¥ `value` æŒ‡å‘çš„å˜é‡ã€‚\n\nâ€‹\t**æ³¨è§£**ï¼šæ‰§è¡Œå®Œæ¯•åè¯»å–å¯„å­˜å™¨çŠ¶æ€ï¼ŒæŸ¥çœ‹ç»“æœæˆ–ä¸‹ä¸€æ­¥æ‰§è¡Œåœ°å€ã€‚\n\n\n\nâ€‹\t`uc_err uc_emu_start(uc_engine *uc, uint64_t begin, uint64_t until, uint64_t timeout, uint64_t count);`\n\nâ€‹\t**åŠŸèƒ½**ï¼šå¯åŠ¨ä»¿çœŸæ‰§è¡Œï¼Œä» `begin` åœ°å€å¼€å§‹æ‰§è¡Œï¼Œç›´åˆ° `until` åœæ­¢\n\nâ€‹\t**å‚æ•°**ï¼šbeginâ€”â€”ä»£ç å…¥å£åœ°å€ã€‚untilâ€”â€”ç»“æŸåœ°å€ï¼ˆå¯è®¾ç½®ä¸º0è¡¨ç¤ºæ— é™æ‰§è¡Œç›´åˆ°å‡ºé”™ï¼‰ã€‚timeoutâ€”â€”è¶…æ—¶æ—¶é—´ï¼ˆå¾®ç§’ï¼‰ï¼Œ0 è¡¨ç¤ºä¸é™åˆ¶ã€‚countâ€”â€”æœ€å¤§æ‰§è¡ŒæŒ‡ä»¤æ•°ï¼Œ0 è¡¨ç¤ºä¸é™åˆ¶ã€‚\n\nâ€‹\t**æ³¨è§£**ï¼šè¿™æ˜¯æ‰§è¡ŒæŒ‡ä»¤çš„æ ¸å¿ƒå‡½æ•°ã€‚\n\n\n\n\n\nâ€‹\tHook æ³¨å†Œå‡½æ•°**uc_hook_add**ï¼šæ·»åŠ é’©å­ï¼Œæ‹¦æˆªæŒ‡ä»¤æ‰§è¡Œã€å†…å­˜è¯»å†™ã€å¼‚å¸¸ç­‰äº‹ä»¶ã€‚\n\nâ€‹\t`hook_code_callback` æ˜¯ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼Œä¼šåœ¨æŒ‡å®šèŒƒå›´å†…æ¯æ¡æŒ‡ä»¤æ‰§è¡Œæ—¶è°ƒç”¨ã€‚\n\n```c\nuc_hook trace;\nuc_hook_add(uc, &trace, UC_HOOK_CODE, hook_code_callback, NULL, ADDRESS, ADDRESS + size);\n```\n\n\n\n\n\nâ€‹\té”™è¯¯ç è¯´æ˜ï¼š`UC_ERR_OK` = 0ï¼ŒæˆåŠŸï¼Œå…¶å®ƒå¦‚ `UC_ERR_WRITE_UNMAPPED`ã€`UC_ERR_READ_UNMAPPED` è¡¨ç¤ºå†…å­˜è®¿é—®é”™è¯¯\n\nä½¿ç”¨ `uc_strerror(err)` å¯è·å–é”™è¯¯ä¿¡æ¯å­—ç¬¦ä¸²ã€‚\n\n\n\n## ç®€å•ä½¿ç”¨ç¤ºä¾‹\n\n```bash\nå…ˆå¯¼å…¥ç¯å¢ƒå˜é‡ï¼Œä¸æƒ³æ¯æ¬¡éƒ½æ“ä½œå¯ä»¥å†™å…¥å®¶ç›®å½•çš„.bashrcä¸­ã€‚\nexport LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/home/ubuntu/desk/unicorn/build\n\nç¼–è¯‘å‘½ä»¤ç¤ºä¾‹å¦‚ä¸‹ï¼Œè‡ªè¡Œä¿®æ”¹æºæ–‡ä»¶è·¯å¾„ã€includeè·¯å¾„å’Œbuildè·¯å¾„ã€‚ï¼ˆæ³¨æ„ï¼Œæœ€å¥½ä¸è¦ç”¨ä¸­æ–‡è·¯å¾„ï¼Œè‹¥æœ‰æŠ¥é”™å¯ä»¥æ£€æŸ¥è¿™ä¸ªç‚¹ï¼‰\n\ngcc -o test /home/ubuntu/desk/test.cpp -I /home/ubuntu/unicorn/include/ -L /home/ubuntu/unicorn/build -l unicorn\n```\n\n\n\n```c\n#include <unicorn/unicorn.h>\n#include <stdio.h>\n#include <string.h>\n\n#define ADDRESS 0x1000\n#define DATA_ADDR 0x2000\t\t\t//æœ€å¥½å®šä¹‰ä¸ºå˜é‡ç±»å‹ï¼Œuint32_t\n#define CODE_SIZE 0x1000\n#define MAX_LEN 64\n\n// x86 32ä½ä»£ç ï¼Œå®ç°å¼‚æˆ–åŠ å¯†ï¼š\n// esi æŒ‡å‘è¾“å…¥ï¼Œecx é•¿åº¦\n// éå†è¾“å…¥å­—èŠ‚ï¼Œå¯¹æ¯å­—èŠ‚å¼‚æˆ–0x55\n// è¿”å›æ—¶ä¿®æ”¹å†…å­˜ä¸­å†…å®¹ä¸ºåŠ å¯†ç»“æœ\nconst uint8_t CODE[] = {\n    0x31, 0xC0,             // xor eax, eax\n    0x31, 0xD2,             // xor edx, edx\n    // loop_start:\n    0x8A, 0x06,             // mov al, byte ptr [esi]\n    0x80, 0xF0, 0x55,       // xor al, 0x55\n    0x88, 0x06,             // mov byte ptr [esi], al\n    0x46,                   // inc esi\n    0x42,                   // inc edx\n    0x49,                   // dec ecx\n    0x75, 0xF5,             // jne loop_start\n    0xC3                    // ret\n};\n\nint main() {\n    uc_engine *uc;\n    uc_err err;\n\n    char input[MAX_LEN];\n    const char encrypted_flag[] = {\n        'C' ^ 0x55, 'T' ^ 0x55, 'F' ^ 0x55, '{' ^ 0x55, 's' ^ 0x55, 'e' ^ 0x55,\n        'c' ^ 0x55, 'r' ^ 0x55, 'e' ^ 0x55, 't' ^ 0x55, '_' ^ 0x55, 'f' ^ 0x55,\n        'l' ^ 0x55, 'a' ^ 0x55, 'g' ^ 0x55, '}' ^ 0x55, '\\0'\n    };\n\n    printf(\"Enter flag: \");\n    if (!fgets(input, sizeof(input), stdin)) {\n        printf(\"Input error\\n\");\n        return -1;\n    }\n    size_t len = strlen(input);\n    if (len > 0 && input[len - 1] == '\\n') {\n        input[len - 1] = '\\0';\n        len--;\n    }\n\n    if (len != strlen(encrypted_flag)) {\n        printf(\"Flag verification failed.\\n\");\n        return 0;\n    }\n\n    // åˆå§‹åŒ– Unicorn\n    err = uc_open(UC_ARCH_X86, UC_MODE_32, &uc);\n    if (err) {\n        printf(\"Failed to initialize Unicorn engine: %u\\n\", err);\n        return -1;\n    }\n\n    // åˆ†é…å†…å­˜ï¼Œå†™å…¥ä»£ç å’Œæ•°æ®\n    uc_mem_map(uc, ADDRESS, CODE_SIZE, UC_PROT_ALL);\n    uc_mem_write(uc, ADDRESS, CODE, sizeof(CODE));\n\n    uc_mem_map(uc, DATA_ADDR, CODE_SIZE, UC_PROT_ALL);\n    uc_mem_write(uc, DATA_ADDR, input, len);\n\n    // è®¾ç½®å¯„å­˜å™¨\n    uc_reg_write(uc, UC_X86_REG_ESI, DATA_ADDR);\t//æœ€å¥½ä¼ å…¥æŒ‡é’ˆ&DATA_ADDRï¼Œå‰ææ˜¯æ”¹ä¸ºå˜é‡ç±»å‹äº†\n    uc_reg_write(uc, UC_X86_REG_ECX, len);\t\t\t//æœ€å¥½ä¼ å…¥&len\n\n    // æ‰§è¡Œä»£ç ï¼ˆåŠ å¯†ï¼‰\n    err = uc_emu_start(uc, ADDRESS, ADDRESS + sizeof(CODE), 0, 0);\n    if (err) {\n        printf(\"Failed to emulate code: %u\\n\", err);\n        uc_close(uc);\n        return -1;\n    }\n\n    // è¯»å–åŠ å¯†åçš„æ•°æ®\n    char encrypted_input[MAX_LEN] = {0};\n    uc_mem_read(uc, DATA_ADDR, encrypted_input, len);\n\n    // æ¯”å¯¹\n    if (memcmp(encrypted_input, encrypted_flag, len) == 0) {\n        printf(\"Flag verified successfully!\\n\");\n    } else {\n        printf(\"Flag verification failed.\\n\");\n    }\n\n    uc_close(uc);\n    return 0;\n}\n\n```\n\n\n\n\n\n\n\n## \tç›¸å…³æ–‡ç« é“¾æ¥\n\nâ€‹\t[åšå®¢å›­](https://www.cnblogs.com/Here-is-SG/p/17080180.html)ã€[Unicorné¡¹ç›®](https://github.com/unicorn-engine/unicorn)\n","tags":["Reverse","æŠ€æœ¯å­¦ä¹ "],"categories":["Reverse"]},{"title":"OpenGLåˆå­¦ä¹ ","url":"/2025/06/25/OpenGLå­¦ä¹ /OpenGLå­¦ä¹ /","content":"\n### \tç¯å¢ƒæ­å»º\n\nâ€‹\tå­¦ä¹ OpenGLçš„æ ¸å¿ƒæ¨¡å¼ï¼Œ[VS2022+GLFW+GLADç¯å¢ƒæ­å»ºæ•™ç¨‹](https://blog.csdn.net/ssunshining/article/details/123767340)ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æ–‡ç« ä¸­ä¸‹è½½çš„GLFWæ˜¯ç¼–è¯‘å¥½çš„ï¼Œæˆ‘ä»¬å¯ä»¥è·³è¿‡CMakeç¼–è¯‘çš„é‚£ä¸€æ­¥ï¼Œç›´æ¥å»æ‰¾includeæ–‡ä»¶å’Œlibæ–‡ä»¶ã€‚\n\nâ€‹\tè¿˜æœ‰å­¦ä¹ èµ„æºï¼Œ[çŸ¥è¯†ç‚¹å­¦ä¹ ](https://learnopengl-cn.github.io/)ã€‚\n\n\n\n------\n\n\n\n### \tåŸºç¡€çŸ¥è¯†ï¼ˆçŸ¥è¯†ç‚¹å­¦ä¹ ï¼‰\n\n\n\n> ### ğŸ”· OpenGL æ˜¯ä»€ä¹ˆï¼Ÿ\n>\n> > OpenGLï¼ˆOpen Graphics Libraryï¼‰æ˜¯ä¸€ä¸ªç”»å›¾çš„æ ‡å‡†å·¥å…·åº“ï¼Œç”¨æ¥ç»˜åˆ¶å›¾å½¢ï¼Œæ¯”å¦‚ 3D æ¨¡å‹ã€åœºæ™¯ã€ç‰¹æ•ˆç­‰ç­‰ã€‚\n>\n> - å®ƒä¸è´Ÿè´£åˆ›å»ºçª—å£ï¼Œä¹Ÿä¸èƒ½å¤„ç†é¼ æ ‡/é”®ç›˜ï¼Œåªä¸“æ³¨â€œç”»å›¾â€ã€‚\n> - æƒ³è±¡ä½ æ˜¯ç”»å®¶ï¼ŒOpenGL å°±æ˜¯ä½ çš„ç”»ç¬”å’Œé¢œæ–™ã€‚\n>\n> ------\n>\n> ### ğŸ”¶ GLFW æ˜¯ä»€ä¹ˆï¼Ÿ\n>\n> > GLFW æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨æ¥åˆ›å»ºçª—å£ã€å¤„ç†ç”¨æˆ·è¾“å…¥ï¼ˆé”®ç›˜é¼ æ ‡ï¼‰å’Œè®¾ç½® OpenGL çš„åº“ã€‚\n>\n> - å®ƒå¸®ä½ æ‰“å¼€ä¸€ä¸ªçª—å£ã€è®¾ç½® OpenGL çš„ç‰ˆæœ¬ï¼Œå¹¶å“åº”é¼ æ ‡/é”®ç›˜äº‹ä»¶ã€‚\n> - æ²¡æœ‰ GLFWï¼ˆæˆ–ç±»ä¼¼çš„åº“ï¼‰ï¼Œä½ è¿â€œæ‰“å¼€ç”»å¸ƒâ€éƒ½åšä¸åˆ°ã€‚\n>\n> ------\n>\n> ### ğŸ”¸ GLAD æ˜¯ä»€ä¹ˆï¼Ÿ\n>\n> > GLAD æ˜¯ä¸€ä¸ª OpenGL çš„â€œåŠ è½½å™¨â€ï¼Œå¸®ä½ æŠŠ OpenGL çš„å‡½æ•°éƒ½å‡†å¤‡å¥½ã€‚\n>\n> - å› ä¸º OpenGL çš„å‡½æ•°ä¸æ˜¯è‡ªåŠ¨æä¾›çš„ï¼Œéœ€è¦æ‰‹åŠ¨â€œåŠ è½½â€æ‰èƒ½ä½¿ç”¨ã€‚\n> - GLAD å°±åƒä¸€ä¸ªå·¥å…·ç®±æ‰“å¼€å™¨ï¼Œç¡®ä¿ä½ èƒ½æ­£ç¡®ä½¿ç”¨æ‰€æœ‰ç”»å›¾å·¥å…·ã€‚\n>\n> ------\n>\n> ## ğŸ§  è®°å¿†å°å£è¯€ï¼š\n>\n> **GLFW å¼€çª—å£ï¼ŒGLAD å¼€å·¥å…·ï¼ŒOpenGL å¼€ç”»å›¾ã€‚**\n\nâ€‹\t\n\n\n\n\n\n\n\n> ## OpenGL çš„åæ ‡ç³»ï¼ˆæ ‡å‡†åŒ–è®¾å¤‡åæ ‡ NDCï¼‰\n>\n> 1. **åæ ‡èŒƒå›´ï¼š**\n>     OpenGL åœ¨æ¸²æŸ“ç®¡çº¿æœ€åä¸€æ­¥ï¼Œä¼šæŠŠé¡¶ç‚¹åæ ‡å˜æ¢åˆ°ä¸€ä¸ªå«åš **æ ‡å‡†åŒ–è®¾å¤‡åæ ‡**ï¼ˆNDCï¼ŒNormalized Device Coordinatesï¼‰çš„ç©ºé—´é‡Œã€‚\n>    - Xè½´èŒƒå›´ï¼šä» **-1 åˆ° 1**ï¼ˆå·¦åˆ°å³ï¼‰\n>    - Yè½´èŒƒå›´ï¼šä» **-1 åˆ° 1**ï¼ˆä¸‹åˆ°ä¸Šï¼‰\n>    - Zè½´èŒƒå›´ï¼šä» **-1 åˆ° 1**ï¼ˆè¿‘åˆ°è¿œï¼Œæ·±åº¦ï¼‰\n> 2. **åæ ‡è½´æ–¹å‘ï¼š**\n>    - Xè½´ï¼šè´Ÿæ–¹å‘æŒ‡å‘å·¦ï¼Œæ­£æ–¹å‘æŒ‡å‘å³\n>    - Yè½´ï¼šè´Ÿæ–¹å‘æŒ‡å‘ä¸‹ï¼Œæ­£æ–¹å‘æŒ‡å‘ä¸Š\n>    - Zè½´ï¼šè´Ÿæ–¹å‘æŒ‡å‘å±å¹•å¤–ï¼ˆè§‚å¯Ÿè€…æ–¹å‘ï¼‰ï¼Œæ­£æ–¹å‘æŒ‡å‘å±å¹•å†…\n> 3. **äºŒç»´ç»˜å›¾æ—¶ï¼ŒZè½´é€šå¸¸ä¸º0**\n> 4. **åŸç‚¹åœ¨æ˜¾ç¤ºçª—å£çš„ä¸­å¿ƒç‚¹**\n\n\n\n\n\nâ€‹\tVBOæ˜¯ä»€ä¹ˆï¼Ÿé¡¶ç‚¹ç¼“å†²å¯¹è±¡ï¼Œç”¨æ¥ç®¡ç†å†…å­˜ã€‚çœ‹ä¸‹é¢çš„ä»£ç ï¼Œå°±æ˜¯ä½¿ç”¨**glGenBuffers**å‡½æ•°ç”Ÿæˆä¸€ä¸ªå¸¦æœ‰ç¼“å†²IDçš„VBOå¯¹è±¡ã€‚\n\n```java\nunsigned int VBO;\nglGenBuffers(1, &VBO);\n```\n\n> ğŸ§  ä¸ºä»€ä¹ˆ VBO æ˜¯ä¸€ä¸ª `unsigned int` å˜é‡ï¼Ÿ\n>\n> â€”â€”å› ä¸ºåœ¨ OpenGL çš„å†…éƒ¨è®¾è®¡ä¸­ï¼Œæ¯ä¸€ä¸ªâ€œå¯¹è±¡â€ï¼ˆæ¯”å¦‚ç¼“å†²åŒºå¯¹è±¡ã€çº¹ç†å¯¹è±¡ã€ç€è‰²å™¨å¯¹è±¡ï¼‰éƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„æ•°å­— IDï¼Œè¿™ä¸ª ID å°±æ˜¯ä¸€ä¸ªæ•´æ•°ã€‚OpenGL å¹¶ä¸ç›´æ¥è¿”å›ä¸€ä¸ªâ€œæŒ‡é’ˆâ€æˆ–è€…â€œç»“æ„ä½“â€ï¼Œå®ƒåªè¿”å›ä¸€ä¸ªæ•´æ•°å€¼ï¼Œç„¶åä½ ä»¥ååªè¦ç”¨è¿™ä¸ªæ•°å­—æ¥å¼•ç”¨è¿™ä¸ªå¯¹è±¡å°±è¡Œäº†ã€‚\n>\n> â“é‚£ VBO æœ¬èº«æ˜¯ç¼“å†²åŒºå—ï¼Ÿ\n>\n> â€”â€”ä¸æ˜¯ã€‚VBOåªæ˜¯ä¸€ä¸ªæ•´æ•°å˜é‡ï¼Œç”¨æ¥å­˜è¿™ä¸ªç¼“å†²åŒºçš„IDï¼ŒçœŸæ­£çš„â€œç¼“å†²åŒºå¯¹è±¡â€æ˜¯åœ¨OpenGLå†…éƒ¨åˆ›å»ºå’Œç®¡ç†çš„ï¼Œä½ åªèƒ½é€šè¿‡è¿™ä¸ªIDæ¥é—´æ¥ä½¿ç”¨å®ƒã€‚\n\n\n\n\n\nâ€‹\tVAOæ˜¯ä»€ä¹ˆï¼Ÿé¡¶ç‚¹æ•°ç»„å¯¹è±¡ï¼Œå¸®ä½ æŠŠä¸€å †â€œé¡¶ç‚¹å±æ€§è®¾ç½®â€çš„çŠ¶æ€ä¿å­˜èµ·æ¥ï¼Œä¸‹æ¬¡æƒ³ç”¨çš„æ—¶å€™ä¸€ç»‘ä¸Šï¼ŒOpenGL å°±çŸ¥é“ä½ çš„é¡¶ç‚¹æ•°æ®é•¿ä»€ä¹ˆæ ·ï¼Œä¸ç”¨ä½ æ¯æ¬¡éƒ½é‡æ–°è®¾ç½®ã€‚\n\n> ## ä¸ºä»€ä¹ˆè¦æœ‰ VAOï¼Ÿ\n>\n> ä½ ç”»ä¸€ä¸ªå›¾å½¢ï¼Œé¡¶ç‚¹æ•°æ®é™¤äº†é¡¶ç‚¹åæ ‡å¤–ï¼Œè¿˜å¯èƒ½æœ‰é¢œè‰²ã€æ³•çº¿ã€çº¹ç†åæ ‡ç­‰ï¼Œæ¯ç§æ•°æ®éƒ½è¦å‘Šè¯‰ OpenGL æ€ä¹ˆè¯»å–ã€‚\n>\n> ä¸¾ä¸ªä¾‹å­ï¼š\n>\n> - ä½ çš„é¡¶ç‚¹åæ ‡æ•°æ®åœ¨ç¼“å†²åŒºé‡Œçš„èµ·å§‹åœ°å€æ˜¯0ï¼Œå¤§å°æ˜¯3ä¸ªfloat\n> - é¢œè‰²æ•°æ®åœ¨ç¼“å†²åŒºé‡Œçš„èµ·å§‹åœ°å€æ˜¯12å­—èŠ‚ï¼Œå¤§å°æ˜¯3ä¸ªfloat\n>\n> æ¯æ¬¡ç»˜åˆ¶ä¹‹å‰ï¼Œä½ å¾—å‘Šè¯‰ OpenGL è¿™äº›æ•°æ®åœ¨å“ªï¼Œæ ¼å¼æ˜¯ä»€ä¹ˆã€‚\n>\n> å¦‚æœæ²¡æœ‰ VAOï¼Œä½ æ¯æ¬¡ç»˜å›¾éƒ½è¦é‡å¤è¿™äº›ç¹ççš„è®¾ç½®ï¼Œéå¸¸éº»çƒ¦ã€‚\n>\n> ------\n>\n> ## VAOçš„ä½œç”¨å°±æ˜¯å¸®ä½ è®°ä½è¿™äº›è®¾ç½®\n>\n> ä½ å…ˆåˆ›å»ºä¸€ä¸ª VAOï¼Œç»‘å®šå®ƒï¼š\n>\n> ```java\n> unsigned int VAO;\n> glGenVertexArrays(1, &VAO);\n> glBindVertexArray(VAO);\n> ```\n>\n> ç„¶åä½ åšå„ç§é¡¶ç‚¹å±æ€§è®¾ç½®ï¼š\n>\n> ```java\n> glBindBuffer(GL_ARRAY_BUFFER, VBO);\n> glVertexAttribPointer(...);\n> glEnableVertexAttribArray(...);\n> ```\n>\n> è¿™äº›è®¾ç½®éƒ½ä¼šè¢« VAO è®°å½•ã€‚\n>\n> ä»¥åä½ åªè¦ï¼š\n>\n> ```java\n> glBindVertexArray(VAO);\n> ```\n>\n> OpenGLå°±è‡ªåŠ¨çŸ¥é“æ‰€æœ‰é¡¶ç‚¹å±æ€§è®¾ç½®ï¼Œä½ å¯ä»¥ç›´æ¥ç”»å›¾äº†ã€‚\n>\n> ------\n>\n> ## ç®€å•æ¯”å–»\n>\n> - **æ²¡æœ‰ VAO**ï¼šæ¯æ¬¡ç”»ç”»éƒ½è¦é‡æ–°å‘Šè¯‰ç”»ç¬”é¢œè‰²ã€ç²—ç»†ã€ä½ç½®ï¼Œéº»çƒ¦åˆå®¹æ˜“å‡ºé”™ã€‚\n> - **æœ‰äº† VAO**ï¼šæŠŠç”»ç¬”çš„è®¾ç½®å­˜å¥½ï¼Œä¸‹æ¬¡ç›´æ¥æ‹¿å‡ºæ¥ç”¨ï¼Œç”»ç”»å¿«åˆæ–¹ä¾¿ã€‚\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n------\n\n\n\n### ç¤ºä¾‹ä»£ç è®²è§£ï¼ˆæ³¨é‡Šç‰ˆï¼‰\n\n```c++\n#include<glad/glad.h>\n#include<GLFW/glfw3.h>\n\n#include<iostream>\n\n//å›è°ƒå‡½æ•°å£°æ˜ï¼Œå½“çª—å£å¤§å°æ”¹å˜å°±ä¼šè°ƒç”¨\nvoid framebuffer_size_callback(GLFWwindow* window, int width, int height);\n\n\nint main()\n{\n    glfwInit();\n    //å‘Šè¯‰GLFWæˆ‘ä»¬ä½¿ç”¨OpenGL3.3 Core Profile\n    glfwWindowHint(GLFW_CONTEXT_VERSION_MAJOR, 3);\n    glfwWindowHint(GLFW_CONTEXT_VERSION_MINOR, 3);\n    glfwWindowHint(GLFW_OPENGL_PROFILE, GLFW_OPENGL_CORE_PROFILE);\n    //glfwWindowHint(GLFW_OPENGL_FORWARD_COMPAT, GL_TRUE);\n\n    GLFWwindow* window = glfwCreateWindow(800, 600, \"LearnOpenGL\", NULL, NULL);\t//åˆ›å»ºçª—å£\n    \n    if (window == NULL)\t//æ£€æŸ¥çª—å£åˆ›å»ºçŠ¶æ€\n    {\n        std::cout << \"Failed to create GLFW window\" << std::endl;\n        glfwTerminate();\n        return -1;\n    }\n    glfwMakeContextCurrent(window);\t//æŠŠOpenGLä¸Šä¸‹æ–‡è®¾ç½®ä¸ºè¿™ä¸ªçª—å£\n\n    if (!gladLoadGLLoader((GLADloadproc)glfwGetProcAddress))\t//åˆå§‹åŒ–GLAD\n    {\n        std::cout << \"Failed to initialize GLAD\" << std::endl;\n        return -1;\n    }\n\n    glViewport(0, 0, 800, 600);\t\t//è®¾ç½®è§†å£\n\n    glfwSetFramebufferSizeCallback(window, framebuffer_size_callback);\t//æ³¨å†Œçª—å£å¤§å°å˜åŒ–çš„å›è°ƒå‡½æ•°\n\n    while (!glfwWindowShouldClose(window))\t // åªè¦çª—å£æ²¡è¢«å…³é—­ï¼Œå°±ä¸€ç›´å¾ªç¯\n    {\n        glfwSwapBuffers(window);\t\t// äº¤æ¢é¢œè‰²ç¼“å†²ï¼ˆæŠŠæ¸²æŸ“çš„å›¾åƒæ˜¾ç¤ºåˆ°å±å¹•ä¸Šï¼‰\n        glfwPollEvents();\t\t// å¤„ç†é”®ç›˜é¼ æ ‡ç­‰äº‹ä»¶\n    }\n    glfwTerminate();\t// æ¸…ç†å¹¶é€€å‡º GLFW\n    return 0;\n}\n\nvoid framebuffer_size_callback(GLFWwindow* window, int width, int height)\n{\n    glViewport(0, 0, width, height);\t\t// æ ¹æ®æ–°çš„çª—å£å¤§å°é‡æ–°è®¾ç½®è§†å£\n}\n```\n\n\n\n\n\n### ä½œä¸šä¸€\n\n\n\n- **ç»˜åˆ¶æ¸å˜è‰²çš„ä¸‰è§’å½¢**\n\n```c++\n#include <glad/glad.h>\n#include <GLFW/glfw3.h>\n#include <iostream>\n\n// çª—å£å¤§å°å˜åŒ–æ—¶è°ƒæ•´è§†å£\nvoid framebuffer_size_callback(GLFWwindow* window, int width, int height)\n{\n    glViewport(0, 0, width, height);\n}\n\n// æ£€æŸ¥ç€è‰²å™¨ç¼–è¯‘é”™è¯¯\nvoid checkCompileErrors(unsigned int shader, std::string type)\n{\n    int success;\n    char infoLog[1024];\n    if (type != \"PROGRAM\")\n    {\n        glGetShaderiv(shader, GL_COMPILE_STATUS, &success);\n        if (!success)\n        {\n            glGetShaderInfoLog(shader, 1024, NULL, infoLog);\n            std::cout << \"ERROR::SHADER_COMPILATION_ERROR of type: \" << type << \"\\n\"\n                << infoLog << \"\\n -- --------------------------------------------------- -- \" << std::endl;\n        }\n    }\n    else\n    {\n        glGetProgramiv(shader, GL_LINK_STATUS, &success);\n        if (!success)\n        {\n            glGetProgramInfoLog(shader, 1024, NULL, infoLog);\n            std::cout << \"ERROR::PROGRAM_LINKING_ERROR of type: \" << type << \"\\n\"\n                << infoLog << \"\\n -- --------------------------------------------------- -- \" << std::endl;\n        }\n    }\n}\n\nint main()\n{\n    // 1. åˆå§‹åŒ– GLFW\n    glfwInit();\n    glfwWindowHint(GLFW_CONTEXT_VERSION_MAJOR, 3); // OpenGL 3.x\n    glfwWindowHint(GLFW_CONTEXT_VERSION_MINOR, 3); // OpenGL x.3\n    glfwWindowHint(GLFW_OPENGL_PROFILE, GLFW_OPENGL_CORE_PROFILE); // æ ¸å¿ƒæ¨¡å¼\n\n#ifdef __APPLE__\n    glfwWindowHint(GLFW_OPENGL_FORWARD_COMPAT, GL_TRUE); // MacOS éœ€è¦è¿™å¥\n#endif\n\n    // 2. åˆ›å»ºçª—å£\n    GLFWwindow* window = glfwCreateWindow(800, 600, \"Colored Triangle\", NULL, NULL);\n    if (window == NULL)\n    {\n        std::cout << \"Failed to create GLFW window\\n\";\n        glfwTerminate();\n        return -1;\n    }\n    glfwMakeContextCurrent(window);\n\n    // 3. åˆå§‹åŒ– GLAD\n    if (!gladLoadGLLoader((GLADloadproc)glfwGetProcAddress))\n    {\n        std::cout << \"Failed to initialize GLAD\\n\";\n        return -1;\n    }\n\n    // 4. è®¾ç½®è§†å£å’Œçª—å£å¤§å°å›è°ƒ\n    glViewport(0, 0, 800, 600);\n    glfwSetFramebufferSizeCallback(window, framebuffer_size_callback);\n\n    // 5. å®šä¹‰é¡¶ç‚¹æ•°æ®ï¼ˆä½ç½® + é¢œè‰²ï¼‰\n    float vertices[] = {\n        // ä½ç½®           // é¢œè‰²(R, G, B)\n         0.0f,  0.5f, 0.0f,  0.0f, 0.0f, 1.0f,  // é¡¶ç‚¹1 è“è‰²\n        -0.5f, -0.5f, 0.0f,  0.0f, 1.0f, 0.0f,  // é¡¶ç‚¹2 ç»¿è‰²\n         0.5f, -0.5f, 0.0f,  1.0f, 0.0f, 0.0f   // é¡¶ç‚¹3 çº¢è‰²\n    };\n\n    // 6. ç¼–å†™é¡¶ç‚¹ç€è‰²å™¨æºç \n    const char* vertexShaderSource = R\"glsl(\n        #version 330 core\n        layout (location = 0) in vec3 aPos;   // ä½ç½®å±æ€§\n        layout (location = 1) in vec3 aColor; // é¢œè‰²å±æ€§\n\n        out vec3 ourColor; // è¾“å‡ºç»™ç‰‡å…ƒç€è‰²å™¨çš„é¢œè‰²å˜é‡\n\n        void main()\n        {\n            gl_Position = vec4(aPos, 1.0); // è®¾ç½®é¡¶ç‚¹ä½ç½®\n            ourColor = aColor;              // ä¼ é€’é¢œè‰²åˆ°ç‰‡å…ƒç€è‰²å™¨\n        }\n    )glsl\";\n\n    // 7. ç¼–å†™ç‰‡å…ƒç€è‰²å™¨æºç \n    const char* fragmentShaderSource = R\"glsl(\n        #version 330 core\n        in vec3 ourColor;       // ä»é¡¶ç‚¹ç€è‰²å™¨ä¼ æ¥çš„é¢œè‰²\n\n        out vec4 FragColor;     // è¾“å‡ºé¢œè‰²\n\n        void main()\n        {\n            FragColor = vec4(ourColor, 1.0); // è®¾ç½®ç‰‡å…ƒé¢œè‰²ï¼Œalphaä¸º1ï¼ˆä¸é€æ˜ï¼‰\n        }\n    )glsl\";\n\n    // 8. ç¼–è¯‘é¡¶ç‚¹ç€è‰²å™¨\n    unsigned int vertexShader = glCreateShader(GL_VERTEX_SHADER);\n    glShaderSource(vertexShader, 1, &vertexShaderSource, NULL);\n    glCompileShader(vertexShader);\n    checkCompileErrors(vertexShader, \"VERTEX\");\n\n    // 9. ç¼–è¯‘ç‰‡å…ƒç€è‰²å™¨\n    unsigned int fragmentShader = glCreateShader(GL_FRAGMENT_SHADER);\n    glShaderSource(fragmentShader, 1, &fragmentShaderSource, NULL);\n    glCompileShader(fragmentShader);\n    checkCompileErrors(fragmentShader, \"FRAGMENT\");\n\n    // 10. é“¾æ¥ç€è‰²å™¨ç¨‹åº\n    unsigned int shaderProgram = glCreateProgram();\n    glAttachShader(shaderProgram, vertexShader);\n    glAttachShader(shaderProgram, fragmentShader);\n    glLinkProgram(shaderProgram);\n    checkCompileErrors(shaderProgram, \"PROGRAM\");\n\n    // 11. åˆ é™¤ç€è‰²å™¨å¯¹è±¡ï¼Œå·²ç»é“¾æ¥åˆ°ç¨‹åºé‡Œäº†\n    glDeleteShader(vertexShader);\n    glDeleteShader(fragmentShader);\n\n    // 12. åˆ›å»ºé¡¶ç‚¹ç¼“å†²å’Œé¡¶ç‚¹æ•°ç»„å¯¹è±¡\n    unsigned int VBO, VAO;\n    glGenVertexArrays(1, &VAO);\n    glGenBuffers(1, &VBO);\n\n    // ç»‘å®š VAO\n    glBindVertexArray(VAO);\n\n    // ç»‘å®šå¹¶å¡«å…… VBO\n    glBindBuffer(GL_ARRAY_BUFFER, VBO);\n    glBufferData(GL_ARRAY_BUFFER, sizeof(vertices), vertices, GL_STATIC_DRAW);\n\n    // ä½ç½®å±æ€§\n    glVertexAttribPointer(0, 3, GL_FLOAT, GL_FALSE, 6 * sizeof(float), (void*)0);\n    glEnableVertexAttribArray(0);\n\n    // é¢œè‰²å±æ€§\n    glVertexAttribPointer(1, 3, GL_FLOAT, GL_FALSE, 6 * sizeof(float), (void*)(3 * sizeof(float)));\n    glEnableVertexAttribArray(1);\n\n    // è§£ç»‘\n    glBindBuffer(GL_ARRAY_BUFFER, 0);\n    glBindVertexArray(0);\n\n    // 13. æ¸²æŸ“å¾ªç¯\n    while (!glfwWindowShouldClose(window))\n    {\n        // å¤„ç†è¾“å…¥ï¼ˆè¿™é‡Œæ²¡å†™è¾“å…¥ï¼Œåç»­å¯ä»¥åŠ ï¼‰\n\n        // æ¸…å±ï¼Œè®¾ç½®èƒŒæ™¯é¢œè‰²\n        glClearColor(0.2f, 0.3f, 0.3f, 1.0f);\n        glClear(GL_COLOR_BUFFER_BIT);\n\n        // ä½¿ç”¨ç€è‰²å™¨ç¨‹åº\n        glUseProgram(shaderProgram);\n\n        // ç»‘å®š VAO\n        glBindVertexArray(VAO);\n\n        // ç»˜åˆ¶ä¸‰è§’å½¢\n        glDrawArrays(GL_TRIANGLES, 0, 3);\n\n        // äº¤æ¢ç¼“å†²åŒºå’Œè½®è¯¢äº‹ä»¶\n        glfwSwapBuffers(window);\n        glfwPollEvents();\n    }\n\n    // 14. é‡Šæ”¾èµ„æº\n    glDeleteVertexArrays(1, &VAO);\n    glDeleteBuffers(1, &VBO);\n    glDeleteProgram(shaderProgram);\n\n    // 15. é€€å‡º GLFW\n    glfwTerminate();\n    return 0;\n}\n```\n\n\n\n![image-20250625101600766](/pictures/OpenGL/image-20250625101600766.png)\n\n\n\n\n\n### ç»ƒä¹ \n\n- æ·»åŠ æ›´å¤šé¡¶ç‚¹åˆ°æ•°æ®ä¸­ï¼Œä½¿ç”¨glDrawArraysï¼Œå°è¯•ç»˜åˆ¶ä¸¤ä¸ªå½¼æ­¤ç›¸è¿çš„ä¸‰è§’å½¢ã€‚\n\nâ€‹\tç›¸è¾ƒäºä¸Šé¢çš„ä»£ç ï¼Œåªéœ€ä¿®æ”¹ä¸¤å¤„å³å¯ï¼šæ·»åŠ é¡¶ç‚¹ï¼ˆåæ ‡å’Œé¢œè‰²å±æ€§ï¼‰ã€ç»˜åˆ¶6ä¸ªé¡¶ç‚¹ã€‚\n\n```java\nfloat vertices[] = {\n\t-0.9f, -0.5f, 0.0f, 0.0f, 0.0f, 1.0f,\n\t-0.0f, -0.5f, 0.0f, 0.0f, 1.0f, 0.0f,\n\t-0.45f, 0.5f, 0.0f, 1.0f, 0.0f, 0.0f,\n\t 0.0f, -0.5f, 0.0f, 0.0f, 0.0f, 1.0f, \n\t 0.9f, -0.5f, 0.0f, 0.0f, 1.0f, 0.0f,\n\t 0.45f, 0.5f, 0.0f, 1.0f, 0.0f, 0.0f\n};\n\nglDrawArrays(GL_TRIANGLES, 0, 6);\t//ç”¨é¡¶ç‚¹æ•°ç»„ä»ç¬¬ 0 ä¸ªé¡¶ç‚¹å¼€å§‹ï¼ŒæŒ‰ä¸‰è§’å½¢æ–¹å¼ï¼Œç»˜åˆ¶ 6ä¸ªé¡¶ç‚¹ç»„æˆçš„ä¸¤ä¸ªä¸‰è§’å½¢ã€‚\n```\n\n![image-20250626135154793](/pictures/OpenGL/image-20250626135154793.png)\n\n\n\n\n\n\n\n- åˆ›å»ºç›¸åŒçš„ä¸¤ä¸ªä¸‰è§’å½¢ï¼Œä½†å¯¹å®ƒä»¬çš„æ•°æ®ä½¿ç”¨ä¸åŒçš„VAOå’ŒVBOã€‚\n\nâ€‹\tå…¶ä»–éƒ¨åˆ†ä¸å˜ï¼Œæ”¹åŠ¨å¦‚ä¸‹ï¼šåˆ›å»ºæ—¶ä½¿ç”¨æ•°ç»„å­˜å‚¨å¤šä¸ªVAOå’ŒVBOã€ä¸¤ä¸ªä¸‰è§’å½¢é¡¶ç‚¹æ•°æ®åˆ†ä¸ºä¸åŒæ•°ç»„å­˜å‚¨ã€åˆ†å¼€ç»‘å®šå¹¶ä¸”ä¼ è¾“æ•°æ®è§£ææ•°æ®ã€åˆ†å¼€ç»˜åˆ¶ã€‚\n\n```java\nunsigned int VBOs[2], VAOs[2];\nglGenVertexArrays(2, VAOs); // we can also generate multiple VAOs or buffers at the same time\nglGenBuffers(2, VBOs);\n\nfloat firstTriangle[] = {\n    -0.9f, -0.5f, 0.0f,  // left \n    -0.0f, -0.5f, 0.0f,  // right\n    -0.45f, 0.5f, 0.0f,  // top \n};\nfloat secondTriangle[] = {\n     0.0f, -0.5f, 0.0f,  // left\n     0.9f, -0.5f, 0.0f,  // right\n     0.45f, 0.5f, 0.0f   // top \n};\n\nglBindVertexArray(VAOs[0]);\nglBindBuffer(GL_ARRAY_BUFFER, VBOs[0]);\nglBufferData(GL_ARRAY_BUFFER, sizeof(firstTriangle), firstTriangle, GL_STATIC_DRAW);\nglVertexAttribPointer(0, 3, GL_FLOAT, GL_FALSE, 3 * sizeof(float), (void*)0);\t// Vertex attributes stay the same\nglEnableVertexAttribArray(0);\n\nglBindVertexArray(VAOs[1]);\t// ç»‘å®šæ–°çš„VAO\nglBindBuffer(GL_ARRAY_BUFFER, VBOs[1]);\t//ç»‘å®šæ–°çš„VBO\nglBufferData(GL_ARRAY_BUFFER, sizeof(secondTriangle), secondTriangle, GL_STATIC_DRAW); //ä¼ è¾“æ•°æ®åˆ°VBOä»£è¡¨çš„ç¼“å†²åŒº\nglVertexAttribPointer(0, 3, GL_FLOAT, GL_FALSE, 0, (void*)0); \t\t//æŒ‡å®šè¯»å–æ–¹å¼\nglEnableVertexAttribArray(0);\t\t\t//å¯ç”¨é¡¶ç‚¹å±æ€§\n\nglBindVertexArray(VAOs[0]);\nglDrawArrays(GL_TRIANGLES, 0, 3);\n        // then we draw the second triangle using the data from the second VAO\nglBindVertexArray(VAOs[1]);\nglDrawArrays(GL_TRIANGLES, 0, 3);\n```\n\nâ€‹\t**glVertexAttribPointer**å‡½æ•°çš„å‚æ•°è›®å¤šï¼Œå»ºè®®è¾¹çœ‹LearnOpenGLé¡¹ç›®ã€‚\n\n\n\n\n\n\n\n- åˆ›å»ºä¸¤ä¸ªç€è‰²å™¨ç¨‹åºï¼Œç¬¬äºŒä¸ªç¨‹åºä½¿ç”¨ä¸€ä¸ªä¸åŒçš„ç‰‡æ®µç€è‰²å™¨ï¼Œè¾“å‡ºé»„è‰²ï¼›å†æ¬¡ç»˜åˆ¶è¿™ä¸¤ä¸ªä¸‰è§’å½¢ï¼Œè®©å…¶ä¸­ä¸€ä¸ªè¾“å‡ºä¸ºé»„è‰²ã€‚\n\nâ€‹\t\n\nâ€‹\tåœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šï¼Œåˆ›å»ºä¸¤ä¸ª**shaderProgram**ã€**fragmentshader**ï¼Œç„¶åç¼–è¯‘å¥½ä¸‰ä¸ªç€è‰²å™¨ï¼ˆåŒ…æ‹¬ä¸€ä¸ªå…±ç”¨çš„é¡¶ç‚¹ç€è‰²å™¨ï¼‰ï¼Œä¹‹ååˆ†ç»„é“¾æ¥åˆ°**shaderProgram**ä¸­ï¼Œæœ€å**while**å¾ªç¯ä¸­ï¼Œåˆ†åˆ«ä½¿ç”¨**glUseProgram**å‡½æ•°æŒ‡å®šæ¸²æŸ“ç¨‹åºè¿›è¡Œç»˜ç”»ã€‚","tags":["OpenGL"],"categories":["å¼€å‘"]},{"title":"é˜…è¯»APPé¡¹ç›®å­¦ä¹ â€”â€”4","url":"/2025/06/24/é˜…è¯»é¡¹ç›®å­¦ä¹ /å®‰å“é¡¹ç›®å­¦ä¹ 4/","content":"\n\n\n\n\n### æ­£æ–‡\n\nâ€‹\t\n\nâ€‹\t**BaseFragment**æŠ½è±¡ç±»ï¼Œæ˜¯ä¸€ä¸ªåŸºç¡€çš„Fragmentç±»å®ç°ï¼Œç»§æ‰¿è‡ª `RxFragment`ï¼ˆè¿™æ˜¯ä¸€ä¸ªæ”¯æŒ RxJava ç”Ÿå‘½å‘¨æœŸç®¡ç†çš„ Fragmentï¼‰ï¼Œç”±äºè¯¥çˆ¶ç±»å®ç°äº†IViewçš„æ–¹æ³•ï¼Œæ‰€ä»¥å¯ä»¥ä¸å†å®ç°ã€‚\n\nâ€‹\t**BaseFragment<T extends IPresenter>**ï¼šè¿™æ˜¯ä¸€ä¸ªæ³›å‹ç±»ï¼Œæ³›å‹å‚æ•° `T` å¿…é¡»æ˜¯ **IPresenter** æ¥å£çš„å­ç±»ã€‚è¯´æ˜è¿™ä¸ª Fragment ä¼šå’ŒæŸä¸ª Presenter å…³è”ï¼Œç¬¦åˆ MVP æ¶æ„è®¾è®¡æ¨¡å¼ã€‚\n\n```java\nprotected View view;\t\t\t\t//ä¿å­˜å½“å‰Fragmentçš„æ ¹å¸ƒå±€è§†å›¾\nprotected Bundle savedInstanceState;\t\t//ä¿å­˜ Fragment çŠ¶æ€æ•°æ®\n@Nullable\n@Override\npublic View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {\n\tthis.savedInstanceState = savedInstanceState;\n\tinitSDK();\n\tview = createView(inflater, container);\n\tinitData();\n\tbindView();\n\tbindEvent();\n\tfirstRequest();\n\treturn view;\n}\n    /**\n     * äº‹ä»¶è§¦å‘ç»‘å®š\n     */\n    protected void bindEvent() {\n\n    }\n    /**\n     * æ§ä»¶ç»‘å®š\n     */\n    protected void bindView() {\n\n    }\n    /**\n     * æ•°æ®åˆå§‹åŒ–\n     */\n    protected void initData() {\n\n    }\n    /**\n     * é¦–æ¬¡é€»è¾‘æ“ä½œ\n     */\n    protected void firstRequest() {\n\n    }\n    /**\n     * åŠ è½½å¸ƒå±€\n     */\n    protected abstract View createView(LayoutInflater inflater, ViewGroup container);\n    /**\n     * ç¬¬ä¸‰æ–¹SDKåˆå§‹åŒ–\n     */\n    protected void initSDK() {\n\n    }\n```\n\nâ€‹\t`onCreateView` æ˜¯ Fragment åˆ›å»ºè§†å›¾æ—¶è°ƒç”¨çš„å›è°ƒæ–¹æ³•ï¼ˆç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼‰ï¼Œå®ƒè´Ÿè´£åŠ è½½å¹¶è¿”å› Fragment çš„å¸ƒå±€è§†å›¾ã€‚\n\n\n\n\n\n\n\n\n\nâ€‹\t**BaseModelImpl**ç±»ç”¨æ¥åˆ›å»ºç½‘ç»œè¯·æ±‚å®¢æˆ·ç«¯çš„åŸºç¡€æ¨¡å‹ç±»ï¼Œå®ƒä¸»è¦è´Ÿè´£é…ç½®å¹¶ç”Ÿæˆ Retrofit å®ä¾‹ï¼Œæ–¹ä¾¿å…¶ä»–æ¨¡å—è°ƒç”¨ç½‘ç»œæ¥å£ã€‚ä½¿ç”¨OkHttpçš„**OkHttpClient.Builder**æ¥åˆ›å»ºå®¢æˆ·ç«¯ï¼Œè®¾ç½®äº†è¿æ¥è¶…æ—¶ã€å†™è¶…æ—¶ã€è¯»è¶…æ—¶ï¼Œå’Œä¸€ä¸ªè‡ªå®šä¹‰çš„ç½‘ç»œæ‹¦æˆªå™¨ï¼Œç”¨äºè¯·æ±‚å¤±è´¥åçš„é‡è¯•é€»è¾‘ã€‚\n\nâ€‹\t**getRetrofitObject**æ–¹æ³•ç”¨æ¥åˆ›å»ºä¸€ä¸ªRetrofitå®ä¾‹ï¼Œä¼ å…¥åŸºç¡€çš„URLã€‚\n\nâ€‹\t**getRetrofitString**å’Œä¸Šé¢çš„æ–¹æ³•ç±»ä¼¼ï¼Œç”¨æ¥å¤„ç†ä¸åŒç¼–ç ï¼ˆ`encode`ï¼‰çš„å­—ç¬¦ä¸²è½¬æ¢ã€‚\n\n```java\npublic class BaseModelImpl {\n\n    protected OkHttpClient.Builder clientBuilder = new OkHttpClient.Builder()\n            .connectTimeout(10, TimeUnit.SECONDS)\n            .writeTimeout(10, TimeUnit.SECONDS)\n            .readTimeout(10, TimeUnit.SECONDS)\n            .addNetworkInterceptor(new RetryIntercepter(1));\n\n    protected Retrofit getRetrofitObject(String url) {\n        return new Retrofit.Builder().baseUrl(url)\n                //å¢åŠ è¿”å›å€¼ä¸ºå­—ç¬¦ä¸²çš„æ”¯æŒ(ä»¥å®ä½“ç±»è¿”å›)\n                .addConverterFactory(ScalarsConverterFactory.create())\n                //å¢åŠ è¿”å›å€¼ä¸ºOservable<T>çš„æ”¯æŒ\n                .addCallAdapterFactory(RxJava2CallAdapterFactory.create())\n                .client(clientBuilder.build())\n                .build();\n    }\n\n    protected Retrofit getRetrofitString(String url, String encode) {\n        return new Retrofit.Builder().baseUrl(url)\n                //å¢åŠ è¿”å›å€¼ä¸ºå­—ç¬¦ä¸²çš„æ”¯æŒ(ä»¥å®ä½“ç±»è¿”å›)\n                .addConverterFactory(EncodoConverter.create(encode))\n                //å¢åŠ è¿”å›å€¼ä¸ºOservable<T>çš„æ”¯æŒ\n                .addCallAdapterFactory(RxJava2CallAdapterFactory.create())\n                .client(clientBuilder.build())\n                .build();\n    }\n}\n```\n\n> 1. Retrofit æ˜¯ä»€ä¹ˆï¼Ÿ\n>\n> - Retrofit æ˜¯ç”± Square å…¬å¸å¼€å‘çš„ä¸€ä¸ª **Android å’Œ Java** å¹³å°ä¸Šçš„ç½‘ç»œè¯·æ±‚åº“ã€‚\n> - å®ƒå¸®åŠ©ä½ å¾ˆæ–¹ä¾¿åœ°è°ƒç”¨ç½‘ç»œä¸Šçš„ **HTTP æ¥å£**ï¼ˆAPIï¼‰ï¼Œä»æœåŠ¡å™¨æ‹¿æ•°æ®ã€‚\n> - å®ƒå¸®ä½ æŠŠç½‘ç»œè¯·æ±‚å’Œå“åº”å˜å¾—â€œåƒè°ƒç”¨æœ¬åœ°æ–¹æ³•â€ä¸€æ ·ç®€å•ã€‚\n\n\n\n\n\n\n\n\n\n\n\n\n\nâ€‹\t**BasePresenterImpl**æŠ½è±¡ç±»å®ç°äº†attachViewåŠŸèƒ½ï¼Œå¹¶ä¸”é€šè¿‡æ¨¡æ¿Tæ¥è¿›è¡Œç±»å‹è½¬æ¢ï¼Œæ˜¯ä¸€ä¸ªPresenteråŸºç±»ã€‚\n\n```java\npublic abstract class BasePresenterImpl<T extends IView> implements IPresenter{\n    protected T mView;\n\n    @Override\n    public void attachView(@NonNull IView iView) {\n        mView = (T) iView;\n    }\n}\n```\n\n\n\n\n\n\n\n\n\nâ€‹\t**RetryIntercepter**ç±»æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„ **OkHttp æ‹¦æˆªå™¨**ï¼Œå…¶ä¸­`Request` ä»£è¡¨è¿™æ¬¡ç½‘ç»œè¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ¯”å¦‚è¯·æ±‚çš„åœ°å€ã€è¯·æ±‚æ–¹æ³•ï¼ˆGETã€POSTï¼‰ã€è¯·æ±‚å¤´ã€è¯·æ±‚ä½“ç­‰ç­‰ã€‚\n\n> ## ä¸ºä»€ä¹ˆè¦è¿™æ ·å†™ï¼Ÿ\n>\n> æ‹¦æˆªå™¨å°±æ˜¯â€œè¯·æ±‚å’Œå“åº”ä¹‹é—´çš„ä¸­é—´äººâ€ï¼Œå®ƒèƒ½ï¼š\n>\n> - **æ‹¿åˆ°è¯·æ±‚**ï¼ˆ`chain.request()`ï¼‰\n> - **å¯¹è¯·æ±‚åšç‚¹äº‹**ï¼ˆæ¯”å¦‚åŠ ä¸ªå¤´ï¼Œæ”¹æ”¹å‚æ•°ï¼Œæˆ–è€…æ‰“å°æ—¥å¿—ï¼‰\n> - **å‘å‡ºè¯·æ±‚**ï¼ˆ`chain.proceed(request)`ï¼‰\n> - **æ‹¿åˆ°å“åº”**ï¼Œè¿˜å¯ä»¥å¯¹å“åº”åšç‚¹äº‹ï¼ˆæ¯”å¦‚åˆ¤æ–­å¤±è´¥é‡è¯•ï¼‰\n\n```java\npublic class RetryIntercepter implements Interceptor {\n    public int maxRetry;//æœ€å¤§é‡è¯•æ¬¡æ•°\n    private int retryNum = 0;//å‡å¦‚è®¾ç½®ä¸º3æ¬¡é‡è¯•çš„è¯ï¼Œåˆ™æœ€å¤§å¯èƒ½è¯·æ±‚4æ¬¡ï¼ˆé»˜è®¤1æ¬¡+3æ¬¡é‡è¯•ï¼‰\n\n    public RetryIntercepter(int maxRetry) {\n        this.maxRetry = maxRetry;\n    }\n\n    @Override\n    public Response intercept(Chain chain) throws IOException {\n        Request request = chain.request();\n        Response response = chain.proceed(request);\n        while (!response.isSuccessful() && retryNum < maxRetry) {\n            retryNum++;\n            response = chain.proceed(request);\n        }\n        return response;\n    }\n}\n```\n\n\n\n\n\n\n\n\n\nâ€‹\tbasemvplibåˆ†æå®Œäº†ï¼Œä¸‹ä¸€æ­¥è¦åˆ†æmonkyåŒ…ã€‚å…ˆå¤§ä½“é€šè¿‡AIé¢„æµ‹ä¸€æ³¢å„ä¸ªæ–‡ä»¶å¤¹çš„å«ä¹‰å’Œå…¶ä¸­ç±»çš„ä½œç”¨ã€‚\n\n> â€‹\t**base**æ–‡ä»¶å¤¹é¡¹ç›®æ˜¯åŸºç¡€ä»£ç ï¼Œæ¯”å¦‚åŸºç±»ï¼ˆBaseActivityã€BaseFragmentã€BasePresenterç­‰ï¼‰ï¼Œå…¬å…±æŠ½è±¡å±‚ï¼Œç”¨æ¥å¤ç”¨å’Œç»Ÿä¸€è§„èŒƒã€‚\n>\n> â€‹\t**bean**æ–‡ä»¶å¤¹å­˜æ”¾æ•°æ®æ¨¡å‹ç±»ï¼ˆå®ä½“ç±»ï¼‰ï¼Œç”¨æ¥è¡¨ç¤ºä¸šåŠ¡æ•°æ®ï¼Œæ¯”å¦‚ä¹¦ç±ä¿¡æ¯ã€ç”¨æˆ·ä¿¡æ¯ç­‰ã€‚é€šå¸¸å’Œæ•°æ®åº“è¡¨ç»“æ„æˆ–è€…æ¥å£è¿”å›æ•°æ®å¯¹åº”ã€‚\n>\n> â€‹\t**cache**ç¼“å­˜ç›¸å…³çš„ä»£ç ï¼Œè´Ÿè´£æ•°æ®ç¼“å­˜é€»è¾‘ã€‚\n>\n> â€‹\t**common**é…ç½®çš„æ˜¯è®¿é—®å°è¯´ç½‘ç«™çš„APIæ¥å£ã€‚\n>\n> â€‹\t**dao**æ˜¯ Data Access Objectï¼ˆæ•°æ®è®¿é—®å¯¹è±¡ï¼‰ çš„ç¼©å†™ï¼Œæ•°æ®è®¿é—®å±‚ï¼Œå°è£…æ•°æ®åº“æ“ä½œï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰ï¼Œé€šå¸¸å¯¹åº”å®ä½“beanï¼Œæœ‰ä¸“é—¨çš„æ¥å£æˆ–ç±»å¤„ç†æ•°æ®å­˜å–ã€‚\n>\n> â€‹\t**listener**å®šä¹‰è·å–ç« èŠ‚åˆ—è¡¨çš„å›è°ƒé€šçŸ¥ã€‚\n>\n> â€‹\t**model**ä¸šåŠ¡é€»è¾‘å±‚ï¼Œå¤„ç†å…·ä½“çš„æ•°æ®æ“ä½œå’Œä¸šåŠ¡è§„åˆ™ã€‚\n>\n> â€‹\t**presenter**è¿™é‡Œæ˜¯ Presenter å±‚ï¼Œè´Ÿè´£è¿æ¥ View å’Œ Modelï¼Œå®ç°ä¸šåŠ¡é€»è¾‘ï¼Œå¤„ç†ç•Œé¢å’Œæ•°æ®çš„äº¤äº’ã€‚\n>\n> â€‹\t**service**ä¸€èˆ¬æ”¾åå°æœåŠ¡ç›¸å…³ä»£ç ï¼Œæ¯”å¦‚ Android çš„ Service ç±»ï¼ŒåšæŒç»­åå°ä»»åŠ¡ï¼Œæˆ–è€…å°è£…ç½‘ç»œè¯·æ±‚ã€ç³»ç»ŸæœåŠ¡æ“ä½œç­‰ã€‚\n>\n> â€‹\t**utils**å·¥å…·ç±»åŒ…ï¼Œå­˜æ”¾å„ç§è¾…åŠ©ç±»å’Œé™æ€æ–¹æ³•ã€‚\n>\n> â€‹\t**view**è‡ªå®šä¹‰çš„è§†å›¾ç±»ï¼Œæˆ–è€…è·Ÿç•Œé¢ç›¸å…³çš„ç±»ï¼ˆä¸åŒ…æ‹¬ç‰¹æ®Šæ§ä»¶ï¼‰ï¼Œä¸€èˆ¬ç”¨æ¥å°è£…ç•Œé¢é€»è¾‘æˆ–å¤ç”¨ç•Œé¢ç»„ä»¶ã€‚\n>\n> â€‹\t**widget**è‡ªå®šä¹‰æ§ä»¶æˆ–è€… UI ç»„ä»¶ï¼Œæ¯”å¦‚è‡ªå®šä¹‰æŒ‰é’®ã€åˆ—è¡¨ã€åŠ¨ç”»æ§ä»¶ç­‰ï¼Œæ‰©å±•ç³»ç»Ÿæ§ä»¶åŠŸèƒ½ã€‚\n\nâ€‹\t**BitIntentDataManager**ç®¡ç† Intent ä¼ é€’çš„æ•°æ®ï¼Œå°è£… Intent æ•°æ®å¤„ç†é€»è¾‘ï¼Œæ–¹ä¾¿ Activity/Fragment ä¹‹é—´ä¼ å‚ã€‚\n\nâ€‹\t**ErrorAnalyContentManager**é”™è¯¯å†…å®¹åˆ†æç®¡ç†å™¨ï¼Œå¯èƒ½æ˜¯æ—¥å¿—æ”¶é›†ã€é”™è¯¯ä¿¡æ¯å¤„ç†æˆ–è€…é”™è¯¯æŠ¥å‘Šç”Ÿæˆç›¸å…³çš„ç±»ã€‚\n\nâ€‹\t**MApplication**è‡ªå®šä¹‰çš„ Application ç±»ï¼Œåº”ç”¨å…¥å£ï¼Œåˆå§‹åŒ–å…¨å±€å˜é‡ã€SDKã€å•ä¾‹ç­‰ã€‚\n\nâ€‹\t**ProxyManager**ä»£ç†ç®¡ç†å™¨ï¼Œå¯èƒ½ç”¨æ¥å®ç°æŸç§ä»£ç†æ¨¡å¼ï¼ŒåŠ¨æ€ä»£ç†å¯¹è±¡ï¼Œæˆ–è€…è´Ÿè´£ç½‘ç»œä»£ç†ã€è¯·æ±‚ä»£ç†ç­‰åŠŸèƒ½ã€‚\n\nâ€‹\t**ReadBookControl**è¯»ä¹¦æ§åˆ¶å™¨ï¼Œè´Ÿè´£ä¹¦ç±é˜…è¯»ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ¯”å¦‚ç¿»é¡µã€å­—ä½“å¤§å°ã€é˜…è¯»è¿›åº¦ç®¡ç†ç­‰ã€‚\n\n\n\n\n\nâ€‹\tæ”¹å¤©å†ç³»ç»Ÿåˆ†æå§ï¼Œä¸‹é¢åœ¨AIé—®åˆ°äº†ä¸€å¥—æ¯”è¾ƒç³»ç»Ÿçš„åˆ†ææµç¨‹ã€‚\n\n> ## ğŸ§­ ä¸€å¥—ç³»ç»Ÿçš„ MVP é¡¹ç›®åˆ†ææµç¨‹ï¼ˆä» UI åˆ°æ•°æ®ï¼‰\n>\n> ------\n>\n> ### âœ… **ç¬¬ä¸€é˜¶æ®µï¼šææ¸…æ¥šç»“æ„å’Œé¡µé¢å…¥å£**\n>\n> #### æ­¥éª¤ 1ï¼šæ‰“å¼€é¡¹ç›®ï¼Œçœ‹ `åŒ…ç»“æ„`\n>\n> - çœ‹åŒ…åä¸‹æœ‰å“ªäº›æ¨¡å—ï¼ˆä½ å‰é¢æåˆ°çš„ `view/`, `presenter/`, `model/`, `dao/` ç­‰ç­‰ï¼‰ã€‚\n> - äº†è§£é¡¹ç›®æ˜¯ä¸æ˜¯ä½¿ç”¨äº† MVP/MVVM æ¶æ„ï¼ˆä» `presenter/` å’Œ `model/` ç›®å½•å¯ä»¥çœ‹å‡ºï¼‰ã€‚\n>\n> #### æ­¥éª¤ 2ï¼šæ‰¾â€œé¦–é¡µ Activityâ€æˆ–ä¸»å…¥å£é¡µé¢\n>\n> - æ‰¾ `MainActivity`, `LauncherActivity`, `SplashActivity` ç­‰ã€‚\n> - å®ƒä¸€èˆ¬ä¼šæ˜¯ä½ å¯åŠ¨ App åçœ‹åˆ°çš„ç¬¬ä¸€ä¸ªé¡µé¢ã€‚\n>\n> ------\n>\n> ### âœ… **ç¬¬äºŒé˜¶æ®µï¼šä» View å±‚å…¥æ‰‹åˆ†æä¸€ä¸ªé¡µé¢**\n>\n> #### æ­¥éª¤ 3ï¼šä» `Activity` æˆ– `Fragment` å¼€å§‹çœ‹\n>\n> - å…³æ³¨ `onCreate()` æˆ– `onCreateView()` æ–¹æ³•ã€‚\n>\n> - çœ‹å®ƒç»‘å®šäº†å“ªä¸ª Presenterï¼Œä¾‹å¦‚ï¼š\n>\n>   ```java\n>   presenter = new ReadBookPresenter();\n>   presenter.attachView(this);\n>   ```\n>\n> - æŸ¥çœ‹å“ªäº›ç”¨æˆ·æ“ä½œï¼ˆæŒ‰é’®ç‚¹å‡»ã€æ»‘åŠ¨ç­‰ï¼‰è§¦å‘äº†å“ªäº›é€»è¾‘ï¼š\n>\n>   ```java\n>   button.setOnClickListener(v -> presenter.doSomething());\n>   ```\n>\n> #### æ­¥éª¤ 4ï¼šæŸ¥æ‰¾ç»‘å®šçš„ View å’Œè‡ªå®šä¹‰æ§ä»¶\n>\n> - æŸ¥çœ‹ XML å¸ƒå±€æ–‡ä»¶å’Œ `findViewById()` ç»‘å®šäº†å“ªäº›æ§ä»¶ã€‚\n> - å¦‚æœå‘ç°æœ‰ `PageWidget`ã€`ReadSettingView` è¿™ç±»è‡ªå®šä¹‰æ§ä»¶ï¼š\n>   - å…ˆäº†è§£å®ƒçš„å¤§è‡´ä½œç”¨ï¼ˆæ¯”å¦‚ç¿»é¡µã€æ˜¾ç¤ºæ–‡å­—ï¼‰\n>   - å†å†³å®šæ˜¯å¦æ·±å…¥çœ‹å®ƒçš„ç»˜å›¾æˆ–æ‰‹åŠ¿é€»è¾‘ï¼ˆå¾ˆå¤šæ—¶å€™å¯ä»¥ç•¥è¿‡ï¼‰\n>\n> ------\n>\n> ### âœ… **ç¬¬ä¸‰é˜¶æ®µï¼šæ·±å…¥ Presenter å±‚ï¼Œåˆ†æä¸šåŠ¡é€»è¾‘**\n>\n> #### æ­¥éª¤ 5ï¼šæ‰“å¼€å¯¹åº”çš„ `Presenter` ç±»\n>\n> - çœ‹è¿™ä¸ª Presenter çš„æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ\n> - ä½ åœ¨ View å±‚ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œæ˜¯è°ƒç”¨çš„å“ªä¸ªæ–¹æ³•ï¼Ÿ\n>\n> ç¤ºä¾‹ï¼š\n>\n> ```java\n> public void loadBook() {\n>     model.getBookData(new Callback() {\n>         @Override\n>         public void success(BookShelfBean bean) {\n>             view.showContent(bean);\n>         }\n>     });\n> }\n> \n> ```\n>\n> - Presenter æ˜¯ **æ ¸å¿ƒé€»è¾‘ä¸­æ¢**ï¼Œè¿æ¥ View å’Œ Modelã€‚\n>\n> ------\n>\n> ### âœ… **ç¬¬å››é˜¶æ®µï¼šæŸ¥çœ‹ Model å±‚ï¼Œæ•°æ®ä»å“ªæ¥ï¼Ÿ**\n>\n> #### æ­¥éª¤ 6ï¼šæ‰“å¼€ `Model` æˆ– `ModelImpl` ç±»\n>\n> - çœ‹å®ƒæ˜¯ä» **å“ªé‡Œæ‹¿æ•°æ®** çš„ï¼š\n>\n>   - ç½‘ç»œè¯·æ±‚ï¼Ÿï¼ˆæ¯”å¦‚ç”¨ Retrofitï¼‰\n>   - æ•°æ®åº“ï¼Ÿï¼ˆæ¯”å¦‚ç”¨ Daoã€GreenDAOï¼‰\n>   - ç¼“å­˜ï¼Ÿï¼ˆæ¯”å¦‚ç”¨ CacheManagerï¼‰\n>\n> - æŸ¥çœ‹å…·ä½“çš„æ•°æ®æ¥æºï¼Œæ¯”å¦‚ï¼š\n>\n>   ```\n>   RetrofitHelper.getApi().getChapters(bookId);\n>   ```\n>\n> ------\n>\n> ### âœ… **ç¬¬äº”é˜¶æ®µï¼šå¾€ä¸‹çœ‹æ•°æ®æ”¯æ’‘å±‚ï¼ˆå¯é€‰ï¼‰**\n>\n> #### æ­¥éª¤ 7ï¼šæŸ¥çœ‹ Beanã€Daoã€Utils å·¥å…·ç±»\n>\n> - `bean/`ï¼šå®šä¹‰äº†å“ªäº›æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚ `BookShelfBean`, `ChapterBean`ï¼Ÿ\n> - `dao/`ï¼šä½ å¯ä»¥çœ‹çœ‹ `BookShelfBeanDao` æ˜¯å¦‚ä½•å­˜/å–ä¹¦çš„æ•°æ®çš„ã€‚\n> - `utils/`ï¼šåªåœ¨ä½ çœ‹åˆ°ç”¨åˆ°çš„æ—¶å€™å†æ·±å…¥çœ‹ï¼Œæ¯”å¦‚å¤„ç†æ—¥æœŸã€æ–‡ä»¶ã€ç½‘ç»œçŠ¶æ€ç­‰ã€‚\n>\n> ------\n>\n> ### âœ… **ç¬¬å…­é˜¶æ®µï¼šæŸ¥æ‰¾å›è°ƒæœºåˆ¶ä¸äº‹ä»¶æµ**\n>\n> - é¡¹ç›®ä¸­å¯èƒ½ä¼šæœ‰ä¸€äº›å›è°ƒæ¥å£ï¼ˆåƒä½ ä¹‹å‰æåˆ°çš„ `OnGetChapterListListener`ï¼‰\n> - åˆ†æå®ƒä»¬æ˜¯æ€ä¹ˆä¼ å€¼ã€è§¦å‘é€»è¾‘çš„ã€‚\n\n","tags":["å®‰å“å¼€å‘å­¦ä¹ "],"categories":["å¼€å‘"]},{"title":"é˜…è¯»APPé¡¹ç›®å­¦ä¹ â€”â€”3","url":"/2025/06/23/é˜…è¯»é¡¹ç›®å­¦ä¹ /å®‰å“é¡¹ç›®å­¦ä¹ 3/","content":"\n\n\n### å‰è¨€\n\nâ€‹\tåˆ†æå¤æ‚ä¸€ç‚¹çš„åŠŸèƒ½ï¼Œéœ€è¦ç†Ÿæ‚‰é¢å‘å¯¹è±¡çš„ç¼–ç¨‹æ€æƒ³ï¼Œç†Ÿæ‚‰æ›´åŠ åŸºç¡€çš„ä»£ç ï¼Œæˆ‘æ„Ÿè§‰æœ‰ç‚¹åŠ›ä¸ä»å¿ƒï¼Œååˆ†éš¾ä»¥ä¸‹æ‰‹ï¼Œè€ƒè™‘è¦ä¸è¦ä»åŸºç¡€ç±»ä¸€ç‚¹ç‚¹å­¦ä¹ ï¼Œåˆ†æå…¶ä½œç”¨ã€ä¸ºä»€ä¹ˆè¦è¿™æ ·å†™ä¹‹ç±»çš„é—®é¢˜ï¼Œèƒ½å­¦åˆ°å¾ˆå¤šçŸ¥è¯†ç‚¹ï¼Œè¿™æ ·æ˜¯ä¸æ˜¯ä¼šæ›´åŠ æœ‰åˆ©äºæˆ‘çš„å¼€å‘ç»éªŒå­¦ä¹ ï¼Œæ¯•ç«Ÿâ€œè½®å­â€çš„ä»£ç éƒ½è¿˜æ²¡ææ˜ç™½ä¸ºä»€ä¹ˆè¿™ä¹ˆå†™ï¼Œç›´æ¥å»è§£æåœ¨æ­¤åŸºç¡€ä¸Šçš„å…¶ä»–åŠŸèƒ½ä¼šè®©æˆ‘æœ‰ç‚¹ä¸è„šè¸å®åœ°çš„æ„Ÿè§‰ã€‚\n\nâ€‹\tå¦å¤–ï¼Œå› ä¸ºé”™è¯¯çš„æ“ä½œï¼ŒæŠŠèµ„æºæ–‡ä»¶ç»™æä¹±äº†ï¼Œåˆå¾—æ–°å»ºé¡¹ç›®é‡æ–°copyäº†ï¼Œæœ‰ç‚¹çƒ¦ã€‚\n\n\n\nâ€‹\t\n\n### æ­£æ–‡\n\nâ€‹\tå…ˆä»basemvplibçš„æ–‡ä»¶å¼€å§‹å§ï¼ŒIViewå’ŒIPresenterçš„åŸºç¡€æ€æƒ³å·²ç»å­¦ä¹ è¿‡äº†ï¼Œå†ä»**AppActivityManager**ã€**BaseApplication**ã€**EncodoConverter**è¿™ä¸‰ä¸ªç±»å¼€å§‹å§ã€‚\n\nâ€‹\t\n\nâ€‹\t**AppActivityManager**ç±»æ˜¯ç®¡ç†é¡¹ç›®ä¸­æ‰€æœ‰Activityçš„å·¥å…·ç±»ï¼Œæ–¹ä¾¿åœ¨åº”ç”¨ä¸­ç»Ÿä¸€æ§åˆ¶ Activity ç”Ÿå‘½å‘¨æœŸï¼Œæ¯”å¦‚æ‰¹é‡å…³é—­æŸç±» Activity æˆ–æ£€æµ‹ Activity æ˜¯å¦åœ¨æ ˆä¸­ã€‚\n\nâ€‹\t`private static List<WeakReference<Activity>> activities;`ä½¿ç”¨å¼±å¼•ç”¨å­˜å‚¨Activityï¼Œå½“ Activity è¢«ç³»ç»Ÿå›æ”¶æ—¶ï¼Œå¼±å¼•ç”¨ä¸ä¼šé˜»æ­¢å®ƒçš„å›æ”¶ï¼Œé¿å…å¼ºå¼•ç”¨å¯¼è‡´å†…å­˜æ³„æ¼ã€‚\n\n\n\nâ€‹\té€šè¿‡åŒé‡æ£€æŸ¥å®ç°çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼ï¼Œä¿è¯AppActivityManageråœ¨æ•´ä¸ªåº”ç”¨ä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚\n\n```java\npublic static AppActivityManager getInstance(){\n        if(null == instance){\n            synchronized (AppActivityManager.class){\n                if(null == instance){\n                    instance = new AppActivityManager();\n                }\n            }\n        }\n        return instance;\n    }\n\n```\n\n\n\nâ€‹\tæä¾›äº†addã€removeæ–¹æ³•ï¼Œå…¶ä¸­æœ‰ä¸¤ç§ç§»é™¤æ–¹å¼ï¼šæä¾›Activityå®ä¾‹å’ŒActivityç±»åã€‚\n\nâ€‹\tæä¾›äº†finishæ–¹æ³•ï¼Œå¯ä»¥å…³é—­æŒ‡å®šçš„Activityå®ä¾‹æˆ–å…³é—­æŒ‡å®šç±»å‹çš„Activityã€‚\n\nâ€‹\tæä¾›isExistæ–¹æ³•ï¼Œèƒ½å¤Ÿåˆ¤æ–­æŸä¸ªActivityç±»æ˜¯å¦å­˜åœ¨ã€‚\n\n\n\n> ### ç®€å•ç†è§£ï¼š\n>\n> - **Application.onCreate()**\n>    æ˜¯æ•´ä¸ªåº”ç”¨ç¨‹åºçš„â€œå¯åŠ¨å…¥å£â€ï¼Œåœ¨åº”ç”¨ä¸€å¯åŠ¨æ—¶è°ƒç”¨ï¼Œåªè°ƒç”¨ä¸€æ¬¡ã€‚\n>    ä½ å¯ä»¥åœ¨è¿™é‡Œåšä¸€äº›**å…¨å±€åˆå§‹åŒ–**ï¼Œæ¯”å¦‚åˆå§‹åŒ–æ•°æ®åº“ã€ç½‘ç»œåº“ã€ç¬¬ä¸‰æ–¹SDKç­‰ï¼Œæ‰€æœ‰é¡µé¢éƒ½èƒ½ç”¨ã€‚\n> - **Activity.onCreate()**\n>    æ˜¯æŸä¸ªå…·ä½“é¡µé¢ï¼ˆActivityï¼‰åˆ›å»ºæ—¶è°ƒç”¨ã€‚æ¯æ‰“å¼€ä¸€ä¸ªæ–°é¡µé¢ï¼Œå°±ä¼šè°ƒç”¨å®ƒã€‚\n>    ä½ å¯ä»¥åœ¨è¿™é‡Œåšè¿™ä¸ªé¡µé¢ä¸“å±çš„åˆå§‹åŒ–ï¼Œæ¯”å¦‚åŠ è½½å¸ƒå±€ã€è®¾ç½®æŒ‰é’®äº‹ä»¶ç­‰ã€‚\n\n\n\nâ€‹\t**BaseApplication**æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„Applicationç±»ï¼Œæ˜¯å®‰å“åº”ç”¨çš„å…¥å£ç±»ï¼Œæ˜¯åº”ç”¨å¯åŠ¨æ—¶åˆ›å»ºçš„å…¨å±€å…¥å£ï¼Œç”¨æ¥åšå…¨å±€åˆå§‹åŒ–å’Œç®¡ç†ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºç¡€æ¡†æ¶ç±»ï¼Œåªå®ç°äº†onCreateæ–¹æ³•ï¼Œè°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ã€‚\n\n\n\nâ€‹\t**EncodoConverter**ç»§æ‰¿äº† `retrofit2.Converter.Factory`ï¼Œç”¨äºåˆ›å»ºæ•°æ®è½¬æ¢å™¨ï¼›æœ‰ä¸€ä¸ªç§æœ‰å­—æ®µ `encode`ï¼Œé»˜è®¤ç¼–ç æ˜¯ `\"utf-8\"`ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰ä¼ å…¥ç¼–ç ï¼›æä¾›äº†ä¸¤ä¸ªé™æ€æ–¹æ³• `create()` ç”¨äºåˆ›å»ºè¯¥è½¬æ¢å™¨å®ä¾‹ï¼Œå¯ä»¥ç”¨é»˜è®¤ç¼–ç ï¼Œä¹Ÿå¯ä»¥ç”¨è‡ªå®šä¹‰ç¼–ç ï¼›é‡å†™äº† `responseBodyConverter()` æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ª `Converter<ResponseBody, String>`ï¼Œè¿™ä¸ªè½¬æ¢å™¨å°±æ˜¯æŠŠå“åº”ä½“æ•°æ®è¯»å–ä¸ºæŒ‡å®šç¼–ç çš„å­—ç¬¦ä¸²ã€‚\n\nâ€‹\tè¿™æ®µä»£ç å°±æ˜¯ç»™ Retrofit å®šåˆ¶ä¸€ä¸ªå“åº”ä½“çš„ç¼–ç è½¬æ¢å™¨ï¼Œè®©å®ƒå¯ä»¥ç”¨æŒ‡å®šç¼–ç æŠŠæœåŠ¡å™¨è¿”å›çš„å­—èŠ‚æµè½¬æˆå­—ç¬¦ä¸²ã€‚\n\n\n\nâ€‹\t**Retrofit** æ˜¯ä¸€ä¸ªç”¨äº Android å’Œ Java çš„ç½‘ç»œè¯·æ±‚åº“ï¼Œå®ƒå¸®ä½ å¾ˆæ–¹ä¾¿åœ°å‘æœåŠ¡å™¨å‘é€ HTTP è¯·æ±‚ï¼Œè·å–æ•°æ®ï¼Œç„¶åè‡ªåŠ¨æŠŠæœåŠ¡å™¨è¿”å›çš„ JSON æˆ– XML è½¬æ¢æˆä½ å®šä¹‰çš„ Java å¯¹è±¡ï¼Œçœå»äº†ä½ è‡ªå·±å†™å¾ˆå¤šè§£æä»£ç ã€‚\n\n\n\n\n\n\n\nâ€‹\tå†çœ‹**BaseActivity**ç±»ï¼Œå®ƒæ˜¯æ‰€æœ‰Activityçš„åŸºç±»ï¼Œç»Ÿä¸€å°è£…ç”Ÿå‘½å‘¨æœŸæ–¹æ³•å’ŒPresenterç®¡ç†ï¼Œä½¿ç”¨äº†æ³›å‹<T extends IPresenter> è¡¨ç¤ºä¼ å…¥çš„ Presenter ç±»å‹ï¼Œå®ç°äº†IViewã€‚\n\nâ€‹\té¡µé¢åˆå§‹åŒ–æµç¨‹ï¼Œä¸éœ€è¦çš„æ–¹æ³•å¯ä»¥ä¸å®ç°ã€‚\n\n```java\n    /**\n     * ç”Ÿå‘½å‘¨æœŸ onCreateï¼ŒActivity å¯åŠ¨æ—¶è°ƒç”¨ã€‚\n     * è¿™é‡Œç»Ÿä¸€è°ƒç”¨äº†ä¸€ç³»åˆ—åˆå§‹åŒ–æ–¹æ³•ï¼Œä¸‹é¢ä¼šè§£é‡Šæ¯ä¸ªæ–¹æ³•ä½œç”¨ã€‚\n     */\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        this.savedInstanceState = savedInstanceState;\n\n        // è·å–æ˜¯å¦ä½¿ç”¨è½¬åœºåŠ¨ç”»\n        if(getIntent()!=null){\n            startShareAnim = getIntent().getBooleanExtra(start_share_ele,false);\n        }\n\n        // æ·»åŠ åˆ°å…¨å±€Activityç®¡ç†å™¨ä¸­ï¼ˆæ–¹ä¾¿ç»Ÿä¸€å…³é—­ã€ç®¡ç†Activityï¼‰\n        AppActivityManager.getInstance().add(this);\n\n        // ç¬¬ä¸€æ­¥ï¼šåˆå§‹åŒ–ç¬¬ä¸‰æ–¹SDKï¼ˆå¯é€‰ï¼‰\n        initSDK();\n\n        // ç¬¬äºŒæ­¥ï¼šè®¾ç½®å¸ƒå±€ï¼Œæ¯”å¦‚ setContentView(R.layout.xxx)\n        onCreateActivity();\n\n        //ç¬¬ä¸‰æ­¥ï¼šåˆ›å»º Presenter å¯¹è±¡\n        mPresenter = initInjector();\n\n        // ç¬¬å››æ­¥ï¼šå°†å½“å‰Viewç»‘å®šåˆ°Presenterä¸Šï¼ˆç”¨äºé€šçŸ¥åˆ·æ–°ï¼‰\n        attachView();\n\n        // ç¬¬äº”æ­¥ï¼šåˆå§‹åŒ–æ•°æ®ï¼ˆå¦‚é€‚é…å™¨ã€å˜é‡ç­‰ï¼‰\n        initData();\n\n        // ç¬¬å…­æ­¥ï¼šç»‘å®šæ§ä»¶ï¼ˆfindViewByIdï¼‰\n        bindView();\n\n        // ç¬¬ä¸ƒæ­¥ï¼šç»‘å®šäº‹ä»¶ï¼ˆç‚¹å‡»ã€åˆ·æ–°ç­‰é€»è¾‘ï¼‰\n        bindEvent();\n\n        // ç¬¬å…«æ­¥ï¼šå‘èµ·é¦–æ¬¡è¯·æ±‚ï¼Œæ¯”å¦‚ç½‘ç»œåŠ è½½ä¹¦æ¶\n        firstRequest();\n    }\n```\n\nâ€‹\tè¿˜å†™å¥½äº†é¡µé¢çš„è·³è½¬åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯å¯åŠ¨æ–°Activityå¹¶å¸¦åŠ¨ç”»æ•ˆæœçš„æ–¹æ³•ï¼Œæœ‰å¤šç§ï¼Œé€‚é…å¤šç§æƒ…å†µä¸‹çš„ä½¿ç”¨éœ€æ±‚ã€‚\n\n```java\n////////////////////////////////å¯åŠ¨Activityè½¬åœºåŠ¨ç”»/////////////////////////////////////////////\n\n    protected void startActivityForResultByAnim(Intent intent, int requestCode, int animIn, int animExit) {\n        startActivityForResult(intent, requestCode);\n        overridePendingTransition(animIn, animExit);\n    }\n\n\n\n    //protectedä»£è¡¨å®ƒçš„å­ç±»å¯ä»¥è°ƒç”¨\n    protected void startActivityByAnim(Intent intent, int animIn, int animExit) {\n        startActivity(intent);\n        overridePendingTransition(animIn, animExit);\n    }\n\n    protected void startActivityForResultByAnim(Intent intent, int requestCode, @NonNull View view, @NonNull String transitionName, int animIn, int animExit) {\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {\n            startActivityForResult(intent, requestCode, ActivityOptions.makeSceneTransitionAnimation(this, view, transitionName).toBundle());\n        } else {\n            startActivityForResultByAnim(intent, requestCode, animIn, animExit);\n        }\n    }\n\n    protected void startActivityByAnim(Intent intent, @NonNull View view, @NonNull String transitionName, int animIn, int animExit) {\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {\n            intent.putExtra(start_share_ele,true);\n            startActivity(intent, ActivityOptions.makeSceneTransitionAnimation(this, view, transitionName).toBundle());\n        } else {\n            startActivityByAnim(intent, animIn, animExit);\n        }\n    }\n\n    public Context getContext(){\t\t//å®ç°çš„IViewæ–¹æ³•\n        return this;\n    }\n\n    public Boolean getStart_share_ele() {\n        return startShareAnim;\n    }\n```\n\nâ€‹\tä»€ä¹ˆæ˜¯â€œå…±äº«å…ƒç´ åŠ¨ç”»â€ï¼Ÿç®€å•è¯´ï¼Œå°±æ˜¯ä¸¤ä¸ªé¡µé¢**â€œå…±ç”¨ä¸€ä¸ªä¸œè¥¿â€**ï¼Œè¿™ä¸ªä¸œè¥¿åœ¨åˆ‡æ¢é¡µé¢æ—¶ä¼š**åŠ¨èµ·æ¥ï¼Œçœ‹èµ·æ¥å¾ˆè‡ªç„¶ã€é…·ç‚«**ã€‚æ›´åŠ è¯¦ç»†çš„è®²è§£å¯ä»¥ç™¾åº¦ã€‚\n\n\n\n\n\n\n\nâ€‹\tåé¢è¿˜æœ‰**BaseFragment**ã€**BaseModelImpl**ã€**BasePresenterImpl**ã€**RetryIntercepter**ç±»ï¼Œæ”¹å¤©å†è§£æï¼Œä»Šå¤©å­¦ä¹ ä»»åŠ¡ç»“æŸï¼\n","tags":["å®‰å“å¼€å‘å­¦ä¹ "],"categories":["å¼€å‘"]},{"title":"é˜…è¯»APPé¡¹ç›®å­¦ä¹ â€”â€”2","url":"/2025/06/22/é˜…è¯»é¡¹ç›®å­¦ä¹ /å®‰å“é¡¹ç›®å­¦ä¹ 2/","content":"\nâ€‹\tæ¬¢è¿é¡µå¼€å§‹åï¼Œå°±è¿›å…¥ä¸»ä½“**MainActivity**ä¸­ï¼ŒæŸ¥çœ‹æºç å¯ä»¥å‘ç°ï¼Œå…¶ä½¿ç”¨äº†ä¼—å¤šè‡ªå®šä¹‰çš„å…¶ä»–ç±»ã€‚\n\nâ€‹\t\n\n### æ¦‚è¿°\n\nâ€‹\tå…ˆå¤§ä½“é€šè¿‡AIåˆ†æä¸€æ³¢ï¼Œçœ‹çœ‹è¿™ä¸ªä¸»é¡µé¢åœ¨å¹²ä»€ä¹ˆã€‚\n\n- é¡µé¢åˆå§‹åŒ–å’Œå¸ƒå±€è®¾ç½®ï¼šç»§æ‰¿è‡ª **MBaseActivity<IMainPresenter>**ï¼Œé‡‡ç”¨ MVP æ¶æ„è®¾è®¡ï¼ˆè§†å›¾å±‚ **MainActivity** è´Ÿè´£UIï¼Œ**IMainPresenter** è´Ÿè´£ä¸šåŠ¡é€»è¾‘ï¼‰ã€‚åˆå§‹åŒ–é¡µé¢ä¸Šçš„æ§ä»¶ï¼Œå¦‚åº”ç”¨logoã€å‡ ä¸ªåŠŸèƒ½æŒ‰é’®ï¼ˆæ‰“èµã€è®¾ç½®ã€ä¹¦åº“ã€æ·»åŠ ä¹¦ç±ã€ä¸‹è½½ï¼‰ã€åˆ·æ–°åˆ—è¡¨æ§ä»¶ï¼ˆ**RefreshRecyclerView**ï¼‰ç­‰ã€‚\n\n- æ˜¾ç¤ºä¹¦æ¶åˆ—è¡¨ï¼šä½¿ç”¨**RefreshRecyclerView**æ¥å±•ç¤ºä¹¦æ¶å†…å®¹ï¼Œä½¿ç”¨è‡ªå®šä¹‰çš„**BookShelfAdapter**ä½œä¸ºåˆ—è¡¨çš„é€‚é…å™¨ï¼Œå†é€šè¿‡å¸ƒå±€ç®¡ç†å™¨**LinearLayoutManager**æ¥æ§åˆ¶**RecyclerView**å¸ƒå±€ã€‚\n- åˆ·æ–°å’ŒåŠ è½½æ•°æ®ï¼šç»‘å®šåˆ·æ–°ç›‘å¬å™¨ï¼ˆ**OnRefreshWithProcessListener**ï¼‰æ¥å®ç°ä¸‹æ‹‰åˆ·æ–°ä¹¦æ¶æ•°æ®ï¼Œåˆ·æ–°æ—¶è°ƒç”¨**mPresenter.queryBookShelf(true)**è¯·æ±‚æœ€æ–°æ•°æ®ã€‚åŒæ—¶å¤„ç†åˆ·æ–°å®Œæˆå’Œåˆ·æ–°é”™è¯¯çš„å›è°ƒï¼Œå¹¶æ›´æ–°UIå’Œè¿›åº¦æ¡ã€‚\n- äº‹ä»¶å¤„ç†ï¼šç»™é¦–é¡µçš„å„ä¸ªæŒ‰é’®ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼šè®¾ç½®æŒ‰é’®å¼¹å‡ºä»£ç†è®¾ç½®çª—å£ï¼›ä¸‹è½½æŒ‰é’®å¼¹å‡ºä¸‹è½½åˆ—è¡¨çª—å£ï¼›ä¹¦åº“æŒ‰é’®è·³è½¬åˆ°ä¹¦åº“ç•Œé¢ï¼ˆ**LibraryActivity**ï¼‰ï¼›æ·»åŠ ä¹¦ç±æŒ‰é’®è·³è½¬åˆ°å¯¼å…¥ä¹¦ç±ç•Œé¢ï¼›æ‰“èµæŒ‰é’®é¢„ç•™äº†ç‚¹å‡»äº‹ä»¶ï¼Œå…·ä½“é€»è¾‘æ²¡å†™ã€‚ç»™ä¹¦æ¶åˆ—è¡¨çš„æ¯ä¸ªä¹¦ç±ç»‘å®šäº†ç‚¹å‡»äº‹ä»¶ï¼šç‚¹å‡»è·³è½¬åˆ°é˜…è¯»ç•Œé¢ï¼›é•¿æŒ‰è·³è½¬åˆ°ä¹¦ç±è¯¦æƒ…ç•Œé¢ï¼Œå¹¶å¸¦åŠ¨ç”»æ•ˆæœã€‚ä¹¦æ¶ä¸­ç‚¹å‡»â€œå»é€‰ä¹¦â€ä¼šè·³è½¬åˆ°ä¹¦åº“ã€‚\n- ç®¡ç†è­¦å‘Šä¿¡æ¯å¼¹çª—ï¼šé¡µé¢ä¸Šæœ‰ä¸€ä¸ªè­¦å‘Šä¿¡æ¯åŒºåŸŸï¼ˆ**flWarn**ï¼‰ï¼Œå¯ä»¥é€šè¿‡å…³é—­æŒ‰é’®éšè—ã€‚\n- å¤„ç†ç³»ç»ŸæŒ‰é”®äº‹ä»¶ï¼šæ•è·è¿”å›é”®ï¼Œå®ç°â€œè¿ç»­ä¸¤æ¬¡æŒ‰è¿”å›é”®é€€å‡ºåº”ç”¨â€çš„äº¤äº’é€»è¾‘ã€‚\n- ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼šåœ¨ **onDestroy** é‡Œåšèµ„æºé”€æ¯ï¼Œæ¯”å¦‚å…³é—­å¼¹çª—ã€‚\n\n\n\n> â€‹\tä¸Šé¢æ¯”è¾ƒé™Œç”Ÿçš„æ¦‚å¿µæœ‰â€œé€‚é…å™¨â€ï¼Œè¿™æ˜¯ä»€ä¹ˆä¸œè¥¿å•Šï¼Ÿ\n>\n> â€‹\tä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼šä½ æƒ³åœ¨å®¶é‡Œçš„ä¹¦æ¶ä¸Šæ‘†ä¹¦ï¼ŒRecyclerViewå°±æ˜¯ä¹¦æ¶ï¼Œé€‚é…å™¨å°±æ˜¯æŒ‰é¡ºåºæ‹¿ä¹¦ï¼Œä¸€æœ¬ä¸€æœ¬æ‘†æ”¾ä¹¦ç±çš„äººï¼Œä¹¦æœ¬çš„æ•°æ®å°±æ˜¯ä½ æ‰‹é‡Œçš„ä¹¦ã€‚æ²¡æœ‰é€‚é…å™¨ï¼Œä½ çš„ä¹¦æ¶å°±ä¸çŸ¥é“æ‘†å“ªäº›ä¹¦ï¼Œä¹Ÿä¸çŸ¥é“æ€ä¹ˆæ‘†ã€‚\n\n\n\n\n\n### é€»è¾‘è§£è¯»\n\nâ€‹\t\n\n```java\n//æˆå‘˜å˜é‡å£°æ˜\n    private ImageView ivLogo;           //åº”ç”¨logoå›¾æ ‡\n    private ImageButton ibMoney;        //æ‰“èµæŒ‰é’®\n    private ImageButton ibSettings;     //è®¾ç½®æŒ‰é’®\n    private ImageButton ibLibrary;      //ä¹¦åº“æŒ‰é’®\n    private ImageButton ibAdd;          //æ·»åŠ ä¹¦ç±æŒ‰é’®\n    private ImageButton ibDownload;     //ä¸‹è½½æŒ‰é’®\n\n    private RefreshRecyclerView rfRvShelf;\n    private BookShelfAdapter bookShelfAdapter;\n\n    private FrameLayout flWarn;         //è­¦å‘Šä¿¡æ¯å¸ƒå±€ï¼ˆå¼¹å‡ºæ¡†ï¼‰\n    private ImageView ivWarnClose;      //å…³é—­è­¦å‘ŠæŒ‰é’®\n\n    private DownloadListPop downloadListPop;        //ä¸‹è½½åˆ—è¡¨å¼¹çª—å¯¹è±¡\n    private ProxyPop proxyPop;          //ä»£ç†è®¾ç½®å¼¹çª—å¯¹è±¡\n```\n\nâ€‹\tImageViewæ˜¯å®‰å“é‡Œé¢ç”¨æ¥æ˜¾ç¤ºå›¾ç‰‡çš„æ§ä»¶ï¼Œå°±æ˜¯ä¸€ä¸ªâ€å›¾ç‰‡æ¡†â€œï¼Œä¸“é—¨ç”¨æ¥åœ¨ç•Œé¢ä¸Šå±•ç¤ºå›¾ç‰‡ï¼Œæ¯”å¦‚åº”ç”¨å›¾æ ‡ã€ç…§ç‰‡ã€æŒ‰é’®å›¾æ ‡ç­‰ç­‰ï¼Œåªè´Ÿè´£æ˜¾ç¤ºå›¾ç‰‡ï¼Œä¸å“åº”ç‚¹å‡»äº‹ä»¶ï¼ˆå½“ç„¶ï¼Œä½ å¯ä»¥ç»™å®ƒåŠ ç‚¹å‡»äº‹ä»¶ï¼Œè®©å®ƒåƒæŒ‰é’®ä¸€æ ·ç”¨ï¼‰ã€‚\n\nâ€‹\tImageButtonå°±æ˜¯æœ‰å›¾ç‰‡çš„æŒ‰é’®ã€‚\n\nâ€‹\tå…¶ä»–å°±æ˜¯è‡ªå®šä¹‰çš„ç»„ä»¶äº†ã€‚\n\n\n\nâ€‹\t\n\nâ€‹\tçœ‹åˆ°å…·ä½“çš„æ–¹æ³•ï¼Œ**initInjector**æ˜¯åœ¨åˆå§‹åŒ–ä¸€ä¸ªPresenterå¯¹è±¡ï¼Œç„¶åè¿”å›ä¸€ä¸ª**MainPresenterImpl**å®ä¾‹ï¼Œè´Ÿè´£ä¸ç•Œé¢ä¸šåŠ¡é€»è¾‘äº¤äº’ã€‚\n\nâ€‹\t**onCreateActivity**è®¾ç½®ç•Œé¢çš„å¸ƒå±€æ–‡ä»¶ã€‚\n\nâ€‹\t**initData**åˆå§‹åŒ–æ•°æ®ï¼Œåˆ›å»ºä¹¦æ¶é€‚é…å™¨å®ä¾‹ã€‚\n\nâ€‹\t**dispatchTouchEvent**å¤„ç†è§¦æ‘¸äº‹ä»¶ï¼Œè°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼Œå¥—å£³å‡½æ•°ã€‚\n\nâ€‹\t**bindView**ç»‘å®šç•Œé¢æ§ä»¶ï¼ˆæ‰¾æ§ä»¶ã€å®ä¾‹åŒ–ï¼‰ï¼Œæ‰¾åˆ°å¸ƒå±€é‡Œçš„å„ç§æ§ä»¶ï¼ˆæŒ‰é’®ã€åˆ—è¡¨ã€å¼¹çª—ç­‰ï¼‰ï¼Œå¹¶å…³è”åˆ°å˜é‡ï¼Œç»™ä¹¦æ¶åˆ—è¡¨ `RecyclerView` è®¾ç½®é€‚é…å™¨å’Œå¸ƒå±€ç®¡ç†å™¨ã€‚\n\nâ€‹\t**bindEvent**ç»‘å®šå„ç§äº‹ä»¶ç›‘å¬å™¨ã€‚\n\nâ€‹\t**bindRvShelfEvent**ç»™ä¹¦æ¶çš„åˆ·æ–°æ§ä»¶ç»‘å®šåˆ·æ–°ç›‘å¬ã€‚\n\nâ€‹\t**firstRequest**é¦–æ¬¡åŠ è½½æ•°æ®ï¼Œåº”ç”¨æ‰“å¼€æ—¶è°ƒç”¨ã€‚\n\nâ€‹\t**refreshBookShelf**å°†æ–°çš„ä¹¦ç±åˆ—è¡¨æ•°æ®ä¼ ç»™é€‚é…å™¨ï¼Œæ›´æ–°æ˜¾ç¤ºã€‚\n\nâ€‹\t**activityRefreshView**è§¦å‘ä¹¦æ¶åˆ·æ–°åŠ¨ä½œï¼Œè®©åˆ·æ–°æ§ä»¶å¼€å§‹åˆ·æ–°åŠ¨ç”»å¹¶è°ƒç”¨åˆ·æ–°é€»è¾‘ã€‚\n\nâ€‹\t**refreshFinish**åˆ·æ–°ç»“æŸï¼Œéšè—åˆ·æ–°åŠ¨ç”»ã€‚\n\nâ€‹\t**refreshError**åˆ·æ–°é”™è¯¯æ—¶è°ƒç”¨ã€‚\n\nâ€‹\t**refreshRecyclerViewItemAdd**åˆ·æ–°æ—¶è¿›åº¦æ¡+1ã€‚\n\nâ€‹\t**setRecyclerMaxProgress**è®¾ç½®åˆ·æ–°è¿›åº¦æ¡çš„æœ€å¤§å€¼ã€‚\n\nâ€‹\t**onKeyDown**æŒ‰é”®äº‹ä»¶å¤„ç†ï¼Œç”¨æˆ·æŒ‰è¿”å›é”®æ—¶ï¼Œè°ƒç”¨ `exit()` æ–¹æ³•ï¼Œå®ç°â€œå†æŒ‰ä¸€æ¬¡é€€å‡ºç¨‹åºâ€çš„é€»è¾‘ã€‚\n\nâ€‹\t**onDestroy**èµ„æºé”€æ¯æ—¶è°ƒç”¨ï¼Œæ¸…ç†ä¸€äº›å¼¹çª—çš„èµ„æºï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚\n\nâ€‹\t**exit**é€€å‡ºç¨‹åºçš„é€»è¾‘ï¼Œå¦‚æœ2ç§’å†…ç¬¬äºŒæ¬¡æŒ‰è¿”å›é”®ï¼Œåˆ™é€€å‡ºç¨‹åºï¼Œå¦åˆ™æç¤ºâ€œå†æŒ‰ä¸€æ¬¡é€€å‡ºç¨‹åºâ€ã€‚\n\n\n\n\n\n### å‰ç«¯é¡µé¢å¤ç°\n\nâ€‹\tçœ‹åˆ°XMLæ–‡ä»¶ï¼Œé‡Œé¢ä½¿ç”¨åˆ°ä¸€ä¸ªè‡ªå®šä¹‰çš„ç»„ä»¶**com.monke.monkeybook.widget.refreshview.RefreshRecyclerView**ï¼Œ\n\nä¸‹å›¾ä¸­çš„ç©ºç™½åŒºåŸŸå°±æ˜¯è¿™ä¸ªç»„ä»¶çš„ä½ç½®ã€‚å½“ç„¶ä¹ŸåŒ…æ‹¬ä¸€ä¸ªä½œè€…è‡ªå·±å¼€æºçš„æ²‰æµ¸æ¡†ï¼Œéœ€è¦å¼•ç”¨ä¾èµ–ã€‚\n\nâ€‹\té‡Œé¢çš„å¸ƒå±€å¾ˆæ¸…æ™°æ˜äº†ï¼Œæ²‰æµ¸æ¡†åŒ…è£¹æœ€å¤–å±‚ï¼Œç„¶åä¸€ä¸ªå‚ç›´æ–¹å‘çš„çº¿æ€§å¸ƒå±€æ¥éš”åˆ†ä¸Šä¸‹é¡µé¢ï¼Œé‡Œé¢å†ç”±æ°´å¹³çš„çº¿æ€§å¸ƒå±€æ¥å±•ç¤ºé¡¶éƒ¨ï¼Œä¸‹é¢å°±æ˜¯ä¹¦æ¶åŒºã€‚\n\n![image-20250622115453885](/pictures/novelReader_app/image-20250622115453885.png)\n\nâ€‹\téœ€è¦å¯¼å…¥å¯¹åº”çš„drawableé‡Œé¢çš„XMLæ–‡ä»¶ã€layouté‡Œé¢çš„å…¶ä»–XMLæ–‡ä»¶ã€valuesé‡Œé¢çš„XMLæ–‡ä»¶ã€‚ç„¶åå†™å…¥**RefreshRecyclerView**ç±»ã€**RefreshProgressBar**ç±»ã€**RefreshRecyclerViewAdapter**æŠ½è±¡ç±»ã€**OnRefreshWithProgressListener**æ¥å£ã€**OnLoadMoreListener**æ¥å£ã€**BaseRefreshListener**æ¥å£ï¼Œè¿˜æœ‰**BookContentView**ç±»ï¼Œå› ä¸ºè¿™ä¸ªç±»åˆå¼•å‡ºä¸€å †å…¶ä»–çš„ç±»å’Œæ¥å£ã€‚å¤ªéº»çƒ¦äº†ã€‚\n\nâ€‹\tå…ˆæ”¾ç€BookContentViewä¸ç®¡å§ï¼Œè¿˜æœ‰å…¶ä»–å‡ ä¸ª**BitIntentDataManager**ã€**MApplication**ã€**ReadBookControl**éƒ½æœ‰ç‚¹é—®é¢˜å•Šï¼è¿™æ ·åˆ†æä¹Ÿå¤ªéº»çƒ¦äº†ã€‚ä¸èƒ½æŒ‰ç…§è¿™ä¸ªé€»è¾‘æä¸‹å»ã€‚\n\n\n\n\n\n### å…·ä½“åŠŸèƒ½æµç¨‹åˆ†æ\n\nâ€‹\tå…ˆä»æœ€ç®€å•çš„é€€å‡ºåŠŸèƒ½æ¥è¯´å§ï¼Œä¸ç„¶éƒ½æ²¡æ³•è¯»ä¸‹å»äº†ã€‚\n\n```java\n\t@Override\n    public boolean onKeyDown(int keyCode, KeyEvent event) {\n        if (keyCode == KeyEvent.KEYCODE_BACK) {\n            exit();\n            return true;\n        }\n        return super.onKeyDown(keyCode, event);\n    }\n\n\tprivate long exitTime = 0;\n\tpublic void exit() {\n        if ((System.currentTimeMillis() - exitTime) > 2000) {\n            Toast.makeText(getApplicationContext(), \"å†æŒ‰ä¸€æ¬¡é€€å‡ºç¨‹åº\",\n                    Toast.LENGTH_SHORT).show();\n            exitTime = System.currentTimeMillis();\n        } else {\n            finish();\n            System.exit(0);\n        }\n    }\n```\n\nâ€‹\tå½“ç”¨æˆ·æ‘ä¸‹â€è¿”å›é”®â€œï¼Œè§¦å‘onKeyDownæ–¹æ³•ï¼Œä¼šè°ƒç”¨exitæ–¹æ³•ï¼Œå¯¼è‡´é€€å‡ºç¨‹åºã€‚keyCodeè¡¨ç¤ºå½“å‰è¢«æŒ‰ä¸‹çš„æŒ‰é”®çš„ä»£ç ï¼ˆç¼–å·ï¼‰ï¼ŒKeyEvent.KEYCODE_BACKæ˜¯å®‰å“ç³»ç»Ÿå®šä¹‰çš„å¸¸é‡ï¼Œä»£è¡¨â€è¿”å›é”®â€œçš„æŒ‰é”®ä»£ç ã€‚System.currentTimeMillisæ–¹æ³•è¿”å›ä¸€ä¸ªâ€longâ€œç±»å‹çš„æ•°å­—ï¼Œè¡¨ç¤ºä»â€œ1970å¹´1æœˆ1æ—¥åˆå¤œâ€ï¼ˆç§°ä¸ºâ€œUnixçºªå…ƒâ€ï¼‰å¼€å§‹ï¼Œåˆ°å½“å‰æ—¶åˆ»æ‰€ç»è¿‡çš„æ¯«ç§’æ•°ã€‚\n\nâ€‹\tç¬¬ä¸€æ¬¡æ‘ä¸‹â€è¿”å›é”®â€œä¼šè®¾ç½®exitTimeä¸ºå½“å‰æ—¶é—´ï¼Œç„¶åéœ€è¦åœ¨ä¸¤ç§’å†…å†æ‘ä¸€æ¬¡ï¼Œæ‰è¿›å…¥elseé‡Œé¢ã€‚\n\nâ€‹\tfinishæ–¹æ³•ï¼Œ**åªæ˜¯å‘Šè¯‰ç³»ç»Ÿâ€œå…³é—­è¿™ä¸ªActivityâ€ï¼Œä½†å®ƒæ˜¯å¼‚æ­¥çš„ï¼Œä¸ä¼šç«‹å³åœæ­¢å½“å‰æ–¹æ³•çš„æ‰§è¡Œ**ã€‚`finish()` ä¼šè¯·æ±‚ç³»ç»Ÿå»é”€æ¯Activityï¼ˆè§¦å‘ç”Ÿå‘½å‘¨æœŸ`onPause() -> onStop() -> onDestroy()`ï¼‰ï¼Œä½†æ˜¯è¿™ä¸ªè¿‡ç¨‹æ˜¯åœ¨ç³»ç»Ÿæ¶ˆæ¯é˜Ÿåˆ—ä¸­æ’é˜Ÿæ‰§è¡Œçš„ï¼Œå¹¶ä¸ä¼šé©¬ä¸Šè·³å‡ºå½“å‰æ–¹æ³•æˆ–ç»ˆæ­¢çº¿ç¨‹ï¼Œä½†æ˜¯è¿™ä¸ªè¿‡ç¨‹æ˜¯åœ¨ç³»ç»Ÿæ¶ˆæ¯é˜Ÿåˆ—ä¸­æ’é˜Ÿæ‰§è¡Œçš„ï¼Œå¹¶ä¸ä¼šé©¬ä¸Šè·³å‡ºå½“å‰æ–¹æ³•æˆ–ç»ˆæ­¢çº¿ç¨‹ã€‚\n\n\n\n\n\n\n\n### AIæ€»ç»“ä¸»é¡µé¢åŠŸèƒ½\n\nâ€‹\tåé¢å°±æ ¹æ®è¿™äº›åŠŸèƒ½ï¼Œå¼€å§‹è¿›è¡Œåˆ†å—è®²è§£ï¼ŒåŒ…æ‹¬ä»£ç è·Ÿè¸ªè®²è§£ï¼Œè¿™æ ·ä¼šæ›´åŠ è®©æˆ‘ä¸“æ³¨äºåŠŸèƒ½çš„å®ç°ã€‚\n\n> ### 1. ç•Œé¢åˆå§‹åŒ–å’Œè§†å›¾ç»‘å®š\n>\n> - **åŠ è½½ç•Œé¢å¸ƒå±€**ï¼ˆ`setContentView`ï¼‰ï¼Œè®©é¡µé¢æ˜¾ç¤ºå‡ºæ¥\n> - **æŸ¥æ‰¾å¹¶ç»‘å®šæ§ä»¶**ï¼Œæ¯”å¦‚logoå›¾æ ‡ã€æŒ‰é’®ã€ä¹¦æ¶åˆ—è¡¨ç­‰\n> - **åˆå§‹åŒ–ä¹¦æ¶é€‚é…å™¨**ï¼Œç®¡ç†ä¹¦ç±åˆ—è¡¨çš„æ˜¾ç¤º\n>\n> ### 2. æ•°æ®å±•ç¤ºå’Œåˆ·æ–°\n>\n> - **å±•ç¤ºä¹¦æ¶åˆ—è¡¨æ•°æ®**ï¼ŒæŠŠæ•°æ®åŠ è½½åˆ°ä¹¦æ¶é€‚é…å™¨é‡Œï¼Œæ˜¾ç¤ºåœ¨åˆ—è¡¨ä¸­\n> - **æ”¯æŒä¸‹æ‹‰åˆ·æ–°**ï¼Œç”¨æˆ·ä¸‹æ‹‰åˆ—è¡¨æ—¶ï¼Œé‡æ–°è¯·æ±‚æ•°æ®ï¼Œåˆ·æ–°ä¹¦æ¶å†…å®¹\n> - **åˆ·æ–°è¿›åº¦åé¦ˆ**ï¼Œé€šè¿‡è¿›åº¦æ¡æ˜¾ç¤ºåˆ·æ–°è¿›åº¦ï¼Œæé«˜ç”¨æˆ·ä½“éªŒ\n>\n> ### 3. ç”¨æˆ·äº¤äº’å¤„ç†\n>\n> - **æŒ‰é’®ç‚¹å‡»äº‹ä»¶**\n>   - ç‚¹å‡»â€œè®¾ç½®â€æŒ‰é’®å¼¹å‡ºä»£ç†è®¾ç½®çª—å£\n>   - ç‚¹å‡»â€œä¸‹è½½â€æŒ‰é’®å¼¹å‡ºä¸‹è½½åˆ—è¡¨\n>   - ç‚¹å‡»â€œæ‰“èµâ€æŒ‰é’®è§¦å‘æ‰“èµæ“ä½œï¼ˆè¿™é‡Œæ²¡å®ç°å…·ä½“é€»è¾‘ï¼‰\n>   - ç‚¹å‡»â€œä¹¦åº“â€æŒ‰é’®è¿›å…¥ä¹¦åº“é¡µé¢\n>   - ç‚¹å‡»â€œæ·»åŠ ä¹¦ç±â€æŒ‰é’®è¿›å…¥å¯¼å…¥ä¹¦ç±é¡µé¢\n> - **ä¹¦æ¶ä¹¦ç±ç‚¹å‡»**\n>   - ç‚¹å‡»ä¹¦ç±è·³è½¬åˆ°é˜…è¯»é¡µé¢ï¼Œæ‰“å¼€ä¹¦ç±\n>   - é•¿æŒ‰ä¹¦ç±è·³è½¬åˆ°ä¹¦ç±è¯¦æƒ…é¡µé¢ï¼Œå¸¦åŠ¨ç”»æ•ˆæœ\n>\n> ### 4. å¼¹çª—ä¸æç¤º\n>\n> - å¼¹å‡ºä»£ç†è®¾ç½®å’Œä¸‹è½½åˆ—è¡¨å¼¹çª—ï¼Œæ–¹ä¾¿ç”¨æˆ·æ“ä½œ\n> - è­¦å‘Šä¿¡æ¯æ¡†çš„æ˜¾ç¤ºå’Œå…³é—­ï¼Œæé†’ç”¨æˆ·é‡è¦ä¿¡æ¯\n>\n> ### 5. ç”Ÿå‘½å‘¨æœŸä¸é€€å‡º\n>\n> - ç›‘å¬æ‰‹æœºè¿”å›é”®ï¼Œé˜²æ­¢è¯¯æ“ä½œé€€å‡º\n> - å®ç°â€œåŒå‡»è¿”å›é”®é€€å‡ºç¨‹åºâ€çš„é€»è¾‘ï¼Œæé«˜ç”¨æˆ·ä½“éªŒ\n> - é€€å‡ºæ—¶é‡Šæ”¾èµ„æºï¼Œé˜²æ­¢å†…å­˜æ³„æ¼\n>\n> â€‹\t\t","tags":["å®‰å“å¼€å‘å­¦ä¹ "],"categories":["å¼€å‘"]},{"title":"é˜…è¯»APPé¡¹ç›®å­¦ä¹ â€”â€”1","url":"/2025/06/21/é˜…è¯»é¡¹ç›®å­¦ä¹ /å®‰å“é¡¹ç›®å­¦ä¹ 1/","content":"\n# \tå‰è¨€\n\nâ€‹\tè¯¥é˜…è¯»é¡¹ç›®æ˜¯[MONKOVEL](https://github.com/ZhangQinhao/MONKOVEL)ï¼Œæˆ‘å°†åˆ†æå­¦ä¹ å…¶é¡¹ç›®è®¾è®¡å’ŒJAVAä»£ç ï¼Œæˆ‘æ²¡ä»€ä¹ˆè¯­è¨€åŸºç¡€ï¼Œä¹Ÿæ²¡æœ‰å¼€å‘ç»éªŒï¼Œæ­¤ç³»åˆ—å°†è®°å½•æˆ‘åœ¨è¿™ä¸ªé¡¹ç›®ä¸­è‡ªå­¦åˆ°çš„çŸ¥è¯†ã€‚\n\nâ€‹\t\n\n# \tæ­£æ–‡\n\nâ€‹\tå…ˆçœ‹åˆ°`AndroidManifest.xml`æ–‡ä»¶ï¼ŒæŸ¥çœ‹APPå­˜åœ¨å¤šå°‘ä¸ªActivityï¼ˆç•Œé¢ï¼‰ï¼š`WelcomeActivity`ç±»è´Ÿè´£æ¬¢è¿ç•Œé¢ï¼Œå®ç°ä¸€ä¸ªåŠ¨ç”»çš„æ•ˆæœã€‚\n\n```xml\n<activity\n            android:name=\".view.impl.WelcomeActivity\"\n            android:screenOrientation=\"portrait\">\n            <intent-filter>\n                <action android:name=\"android.intent.action.MAIN\" />\n\n                <category android:name=\"android.intent.category.LAUNCHER\" />\n            </intent-filter>\n        </activity>\n```\n\nâ€‹\tä¹‹åä¼šè·³è½¬åˆ°ä¸»ç•Œé¢ã€‚\n\n```java\npublic void onAnimationEnd(Animator animation) {\n                startActivityByAnim(new Intent(WelcomeActivity.this, MainActivity.class), android.R.anim.fade_in, android.R.anim.fade_out);\n                finish();\n            }\n```\n\n\n\nâ€‹\t`MainActivity`è´Ÿè´£ä¸»é¡µé¢çš„å‘ˆç°ï¼Œå±•ç¤ºä»å„ä¸ªç½‘ç«™è§£ææ¥çš„ä¹¦ç±ï¼›`SearchActivity`ç±»è´Ÿè´£å…³é”®è¯æœç´¢ï¼Œå¯èƒ½ä¼šè°ƒç”¨ç½‘ç»œæ¥å£æˆ–æœ¬åœ°æ•°æ®åº“æŸ¥è¯¢ï¼›`DownloadService`è´Ÿè´£åå°ä¸‹è½½ä»»åŠ¡ï¼Œé€šå¸¸æ˜¯serviceç±»å‹ï¼Œä¸é˜»å¡UIï¼Œç®¡ç†ä¸‹è½½é˜Ÿåˆ—ï¼Œå¤„ç†æ–­ç‚¹ç»­ä¼ ç­‰ç­‰ï¼›è¿˜æœ‰`LibraryActivity`ä¹¦æ¶é¡µé¢ã€`ChoiceBookActivity`ä¹¦ç±é€‰æ‹©é¡µé¢ã€`BookDetailActivity`ä¹¦çš„è¯¦ç»†è¯¦ç»†ã€`ReadBookActivity`è´Ÿè´£é˜…è¯»ç•Œé¢ã€`ImportBookActivity`è´Ÿè´£æœ¬åœ°å¯¼å…¥ä¹¦ç±ã€‚\n\n\n\n\n\n## å¤ç°\n\nâ€‹\té¦–å…ˆå¯ä»¥å•ç‹¬å¤ç°å‡ºwelcomeç•Œé¢ï¼Œå…ˆå¤„ç†å¥½xmlæ–‡ä»¶ï¼Œä¼šéœ€è¦å¯¼å…¥åŒ…ï¼šæ³¨æ„æ–°çš„å†™æ³•æ˜¯`implementation(\"...\")`ã€‚å†™å…¥`activity_welcome.xml`æ–‡ä»¶ï¼Œå¤åˆ¶å›¾ç‰‡èµ„æºåˆ°resç›®å½•ä¸‹ï¼Œæ”¹å†™ç³»ç»Ÿé»˜è®¤çš„`AndroidManifest.xml`æ–‡ä»¶ï¼Œåˆ é™¤ç³»ç»Ÿç»™çš„`MainActivity`éƒ¨åˆ†ã€‚åé¢ä»`view.impl.WelcomeActivity`å¼€å§‹æ…¢æ…¢æŠ„å…¥å…¶ä»–æ–‡ä»¶ï¼Œæš‚æ—¶ä¸éœ€è¦çš„åŠŸèƒ½å¯ä»¥æ³¨é‡Šæ‰ã€‚\n\nâ€‹\t\n\n### MVPæ¶æ„\n\nâ€‹\tå®ç°`IView`å’Œ`IPresenter`æ¥å£ï¼Œè¿™æ˜¯MVPè®¾è®¡æ¶æ„ä¸­å¸¸è§çš„åŸºç¡€æ¥å£ã€‚\n\n> MVPçš„æ€æƒ³æ˜¯ï¼šViewï¼ˆè§†å›¾ï¼‰ï¼šè´Ÿè´£â€œæ˜¾ç¤ºâ€å’Œâ€œç”¨æˆ·äº¤äº’â€ã€‚\n>\n> â€‹\t\tPresenterï¼ˆä¸­é—´äººï¼‰ï¼šè´Ÿè´£â€œå¤„ç†é€»è¾‘â€å’Œâ€œæ²Ÿé€šâ€ã€‚\n>\n> â€‹\t\tModelï¼ˆæ¨¡å‹ï¼‰ï¼šè´Ÿè´£â€œæ•°æ®å’Œä¸šåŠ¡é€»è¾‘â€ã€‚\n>\n> MVP å°±æ˜¯æŠŠâ€œæ˜¾ç¤ºç•Œé¢â€å’Œâ€œä¸šåŠ¡é€»è¾‘â€æ‹†å¼€ï¼Œè®©ä»£ç æ›´æ•´æ´ã€æ›´å®¹æ˜“ç»´æŠ¤\n\n> #### çœŸå®å¼€å‘ä¸­ï¼š\n>\n> - ä½ çš„æ‰‹æœºç•Œé¢å°±æ˜¯ Viewï¼Œè´Ÿè´£æ˜¾ç¤ºæŒ‰é’®ã€åˆ—è¡¨ç­‰\n> - ä»£ç é‡Œå†™çš„ Presenter è´Ÿè´£ç›‘å¬æŒ‰é’®ï¼Œå¤„ç†ä¸šåŠ¡é€»è¾‘\n> - Model è´Ÿè´£æ•°æ®å­˜å–ï¼Œæ¯”å¦‚ä»æ•°æ®åº“æ‹¿æ•°æ®ï¼Œæˆ–è€…è°ƒç”¨ç½‘ç»œæ¥å£\n\nâ€‹\t\n\nâ€‹\t\n\n```java\npublic interface IView {\n    public Context getContext();\n}\n```\n\nâ€‹\tçœ‹åˆ°`IView`çš„æ¥å£æ–¹æ³•ï¼Œ`getContext`æ–¹æ³•ï¼Œä»€ä¹ˆæ˜¯Contextï¼Ÿçœ‹ä¸€ä¸‹ChatGptçš„çœ‹æ³•ã€‚\n\n> - **Context å°±åƒæ‰‹æœºé‡Œçš„â€œä¸‡èƒ½é’¥åŒ™â€æˆ–è€…â€œå·¥å…·ç®±â€**ï¼Œå®ƒå‘Šè¯‰ä½ â€œç°åœ¨åœ¨å“ªä¸ªç¯å¢ƒä¸‹â€ï¼Œå¯ä»¥å¸®ä½ è®¿é—®å¾ˆå¤šç³»ç»ŸæœåŠ¡ã€èµ„æºï¼Œç”šè‡³æ‰“å¼€æ–°é¡µé¢ã€æ˜¾ç¤ºæç¤ºæ¶ˆæ¯ã€‚\n> - å‡è®¾ä½ åœ¨ä¸€ä¸ªå¤§å•†åœºé‡Œï¼ŒContext å°±åƒä½ çš„å•†åœºä¼šå‘˜å¡ï¼Œä½ æ‹¿ç€ä¼šå‘˜å¡ï¼Œå•†åœºæ‰çŸ¥é“ä½ æ˜¯è°ã€ä½ åœ¨å“ªä¸ªåº—é“ºã€ä½ å¯ä»¥ç”¨å“ªäº›ä¼˜æƒ ï¼Œé€šè¿‡ä¼šå‘˜å¡ï¼Œä½ å¯ä»¥å»ä¸åŒçš„æŸœå°ï¼ˆæœåŠ¡ï¼‰åŠäº‹æƒ…ï¼Œæ¯”å¦‚ä¹°ä¸œè¥¿ã€é€€è´§ã€æŸ¥ä½™é¢ã€‚\n> - åœ¨ä»£ç é‡Œ Context èƒ½åšä»€ä¹ˆï¼Ÿæ‰“å¼€æ–°ç•Œé¢ã€æ˜¾ç¤ºå¼¹çª—ã€è®¿é—®èµ„æºã€è·å–ç³»ç»ŸæœåŠ¡ï¼ˆæ¯”å¦‚ç½‘ç»œã€ä¼ æ„Ÿå™¨ï¼‰ã€è®¿é—®æ–‡ä»¶ã€æ•°æ®åº“ç­‰ç­‰ã€‚\n> - ä¸¾ä¸ªç®€å•ä¾‹å­ï¼Œ`Toast.makeText(context, \"Hello!\", Toast.LENGTH_SHORT).show();`ï¼Œè¿™å¥è¯çš„ `context` å°±å‘Šè¯‰ç³»ç»Ÿï¼Œâ€œä½ ç°åœ¨åœ¨å“ªä¸ªç¯å¢ƒä¸‹æ˜¾ç¤ºè¿™ä¸ªå¼¹çª—â€ï¼Œç³»ç»Ÿæ‰èƒ½æ­£ç¡®åœ°æŠŠå¼¹çª—æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚\n> - å¸¸è§çš„ Context ç±»å‹ï¼š**Activity**ï¼Œå®ƒæœ¬èº«å°±æ˜¯ä¸€ä¸ª Contextï¼Œä»£è¡¨ä¸€ä¸ªç•Œé¢ï¼›**Application**ï¼Œæ•´ä¸ªåº”ç”¨ç¨‹åºçš„å…¨å±€ Contextï¼›**Service**ï¼Œåå°æœåŠ¡çš„ Contextã€‚\n\nâ€‹\t`getContext`æ˜¯ç»™è°ç”¨çš„ï¼Ÿâ€”â€”â€”â€”ç»™ **Presenterï¼ˆä¸šåŠ¡é€»è¾‘å±‚ï¼‰ç”¨çš„**ï¼ŒPresenter é€šè¿‡ `IView.getContext()` æ‹¿åˆ°è¿™ä¸ªç¯å¢ƒï¼ˆContextï¼‰ï¼Œå°±èƒ½åšå¾ˆå¤šäº‹æƒ…ã€‚\n\nâ€‹\tçœ‹çœ‹ä¾‹å­ï¼Œå¾ˆæ¸…æ¥šã€‚\n\n```java\npublic class MainPresenter implements IPresenter {\n    private IView view;\n    @Override\n    public void attachView(@NonNull IView iView) {\n        this.view = iView;\n    }\n    @Override\n    public void detachView() {\n        this.view = null;\n    }\n    public void showMessage() {\n        // é€šè¿‡viewæ‹¿Contextæ¥æ˜¾ç¤ºToast\n        Toast.makeText(view.getContext(), \"Hello MVP!\", Toast.LENGTH_SHORT).show();\n    }\n}\n```\n\n\n\n\n\n\n\n```java\npublic interface IPresenter {\n    /**\n     * æ³¨å…¥Viewï¼Œä½¿ä¹‹èƒ½å¤Ÿä¸Viewç›¸äº’å“åº”\n     */\n    void attachView(@NonNull IView iView);\n    /**\n     * é‡Šæ”¾èµ„æºï¼Œå¦‚æœä½¿ç”¨äº†ç½‘ç»œè¯·æ±‚ å¯ä»¥åœ¨æ­¤æ‰§è¡ŒIModel.cancelRequest()\n     */\n    void detachView();\n}\n```\n\nâ€‹\tçœ‹åˆ°`IPresenter`æ¥å£ï¼Œ`attachview`å°±æ˜¯æä¾›çš„ç”¨æ¥ç»‘å®šviewå’Œpresenterçš„æ–¹æ³•ã€‚\n\nâ€‹\tä»€ä¹ˆæ—¶å€™ä¼šè°ƒç”¨ï¼Ÿ  ä¸€èˆ¬æ˜¯åœ¨ç•Œé¢åˆšåˆ›å»ºæˆ–åˆšå‡†å¤‡å¥½è·Ÿ Presenter äº¤äº’çš„æ—¶å€™è°ƒç”¨ï¼Œæ¯”å¦‚ `Activity` çš„ `onCreate()` æˆ– `onStart()` é‡Œã€‚\n\nâ€‹\tè°æ¥è°ƒç”¨ï¼Ÿ  é€šå¸¸æ˜¯ **Viewï¼ˆç•Œé¢å±‚ï¼Œæ¯”å¦‚ Activityï¼‰è‡ªå·±è°ƒç”¨**ï¼Œæˆ–è€…æœ‰æ—¶æ˜¯åœ¨åˆ›å»º Presenter çš„æ—¶å€™ç”±æ¡†æ¶æˆ–ä»£ç è°ƒç”¨ã€‚\n\nâ€‹\tä¸ºä»€ä¹ˆï¼Ÿ  å› ä¸º Presenter éœ€è¦çŸ¥é“å®ƒæœåŠ¡çš„æ˜¯å“ªä¸ª Viewï¼Œæ‰èƒ½è®© View æ˜¾ç¤ºæ•°æ®æˆ–è€…å“åº”ç”¨æˆ·æ“ä½œã€‚\n\n\n\nâ€‹\tä¸‹é¢æ˜¯AIä¸¾å¾—å°ä¾‹å­ï¼Œå¾ˆäº†ç„¶äº†ã€‚\n\n```java\npublic class MainActivity extends AppCompatActivity implements IView {\n    private IPresenter presenter;\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        presenter = new MainPresenter();\n        presenter.attachView(this);  // æŠŠè‡ªå·±ï¼ˆViewï¼‰ä¼ ç»™Presenterï¼Œç»‘å®šå…³ç³»å»ºç«‹\n    }\n    @Override\n    protected void onDestroy() {\n        super.onDestroy();\n        presenter.detachView();  // è§£ç»‘ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼\n    }\n    // å®ç°IViewçš„æ–¹æ³•\n    @Override\n    public Context getContext() {\n        return this;\n    }\n}\n```\n\n\n\nâ€‹\tæˆ‘ä»¬æŸ¥çœ‹presenterå’Œviewæ–‡ä»¶å¤¹ä¹Ÿå‘ç°äº†è¿™ä¸ªä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼Œé™¤äº†æ¬¢è¿ç•Œé¢ï¼ˆå› ä¸ºæ²¡æœ‰äº¤äº’ï¼Œæ‰€ä»¥ä¸éœ€è¦ï¼‰ã€‚\n\n![image-20250621210554075](/pictures/novelReader_app/image-20250621210554075.png)\n\n\n\n### å…¶ä»–å­ç±»è®¾è®¡\n\nâ€‹\t`BaseApplication`åŸºç¡€ç±»ã€‚\n\nâ€‹\t`AppActivityManager`æ˜¯ä¸€ä¸ªâ€œActivityç®¡ç†å·¥å…·ç±»â€ï¼šè®°å½•ã€ç®¡ç†å½“å‰æ‰€æœ‰çš„Activityï¼Œèƒ½å…³é—­æŒ‡å®šçš„Activityã€èƒ½åˆ¤æ–­Activityæ˜¯å¦å­˜åœ¨ã€é€šè¿‡å¼±å¼•ç”¨é¿å…å†…å­˜æ³„éœ²ã€‚\n\nâ€‹\t`BaseActivity`æ˜¯â€œé€šç”¨Activityæ¨¡æ¿â€ï¼Œå®ƒå°è£…äº† Activity å¸¸ç”¨çš„åŠŸèƒ½ã€ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€å’Œ Presenter çš„ç»‘å®šé€»è¾‘ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯ï¼šæŠŠæ¯ä¸ªé¡µé¢éƒ½è¦é‡å¤å†™çš„ä»£ç ï¼ˆå¦‚å›ºå®šçš„æ–¹æ³•è°ƒç”¨ï¼ŒActivityè½¬åœºåŠ¨ç”»è°ƒç”¨ç­‰ç­‰ï¼‰ï¼Œç»Ÿä¸€å†™åœ¨è¿™ä¸ªâ€œçˆ¶ç±»â€é‡Œï¼Œå­ç±»åªéœ€è¦å…³æ³¨é¡µé¢è‡ªå·±çš„åŠŸèƒ½å®ç°ï¼Œçœæ—¶çœåŠ›ï¼\n\nâ€‹\t`MBaseActivity`æ˜¯ç»§ç»­æ·»åŠ å‹ç›Ÿç»Ÿè®¡çš„ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œèƒ½å¤Ÿç»Ÿè®¡ç”¨æˆ·çš„ä½¿ç”¨æƒ…å†µã€‚\n\nâ€‹\t\n\n\n\nâ€‹\tå†æŠ„ä¸‹`activity_welcome.xml`å¸ƒå±€æ–‡ä»¶ï¼Œåº”è¯¥å°±å¯ä»¥å±•ç¤ºç¬¬ä¸€ä¸ªç•Œé¢çš„æ•ˆæœäº†ã€‚\n","tags":["å®‰å“å¼€å‘å­¦ä¹ "],"categories":["å¼€å‘"]},{"title":"ISCTF2024","url":"/2025/06/05/ISCTF2024/RE/","content":"\n# Ezre\n\n> â€‹\tä¸€ä¸ªç®€å•çš„ç»´å‰å°¼äºšåŠ å¯†ï¼Œçœ‹äº†åŠå¤©æ²¡çœ‹å‡ºæ¥ï¼Œåœ¨å¼ºè¡Œå†™è§£å¯†ç®—æ³•åï¼Œæ‰çªç„¶å‘ç°ã€‚\n\n------\n\n\n\n# ã€Šå›å¿†å®‰é­‚æ›²ã€‹ä¸‰â€”â€”mainn.exe\n\n\n\n> â€‹\tè¿·å®«ç±»é¢˜ç›®ï¼Œæ— å£³64ä½ã€‚æ§½ç‚¹å°±æ˜¯å°†ç§»åŠ¨é”®æ¢æˆäº†â€œloveâ€å››ä¸ªå­—ç¬¦ï¼Œç„¶åè¿·å®«å¯¹åº”çš„å­—ç¬¦ä¸²åœ¨ç»“å°¾å¤šç»™äº†å‡ ä¸ªï¼Œèµ·åˆ°è¿·æƒ‘æ€§æ•ˆæœï¼Œå·®ç‚¹è®©æˆ‘æä¸æ¸…è¡Œåˆ—æ•°ï¼Œè¿˜æœ‰è¡Œåæ ‡ä»0å¼€å§‹ï¼Œåˆ—åæ ‡ä»0å¼€å§‹ï¼Œèµ·å§‹ç‚¹åæ ‡ï¼ˆ1ï¼Œ1ï¼‰ã€‚å¼€å§‹ç›´æ¥æŠŠæˆ‘ç»•æ™•ã€‚\n>\n> â€‹\tç¡®å®šè¿·å®«åï¼Œåˆå¤ä¹ äº†DFSç®—æ³•ã€‚æ”¶è·ä¸å°‘ã€‚\n\n```python\nmaze_str = \"\"\"###############################P#...............#...#.......#.#####.###.#####.#.###.#####.#.....#...#.#.....#...#.#...#.#####.#.###.#.#######.#.#.###.#C..#.#.#...#.#...#...#.#.#...#.#.#.#.#.###.#.#.#.###.#.#.#.#.#.#.#.#...#...#.#.......#.#.#.###.#.###.#####.#########.###.#...#...#.....#.#.......#...#.#.#####.#####.#.#.#####.###.#...#...#...#...#...#...#.#...#.###.#.###.#.#######.#.#.#.#.#...#.#.#...#.#...#...#...#.#.###.#.#.#####.#.#.#.#######.###.#...#.....#...#.#.#...#.....#.#########.#####.#.###.#.###.#.#.....#.#...#...#...#...#.#.#.#.#.#.#.###.#.#####.###.#.#.#...#.#...#.#...#...#...#...#.#.###.###.#.#####.#.###.###.#.#...#.#.#.......#.#...#.#...#.#####.#.#######.#.#####.#.###.#...#.#.......#.#...#...#.#..E#.#.#.#.#######.###.#.#####.#.#.#...#.............#.....#.#.#.###############.#######.#.#.#.........#...#...#.....#...#.#.#######.#.#.#####.#.#######.#.......#...#.......#.........\"\"\"\n\nfor i in range(30):\n    for j in range(30):\n        print(maze_str[i*30+j], end=' ')\n    print()\n\n\nmaze = []\nfor i in range(30):\n    maze_row = []\n    for j in range(30):\n        maze_row.append(maze_str[i*30+j])\n    maze.append(maze_row)\n\nstart = (1,1)\n\ndef dfs(maze, x, y,path):\n    if maze[x][y] == 'E':\n        return True\n    if x < 0 or x >= len(maze) or y < 0 or y >= len(maze[0]) or maze[x][y] == '#' or maze[x][y] == 'C':\n        return False\n\n    maze[x][y] = '#'\n\n    directions = [(-1,0), (0,-1), (1,0), (0,1)]\n    directions_str = ['l', 'v', 'o', 'e']\n    for i in range(4):\n        dx = directions[i][0]\n        dy = directions[i][1]\n        path.append(directions_str[i])\n        if dfs(maze, x+dx, y+dy,path):\n            return True\n        path.pop()\n\n    maze[x][y] = '.'\n    return False\n\ndef find_path():\n    path = []\n    if dfs(maze, start[0], start[1], path):\n        return path\n    else:\n        return \"No path found\"\n\nans = find_path()\nans = ''.join(ans)\nprint(ans)\n```\n\n------\n\n\n\n# **æ‰¾å•Šæ‰¾**â€”â€”zhao.exe\n\n> â€‹\tç›´æ¥æ‹–å…¥IDAå‘ç°åªæœ‰å¾ˆå°‘å‡ ä¸ªå‡½æ•°ï¼Œäºæ˜¯å»æŸ¥å£³å‘ç°UPXå£³ï¼Œç„¶åç›´æ¥-dè„±å£³å¤±è´¥ï¼Œæ‹–å…¥HxDå‘ç°æ ‡å¿—ä½è¢«æ”¹æˆAPKäº†ï¼Œæ”¹å›æ¥å°±æˆåŠŸè„±å£³äº†ã€‚\n>\n> â€‹\tå†æ‹–å…¥IDAä¸­å°±æ­£å¸¸äº†ï¼Œé€»è¾‘å¾ˆç®€å•ï¼ŒæŸ¥çœ‹åŠ å¯†é€»è¾‘ï¼Œå…ˆå¤§å°å†™å­—æ¯æ›¿æ¢ï¼Œå†å¼‚æˆ–ä¸€ä¸‹ã€‚é™æ€åˆ†ææ—¶ç›´æ¥å»æ•°æ®èŠ‚æŸ¥çœ‹æ—¶ï¼Œå¾—åˆ°ä¸€ç»„æ•°æ®ï¼Œç„¶åå†™pythonä»£ç ï¼Œè·‘å‡ºæ¥æç¤ºä¸ºé”™è¯¯çš„flagï¼Œæ˜¯å‡ºé¢˜äººæŒ–çš„ä¸€ä¸ªå‘ã€‚\n>\n> â€‹\tåå¤æŸ¥çœ‹åŠ å¯†é€»è¾‘å‘ç°æ²¡æœ‰é—®é¢˜ï¼Œæœ€ååŠ¨æ€è°ƒè¯•ï¼Œåœ¨æ¯”è¾ƒä¹‹å‰æŸ¥çœ‹æ•°æ®ï¼Œå‘ç°ç¨‹åºé‡Œå­˜å‚¨çš„åŠ å¯†æ•°æ®è¢«æ”¹äº†ï¼Œçœ‹æ¥æ˜¯ç¨‹åºåœ¨è¿è¡Œåˆå§‹åŒ–æ—¶æ‰ç»™å‡ºçœŸæ­£çš„åŠ å¯†flagã€‚å–å‡ºæ•°æ®ï¼Œè·‘è§£å¯†è„šæœ¬å°±okäº†ã€‚\n>\n> â€‹\tè¿˜æ˜¯åŠ¨è°ƒå‘ç°é—®é¢˜ã€‚\n\n------\n\n\n\n# pyä¸å¥½ï¼Œä¼šè¢«ban\n\n\n\n> â€‹\tpythonçš„exeç¨‹åºã€‚å…ˆä½¿ç”¨Pyinstxtractorè§£å‡ºpycï¼Œç„¶åç›´æ¥æ‰˜åœ¨çº¿å¹³å°è§£å‡ºpyã€‚æˆ‘å¼€å§‹æ‰¾çš„å¹³å°è§£ä¸å‡ºæ¥ï¼Œæˆ‘è¿˜åœ¨çŒœæ˜¯ä¸æ˜¯é¢˜ç›®åŠ éš¾åº¦äº†ï¼Œå¯¼è‡´æ–‡ä»¶è¿›è¡Œäº†ä¸€å®šçš„ä¿®æ”¹ï¼Œä¸èƒ½ç›´æ¥è§£å‡ºæ¥ã€‚åŸæ¥æ˜¯å·¥å…·ä¸è¡Œï¼æœ€åçœ‹wpæ‰å‘ç°è¿™ä¸ªç½‘ç«™ã€‚\n>\n> â€‹\tè§£å‡ºpyåç›´æ¥åå‘å†™è§£å¯†é€»è¾‘å³å¯è§£å¯†ã€‚\n\n\n\n------\n\n\n\n# ä½ çŸ¥é“.elfæ–‡ä»¶å—\n\n> â€‹\tè·‘ä¸èµ·æ¥ï¼Œç­¾åˆ°é¢˜ï¼Œæ²¡æœ‰æŠ€æœ¯å«é‡ï¼Œç®—äº†ã€‚\n\n\n\n------\n\n\n\n# ã€Šå›å¿†å®‰é­‚æ›²ã€‹äºŒâ€”â€”test11\n\n> â€‹\tä¸€ä¸ªELFæ–‡ä»¶ï¼Œä½¿ç”¨IDAè¿œç¨‹è°ƒè¯•ï¼Œæ”¶è·åˆ°äº†IDAè°ƒè¯•ELFç¨‹åºçš„æ–¹æ³•ï¼Œè¿›ä¸€æ­¥å¢åŠ äº†åŠ¨æ€è°ƒè¯•çš„ç»éªŒï¼Œè®¤è¯†åˆ°ä¸€ç§å¹²æ‰°ç¼–è¯‘çš„æ–¹æ³•ï¼Œå°±æ˜¯åœ¨è°ƒç”¨ç¨‹åºæ—¶ï¼Œä¸ç›´æ¥ä½¿ç”¨callï¼Œè€Œæ˜¯å°†å‡½æ•°é¦–åœ°å€åŠ è½½è¿›å¯„å­˜å™¨ï¼Œç„¶åä½¿ç”¨callå¯„å­˜å™¨è°ƒç”¨ï¼Œè¿™æ ·IDAåˆ†æä¸å‡ºæ¥ï¼Œåªæœ‰åŠ¨è°ƒèƒ½çœ‹åˆ°å…¶ä¸­çš„è·³è½¬é€»è¾‘ã€‚\n>\n> â€‹\tæŸ¥é˜…çŸ¥é“ï¼Œè¿™æ˜¯ä¸€ç§â€œæ§åˆ¶æµå¹³å¦åŒ–â€çš„åç¼–è¯‘æŠ€æœ¯ï¼Œé€šè¿‡ä¸»åˆ†å‘å™¨æ¥æ§åˆ¶ç¨‹åºåŸºæœ¬å—çš„æ‰§è¡Œæµç¨‹ã€‚\n>\n> â€‹\tå¾—çŸ¥flagé•¿åº¦ä¸º36ä½ï¼Œç„¶åencåŠ å¯†ï¼ŒåŠ¨æ€è°ƒè¯•åˆ†æåŠ å¯†é€»è¾‘ã€‚ç¡®å®šæ˜¯é€å­—èŠ‚åŠ å¯†ï¼Œå‡è®¾å½“å‰å­—ç¬¦ä¸‹æ ‡ä¸ºiï¼Œå­—ç¬¦ä¸²æ•°ç»„ä¸ºstrã€‚æœ‰ä¸ªå¯†é’¥keyä¸ºå­—ç¬¦ä¸²â€œi_can_reverse_but_i_can_not_have_youâ€œã€‚\n>\n> â€‹\tæœ€ç»ˆå¾—åˆ°çš„åŠ å¯†æ•°æ®ä¸ºï¼š[234, 12, 26, 17, 246, 44, 29, 62, 23, 53, 49, 41, 244, 57, 57, 211, 195, 45, 0, 16, 48, 61, 204, 0, 211, 192, 75, 198, 17, 199, 41, 62, 186, 96, 144, 52]\n>\n> - str[i] = str[i] ^ (0x66 + i) ^ 0x52\n>- str[i] = str[i] + 6\n> - str[i] = str[i] ^ (key[i] + i)\n\n```python\nenc = [234, 12, 26, 17, 246, 44, 29, 62, 23, 53, 49, 41, 244, 57, 57, 211, 195, 45, 0, 16, 48, 61, 204, 0, 211, 192, 75, 198, 17, 199, 41, 62, 186, 96, 144, 52]\nkey = 'i_can_reverse_but_i_can_not_have_you'\n\nfor i in range(len(enc)):\n    enc[i] = (enc[i] ^ (ord(key[i]) + i)) & 0xff\n    enc[i] = (enc[i] - 6) & 0xff\n    enc[i] = (enc[i] ^ 0x52 ^(0x66 + i)) & 0xff\n    print(chr(enc[i]), end='')\n    #ISCTF{as_her_never_will_come_back!!}\n```\n\n------\n\n\n\n# ã€Šå›å¿†å®‰é­‚æ›²ã€‹å››â€”â€”æ–‡ä»¶å¤¹ï¼šåˆè¯†é£ä»™å„¿\n\n> â€‹\tè§£å‹å¾—åˆ°ä¸€ä¸ªmain.pyå’Œsoæ–‡ä»¶ã€‚è¿™æ˜¯ä¸€ä¸ª`Cpython`é€†å‘é¢˜ï¼Œæˆ‘æ˜¯ç¬¬ä¸€æ¬¡é‡è§ï¼Œå…ˆè·Ÿç€WPå­¦ä¹ ï¼Œä½†æ˜¯ç¬¬ä¸€æ­¥é€šè¿‡pythonä¸­çš„`helpå‡½æ•°`æŸ¥çœ‹æ¨¡å—å°±å‡ºé—®é¢˜äº†ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Œå› ä¸ºå‡ ä¸ªè™šæ‹Ÿæœºçš„pythonç‰ˆæœ¬ä¸å¯¹ï¼Œéœ€è¦3.10çš„ï¼Œè€Œä¸”æœ¬æœºæ˜¯windowsç³»ç»Ÿï¼Œä¸€ç›´æ˜¯è¦ä¹ˆå¯¼å…¥é”™ç³»ç»Ÿtestæ¨¡å—ï¼Œè¦ä¹ˆå¯¼å…¥ä¸è¿›ï¼Œå”‰ï¼Œç¯å¢ƒæ„æ­»äººï¼ä¸‹è½½python3.10è¿˜æŠŠæˆ‘çš„ubuntu20.04ç»™å¹²å´©äº†ï¼Œè¢«æˆ‘ç›´æ¥åˆ äº†ã€‚**ä¹‹åå†å¹²è¿™ç§æ´»è¦æ‹å¿«ç…§äº†**ï¼æœ€ååœ¨ubuntu24.04ä¸­ä¸‹è½½å¥½äº†ï¼Œç„¶åå°±å¯¼å…¥è¿›å»äº†ã€‚çœŸçš„è¢«ç¯å¢ƒæŠ˜ç£¨æƒ¨äº†å•Šã€‚\n>\n> â€‹\tçœ‹äº†æ•™ç¨‹ï¼Œéƒ½æ˜¯ç¥ä»™ï¼Œæœ‰çš„ç›´æ¥çŒœå‡ºåŠ å¯†ç®—æ³•ï¼Œæœ‰çš„ä¸€ç‚¹ç‚¹æ­»çœ‹IDAä¸­çš„å‡ åƒè¡Œ`Cythonä»£ç `ï¼Œæœ‰çš„å‡­ç©ºç”Ÿæˆäº†soå¯¹åº”çš„pythonæºä»£ç ã€‚ä¸€ä¸ªéƒ½è¡Œä¸é€šï¼Œæœ€ååœ¨ç½‘ä¸Šæ‰¾äº†ä¸ªAIä»£ç è°ƒæ•´ï¼ŒæŠŠåŸæœ¬çš„å‡ åƒè¡Œ`Cython`ç»™ä¼˜åŒ–äº†ï¼Œå‡ºäº†ä¸€ä¸ªç®€åŒ–çš„Cè¯­è¨€ç‰ˆï¼Œå¹¶ä¸”æ•´ç†å‡ºäº†æ ¸å¿ƒé€»è¾‘ï¼Œäºæ˜¯æˆ‘ç›´æ¥çœ‹æ ¸å¿ƒåŠ å¯†é€»è¾‘ï¼Œå¾ˆæ¸…æ™°ï¼Œç„¶åå†™è§£å¯†å°±å‡ºäº†ã€‚\n\n```python\nhack_data = [27, 16, 43, 29, 127, 46, 51, 102, 50, 1, 112, 50, 53, 101, 57, 1] \nkey = 'H1m' sbox = [1, 14, 4, 13, 10, 2, 5, 8, 7, 6, 9, 12, 15, 3, 11, 0]  \nflag_list = [0] * 16  \nfor i in range(len(sbox)):\n    tmp = hack_data[i] ^ ord(key[i % len(key)])\n    flag_list[sbox[i]] = tmp\nfor i in range(len(flag_list)):\n    print(chr(flag_list[i]), end='')\n```\n\n------\n\n\n\n# MIPS\n\n> â€‹\tä¸€ç§æ–°çš„æŒ‡ä»¤é›†ï¼Œå¯¹åº”çš„æ±‡ç¼–è¯­è¨€ä¹Ÿä¸ä¸€æ ·ï¼Œéœ€è¦é‡æ–°å­¦ä¹ ã€‚\n\nâ€‹\tå•ç‹¬å‡ºä¸€ä¸ªwpæ¥è®°å½•å­¦ä¹ è¿‡ç¨‹ä¸­å¾—åˆ°çš„çŸ¥è¯†ã€‚\n\n------\n\n\n\n\n\n# æ¡€æ¡€æ¡€\n\n> â€‹\t`rep stosdæ˜¯ä¸€æ¡é«˜æ•ˆçš„å­—ç¬¦ä¸²æ“ä½œæŒ‡ä»¤ï¼Œé€‚ç”¨äºå¿«é€Ÿåˆå§‹åŒ–æˆ–å¡«å……å†…å­˜åŒºåŸŸï¼Œediä¿å­˜å¡«å……åœ°å€ï¼Œecxä¿å­˜å¡«å……æ¬¡æ•°ï¼Œeaxä¿å­˜å•æ¬¡å¡«å……å€¼ã€‚`\n>\n> â€‹\tè¿™ä¸€é¢˜å¾ˆæœ‰æ„æ€å•Šï¼Œæœ‰èŠ±æŒ‡ä»¤ã€TLSã€ä¼ªéšæœºæ•°å’Œé­”æ”¹teaï¼Œæœ‰å¾ˆå¤šå¯å­¦çš„ç‚¹ï¼Œåœ¨åšé¢˜çš„æ—¶å€™ï¼Œç”±äºå¯¹èŠ±æŒ‡ä»¤çš„ä¸å¤Ÿå…¨é¢çš„äº†è§£ï¼Œå’Œå¯¹TLSçš„ä¸å…¨é¢äº†è§£ï¼Œå¯¼è‡´æˆ‘ä¸€ç›´å›°åœ¨å¯¹éæ ¸å¿ƒéƒ¨åˆ†çš„æ¢ç´¢å­¦ä¹ ä¸­ï¼Œå§‹ç»ˆæœªèƒ½æŠ“ä½ä¸»è¦é€»è¾‘ï¼Œæœ€åå¯¼è‡´èº«å¿ƒç–²æƒ«ã€‚\n>\n> â€‹\täºæ˜¯å†³å®šå‚ç…§WPå’Œç½‘ä¸Šçš„èµ„æ–™ï¼Œå¥½å¥½æ¶è¡¥ä¸€ä¸‹è¿™äº›æ–¹é¢çš„çŸ¥è¯†ï¼Œå¹¶ä¸”è®°å½•ä¸‹æ¥ã€‚\n\n```python\nfor i in range(0x4119E2, 0x4119E7):\t\t#IDAçš„patchè„šæœ¬ï¼Œè®°ä½ä½¿ç”¨åˆ°çš„å‡½æ•°åå°±å¥½ã€‚\n    idc.patch_byte(i, 0x90)\n```\n\nä¸“é—¨å‡ºä¸€ä¸ªWPï¼Œè®°å½•ä¸€ä¸‹è¿™äº›éš¾é¢˜ã€‚\n\n------\n\n\n\n# å˜¿å˜¿å˜¿\n\nâ€‹\tæ— å£³ï¼ŒéªŒè¯é•¿åº¦32ä½ï¼Œç„¶åè¿›å…¥140001850ï¼Œæœ‰SMCä¿æŠ¤æŠ€æœ¯ï¼Œæˆ‘ä»¬ä¿®æ”¹æ ‡å¿—ä½ç»•è¿‡åè°ƒè¯•ï¼Œ\n\n![image-20250521110206759](/pictures/ISCTF2024/image-20250521110206759.png)\n\n![image-20250521110250703](/pictures/ISCTF2024/image-20250521110250703.png)\n\nâ€‹\tè¿™é‡Œä¹Ÿæ²¡æœ‰è°ƒç”¨ï¼Œæˆ‘ä»¬å…ˆä¸ç”¨ç®¡140001A0å‡½æ•°ï¼Œç»§ç»­å»mainå‡½æ•°ä¸­çœ‹ç¨‹åºé€»è¾‘ã€‚çœ‹åˆ°1400017B0å‡½æ•°ï¼Œé©¬ä¸Šå°±è°ƒç”¨äº†è§£å¯†å‡ºçš„å‡½æ•°ï¼Œå‚æ•°åˆ†åˆ«æ˜¯å­—ç¬¦ä¸²\"Welcome_to_ISCTF\"ï¼Œè¿˜æœ‰ä¸¤ä¸ªç©ºæ•°ç»„ã€‚\n\n![image-20250521110613803](/pictures/ISCTF2024/image-20250521110613803.png)\n\nâ€‹\tå…ˆçœ‹140001440ï¼Œå¯¹å­—ç¬¦ä¸²è¿›è¡Œå¼‚æˆ–ï¼Œå­˜å‚¨åˆ°a2ä¸­ï¼Œ140003270æ•°æ®å¯ä»¥ç›´æ¥çœ‹åˆ°ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨IDAä¸­æ•°æ®ä»¥å°ç«¯ä¿å­˜ï¼Œå°½ç®¡å­—ç¬¦ä¸²æ˜¾ç¤ºçš„é¡ºåºæ˜¯â€œWelcome_to_ISCTFâ€ï¼Œä½†åœ¨æ ˆå¸§ä¸­ä¿å­˜çš„é¡ºåºå…¶å®æ˜¯cleW......ï¼Œéœ€è¦æ¯4ä¸ªå­—èŠ‚é€†åºï¼Œè¿™æ ·æ‰æ˜¯a1[i]çš„å€¼ã€‚\n\n![image-20250521110827346](/pictures/ISCTF2024/image-20250521110827346.png)\n\n![image-20250521110918291](/pictures/ISCTF2024/image-20250521110918291.png)\n\nâ€‹\tæ¥ç€è¿›å…¥1400014A0å‡½æ•°ï¼Œa1æ˜¯ç©ºæ•°ç»„ï¼Œa2æ˜¯æ‰åŠ å¯†çš„ä¸­é—´å¯†é’¥çš„æŒ‡é’ˆã€‚å¦‚æœåªæ˜¯å‡ºflagçš„è¯ï¼Œè¿™é‡Œæ²¡æœ‰å¿…è¦æ·±å…¥åˆ†æäº†ï¼Œç›´æ¥å–æœ€ç»ˆå¯†é’¥å°±è¡Œäº†ã€‚\n\n![image-20250521104520689](/pictures/ISCTF2024/image-20250521104520689.png)\n\nâ€‹\tå›åˆ°ä¸»å‡½æ•°ï¼Œ1400017B0å‡½æ•°æ‰æ˜¯åŠ å¯†çš„åœ°æ–¹ï¼Œç»§ç»­çœ‹140001630ï¼Œç”±äºæ˜¯å¯¹æ˜æ–‡è¿›è¡Œäº†åˆ†å—çš„ï¼Œåˆ†æˆ2ä¸ª16å­—èŠ‚åŠ å¯†çš„ã€‚\n\n![image-20250521113825145](/pictures/ISCTF2024/image-20250521113825145.png)\n\nâ€‹\té‡Œé¢ä¸¤ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªåŠ å¯†ï¼Œä¸€ä¸ªé€†åºå¤åˆ¶ã€‚\n\n![image-20250521112328705](/pictures/ISCTF2024/image-20250521112328705.png)\n\nâ€‹\tåŠ å¯†ä»¥4å­—èŠ‚ä¸ºä¸€ä¸ªå•ä½ï¼Œå°†16å­—èŠ‚åˆ†ä¸º4ä¸ªå…ƒç´ ï¼ŒåŠ å¯†32è½®ï¼Œæ•´ä½“åŠ å¯†32/4=8è½®ã€‚åŠ å¯†æ–¹å¼å°±æ˜¯å¼‚æˆ–1400013F0çš„è¿”å›å€¼ã€‚\n\n![image-20250521112403260](/pictures/ISCTF2024/image-20250521112403260.png)\n\nâ€‹\t\ta2ç¡®å®šæ˜¯1ã€‚a1æ˜¯é‚£ç¾¤å¼‚æˆ–å¾—åˆ°çš„å€¼ã€‚\n\n![image-20250521113204681](/pictures/ISCTF2024/image-20250521113204681.png)\n\nâ€‹\tè¿™é‡Œæœ‰ä¸€ä¸ªæ˜ å°„è¡¨ï¼Œ256å­—èŠ‚ã€‚\n\n![image-20250521113218351](/pictures/ISCTF2024/image-20250521113218351.png)\n\nâ€‹\tæ˜ å°„åçš„å€¼ä¸ºa1.\n\n![image-20250521113233640](/pictures/ISCTF2024/image-20250521113233640.png)\n\nâ€‹\tè¿™é‡Œå…¶å®æ˜¯ä¸€ç§æ‰©å±•çš„å·¦ç§»å¹¶è®°å½•æº¢å‡ºä½çš„æ“ä½œã€‚\n\n![image-20250521113401853](/pictures/ISCTF2024/image-20250521113401853.png)\n\nå†çœ‹è¿™ä¸ªå‡½æ•°ï¼Œä»¥4å­—èŠ‚ä¸ºæ•´ä½“è¿›è¡Œé€†åºï¼Œå› ä¸ºæ¯æ¬¡åŠ å¯†åªæœ‰16å­—èŠ‚å‚ä¸ï¼Œæ‰€ä»¥åªéœ€è¦ç§»åŠ¨4æ¬¡ã€‚\n\n![image-20250521113539461](/pictures/ISCTF2024/image-20250521113539461.png)\n\nçœ‹å›ä¸»å‡½æ•°ï¼Œé€šè¿‡è°ƒè¯•ç¡®å®šï¼Œæ¯”å¯¹çš„æ—¶å€™å¯†æ–‡ç«¯åºä¸å˜ï¼Œè§£å¯†è„šæœ¬ä¸­å°±ç›´æ¥ä½¿ç”¨æ•°æ®ã€‚\n\n![image-20250521113646251](/pictures/ISCTF2024/image-20250521113646251.png)\n\næœ€åå®Œå…¨ä¸çœ‹WPï¼Œè‡ªå·±å†™å‡ºæ¥äº†ï¼ŒExpå¦‚ä¸‹ã€‚èŠ±äº†4ä¸ªå°æ—¶å§ã€‚\n\n```c\n#include <stdio.h>\n#include <stdlib.h> \n#include <stdint.h>\n\n//å¯†é’¥åœ¨åŠ¨è°ƒçš„æ—¶å€™å–å‡ºå°±è¡Œäº†ã€‚\nuint8_t key[128] = {64, 219, 65, 24, 40, 193, 230, 145, 203, 169, 18, 125, 170, 192, 199, 159, 157, 38, 46, 6, 157, 90, 123, 166, 146, 16, 175, 171, 169, 249, 251, 160, 135, 168, 171, 240, 25, 222, 93, 91, 231, 26, 172, 17, 30, 69, 73, 82, 201, 42, 246, 134, 66, 49, 108, 95, 150, 236, 129, 102, 94, 24, 255, 27, 69, 188, 182, 179, 250, 225, 54, 233, 113, 90, 12, 164, 92, 131, 61, 232, 59, 85, 99, 174, 230, 155, 235, 1, 32, 36, 55, 178, 65, 89, 177, 99, 76, 98, 54, 100, 188, 139, 221, 165, 68, 157, 191, 115, 242, 75, 56, 38, 65, 13, 123, 99, 220, 204, 61, 124, 51, 252, 15, 10, 176, 107, 255, 109};\n\n\n//å–å‡ºå°±è¡Œäº†ã€‚\nuint8_t map[256] = {214, 144, 233, 254, 204, 225, 61, 183, 22, 182, 20, 194, 40, 251, 44, 5, 43, 103, 154, 118, 42, 190, 4, 195, 170, 68, 19, 38, 73, 134, 6, 153, 156, 66, 80, 244, 145, 239, 152, 122, 51, 84, 11, 67, 237, 207, 172, 98, 228, 179, 28, 169, 201, 8, 232, 149, 128, 223, 148, 250, 117, 143, 63, 166, 71, 7, 167, 252, 243, 115, 23, 186, 131, 89, 60, 25, 230, 133, 79, 168, 104, 107, 129, 178, 113, 100, 218, 139, 248, 235, 15, 75, 112, 86, 157, 53, 30, 36, 14, 94, 99, 88, 209, 162, 37, 34, 124, 59, 1, 33, 120, 135, 212, 0, 70, 87, 159, 211, 39, 82, 76, 54, 2, 231, 160, 196, 200, 158, 234, 191, 138, 210, 64, 199, 56, 181, 163, 247, 242, 206, 249, 97, 21, 161, 224, 174, 93, 164, 155, 52, 26, 85, 173, 147, 50, 48, 245, 140, 177, 227, 29, 246, 226, 46, 130, 102, 202, 96, 192, 41, 35, 171, 13, 83, 78, 111, 213, 219, 55, 69, 222, 253, 142, 47, 3, 255, 106, 114, 109, 108, 91, 81, 141, 27, 175, 146, 187, 221, 188, 127, 17, 217, 92, 65, 31, 16, 90, 216, 10, 193, 49, 136, 165, 205, 123, 189, 45, 116, 208, 18, 184, 229, 180, 176, 137, 105, 151, 74, 12, 150, 119, 126, 101, 185, 241, 9, 197, 110, 198, 132, 24, 240, 125, 236, 58, 220, 77, 32, 121, 238, 95, 62, 215, 203, 57, 72};\n\n\nuint32_t sub_1400012F0(uint32_t a1, int16_t a2){\n    for(int16_t i=0;i<a2;i++){\n        a1 = a1 / 0x80000000 + 2 * a1;\n    }\n    return a1;\n}\n\nuint32_t sub_140001340(uint32_t a1){\n    return sub_1400012F0(a1,24) ^ sub_1400012F0(a1, 18) ^ sub_1400012F0(a1, 10) ^ sub_1400012F0(a1, 2) ^ a1;\n}\n\n//å®Œå…¨ç…§æŠ„åŠ å¯†æ—¶çš„é€»è¾‘å°±è¡Œï¼Œè¿™é‡Œæ˜¯æ±‚å¼‚æˆ–å€¼çš„åœ°æ–¹ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯è¦æ‰¾å‡ºä¸€æ ·çš„å¼‚æˆ–å€¼ï¼Œæ‰€ä»¥è¦å’ŒåŠ å¯†æ—¶çš„é€»è¾‘ä¸€æ ·ã€‚\nuint32_t get_xor(uint32_t seed){\n    uint32_t t = map[(uint8_t)seed] + (map[(uint8_t)(seed>>8)] << 8) + (map[(uint8_t)(seed>>16)] << 16) + (map[(uint8_t)(seed>>24)] << 24);\n    return sub_140001340(t);\n\n}\n\n\n//ä»¿ç…§åŠ å¯†è¿‡ç¨‹ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªå¼‚æˆ–æ“ä½œï¼Œåªæ˜¯è¿™ä¸ªå¼‚æˆ–çš„å¯†é’¥ç»è¿‡å¤æ‚çš„è¿ç®—å¾—å‡ºçš„\nvoid  decrypt(uint32_t *enc, uint8_t *key){\n    uint32_t *k = (uint32_t*)key;\n    for(int i=31;i>=0;i--){\n        enc[i%4] ^= get_xor(k[i] ^ enc[(i+3)%4] ^ enc[(i+2)%4] ^ enc[(i+1)%4]);\n    }\n}\n\n\nint main(){\n    \n    //å¯†æ–‡æœ€å¥½æ˜¯è°ƒè¯•çš„æ—¶å€™çœ‹ï¼Œæ–­ç‚¹ä¸‹åœ¨æ¯”è¾ƒçš„åœ°æ–¹ã€‚\n    uint32_t enc[] = \t\t\t\t{0xA8F44759,0xCDB824F2,0x32FB3C01,0x42BEFFE1,0x3EC30B40,0xE094AA46,0x2AEA2B,0x362C0888};\n    uint32_t enc1[8];\n    \n    \n    for(int i=0;i<8;i++){\n        int j = i % 4;\n        enc1[i] = enc[(i/4)*4 + (3-j)];\n    }\n\n    for(int i=0;i<2;i++){\n        decrypt(enc1+i*4,key);\n    }\n\n    for(int i=0;i<8;i++){\t\t\t\t\t//è¿™é‡Œå¼€å§‹æ˜¯åçš„ï¼Œè¿˜æé”™äº†ã€‚å­—ç¬¦ä¸²çš„å¤§å°ç«¯æ€»æ˜¯è®©æˆ‘æ‘¸ä¸ç€å¤´è„‘ã€‚\n        printf(\"%c\",enc1[i]&0xFF);\n        printf(\"%c\",enc1[i]>>8&0xFF);\n        printf(\"%c\",enc1[i]>>16&0xFF);\n        printf(\"%c\",enc1[i]>>24&0xFF);\n    }\n\n    return 0;\n}\n```\n\n------\n\n# èåœå­çš„èƒèŸ¹\n\nâ€‹\t\tRUSTè¯­è¨€ç¨‹åºï¼Œå¯ä»¥ä½¿ç”¨IDAåç¼–è¯‘æ‰“å¼€ï¼Œéš¾ç‚¹å°±æ˜¯åç¼–è¯‘ä»£ç å¾ˆéš¾çœ‹ï¼Œéœ€è¦é…åˆåŠ¨è°ƒç¡®å®šç¨‹åºçš„è¿è¡Œé€»è¾‘ã€‚æœ‰ç‚¹ç´¯äº†ï¼Œæ”¹å¤©å†å†™ã€‚\n\nâ€‹\tåŠ¨è°ƒè¿˜æ˜¯ç»éªŒå¤ªå°‘äº†ï¼Œè¶æ­¤æœºä¼šï¼Œå¥½å¥½ç…§ç€WPå­¦ä¹ ä¸€ä¸‹åŠ¨è°ƒçš„ç»éªŒã€‚ä¸‹é¢åªæ€»ç»“äº†æ”¶è·çš„ç»éªŒï¼Œå®Œæ•´WPéƒ½æœ‰ã€‚\n\n\n\n- #### é€šè¿‡æç¤ºå­—ç¬¦ä¸²çš„äº¤å‰å¼•ç”¨æ‰¾åˆ°ç¨‹åºçš„ä¸»è¦é€»è¾‘å‡½æ•°ã€‚\n\n- #### çœ‹åˆ°å¦‚ä¸‹å›¾æ‰€ç¤ºçš„è¿™ç§ä¹±ä¸ƒå…«ç³Ÿçš„å‡½æ•°åï¼Œçœ‹åˆ°å¦‚æ­¤éš¾ä»¥è¯»æ‡‚çš„ä¼ªä»£ç ï¼Œå…ˆå•æ­¥è°ƒè¯•æ‰¾åˆ°inputå‡½æ•°ã€‚å¹¶ä¸”ï¼Œæ ¹æ®inputå‡½æ•°ä¸­çš„å‚æ•°å€¼ï¼Œæ‰¾åˆ°å­˜å‚¨è¾“å…¥flagçš„åœ°å€ã€‚å‚æ•°æ˜¯æŒ‡é’ˆï¼Œè¦é€šè¿‡Gé”®è·³è½¬åˆ°å¯¹åº”çš„å†…å­˜åœ°å€å¤„æŸ¥çœ‹ã€‚\n\n![image-20250522122253781](/pictures/ISCTF2024/image-20250522122253781.png)\n\n- #### æ‰¾åˆ°INPUTä¹‹åï¼Œå†é…Œæƒ…åˆ†æç¨‹åºè¿˜æœ‰å“ªäº›é‡è¦éƒ¨åˆ†ã€‚ç„¶åå¿½ç•¥å…¶ä»–æ“ä½œï¼Œé™¤å¼€ä¸è¾“å…¥flagç›¸å…³çš„éƒ¨åˆ†ï¼Œå…¶ä»–éƒ½å¯ä»¥ä¸ç®¡ï¼Œéœ€è¦ä»€ä¹ˆå¯ä»¥é åŠ¨è°ƒç›´æ¥è¯»å–å€¼ã€‚\n\n- #### çœ‹åˆ°é•¿åº¦æ¯”è¾ƒå’Œèµ‹å€¼éƒ¨åˆ†ï¼Œè¿™ä¸€å¤§å †æ•°æ®å¾ˆå¯èƒ½å°±æ˜¯å¯†æ–‡ï¼Œä½†æ˜¯ä¸èƒ½ç€æ€¥ï¼Œå¯†æ–‡ä¹Ÿæ˜¯å¯ä»¥åšå¤„ç†çš„ï¼Œä¸åˆ°æœ€åæ¯”å¯¹çš„æ—¶å€™éƒ½ä¸è¦å®Œå…¨ç¡®å®šå¯†æ–‡ã€‚\n\n![image-20250522122710905](/pictures/ISCTF2024/image-20250522122710905.png)\n\n- #### çœ‹åˆ°ä¸‹é¢å‰ä¸¤ä¸ªå‡½æ•°éƒ½æ˜¯å¯¹å¯†æ–‡è¿›è¡Œæ“ä½œï¼Œv35->v40->v36ï¼Œä¸ç”¨ç®¡ã€‚æˆ‘ä»¬åªéœ€è¦é”å®šä½æˆ‘ä»¬çš„è¾“å…¥å³å¯ï¼Œv29å°±æ˜¯è¾“å…¥å­—ç¬¦ä¸²çš„æŒ‡é’ˆï¼Œæˆ‘ä»¬çœ‹åˆ°v29åªåœ¨405F80å‚æ•°å¤„å‡ºç°äº†ï¼Œè€Œä¸”ä¸‹é¢å°±æ˜¯æ¯”å¯¹äº†ã€‚æ‰€ä»¥è¯¥é¢˜åº”è¯¥åªåœ¨è¿™ä¸ªå‡½æ•°é‡Œé¢è¿›è¡Œäº†å¤„ç†ã€‚\n\n![image-20250522122830052](/pictures/ISCTF2024/image-20250522122830052.png)\n\n- #### ä¸‹é¢çš„æ¯”å¯¹æ“ä½œï¼Œéœ€è¦ç®€å•è·Ÿè¸ªå˜é‡å€¼ç¡®å®šå˜é‡ä»£è¡¨çš„å«ä¹‰ï¼Œåœ¨è¿›å…¥406AA0æ—¶ä¸‹æ–­ç‚¹å–å‡ºå¯†æ–‡å€¼å³å¯ã€‚\n\n![image-20250522123228352](/pictures/ISCTF2024/image-20250522123228352.png)\n\n- #### é‡ç‚¹æ˜¯æ€ä¹ˆçŸ¥é“å¯¹è¾“å…¥çš„æ“ä½œæ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Œåœ¨ä¸Šé¢çš„v29å¤„æ‰¾åˆ°è¾“å…¥çš„flagï¼Œæ‰“ä¸‹å†…å­˜æ–­ç‚¹ï¼Œè¿™æ ·æ¯å½“ç¨‹åºå»è®¿é—®è¿™ä¸ªåœ°å€æ—¶å°±ä¼šè§¦å‘æ–­ç‚¹ï¼Œåˆ†åˆ«æˆ‘ä»¬åˆ†æç¨‹åºå¯¹flagåšäº†ä»€ä¹ˆå¤„ç†ã€‚å…·ä½“æ“ä½œå°±æ˜¯åœ¨æ•°æ®å¤´æ‘ä¸‹F2ä¸‹æ–­ç‚¹ï¼Œç„¶åå¡«ä¸‹æ•°æ®é•¿åº¦å°±è¡Œã€‚\n\n![image-20250522123655696](/pictures/ISCTF2024/image-20250522123655696.png)\n\n- #### ä¹‹åå°±å¯ä»¥çœ‹æƒ…å†µF9ç­–é©¬å¥”è…¾äº†ï¼Œæ³¨æ„ntdllæœ‰æ—¶å€™å›è®¿é—®è¿™ä¸ªå†…å­˜åœ°å€çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹æ–­ç‚¹è¡¨ï¼Œéšæ—¶å¼€å¯æˆ–å…³é—­æ–­ç‚¹ï¼Œè®°å¾—é…åˆç¨‹åºæ–­ç‚¹ï¼Œå…³é—­å†…å­˜æ–­ç‚¹ï¼Œç›´æ¥F9æ¥è·³è¿‡ntdllçš„è®¿é—®ï¼Œæˆ‘ä»¬åªå…³å¿ƒä¸»è¦é€»è¾‘å¯¹è¯¥åœ°å€çš„è®¿é—®ã€‚è·³å‡ºntdllåï¼Œå†å¼€å¯å†…å­˜æ–­ç‚¹ã€‚\n\n![image-20250522123845878](/pictures/ISCTF2024/image-20250522123845878.png)\n\n![image-20250522123934610](/pictures/ISCTF2024/image-20250522123934610.png)\n\n\n\nâ€‹\tæœ€åå¤ç°WPï¼Œè‡ªå·±æ‰‹åŠ¨æ‰¾åˆ°æ•°æ®ï¼Œè§£å¯†æˆåŠŸã€‚\n\nâ€‹\té€šè¿‡æœ¬é¢˜ï¼Œæˆ‘å­¦ä¹ åˆ°äº†å†…å­˜æ–­ç‚¹æ‰¾åŠ å¯†æ“ä½œçš„æ–¹æ³•ï¼Œå‘ç°äº†é€šè¿‡Gé”®è¿›è¡Œå†…å­˜è·³è½¬çš„åŠŸèƒ½ã€‚\n\n```python\ndata = \"A\" * 52\nenc_data = [105, 170, 63, 98, 219, 177, 5, 252, 176, 134, 189, 146, 177, 222, 70, 219, 183, 31, 150, 151, 6, 229, 101, 231, 47, 223, 159, 159, 159, 228, 116, 102, 218, 205, 139, 51, 99, 178, 172, 136, 66, 138, 47, 12, 150, 246, 201, 34, 207, 27, 86, 152]\n\nxor_key = []\nfor i in range(52):\n    xor_key.append(enc_data[i] ^ ord(data[i]))\n\n\nenc_flag =[97, 184, 61, 119, 220, 139, 54, 200, 130, 179, 163, 226, 196, 192, 106, 255, 155, 110, 165, 175, 20, 197, 66, 195, 49, 242, 191, 144, 185, 250, 19, 1, 196, 245, 165, 7, 125, 179, 159, 172, 92, 140, 94, 34, 179, 232, 200, 60, 220, 57, 35, 164]\nflag = \"\"\n\nfor i in range(52):\n    flag += chr(enc_flag[i] ^ xor_key[i])\n\nprint(flag)\n```\n","tags":["å¤ç°WP","Reverse"],"categories":["CTF"]},{"title":"BaseCTF2024","url":"/2025/06/04/BaseCTF/BaseCTF2024_RE/","content":"\n\n\n------\n\n> **UPX mimiï¼š**\n>\n> â€‹\tåˆæ­¥æ¥è§¦åˆ°äº†UPXåŠ å£³ä¿æŠ¤çš„çŸ¥è¯†å’Œå¯¹åº”çš„è„±å£³å·¥å…·ï¼Œè¿™æ˜¯ä¸€ç§â€œå‹ç¼©â€ä¿æŠ¤å£³ï¼Œå³å°†æºç¨‹åºä»£ç è¿›è¡Œå‹ç¼©ï¼Œç„¶åé…ä¸Šè§£å‹ç¼©ä»£ç ï¼Œç»„æˆæ–°çš„ç¨‹åºï¼Œå³â€œUPXè§£å‹ä»£ç â€+â€œå‹ç¼©çš„æºæ–‡ä»¶â€ã€‚åœ¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œä¼šå…ˆæ‰§è¡ŒUPXçš„è§£å‹ä»£ç ï¼Œå¾—åˆ°è§£å‹åçš„æºæ–‡ä»¶ï¼Œç„¶åå°†æ§åˆ¶æµè½¬ç§»åˆ°æºæ–‡ä»¶ã€‚\n\n> **ez_maze:**\n>\n> â€‹\tæœ€åŸºç¡€çš„è¿·å®«é¢˜ç›®ï¼Œä»IDAä¸­å¯ä»¥ç›´æ¥çœ‹åˆ°è¿·å®«ï¼Œäººå·¥å°±èƒ½å¾—åˆ°è·¯å¾„ã€‚\n\n> **BasePlus:**\n>\n> â€‹\tæ— ä¿æŠ¤ï¼Œç›´æ¥æ‹–å…¥IDAï¼Œè€ƒå¯ŸåŸºç¡€çš„é˜…è¯»ä»£ç çš„èƒ½åŠ›ï¼ŒåŠ å¯†å‡½æ•°ä¸ºBase64çš„ä¸€ç‚¹ç‚¹å˜åŒ–ï¼Œå¯¹Base64åŠ å¯†åç»§ç»­å¼‚æˆ–ä¸€ä¸‹ã€‚å¾ˆåŸºç¡€ã€‚ç¬¬ä¸€æ¬¡è®¤çœŸæ“Base64çš„cè¯­è¨€ä»£ç ï¼Œæ”¶è·ä¸å°‘ã€‚\n\n> **Ez_Xor:**\n>\n> â€‹\tå¤ä¹ äº†å¤§å°ç«¯åºçš„çŸ¥è¯†ã€‚\n>\n> â€‹\tâ€œå°ç«¯åºâ€ï¼šä½ä½æœ‰æ•ˆå­—èŠ‚ä¿å­˜åœ¨å°åœ°å€ã€‚å¦‚0xDEADBEEFåœ¨å†…å­˜ä¸­çš„é¡ºåºæ˜¯ï¼ˆå°åœ°å€ï¼‰EF BE AD DEï¼ˆå¤§åœ°å€ï¼‰ã€‚â€œå¤§ç«¯åºâ€ç›¸åã€‚\n>\n> â€‹\tæœ¬é¢˜å°±æ˜¯ç®€å•çš„æµåŠ å¯†ï¼Œç”Ÿæˆå¯†é’¥æµç„¶ååŠ å¯†ã€‚å¯¹åº”è§£å¯†å³å¯ã€‚\n\n> **UPX:**\n>\n> â€‹\tæœ‰å£³ï¼Œç›´æ¥è„±å£³æŠ¥é”™ã€‚å­¦ä¹ åˆ°äº†ï¼Œæ”¹æ ‡å¿—ä½æ¥ä¿æŠ¤åŠ å£³ç¨‹åºçš„æ‰‹æ®µï¼Œæˆ‘ä»¬çš„ååˆ¶æ“ä½œå°±æ˜¯æ‰“å¼€æ–‡ä»¶ï¼Œå°†å¯¹åº”çš„æ ‡å¿—ä½ä»å°å†™æ”¹å›å¤§å†™ã€‚ä¹‹åå°±å¯ä»¥æ­£å¸¸è„±å£³äº†ã€‚\n>\n> â€‹\tæ‹–å…¥IDAåï¼Œè€ƒå¯Ÿçš„æ˜¯æ¢è¡¨çš„Base64ã€‚å”¯ä¸€éœ€è¦æ³¨æ„çš„ç‚¹å°±æ˜¯å› ä¸ºé¢˜ç›®æºç æ˜¯Cè¯­è¨€ï¼Œåœ¨IDAå­—ç¬¦ä¸²æ˜¾ç¤ºä¸­ç»™åŒå¼•å·å…¨é¢åŠ äº†è½¬ä¹‰ç¬¦å·çš„ï¼Œä¸è¦æé”™äº†ã€‚\n\n![image-20250425170632940](/pictures/BaseCTF2024/image-20250425170632940.png)\n\n> **lk:**\n>\n> â€‹\tæ¯”è¾ƒå¤§çš„çº¿æ€§æ–¹ç¨‹ç»„ï¼Œè€ƒå¯Ÿpythonçš„z3solveråº“ä½¿ç”¨ã€‚\n\n> **å–æ¯ä¸‹åˆèŒ¶ï¼š**\n>\n> â€‹\tæ ‡å‡†çš„TeaåŠ å¯†ï¼Œç¬¬ä¸€æ¬¡ä½¿ç”¨Cè¯­è¨€å®ç°äº†è¯¥ç®—æ³•ï¼Œæ”¶è·ä¸å°‘ã€‚\n\n> **Ezpy:**\n>\n> â€‹\tè€ƒå¯Ÿpythonæ‰“åŒ…å‡ºçš„EXEç¨‹åºã€‚åç¼–è¯‘å‡ºæºç ã€‚\n>\n> â€‹\tå†è€ƒå¯ŸRC4åŠ å¯†ã€‚\n\n> **æœ€ç®€å•çš„ç¼–ç ï¼š**\n>\n> â€‹\tæ— ä¿æŠ¤æŠ€æœ¯ï¼Œçº¯è€ƒéªŒä¼ªä»£ç çš„é˜…è¯»æ°´å¹³ï¼Œè€ä¸‹å¿ƒæ¥åˆ†æå°±å¥½äº†ã€‚\n\n> **neuroçˆ±æ•°å­¦ï¼š**\n>\n> â€‹\t\n\n> **RivestCipher:**\n>\n> â€‹\tè€ƒå¯Ÿæ ‡å‡†RC4åŠ å¯†ç®—æ³•ã€‚\n\n> **ezAndroid:**\n>\n> â€‹\tæ”¶è·åˆ°äº†é€†å‘apkå®‰è£…åŒ…çš„è½¯ä»¶jadxï¼Œæ¥è§¦åˆ°äº†soæ–‡ä»¶ï¼ˆå…±äº«åº“ï¼‰é€†å‘ï¼Œæ˜¯ä¸€äº›æ²¡æœ‰æ¥è§¦è¿‡çš„æ“ä½œã€‚åˆè¦è¯»å¥‡æ€ªçš„ä»£ç ã€‚å”‰ï¼\n\n------\n\n# **UPX PRO MAX**\t\n\nâ€‹\tç›´æ¥è¿è¡ŒEXEç¨‹åºï¼Œä¼šå‡ºç°ä¸‹å›¾çš„æ˜¾ç¤ºã€‚\n\n![image-20250506132159230](/pictures/BaseCTF2024/image-20250506132159230.png)\n\nDIEä¹Ÿçœ‹åˆ°UPXå£³ã€‚\n\n![image-20250506132311405](/pictures/BaseCTF2024/image-20250506132311405.png)\n\nç›´æ¥ä¸Šå·¥å…·æ˜¯ä¸è¡Œçš„å•Šï¼ŒæŠ¥é”™äº†ã€‚\n\nè·Ÿç€WPå­¦ä¹ â€”â€”**åˆ©ç”¨ESPå®šå¾‹x64dbgæ‰‹è„±UPXå£³**ã€‚\n\n> â€œESPå®šå¾‹â€ä¹Ÿç§°â€œå †æ ˆå¹³è¡¡å®šå¾‹â€\n>\n> ç”±äºåœ¨ç¨‹åºè‡ªè§£å¯†æˆ–è€…è‡ªè§£å‹è¿‡ç¨‹ä¸­, å¤šæ•°å£³ä¼šå…ˆå°†å½“å‰å¯„å­˜å™¨çŠ¶æ€å‹æ ˆ, å¦‚ä½¿ç”¨`pushad`, è€Œåœ¨è§£å‹ç»“æŸå, ä¼šå°†ä¹‹å‰çš„å¯„å­˜å™¨å€¼å‡ºæ ˆ, å¦‚ä½¿ç”¨`popad`. å› æ­¤åœ¨å¯„å­˜å™¨å‡ºæ ˆæ—¶, å¾€å¾€ç¨‹åºä»£ç è¢«æ¢å¤, æ­¤æ—¶ç¡¬ä»¶æ–­ç‚¹è§¦å‘ï¼ˆè¿™å°±æ˜¯æˆ‘ä»¬è¦ä¸‹ç¡¬ä»¶æ–­ç‚¹çš„åŸå› ï¼‰ï¼Œç„¶ååœ¨ç¨‹åºå½“å‰ä½ç½®, åªéœ€è¦ä¸€äº›å•æ­¥æ“ä½œ, å°±ä¼šåˆ°è¾¾æ­£ç¡®çš„OEPä½ç½®ã€‚\n>\n> 1. ç¨‹åºåˆšè½½å…¥å¼€å§‹ `pushad/pushfd`\n> 2. å°†å…¨éƒ¨å¯„å­˜å™¨å‹æ ˆåå°±è®¾å¯¹ ESP å¯„å­˜å™¨è®¾ç¡¬ä»¶æ–­ç‚¹\n> 3. è¿è¡Œç¨‹åº, è§¦å‘æ–­ç‚¹\n> 4. åˆ é™¤ç¡¬ä»¶æ–­ç‚¹å¼€å§‹åˆ†æ\n\nåœ¨x64dbgä¸­ï¼ŒF9ä¸¤æ¬¡åæ¥åˆ°è¿™ä¸ªå‹æ ˆçš„æ“ä½œå¤„ã€‚æ¥ç€å•æ­¥è¿è¡Œä¸€æ¬¡ï¼Œçœ‹åˆ°ESPçš„å€¼ä¸ºçº¢è‰²ï¼Œä»£è¡¨å…¶å€¼è¢«ä¿®æ”¹äº†ï¼Œæˆ‘ä»¬å³é”®é€‰æ‹©â€œåœ¨å†…å­˜çª—å£ä¸­è½¬åˆ°â€ï¼Œç„¶ååœ¨æ ˆä¸­æ‰“ä¸‹ç¡¬ä»¶æ–­ç‚¹ã€‚\n\n![image-20250506133643545](/pictures/BaseCTF2024/image-20250506133643545.png)\n\n![image-20250506134057787](/pictures/BaseCTF2024/image-20250506134057787.png)\n\n![image-20250506134312068](/pictures/BaseCTF2024/image-20250506134312068.png)\n\nä¹‹åF9ï¼Œè§¦å‘æ–­ç‚¹åå•æ­¥è¿è¡Œå‡ ä¸‹å°±æ‰¾åˆ°OEPäº†ï¼Œå³ç¨‹åºå…¥å£ç‚¹ã€‚å¯ä»¥çœ‹åˆ°è¿™ä¸ªåœ°æ–¹çš„å¤šæ¬¡popæŒ‡ä»¤ã€‚\n\næ ¹æ®wpä¸­çš„æç¤ºï¼Œ0X41CF65è·³è½¬çš„åœ°æ–¹å°±æ˜¯ç¨‹åºçš„å…¥å£ç‚¹äº†ã€‚åº”è¯¥æ˜¯äº†ã€‚\n\n![image-20250506134519180](/pictures/BaseCTF2024/image-20250506134519180.png)\n\nä¸‹é¢æ ¹æ®WPä¸­çš„æ“ä½œä»‹ç»ä¸€æ­¥æ­¥å°±å¯ä»¥è„±å‡ºæ— å£³çš„ç¨‹åºäº†ï¼Œå«UPX_PRO_MAX_dump_SCY.exeã€‚\n\n> `scylla`æ’ä»¶ï¼šåœ¨ x64dbg ä¸­å†…ç½®çš„ Scylla æ’ä»¶å¯ç”¨äº dump è¿›ç¨‹ï¼Œ**å³å°†å†…å­˜ä¸­çš„ç¨‹åºæ•°æ®è½¬å‚¨åˆ°ç£ç›˜ä¸Š**ï¼Œå½¢æˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶çš„å‰¯æœ¬ï¼Œæ–¹ä¾¿åç»­å¯¹ç¨‹åºçš„åˆ†æå’Œç ”ç©¶ã€‚\n>\n> `IAT AutoSearch`ï¼š åœ¨åˆ†æç»è¿‡åŠ å£³æˆ–åŠ å¯†çš„ç¨‹åºæ—¶ï¼Œç¨‹åºçš„å¯¼å…¥è¡¨å¯èƒ½è¢«ç ´åæˆ–éšè—ï¼ŒIAT AutoSearch å¯ä»¥è‡ªåŠ¨æ‰«æå†…å­˜æˆ–ä»£ç æ®µï¼Œå¯»æ‰¾å¯èƒ½çš„å¯¼å…¥å‡½æ•°åœ°å€ï¼Œå¸®åŠ©é€†å‘å·¥ç¨‹å¸ˆå¿«é€Ÿæ‰¾åˆ°ç¨‹åºæ‰€è°ƒç”¨çš„å¤–éƒ¨å‡½æ•°ã€‚\n\n> ç¨‹åºçš„å¯¼å…¥è¡¨æ˜¯ç¨‹åºçš„å…³é”®æ•°æ®ç»“æ„ï¼Œç”¨äºåˆ—å‡ºç¨‹åºè¿è¡Œæ—¶éœ€è¦ä»å…¶ä»–æ¨¡å—ï¼ˆé€šå¸¸æ˜¯ DLLï¼‰ä¸­å¯¼å…¥çš„å‡½æ•°å’Œå˜é‡ã€‚ä»¥ä¸‹æ˜¯å¯¼å…¥è¡¨çš„è¯¦ç»†ä»‹ç»ï¼š\n>\n>   * å¯¼å…¥è¡¨æ˜¯ç¨‹åºçš„ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œå®ƒåŒ…å«äº†ä¸€ç³»åˆ—çš„å¼•ç”¨ä¿¡æ¯ï¼ŒæŒ‡å‘ç¨‹åºè¿è¡Œæ—¶éœ€è¦è°ƒç”¨çš„å¤–éƒ¨å‡½æ•°å’Œå˜é‡æ‰€åœ¨çš„æ¨¡å—åŠå…¶å…·ä½“åœ°å€ã€‚\n>\n> \n>\n>   * **ä¾¿äºè°ƒç”¨å¤–éƒ¨æ¨¡å—åŠŸèƒ½** ï¼šç¨‹åºé€šå¸¸ä¸ä¼šå°†æ‰€æœ‰åŠŸèƒ½éƒ½è‡ªå·±å®ç°ï¼Œè€Œæ˜¯é€šè¿‡è°ƒç”¨ç³»ç»Ÿæˆ–ç¬¬ä¸‰æ–¹æä¾›çš„ DLL ä¸­çš„å‡½æ•°å’Œå˜é‡æ¥å®ç°å¤æ‚çš„åŠŸèƒ½ã€‚å¯¼å…¥è¡¨å°±åƒä¸€ä¸ªç›®å½•ï¼Œå‘Šè¯‰æ“ä½œç³»ç»Ÿç¨‹åºéœ€è¦ä»å“ªäº› DLL ä¸­ä½¿ç”¨å“ªäº›åŠŸèƒ½ã€‚\n>   * **ä¾¿äºç¨‹åºçš„åŠ¨æ€é“¾æ¥** ï¼šå®ƒæ”¯æŒç¨‹åºçš„åŠ¨æ€é“¾æ¥æœºåˆ¶ã€‚ç¨‹åºåœ¨ç¼–è¯‘æ—¶ä¸ä¼šç›´æ¥å°† DLL ä¸­çš„å‡½æ•°å’Œå˜é‡ä»£ç åŒ…å«è¿›æ¥ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶è£…è½½æ‰€éœ€çš„ DLLï¼Œå¹¶é€šè¿‡å¯¼å…¥è¡¨æ‰¾åˆ°å…·ä½“çš„å‡½æ•°å’Œå˜é‡åœ°å€ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ç¨‹åºè‡ªèº«çš„ä½“ç§¯ï¼ŒåŒæ—¶æ–¹ä¾¿å¯¹ DLL è¿›è¡Œæ›´æ–°å’Œå…±äº«ã€‚\n>\n> \n>\n>   * **å¯¼å…¥æ¨¡å—åè¡¨** ï¼šå­˜æ”¾äº†ç¨‹åºéœ€è¦å¯¼å…¥çš„å„ä¸ªæ¨¡å—çš„åå­—ï¼Œæ¯”å¦‚ â€œkernel32.dllâ€â€œuser32.dllâ€ ç­‰ã€‚\n>   * **å¯¼å…¥å‡½æ•°åè¡¨** ï¼šå¯¹äºæ¯ä¸ªå¯¼å…¥æ¨¡å—ï¼Œéƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„å¯¼å…¥å‡½æ•°åè¡¨ï¼Œåˆ—å‡ºäº†ä»è¯¥æ¨¡å—ä¸­å¯¼å…¥çš„å…·ä½“å‡½æ•°åç§°ï¼Œå¦‚ â€œMessageBoxAâ€â€œCreateFileAâ€ ç­‰ã€‚\n>   * **å¯¼å…¥å‡½æ•°åœ°å€è¡¨ï¼ˆIATï¼‰** ï¼šåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†æ¯ä¸ªå¯¼å…¥å‡½æ•°çš„å®é™…å†…å­˜åœ°å€å¡«å…¥è¿™ä¸ªè¡¨ä¸­ï¼Œç¨‹åºé€šè¿‡è¿™ä¸ªè¡¨ä¸­çš„åœ°å€æ¥è°ƒç”¨ç›¸åº”çš„å‡½æ•°ã€‚\n\nè„±å£³åçš„ç¨‹åºå¯¼å…¥IDAä¸­ï¼Œå¾ˆæ¸…æ™°çš„åŠ å¯†é€»è¾‘ã€‚ç›´æ¥é€†å‘å†™è„šæœ¬å°±è¡Œã€‚\n\n![image-20250506141212651](/pictures/BaseCTF2024/image-20250506141212651.png)\n\nä½†æ˜¯è¿™é‡Œå‡ºç°äº†ä¸€ä¸ªå‘ï¼š`sub_401550`å‡½æ•°å…¶å®å°±æ˜¯ä¸€äº›åŠ å¯†å­—ç¬¦ä¸²ç§»åŠ¨æ“ä½œï¼Œåˆ†æˆå‡ éƒ¨åˆ†å­˜å‚¨åœ¨å‡ ä¸ªå˜é‡ä¸­ã€‚ä½†æ˜¯åœ¨éªŒè¯å‡½æ•°ä¸­ï¼Œå…¨ç¨‹åªç”¨åˆ°äº†a1å’Œa2éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯sub_401550ä¸­çš„a2å’Œa3ï¼Œä¸æ˜¯å®Œæ•´çš„å¯†æ–‡ï¼Œæˆ‘è§‰å¾—è¿™é‡Œæ˜¯ä¸­é—´å‡ºäº†é—®é¢˜ï¼Œè€Œä¸”è¿™ä¸ªæå–å‡ºæ¥çš„exeç¨‹åºæ— æ³•æ­£å¸¸è¿è¡Œï¼ŒIDAä¸­ä¹Ÿè°ƒè¯•ä¸è¡Œï¼Œåªèƒ½é™æ€åˆ†æã€‚æ‰€ä»¥è¿˜æ˜¯æœ‰ç‚¹ä¸é è°±çš„ä¸œè¥¿å­˜åœ¨ã€‚\n\n![image-20250506142108769](/pictures/BaseCTF2024/image-20250506142108769.png)\n\n![image-20250506141429954](/pictures/BaseCTF2024/image-20250506141429954.png)\n\n------\n\n# EZ_VM\n\nâ€‹\tåŸºæœ¬ä¿¡æ¯ï¼š`pyinstaller`æ‰“åŒ…çš„`ELF64`ä½ç¨‹åºï¼Œä½¿ç”¨`pydumpck`è§£åŒ…å¾—åˆ°`py`æ–‡ä»¶ã€‚\n\nâ€‹\tåŠ å¯†é€»è¾‘åœ¨`what.py`æ–‡ä»¶ï¼Œæ‰“å¼€ï¼Œé‡Œé¢å‡½æ•°åç§°å’Œå˜é‡åéƒ½æ˜¯ç”¨æ•°å­—ä»£æ›¿çš„ï¼Œè¿˜æœ‰ä¸€äº›å°é”™è¯¯ï¼Œæ¯”å¦‚æœ¬æ¥çš„â€œwhileâ€è¯­å¥å˜æˆâ€œifâ€ï¼Œéœ€è¦æ”¹è¿‡æ¥ã€‚\n\nâ€‹\tä»£ç çš„é€»è¾‘å°±æ˜¯ï¼šåˆ†åˆ«ä½¿ç”¨ä¸€ä¸ªæ•°ç»„å˜é‡å’Œä¸€ä¸ªå­—å…¸æ¥æ¨¡æ‹Ÿä¸€ä¸ªæ ˆå’Œå†…å­˜ï¼Œä½¿ç”¨å˜é‡æ¨¡æ‹Ÿå¯„å­˜å™¨ï¼Œé€šè¿‡æ•°ç»„çš„`pop`å’Œ`push`æ¨¡æ‹Ÿæ ˆçš„æ“ä½œï¼Œä½¿ç”¨å‡½æ•°å®šä¹‰å„ç§æ±‡ç¼–æŒ‡ä»¤ï¼Œå¦‚pushã€popã€addã€subç­‰ç­‰ï¼Œéƒ½æ˜¯ç»Ÿä¸€æ“ä½œæ•°é•¿åº¦ã€‚å°±è¿™æ ·å®šä¹‰äº†ä¸€ä¸ªèƒ½å¤Ÿé€šè¿‡æ±‡ç¼–æŒ‡ä»¤è¿›è¡Œè¿è¡Œçš„â€œè™šæ‹Ÿæœºâ€ï¼Œé‡Œé¢å­˜åœ¨å‡ºé¢˜äººé¢„å…ˆå†™å¥½çš„ä¸€æ®µé™æ€æ±‡ç¼–ä»£ç ï¼Œä½œä¸ºåŠ å¯†å‡½æ•°ã€‚\n\n> 1. æˆ‘ä»¬é¦–è¦ä»»åŠ¡å°±æ˜¯ç»™æºpythonä»£ç è¿›è¡Œé‡å‘½åå’Œæ˜æ˜¾çš„é”™è¯¯çº æ­£ã€‚ï¼ˆéœ€è¦è¶³å¤Ÿç†Ÿæ‚‰æ±‡ç¼–æŒ‡ä»¤ï¼Œèµ·ç çš„è¦çŸ¥é“ã€‚è½¬ç§»æŒ‡ä»¤è¿˜æ²¡é‚£ä¹ˆé‡è¦ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å…³å¿ƒç¨‹åºçš„æ‰§è¡Œæµç¨‹ï¼Œæˆ‘ä»¬åªéœ€è¦æ³¨æ„å¯†æ–‡çš„æ¥å¤„å³å¯ã€‚ï¼‰\n> 2. ç„¶ååœ¨å…¶ä¸­æ’å…¥printè°ƒè¯•è¯­å¥è¾“å‡ºæ“ä½œæŒ‡ä»¤ã€æ ˆå’Œå†…å­˜çš„å€¼ï¼Œé”å®šå¯†æ–‡çš„å­˜å‚¨åœ°æ–¹ï¼Œè§‚å¯ŸåŠ å¯†æ–¹æ³•ã€‚\n> 3. æ ¹æ®åŠ å¯†æ–¹æ³•å†™é€†å‘è„šæœ¬ã€‚\n\nâ€‹\t\n\n```python\nenc_flag = [\n    35,\n    18,\n    22,\n    38,\n    23,\n    18,\n    61,\n    25,\n    83,\n    4,\n    0,\n    5,\n    5,\n    83,\n    95,\n    20,\n    29,\n    83,\n    82,\n    1,\n    29,\n    25,\n    0,\n    0,\n    81,\n    72,\n    76,\n    85,\n    3,\n    85,\n    79,\n    73,\n    83,\n    0,\n    15,\n    9,\n    85,\n    7,\n    80,\n    82,\n    0,\n    5,\n    84,\n    77,\n    130]\n\n\nclass Opcode:\n    vm_push = 240\n    vm_pop = 241\n    vm_and = 242\n    vm_or = 243\n    vm_not = 244\n    vm_xor = 245\n    vm_jmp = 246\n    vm_jz = 247\n    vm_label = 248\n    vm_strlen = 249\n    vm_loadchar = 250\n    vm_store = 251\n    vm_load = 252\n    vm_add = 253\n    vm_sub = 254\n\n\nclass VM:\n\n    def __init__(self):\n        self.stack = []\n        self.bytecode = []\n        self.pc = 0\n        self.labels = {}\n        self.memory = {}\n\n    def push(self, value):\n        self.stack.append(value)\n\n    def pop(self):\n        if not self.stack:\n            raise IndexError('something wrong..')\n        return self.stack.pop()\n\n    def _scan_labels(self):\n        labels = {}\n        pc = 0\n        while pc < len(self.bytecode):\n            if self.bytecode[pc] == Opcode.vm_label:\n                label_name = self.bytecode[pc + 1]\n                labels[label_name] = pc\n                pc += 2\n            else:\n                pc += 1\n\n        return labels\n\n    def vm_and(self):\n        a = self.pop()\n        b = self.pop()\n        self.push(b & a)\n\n    def vm_or(self):\n        a = self.pop()\n        b = self.pop()\n        self.push(b | a)\n\n    def vm_not(self):\n        b = self.pop()\n        self.push(~b)\n\n    def vm_xor(self):\n        a = self.pop()\n        b = self.pop()\n        self.push(b ^ a)\n\n    def vm_jmp(self):\n        label_name = self.bytecode[self.pc]\n        self.pc = self.labels[label_name]\n\n    def vm_jz(self):\n        label_name = self.bytecode[self.pc]\n        self.pc += 1\n        a = self.pop()\n        b = self.pop()\n        if a == b:\n            self.pc = self.labels[label_name]\n\n    def vm_strlen(self):\n        string = self.pop()\n        self.push(len(string))\n\n    def vm_loadchar(self):\n        string = self.pop()\n        index = self.pop()\n        self.push(ord(string[index]))\n\n    def vm_store(self):\n        value = self.pop()\n        key = self.bytecode[self.pc]\n        if key == 'r':\n            if key not in self.memory:\n                self.memory[key] = []\n            self.memory[key].append(value)\n        else:\n            self.memory[key] = value\n        self.pc += 1\n\n    def vm_load(self):\n        key = self.bytecode[self.pc]\n        self.push(self.memory[key])\n        self.pc += 1\n\n    def vm_add(self):\n        a = self.pop()\n        b = self.pop()\n        self.push(b + a)\n\n    def vm_sub(self):\n        a = self.pop()\n        b = self.pop()\n        self.push(b - a)\n\n    def run(self, bytecode):\n        self.bytecode = bytecode\n        self.pc = 0\n        self.labels = self._scan_labels()\n        while self.pc < len(self.bytecode):\n            opcode = self.bytecode[self.pc]\n            self.pc += 1\n            if opcode == Opcode.vm_push:\n                value = self.bytecode[self.pc]\n                self.pc += 1\n                self.push(value)\n            elif opcode == Opcode.vm_pop:\n                self.pop()\n            elif opcode == Opcode.vm_and:\n                self.vm_and()\n            elif opcode == Opcode.vm_or:\n                self.vm_or()\n            elif opcode == Opcode.vm_not:\n                self.vm_not()\n            elif opcode == Opcode.vm_xor:\n                self.vm_xor()\n            elif opcode == Opcode.vm_jmp:\n                self.vm_jmp()\n            elif opcode == Opcode.vm_jz:\n                self.vm_jz()\n            elif opcode == Opcode.vm_label:\n                self.pc += 1\n            elif opcode == Opcode.vm_strlen:\n                self.vm_strlen()\n            elif opcode == Opcode.vm_loadchar:\n                self.vm_loadchar()\n            elif opcode == Opcode.vm_store:\n                self.vm_store()\n            elif opcode == Opcode.vm_load:\n                self.vm_load()\n            elif opcode == Opcode.vm_add:\n                self.vm_add()\n            elif opcode == Opcode.vm_sub:\n                self.vm_sub()\n            else:\n                raise ValueError('something wrong')\n            print(f\"pc: {self.pc}| opcode: {get_opcode_name(opcode)}, stack: {self.stack}, memory: {self.memory}\")\n\n    def encrypt(self, serial):\n        bytecode = [\n            Opcode.vm_push, serial,\n            Opcode.vm_strlen,\n            Opcode.vm_store, 'l1',\n            Opcode.vm_push, 0,\n            Opcode.vm_store, 'i',\n            Opcode.vm_label, 's',\n            Opcode.vm_load, 'l1',\n            Opcode.vm_push, 1,\n            Opcode.vm_sub,\n            Opcode.vm_load, 'i',\n            Opcode.vm_jz, 'e',\n            Opcode.vm_load, 'i',\n            Opcode.vm_push, serial,\n            Opcode.vm_loadchar,\n            Opcode.vm_load, 'i',\n            Opcode.vm_push, 1,\n            Opcode.vm_add,\n            Opcode.vm_push, serial,\n            Opcode.vm_loadchar,\n            Opcode.vm_xor,\n            Opcode.vm_store, 'r',\n            Opcode.vm_load, 'i',\n            Opcode.vm_push, 1,\n            Opcode.vm_add,\n            Opcode.vm_store, 'i',\n            Opcode.vm_jmp, 's',\n            Opcode.vm_label, 'e',\n            Opcode.vm_load, 'i',\n            Opcode.vm_push, serial,\n            Opcode.vm_loadchar,\n            Opcode.vm_push, 255,\n            Opcode.vm_xor,\n            Opcode.vm_store, 'r'\n        ]\n        self.run(bytecode)\n        enc = self.memory['r']\n        return enc\n\ndef get_opcode_name(opcode):\n    for name, value in Opcode.__dict__.items():\n        if value == opcode:\n            return name\n    return None\n\nvm = VM()\ntest_flag = \"BaseCTF{VM_is_awesome}\"\nenc = vm.encrypt(test_flag)\nprint(f\"encrypted test_flag: {enc}\")\nprint(f\"original flag: {enc_flag}\")\n```\n\næ ¹æ®WPæç¤ºé‡å‘½ååï¼Œè§‚å¯Ÿä¼ è¾“çš„è°ƒè¯•ä¿¡æ¯ã€‚çœ‹ä¸€ä¸‹å¼€å¤´å’Œç»“å°¾å°±è¡Œã€‚\n\n![image-20250509160138052](/pictures/BaseCTF2024/image-20250509160138052.png)\n\n![image-20250509160305470](/pictures/BaseCTF2024/image-20250509160305470.png)\n\nâ€‹\tæ‰€ä»¥çŒœåˆ°åŠ å¯†é€»è¾‘æ˜¯ï¼šä»å‰å¾€åï¼Œç›¸é‚»ä¸¤ä½å¼‚æˆ–ï¼Œå°¾éƒ¨å’Œ255å¼‚æˆ–ã€‚\n\nè¿™é‡Œç»™å‡ºæˆ‘çš„è§£å¯†è„šæœ¬ã€‚\n\n```python\nenc_flag = [35, 18, 22, 38, 23,  18,61, 25,  83,4,0, 5, 5,83,95,  20,  29, 83,82,  1, 29, 25, 0,0,81,72,76,85,3,85,79,73,83,0,15,9,85,7,80,82,0,5,84,77,130,255]\n\nflag = \"\"\nfor i in range(len(enc_flag)):\n    char = enc_flag[i]\n    for j in range(i+1, len(enc_flag)):\n        char = char ^ enc_flag[j]\n\n    flag += chr(char)\n\nprint(flag)\n```\n\n------\n\n# Microgame\n\nâ€‹\tä¸ç†è§£ï¼Œä¸ä¼šæ¸¸æˆé€†å‘ï¼Œåé¢å¾—å­¦å•Šã€‚ä¸“é—¨åšäº†ä¸€ä¸ªCEçš„å­¦ä¹ ã€‚\n\nâ€‹\tå­¦ä¹ å®ŒCEï¼Œä¸“é—¨å‡ºä¸ªWPæ¥åšã€‚\n\n------\n\n# neuroçˆ±æ•°å­¦\n\nâ€‹\tç›´æ¥æ‰“å¼€IDAçœ‹çœ‹`main`å‡½æ•°ï¼Œç¨‹åºæ— å£³ï¼Œå°±æ˜¯è€ƒå¯Ÿæ•°å­¦é—®é¢˜ã€‚\n\n![image-20250512120720066](/pictures/BaseCTF2024/image-20250512120720066.png)\n\n![image-20250512130852846](/pictures/BaseCTF2024/image-20250512130852846.png)\n\n![image-20250512130953971](/pictures/BaseCTF2024/image-20250512130953971.png)\n\n```c\n#include<stdio.h>\n#include<stdint.h>\n#include<intrin.h>\n\nint main(){\t\t\t\t\t\t\t\t//æ³¨æ„ï¼šå„ä¸ªå˜é‡å’Œå‡½æ•°çš„ç±»å‹æ˜¯å…³é”®ï¼Œä¸èƒ½æé”™ï¼Œéœ€è¦å¯¹ç…§IDAä¼ªä»£ç \n    int64_t v5=0x400C0210000001;\t\t\t//è¿™ä¸ªå€¼æ˜¯å›ºå®šçš„ï¼Œä½†æ˜¯éœ€è¦åŠ¨è°ƒç¨‹åºå¾—åˆ°è¿™ä¸ªå€¼ã€‚\n\n    for(int i=-60; i<=59; i++){\n        if(i == 44 || i == 58){\n            printf(\"ç¬¦åˆæ¡ä»¶çš„iå€¼ä½ï¼š%d/n\", i);\n            continue;\n        }\n\n        unsigned int v12 = (unsigned int)(i + 37);\n        if(v12 <= 54 && _bittest64((int64_t*)&v5,(unsigned int)v12) != 0){\n            printf(\"ç¬¦åˆæ¡ä»¶çš„iå€¼ä¸ºï¼š%d/n\", i);\n        }\n\n    }\n\n    return 0;\n}\n\n```\n\n![image-20250512131328904](/pictures/BaseCTF2024/image-20250512131328904.png)\n\nç„¶åä½¿ç”¨pythonè„šæœ¬å±•å¼€å¤šé¡¹å¼å¾—åˆ°ç³»æ•°ã€‚\n\n````python\nfrom sympy import symbols, expand\n\n# å®šä¹‰ç¬¦å·å˜é‡\nx = symbols('x')\n\n# æ„é€ å¤šé¡¹å¼\npolynomial = (x - 44) * (x - 58) * (x - 5) * (x + 37) * (x - 17) * (x + 9) * (x - 6) * (x + 4)\n\n# å±•å¼€å¤šé¡¹å¼\nexpanded_polynomial = expand(polynomial)\n\n# æå–å¹¶æ‰“å°ç³»æ•°\nstandard_form = expanded_polynomial.as_poly()  # è·å–æ ‡å‡†å½¢å¼çš„å¤šé¡¹å¼\ncoefficients = standard_form.all_coeffs()    # è·å–æ‰€æœ‰ç³»æ•°\n\n# æ‰“å°ç³»æ•°é€†åºï¼ˆä»å¸¸æ•°é¡¹åˆ°æœ€é«˜æ¬¡é¡¹ï¼‰ã€‚å› ä¸ºæ­£å¸¸æ˜¯ä»é«˜æ¬¡é¡¹åˆ°ä½æ¬¡é¡¹ã€‚\nprint(coefficients[::-1])\n#[-1733624640, 134045088, 122783468, -12168520, -1364231, 121272, -358, -80, 1]\n````\n\n![æµ‹è¯•å›¾ç‰‡](/pictures/BaseCTF2024/image-20250512131708984.png)\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["å¤ç°WP","Reverse"],"categories":["CTF"]},{"title":"å…³äº","url":"/about/index.html","content":"\n\n\n"},{"url":"/json/music.json","content":"[\n  {\n    \"name\": \"é’èŠ±ç“·\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.4/é’èŠ±ç“·/é’èŠ±ç“·.mp3\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000002eFUFm2XYZ7z_2.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.4/é’èŠ±ç“·/é’èŠ±ç“·.lrc\"\n  },\n  {\n    \"name\": \"ç¨»é¦™\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.1/å‘¨æ°ä¼¦/ç¨»é¦™/ç¨»é¦™.mp3\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000002Neh8l0uciQZ_1.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.1/å‘¨æ°ä¼¦/ç¨»é¦™/ç¨»é¦™.lrc\"\n  },\n  {\n    \"name\": \"æ™´å¤©\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.2/æ™´å¤©/æ™´å¤©.mp3\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000000MkMni19ClKG_3.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.2/æ™´å¤©/æ™´å¤©.lrc\"\n  },\n  {\n    \"name\": \"ä¸ƒé‡Œé¦™\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.2/ä¸ƒé‡Œé¦™/ä¸ƒé‡Œé¦™.mp3\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000003DFRzD192KKD_1.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.2/ä¸ƒé‡Œé¦™/ä¸ƒé‡Œé¦™.lrc\"\n  },\n  {\n    \"name\": \"èŠ±æµ·\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music-jay@1.0.1/èŠ±æµ·/èŠ±æµ·.flac\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000002Neh8l0uciQZ_1.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music-jay@1.0.1/èŠ±æµ·/èŠ±æµ·.lrc\"\n  },\n  {\n    \"name\": \"åæ–¹å‘çš„é’Ÿ\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music-jay@1.0.1/åæ–¹å‘çš„é’Ÿ/åæ–¹å‘çš„é’Ÿ.flac\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000000f01724fd7TH_1.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music-jay@1.0.1/åæ–¹å‘çš„é’Ÿ/åæ–¹å‘çš„é’Ÿ.lrc\"\n  },\n  {\n    \"name\": \"å…°äº­åº\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.1/å‘¨æ°ä¼¦/å…°äº­åº/å…°äº­åº.mp3\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000002Neh8l0uciQZ_1.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.1/å‘¨æ°ä¼¦/å…°äº­åº/å…°äº­åº.lrc\"\n  },\n  {\n    \"name\": \"è¯´å¥½çš„è¾›ç¦å‘¢\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.2/è¯´å¥½çš„è¾›ç¦å‘¢/è¯´å¥½çš„è¾›ç¦å‘¢.mp3\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000002Neh8l0uciQZ_1.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.2/è¯´å¥½çš„è¾›ç¦å‘¢/è¯´å¥½çš„å¹¸ç¦å‘¢.lrc\"\n  },\n  {\n    \"name\": \"ç­‰ä½ ä¸‹è¯¾ (with æ¨ç‘ä»£)\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.1/å‘¨æ°ä¼¦/ç­‰ä½ ä¸‹è¯¾/ç­‰ä½ ä¸‹è¯¾.mp3\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000003bSL0v4bpKAx_1.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.1/å‘¨æ°ä¼¦/ç­‰ä½ ä¸‹è¯¾/ç­‰ä½ ä¸‹è¯¾.lrc\"\n  },\n  {\n    \"name\": \"æˆ‘è½æ³ªæƒ…ç»ªé›¶ç¢\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.2/æˆ‘è½æ³ªæƒ…ç»ªé›¶ç¢/æˆ‘è½æ³ªæƒ…ç»ªé›¶ç¢.mp3\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000000bviBl4FjTpO_1.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.2/æˆ‘è½æ³ªæƒ…ç»ªé›¶ç¢/æˆ‘è½æ³ªæƒ…ç»ªé›¶ç¢.lrc\"\n  },\n  {\n    \"name\": \"å¬å¦ˆå¦ˆçš„è¯\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.2/å¬å¦ˆå¦ˆçš„è¯/å¬å¦ˆå¦ˆçš„è¯.mp3\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000002jLGWe16Tf1H_1.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.2/å¬å¦ˆå¦ˆçš„è¯/å¬å¦ˆå¦ˆçš„è¯.lrc\"\n  },\n  {\n    \"name\": \"æ˜æ˜å°±\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music-jay@1.0.1/æ˜æ˜å°±/æ˜æ˜å°±.flac\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000003Ow85E3pnoqi_1.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music-jay@1.0.1/æ˜æ˜å°±/æ˜æ˜å°±.lrc\"\n  },\n  {\n    \"name\": \"æˆ‘æ˜¯å¦‚æ­¤ç›¸ä¿¡\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music-jay@1.0.1/æˆ‘æ˜¯å¦‚æ­¤ç›¸ä¿¡/æˆ‘æ˜¯å¦‚æ­¤ç›¸ä¿¡.flac\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000001hGx1Z0so1YX_1.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music-jay@1.0.1/æˆ‘æ˜¯å¦‚æ­¤ç›¸ä¿¡/æˆ‘æ˜¯å¦‚æ­¤ç›¸ä¿¡.lrc\"\n  },\n  {\n    \"name\": \"å‘å¦‚é›ª\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.3/å‘å¦‚é›ª/å‘å¦‚é›ª.mp3\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M0000024bjiL2aocxT_3.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.3/å‘å¦‚é›ª/å‘å¦‚é›ª.lrc\"\n  },\n  {\n    \"name\": \"ä»¥çˆ¶ä¹‹å\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.3/ä»¥çˆ¶ä¹‹å/ä»¥çˆ¶ä¹‹å.mp3\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000000MkMni19ClKG_3.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.3/ä»¥çˆ¶ä¹‹å/ä»¥çˆ¶ä¹‹å.lrc\"\n  },\n  {\n    \"name\": \"å›­æ¸¸ä¼š\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.3/å›­æ¸¸ä¼š/å›­æ¸¸ä¼š.flac\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000003DFRzD192KKD_1.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.3/å›­æ¸¸ä¼š/å›­æ¸¸ä¼š.lrc\"\n  },\n  {\n    \"name\": \"æœ¬è‰çº²ç›®\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.4/æœ¬è‰çº²ç›®/æœ¬è‰çº²ç›®.mp3\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000002jLGWe16Tf1H_1.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.4/æœ¬è‰çº²ç›®/æœ¬è‰çº²ç›®.lrc\"\n  },\n  {\n    \"name\": \"é¾™å·é£\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.4/é¾™å·é£/é¾™å·é£.mp3\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000000f01724fd7TH_1.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.4/é¾™å·é£/é¾™å·é£.lrc\"\n  }\n]"},{"url":"/static/js/index_media.js","content":"// ======================= æ¨ªç«–å±è‡ªé€‚åº”èƒŒæ™¯åª’ä½“åŠ è½½å™¨ =======================\nlet lastOrientation = null; // è®°å½•ä¸Šä¸€æ¬¡çš„æ–¹å‘çŠ¶æ€\n\n// ================= æ–°å¢æ»šåŠ¨æ¸å˜æ•ˆæœå‡½æ•° =================\nfunction initScrollFadeEffect() {\n  const mediaContainer = document.getElementById('home-media-container');\n  if (!mediaContainer) return;\n  \n  const mediaElement = mediaContainer.querySelector('.home-media');\n  if (!mediaElement) return;\n  \n  // èŠ‚æµå‡½æ•°ä¼˜åŒ–æ€§èƒ½\n  function throttle(func, limit) {\n    let lastFunc, lastRan;\n    return function() {\n      const context = this;\n      const args = arguments;\n      if (!lastRan) {\n        func.apply(context, args);\n        lastRan = Date.now();\n      } else {\n        clearTimeout(lastFunc);\n        lastFunc = setTimeout(function() {\n          if ((Date.now() - lastRan) >= limit) {\n            func.apply(context, args);\n            lastRan = Date.now();\n          }\n        }, limit - (Date.now() - lastRan));\n      }\n    }\n  }\n\n  // å¤„ç†æ»šåŠ¨æ—¶çš„é€æ˜åº¦å˜åŒ–\n  function handleScrollFade() {\n    const scrollY = window.scrollY;\n    const windowHeight = window.innerHeight;\n    \n    // è®¡ç®—é€æ˜åº¦ï¼šä»1ï¼ˆå®Œå…¨ä¸é€æ˜ï¼‰åˆ°0ï¼ˆå®Œå…¨é€æ˜ï¼‰\n    // å½“æ»šåŠ¨åˆ°ä¸€å±é«˜åº¦æ—¶ï¼Œé€æ˜åº¦å˜ä¸º0\n    let opacity = 1 - (scrollY / windowHeight);\n    opacity = Math.max(0, Math.min(1, opacity)); // é™åˆ¶åœ¨0-1èŒƒå›´\n    \n    mediaElement.style.opacity = opacity;\n  }\n\n  // èŠ‚æµå¤„ç†æ»šåŠ¨äº‹ä»¶ï¼ˆæ¯50msæ£€æŸ¥ä¸€æ¬¡ï¼‰\n  const throttledScrollHandler = throttle(handleScrollFade, 50);\n  \n  // æ·»åŠ æ»šåŠ¨ç›‘å¬\n  window.addEventListener('scroll', throttledScrollHandler);\n  \n  // åˆå§‹åŒ–æ—¶æ‰§è¡Œä¸€æ¬¡\n  handleScrollFade();\n  \n  // å­˜å‚¨å½“å‰æ»šåŠ¨å¤„ç†å™¨ä»¥ä¾¿åç»­ç§»é™¤\n  return throttledScrollHandler;\n}\n\n\n// ================= æ»šåŠ¨æ¸å˜æ•ˆæœå‡½æ•°ç»“æŸ =================\n\n// ================= æ–°å¢åº•éƒ¨é®ç½©å±‚æ§åˆ¶å‡½æ•° =================\nfunction initScrollMaskEffect() {\n  const mediaContainer = document.getElementById('home-media-container');\n  if (!mediaContainer) return;\n  \n  // èŠ‚æµå‡½æ•°ä¼˜åŒ–æ€§èƒ½\n  function throttle(func, limit) {\n    let lastFunc, lastRan;\n    return function() {\n      const context = this;\n      const args = arguments;\n      if (!lastRan) {\n        func.apply(context, args);\n        lastRan = Date.now();\n      } else {\n        clearTimeout(lastFunc);\n        lastFunc = setTimeout(function() {\n          if ((Date.now() - lastRan) >= limit) {\n            func.apply(context, args);\n            lastRan = Date.now();\n          }\n        }, limit - (Date.now() - lastRan));\n      }\n    }\n  }\n\n  // å¤„ç†æ»šåŠ¨æ—¶çš„é®ç½©å˜åŒ–\n  function handleScrollMask() {\n    const scrollY = window.scrollY;\n    const windowHeight = window.innerHeight;\n    \n    // è®¡ç®—é®ç½©é«˜åº¦ï¼ˆ0-100%ï¼‰\n    let maskHeight = (scrollY / windowHeight) * 100;\n    maskHeight = Math.min(100, Math.max(0, maskHeight));\n    \n    // åŠ¨æ€è®¾ç½®é®ç½©å±‚é«˜åº¦\n    mediaContainer.style.setProperty('--mask-height', `${maskHeight}%`);\n  }\n\n  // èŠ‚æµå¤„ç†æ»šåŠ¨äº‹ä»¶ï¼ˆæ¯50msæ£€æŸ¥ä¸€æ¬¡ï¼‰\n  const throttledScrollHandler = throttle(handleScrollMask, 50);\n  \n  // æ·»åŠ æ»šåŠ¨ç›‘å¬\n  window.addEventListener('scroll', throttledScrollHandler);\n  \n  // åˆå§‹åŒ–æ—¶æ‰§è¡Œä¸€æ¬¡\n  handleScrollMask();\n  \n  // è¿”å›å¤„ç†å™¨ä»¥ä¾¿åç»­ç§»é™¤\n  return throttledScrollHandler;\n}\n\n\nfunction initResponsiveBackground() {\n  const mediaContainer = document.getElementById('home-media-container');\n  if (!mediaContainer) {\n    console.error('[èƒŒæ™¯åŠ è½½å™¨] æœªæ‰¾åˆ°åª’ä½“å®¹å™¨å…ƒç´ ');\n    return;\n  }\n\n  // æ£€æµ‹å½“å‰å±å¹•æ–¹å‘\n  const currentIsPortrait = window.innerHeight > window.innerWidth;\n  const currentOrientation = currentIsPortrait ? 'portrait' : 'landscape';\n  \n  // å¦‚æœæ–¹å‘æœªæ”¹å˜ï¼Œåˆ™ç›´æ¥è¿”å›\n  if (lastOrientation === currentOrientation) {\n    console.log('[èƒŒæ™¯åŠ è½½å™¨] æ–¹å‘æœªæ”¹å˜ï¼Œæ— éœ€é‡æ–°åŠ è½½');\n    return;\n  }\n  \n  // æ›´æ–°æ–¹å‘è®°å½•\n  lastOrientation = currentOrientation;\n  console.log(`[èƒŒæ™¯åŠ è½½å™¨] æ–¹å‘å˜åŒ–: ${currentOrientation}`);\n\n  // æ¸…é™¤ç°æœ‰åª’ä½“å…ƒç´ å’ŒåŠ è½½åŠ¨ç”»\n  const existingMedia = mediaContainer.querySelector('.home-media');\n  const existingLoader = mediaContainer.querySelector('.custom-loader');\n  if (existingMedia) existingMedia.remove();\n  if (existingLoader) existingLoader.remove();\n\n  // æ ¹æ®æ–¹å‘é€‰æ‹©èµ„æº\n  let mediaSrc, posterSrc, mediaType;\n  if (currentIsPortrait) {\n    mediaSrc = mediaContainer.dataset.portraitVideo || mediaContainer.dataset.portraitImg;\n    posterSrc = mediaContainer.dataset.portraitPoster;\n    mediaType = mediaContainer.dataset.portraitVideo ? 'video' : 'img';\n  } else {\n    mediaSrc = mediaContainer.dataset.landscapeVideo || mediaContainer.dataset.landscapeImg;\n    posterSrc = mediaContainer.dataset.landscapePoster;\n    mediaType = mediaContainer.dataset.landscapeVideo ? 'video' : 'img';\n  }\n\n  if (!mediaSrc) {\n    console.error('[èƒŒæ™¯åŠ è½½å™¨] æœªæ‰¾åˆ°æœ‰æ•ˆåª’ä½“èµ„æº');\n    return;\n  }\n\n  console.log(`[èƒŒæ™¯åŠ è½½å™¨] ä½¿ç”¨èµ„æº: ${mediaSrc} (ç±»å‹: ${mediaType})`);\n\n  // åˆ›å»ºåª’ä½“å…ƒç´ \n  const mediaElement = document.createElement(mediaType);\n  mediaElement.className = 'home-media';\n  mediaElement.style.cssText = 'width:100%;height:100%;object-fit:cover';\n  \n  // ================= è®¾ç½®åˆå§‹é€æ˜åº¦ =================\n  mediaElement.style.opacity = '1';\n  mediaElement.style.transition = 'opacity 0.5s ease';\n  // ================================================\n  \n  // åœ¨åª’ä½“å®¹å™¨æ·»åŠ åª’ä½“å…ƒç´ åè°ƒç”¨æ•ˆæœå‡½æ•°\n  mediaContainer.appendChild(mediaElement);\n  addMediaEffects(mediaElement, mediaType); // æ·»åŠ æ–°åŠŸèƒ½\n   \n  console.log('[èƒŒæ™¯åŠ è½½å™¨] åª’ä½“å…ƒç´ å·²åˆ›å»º');\n   \n  // åˆ›å»ºè‡ªå®šä¹‰åŠ è½½åŠ¨ç”»å®¹å™¨\n  const loaderContainer = document.createElement('div');\n  loaderContainer.className = 'custom-loader';\n  mediaContainer.prepend(loaderContainer);\n  \n  // åˆ›å»ºåŠ è½½åŠ¨ç”»å…ƒç´ \n  const loaderElement = document.createElement('div');\n  loaderElement.className = 'loader-animation';\n  \n  // è®¾ç½®åŠ è½½åŠ¨ç”»æ ·å¼ï¼ˆä½¿ç”¨GIFï¼‰\n  loaderElement.style.backgroundImage = `url(${posterSrc})`;\n  loaderContainer.appendChild(loaderElement);\n  \n  // è§†é¢‘ç‰¹æ®Šå¤„ç†\n  if (mediaType === 'video') {\n    mediaElement.autoplay = true;\n    mediaElement.muted = true;\n    mediaElement.loop = true;\n    mediaElement.playsInline = true;\n    mediaElement.setAttribute('playsinline', '');\n    mediaElement.setAttribute('webkit-playsinline', '');\n    \n    // å¤šæºæ”¯æŒ\n    const source = document.createElement('source');\n    source.src = mediaSrc;\n    source.type = 'video/mp4';\n    mediaElement.appendChild(source);\n    \n    // å¤„ç†è‡ªåŠ¨æ’­æ”¾é™åˆ¶\n    const playPromise = mediaElement.play();\n    if (playPromise !== undefined) {\n      playPromise.catch(error => {\n        console.warn('[èƒŒæ™¯åŠ è½½å™¨] è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢:', error);\n        mediaElement.muted = true;\n        mediaElement.play();\n      });\n    }\n    \n    // è§†é¢‘åŠ è½½å®Œæˆåç§»é™¤åŠ è½½åŠ¨ç”»\n    mediaElement.addEventListener('loadeddata', () => {\n      loaderContainer.style.opacity = '0';\n      setTimeout(() => {\n        if (loaderContainer.parentNode) {\n          loaderContainer.parentNode.removeChild(loaderContainer);\n        }\n      }, 500); // æ·¡å‡ºåŠ¨ç”»æŒç»­æ—¶é—´\n    });\n  } else {\n    mediaElement.src = mediaSrc;\n    mediaElement.loading = 'eager';\n    \n    // å›¾ç‰‡åŠ è½½å®Œæˆåç§»é™¤åŠ è½½åŠ¨ç”»\n    mediaElement.addEventListener('load', () => {\n      loaderContainer.style.opacity = '0';\n      setTimeout(() => {\n        if (loaderContainer.parentNode) {\n          loaderContainer.parentNode.removeChild(loaderContainer);\n        }\n      }, 500);\n    });\n  }\n\n  // é”™è¯¯å¤„ç†\n  mediaElement.onerror = function() {\n    console.error(`[èƒŒæ™¯åŠ è½½å™¨] èµ„æºåŠ è½½å¤±è´¥: ${mediaSrc}`);\n    this.style.display = 'none';\n    \n    // å°è¯•å›é€€åˆ°å¤‡ç”¨ç±»å‹\n    console.warn('[èƒŒæ™¯åŠ è½½å™¨] å°è¯•å›é€€åˆ°å¤‡ç”¨åª’ä½“');\n    const fallbackType = mediaType === 'video' ? 'img' : 'video';\n    const fallbackSrc = currentIsPortrait ? \n      (mediaContainer.dataset.portraitImg || mediaContainer.dataset.portraitVideo) :\n      (mediaContainer.dataset.landscapeImg || mediaContainer.dataset.landscapeVideo);\n    \n    if (fallbackSrc && fallbackSrc !== mediaSrc) {\n      console.log(`[èƒŒæ™¯åŠ è½½å™¨] ä½¿ç”¨å¤‡ç”¨èµ„æº: ${fallbackSrc}`);\n      mediaElement.src = fallbackSrc;\n      mediaElement.style.display = 'block';\n    }\n  };\n\n  mediaContainer.appendChild(mediaElement);\n  console.log('[èƒŒæ™¯åŠ è½½å™¨] åª’ä½“å…ƒç´ å·²åˆ›å»º');\n  \n  // ================= åˆå§‹åŒ–æ»šåŠ¨æ¸å˜æ•ˆæœ =================\n  initScrollFadeEffect();\n}\n\nfunction addMediaEffects(mediaElement, mediaType) {\n  if (mediaType === 'video') {\n    // è·å–å½“å‰æ–¹å‘\n    const currentIsPortrait = window.innerHeight > window.innerWidth;\n\n    // ç«–å±æ¨¡å¼ä¸‹å›ºå®šæ”¾å¤§105%\n    const baseScale = currentIsPortrait ? 1.05 : 1.2;\n    mediaElement.style.transform = `scale(${baseScale})`;\n    \n    // æ£€æµ‹æ˜¯å¦ä¸ºiOSè®¾å¤‡\n    function isIOS() {\n      return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;\n    }\n\n    // å¦‚æœæ˜¯iOSè®¾å¤‡ï¼Œç›´æ¥ç¦ç”¨æ‰€æœ‰è§†å·®æ•ˆæœ\n    if (isIOS()) {\n      console.log('[è§†å·®æ•ˆæœ] åœ¨iOSè®¾å¤‡ä¸Šï¼Œç¦ç”¨æ‰€æœ‰è§†å·®æ•ˆæœ');\n      return; // ç›´æ¥è¿”å›ï¼Œä¸åˆå§‹åŒ–ä»»ä½•è§†å·®æ•ˆæœ\n    }\n    // 1. æ·»åŠ ç¼©æ”¾åŠ¨ç”»æ•ˆæœ\n    mediaElement.style.transform = 'scale(1.2)'; // åˆå§‹æ”¾å¤§110%\n    mediaElement.style.transition = 'transform 0.5s ease-out';\n    \n    // åœ¨è§†é¢‘åŠ è½½å®Œæˆåè§¦å‘ç¼©æ”¾åŠ¨ç”»\n    mediaElement.addEventListener('loadeddata', () => {\n      // ç«–å±æ¨¡å¼ä¿æŒ105%ç¼©æ”¾ï¼Œä¸éœ€è¦åŠ¨ç”»\n      if (currentIsPortrait) {\n        mediaElement.style.transform = 'scale(1.05)';\n      } \n      // æ¨ªå±æ¨¡å¼æ‰§è¡Œç¼©æ”¾åŠ¨ç”»åˆ°æ­£å¸¸å¤§å°\n      else {\n        setTimeout(() => {\n          mediaElement.style.transform = 'scale(1)';\n        }, 100);\n      }\n    });\n    \n    // 2. æ·»åŠ è§†å·®æ•ˆæœï¼ˆé¼ æ ‡/é™€èºä»ªï¼‰\n    const mediaContainer = document.getElementById('page-header');\n    mediaContainer.style.overflow = 'hidden';\n    mediaElement.style.transformOrigin = 'center center';\n    \n    // è§†å·®æ•ˆæœå‚æ•°\n    const parallaxIntensity = 0.05;\n    const scaleIntensity = 0.05;\n    let isGyroActive = false;\n    \n    // ================= æ–°å¢é™€èºä»ªæ”¯æŒ =================\n    // æ£€æµ‹é™€èºä»ªæ”¯æŒ\n    function initGyroParallax() {\n      if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {\n        // iOS 13+ éœ€è¦æƒé™\n        DeviceOrientationEvent.requestPermission()\n          .then(permissionState => {\n            if (permissionState === 'granted') {\n              setupGyroListeners();\n              isGyroActive = true;\n            }\n          })\n          .catch(console.error);\n      } else if ('DeviceOrientationEvent' in window) {\n        // Androidå’Œå…¶ä»–æ”¯æŒè®¾å¤‡\n        setupGyroListeners();\n        isGyroActive = true;\n      }\n      \n      return isGyroActive;\n    }\n    \n    // è®¾ç½®é™€èºä»ªç›‘å¬\n    function setupGyroListeners() {\n      window.addEventListener('deviceorientation', handleOrientation);\n    }\n    \n    // å¤„ç†é™€èºä»ªæ•°æ®\n    function handleOrientation(event) {\n      // ç«–å±æ¨¡å¼ä½¿ç”¨105%åŸºç¡€ç¼©æ”¾\n      const baseScaleValue = currentIsPortrait ? 1.05 : 1;\n      if (!isGyroActive) return;\n      \n      // è·å–é™€èºä»ªæ•°æ®ï¼ˆbeta: å‰åå€¾æ–œ, gamma: å·¦å³å€¾æ–œï¼‰\n      const beta = event.beta || 0;  // å‰åå€¾æ–œï¼ˆ-180åˆ°180ï¼‰\n      const gamma = event.gamma || 0; // å·¦å³å€¾æ–œï¼ˆ-90åˆ°90ï¼‰\n      \n      // å°†è§’åº¦è½¬æ¢ä¸ºç™¾åˆ†æ¯”åç§»ï¼ˆå½’ä¸€åŒ–å¤„ç†ï¼‰\n      const moveX = (gamma / 90) * parallaxIntensity * 100; // -100% åˆ° 100%\n      const moveY = (beta / 180) * parallaxIntensity * 100; \n      \n      // åº”ç”¨è§†å·®æ•ˆæœ\n      mediaElement.style.transform = `\n        translate(${moveX}%, ${moveY}%)\n        scale(${baseScaleValue + scaleIntensity})\n      `;\n    }\n    \n    // ================= é¼ æ ‡è§†å·®æ•ˆæœ =================\n    function initMouseParallax() {\n      mediaContainer.addEventListener('mousemove', (e) => {\n        const rect = mediaContainer.getBoundingClientRect();\n        const x = (e.clientX - rect.left) / rect.width;\n        const y = (e.clientY - rect.top) / rect.height;\n        \n        const moveX = (x - 0.5) * parallaxIntensity * 100;\n        const moveY = (y - 0.5) * parallaxIntensity * 100;\n        \n        mediaElement.style.transform = `\n          translate(${moveX}%, ${moveY}%)\n          scale(${1 + scaleIntensity})\n        `;\n      });\n      \n      mediaContainer.addEventListener('mouseleave', () => {\n        mediaElement.style.transform = 'scale(1)';\n      });\n    }\n    \n    // ================= æ ¹æ®è®¾å¤‡ç±»å‹åˆå§‹åŒ– =================\n    // æ£€æµ‹ç§»åŠ¨è®¾å¤‡\n    const isMobile = /Mobi|Android/i.test(navigator.userAgent);\n    \n    if (isMobile) {\n      // ç§»åŠ¨è®¾å¤‡ä¼˜å…ˆä½¿ç”¨é™€èºä»ª\n      if (!initGyroParallax()) {\n        // ä¸æ”¯æŒé™€èºä»ªåˆ™å›é€€åˆ°è§¦æ‘¸äº‹ä»¶\n        initTouchParallax();\n      }\n    } else {\n      // PCè®¾å¤‡ä½¿ç”¨é¼ æ ‡äº‹ä»¶\n      initMouseParallax();\n    }\n    \n    // ================= è§¦æ‘¸äº‹ä»¶å›é€€æ–¹æ¡ˆ =================\n    function initTouchParallax() {\n      mediaContainer.addEventListener('touchmove', (e) => {\n        e.preventDefault();\n        const touch = e.touches[0];\n        const rect = mediaContainer.getBoundingClientRect();\n        const x = (touch.clientX - rect.left) / rect.width;\n        const y = (touch.clientY - rect.top) / rect.height;\n        \n        const moveX = (x - 0.5) * parallaxIntensity * 50; // ç§»åŠ¨å¼ºåº¦å‡åŠ\n        const moveY = (y - 0.5) * parallaxIntensity * 50;\n        \n        mediaElement.style.transform = `\n          translate(${moveX}%, ${moveY}%)\n          scale(${1 + scaleIntensity * 0.5}) // ç¼©æ”¾å¼ºåº¦å‡åŠ\n        `;\n      });\n      \n      mediaContainer.addEventListener('touchend', () => {\n        mediaElement.style.transform = 'scale(1)';\n      });\n    }\n    \n    // ================= æ€§èƒ½ä¼˜åŒ– =================\n    // é¡µé¢ä¸å¯è§æ—¶æš‚åœé™€èºä»ª\n    document.addEventListener('visibilitychange', () => {\n      if (document.visibilityState === 'hidden') {\n        isGyroActive = false;\n      } else if (isMobile) {\n        isGyroActive = initGyroParallax();\n      }\n    });\n  }\n}\n\n// åœ¨initMediaå‡½æ•°ä¸­è°ƒç”¨æ–°åŠŸèƒ½\nfunction initMedia() {\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', function() {\n      initResponsiveBackground();\n      initScrollFadeEffect(); // æ·»åŠ è°ƒç”¨\n    });\n  } else {\n    initResponsiveBackground();\n    initScrollFadeEffect(); // æ·»åŠ è°ƒç”¨\n  }\n}\n\n\n// ======================= æ‰§è¡Œå…¥å£ =======================\ninitMedia();\n\n// é˜²æŠ–å¤„ç†çª—å£å˜åŒ–\nlet resizeTimer;\nwindow.addEventListener('resize', () => {\n  clearTimeout(resizeTimer);\n  resizeTimer = setTimeout(() => {\n    // è®¡ç®—å½“å‰æ–¹å‘çŠ¶æ€\n    const currentIsPortrait = window.innerHeight > window.innerWidth;\n    const currentOrientation = currentIsPortrait ? 'portrait' : 'landscape';\n    \n    // åªæœ‰æ–¹å‘å®é™…æ”¹å˜æ—¶æ‰æ‰§è¡Œé‡è½½\n    if (lastOrientation !== currentOrientation) {\n      console.log('[èƒŒæ™¯åŠ è½½å™¨] çª—å£å¤§å°å˜åŒ–ï¼Œé‡æ–°åŠ è½½åª’ä½“');\n      initResponsiveBackground();\n    } else {\n      console.log('[èƒŒæ™¯åŠ è½½å™¨] çª—å£å¤§å°å˜åŒ–ä½†æ–¹å‘æœªæ”¹å˜');\n      // ================= æ–¹å‘æœªå˜æ—¶é‡ç½®é€æ˜åº¦ =================\n      initScrollFadeEffect();\n    }\n  }, 500);\n});\n\n// é¡µé¢å¯è§æ€§å˜åŒ–å¤„ç†\ndocument.addEventListener('visibilitychange', () => {\n  if (document.visibilityState === 'visible') {\n    const video = document.querySelector('#home-media-container video');\n    if (video && video.paused) {\n      console.log('[èƒŒæ™¯åŠ è½½å™¨] é¡µé¢æ¢å¤å¯è§ï¼Œé‡æ–°æ’­æ”¾è§†é¢‘');\n      video.play().catch(e => console.warn('è§†é¢‘æ¢å¤æ’­æ”¾å¤±è´¥:', e));\n    }\n    // ================= é¡µé¢æ¢å¤å¯è§æ—¶é‡ç½®é€æ˜åº¦ =================\n    initScrollFadeEffect();\n  }\n});\n\n// ========== æ–°å¢ä¿®å¤ä»£ç ï¼ˆç›´æ¥åŠ åœ¨ç°æœ‰ä»£ç åé¢ï¼‰ ========== //\n\n// 1. ç¼“å­˜æ¢å¤æ£€æµ‹ï¼ˆæ ¸å¿ƒä¿®å¤ï¼‰\nwindow.addEventListener('pageshow', event => {\n  if (event.persisted && location.pathname === '/') {\n    console.log('[ä¿®å¤] æ£€æµ‹åˆ°ç¼“å­˜æ¢å¤ä¸»é¡µï¼Œå¼ºåˆ¶é‡ç½®');\n    lastOrientation = null;\n    initResponsiveBackground();\n    // ================= ç¼“å­˜æ¢å¤æ—¶é‡ç½®é€æ˜åº¦ =================\n    setTimeout(initScrollFadeEffect, 300);\n  }\n});\n\n// 2. è·¯ç”±å˜åŒ–ç›‘å¬ï¼ˆSPAå…¼å®¹ï¼‰\nwindow.addEventListener('popstate', () => {\n  if (location.pathname === '/') {\n    console.log('[ä¿®å¤] æ£€æµ‹åˆ°è¿”å›ä¸»é¡µ');\n    setTimeout(() => {\n      // æ£€æŸ¥åª’ä½“å…ƒç´ æ˜¯å¦å­˜åœ¨\n      const container = document.getElementById('home-media-container');\n      if (!container?.querySelector('.home-media')) {\n        lastOrientation = null;\n        initResponsiveBackground();\n      }\n      // ================= è¿”å›ä¸»é¡µæ—¶é‡ç½®é€æ˜åº¦ =================\n      initScrollFadeEffect();\n    }, 300); // å»¶è¿Ÿç¡®ä¿DOMæ›´æ–°\n  }\n});\n\n// 3. åª’ä½“çŠ¶æ€è‡ªæ£€ï¼ˆå…œåº•æ–¹æ¡ˆï¼‰\nfunction checkMediaStatus() {\n  if (location.pathname !== '/') return;\n  \n  const container = document.getElementById('home-media-container');\n  if (!container) return;\n  \n  const hasMedia = container.querySelector('.home-media');\n  if (!hasMedia) {\n    console.log('[ä¿®å¤] è‡ªæ£€å‘ç°åª’ä½“ä¸¢å¤±');\n    lastOrientation = null;\n    initResponsiveBackground();\n  }\n  // ================= åª’ä½“è‡ªæ£€æ—¶é‡ç½®é€æ˜åº¦ =================\n  initScrollFadeEffect();\n}\n\n// æ¯0.5ç§’æ£€æŸ¥ä¸€æ¬¡ï¼ˆè½»é‡çº§æ£€æµ‹ï¼‰\nsetInterval(checkMediaStatus, 500);\n\n// 4. å¢å¼ºé”™è¯¯å¤„ç†ï¼ˆåœ¨initResponsiveBackgroundå‡½æ•°å†…ä¿®æ”¹ï¼‰\n// åœ¨mediaElement.onerrorå‡½æ•°å†…æ·»åŠ ï¼š\nsetTimeout(() => {\n  if (!mediaElement.parentNode) {\n    console.warn('[ä¿®å¤] å°è¯•å®Œå…¨é‡å»º');\n    lastOrientation = null;\n    initResponsiveBackground();\n    // ================= é”™è¯¯é‡å»ºæ—¶é‡ç½®é€æ˜åº¦ =================\n    setTimeout(initScrollFadeEffect, 500);\n  }\n}, 1000);\n\n\n"},{"url":"/static/css/index_media.css","content":"/* index ï¼Œä¸»é¡µé¢åŠ¨ç”»*/\n\n  #home-media-container {\n    position: fixed; /* æ”¹ä¸ºå›ºå®šå®šä½ */\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n    z-index: 0;\n    \n    /* æ·»åŠ åº•éƒ¨å‘ä¸Šæ¸å˜é®ç½© */\n    -webkit-mask-image: linear-gradient(to top, transparent 0%, black 0%);\n    mask-image: linear-gradient(to top, transparent 0%, black 0%);\n  }\n  \n  .home-media {\n    position: fixed; /* åŒæ­¥æ”¹ä¸ºå›ºå®šå®šä½ */\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n    \n    /* æ·»åŠ é€æ˜åº¦è¿‡æ¸¡ */\n    transition: opacity 0.5s ease;\n    opacity: 1;\n  }\n  \n    /* è‡ªå®šä¹‰åŠ è½½åŠ¨ç”»å®¹å™¨ */\n  .custom-loader {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    z-index: 10; /* ç¡®ä¿åœ¨è§†é¢‘ä¸Šæ–¹ */\n    pointer-events: none; /* é˜²æ­¢é˜»æŒ¡è§†é¢‘äº¤äº’ */\n    transition: opacity 0.5s ease; /* æ·¡å‡ºåŠ¨ç”» */\n  }\n\n  /* åŠ è½½åŠ¨ç”»å…ƒç´  */\n  .loader-animation {\n    width: 18%;\n    height: 18%;\n    min-width: 128px;\n    min-height: 128px;\n    background-size: contain; /* ä¿æŒæ¯”ä¾‹ */\n    background-position: center;\n    background-repeat: no-repeat;\n    animation: pulse 1.5s infinite ease-in-out;\n  }\n\n  /* å‘¼å¸åŠ¨ç”»æ•ˆæœ */\n  @keyframes pulse {\n    0% { transform: scale(1); opacity: 0.8; }\n    50% { transform: scale(1.1); opacity: 1; }\n    100% { transform: scale(1); opacity: 0.8; }\n  }\n"},{"title":"æ ‡ç­¾","url":"/tags/index.html"},{"title":"åˆ†ç±»","url":"/categories/index.html"},{"title":"éŸ³ä¹é¦†","url":"/music/index.html"}]