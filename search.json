[{"title":"OpenGLåˆå­¦ä¹ ","url":"/2025/06/25/OpenGLå­¦ä¹ /OpenGLå­¦ä¹ /","content":"\n### \tç¯å¢ƒæ­å»º\n\nâ€‹\tå­¦ä¹ OpenGLçš„æ ¸å¿ƒæ¨¡å¼ï¼Œ[VS2022+GLFW+GLADç¯å¢ƒæ­å»ºæ•™ç¨‹](https://blog.csdn.net/ssunshining/article/details/123767340)ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æ–‡ç« ä¸­ä¸‹è½½çš„GLFWæ˜¯ç¼–è¯‘å¥½çš„ï¼Œæˆ‘ä»¬å¯ä»¥è·³è¿‡CMakeç¼–è¯‘çš„é‚£ä¸€æ­¥ï¼Œç›´æ¥å»æ‰¾includeæ–‡ä»¶å’Œlibæ–‡ä»¶ã€‚\n\nâ€‹\tè¿˜æœ‰å­¦ä¹ èµ„æºï¼Œ[çŸ¥è¯†ç‚¹å­¦ä¹ ](https://learnopengl-cn.github.io/)ã€‚\n\n\n\n------\n\n\n\n### \tåŸºç¡€çŸ¥è¯†ï¼ˆçŸ¥è¯†ç‚¹å­¦ä¹ ï¼‰\n\n\n\n> ### ğŸ”· OpenGL æ˜¯ä»€ä¹ˆï¼Ÿ\n>\n> > OpenGLï¼ˆOpen Graphics Libraryï¼‰æ˜¯ä¸€ä¸ªç”»å›¾çš„æ ‡å‡†å·¥å…·åº“ï¼Œç”¨æ¥ç»˜åˆ¶å›¾å½¢ï¼Œæ¯”å¦‚ 3D æ¨¡å‹ã€åœºæ™¯ã€ç‰¹æ•ˆç­‰ç­‰ã€‚\n>\n> - å®ƒä¸è´Ÿè´£åˆ›å»ºçª—å£ï¼Œä¹Ÿä¸èƒ½å¤„ç†é¼ æ ‡/é”®ç›˜ï¼Œåªä¸“æ³¨â€œç”»å›¾â€ã€‚\n> - æƒ³è±¡ä½ æ˜¯ç”»å®¶ï¼ŒOpenGL å°±æ˜¯ä½ çš„ç”»ç¬”å’Œé¢œæ–™ã€‚\n>\n> ------\n>\n> ### ğŸ”¶ GLFW æ˜¯ä»€ä¹ˆï¼Ÿ\n>\n> > GLFW æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨æ¥åˆ›å»ºçª—å£ã€å¤„ç†ç”¨æˆ·è¾“å…¥ï¼ˆé”®ç›˜é¼ æ ‡ï¼‰å’Œè®¾ç½® OpenGL çš„åº“ã€‚\n>\n> - å®ƒå¸®ä½ æ‰“å¼€ä¸€ä¸ªçª—å£ã€è®¾ç½® OpenGL çš„ç‰ˆæœ¬ï¼Œå¹¶å“åº”é¼ æ ‡/é”®ç›˜äº‹ä»¶ã€‚\n> - æ²¡æœ‰ GLFWï¼ˆæˆ–ç±»ä¼¼çš„åº“ï¼‰ï¼Œä½ è¿â€œæ‰“å¼€ç”»å¸ƒâ€éƒ½åšä¸åˆ°ã€‚\n>\n> ------\n>\n> ### ğŸ”¸ GLAD æ˜¯ä»€ä¹ˆï¼Ÿ\n>\n> > GLAD æ˜¯ä¸€ä¸ª OpenGL çš„â€œåŠ è½½å™¨â€ï¼Œå¸®ä½ æŠŠ OpenGL çš„å‡½æ•°éƒ½å‡†å¤‡å¥½ã€‚\n>\n> - å› ä¸º OpenGL çš„å‡½æ•°ä¸æ˜¯è‡ªåŠ¨æä¾›çš„ï¼Œéœ€è¦æ‰‹åŠ¨â€œåŠ è½½â€æ‰èƒ½ä½¿ç”¨ã€‚\n> - GLAD å°±åƒä¸€ä¸ªå·¥å…·ç®±æ‰“å¼€å™¨ï¼Œç¡®ä¿ä½ èƒ½æ­£ç¡®ä½¿ç”¨æ‰€æœ‰ç”»å›¾å·¥å…·ã€‚\n>\n> ------\n>\n> ## ğŸ§  è®°å¿†å°å£è¯€ï¼š\n>\n> **GLFW å¼€çª—å£ï¼ŒGLAD å¼€å·¥å…·ï¼ŒOpenGL å¼€ç”»å›¾ã€‚**\n\nâ€‹\t\n\n\n\n\n\n\n\n> ## OpenGL çš„åæ ‡ç³»ï¼ˆæ ‡å‡†åŒ–è®¾å¤‡åæ ‡ NDCï¼‰\n>\n> 1. **åæ ‡èŒƒå›´ï¼š**\n>     OpenGL åœ¨æ¸²æŸ“ç®¡çº¿æœ€åä¸€æ­¥ï¼Œä¼šæŠŠé¡¶ç‚¹åæ ‡å˜æ¢åˆ°ä¸€ä¸ªå«åš **æ ‡å‡†åŒ–è®¾å¤‡åæ ‡**ï¼ˆNDCï¼ŒNormalized Device Coordinatesï¼‰çš„ç©ºé—´é‡Œã€‚\n>    - Xè½´èŒƒå›´ï¼šä» **-1 åˆ° 1**ï¼ˆå·¦åˆ°å³ï¼‰\n>    - Yè½´èŒƒå›´ï¼šä» **-1 åˆ° 1**ï¼ˆä¸‹åˆ°ä¸Šï¼‰\n>    - Zè½´èŒƒå›´ï¼šä» **-1 åˆ° 1**ï¼ˆè¿‘åˆ°è¿œï¼Œæ·±åº¦ï¼‰\n> 2. **åæ ‡è½´æ–¹å‘ï¼š**\n>    - Xè½´ï¼šè´Ÿæ–¹å‘æŒ‡å‘å·¦ï¼Œæ­£æ–¹å‘æŒ‡å‘å³\n>    - Yè½´ï¼šè´Ÿæ–¹å‘æŒ‡å‘ä¸‹ï¼Œæ­£æ–¹å‘æŒ‡å‘ä¸Š\n>    - Zè½´ï¼šè´Ÿæ–¹å‘æŒ‡å‘å±å¹•å¤–ï¼ˆè§‚å¯Ÿè€…æ–¹å‘ï¼‰ï¼Œæ­£æ–¹å‘æŒ‡å‘å±å¹•å†…\n> 3. **äºŒç»´ç»˜å›¾æ—¶ï¼ŒZè½´é€šå¸¸ä¸º0**\n> 4. **åŸç‚¹åœ¨æ˜¾ç¤ºçª—å£çš„ä¸­å¿ƒç‚¹**\n\n\n\n\n\nâ€‹\tVBOæ˜¯ä»€ä¹ˆï¼Ÿé¡¶ç‚¹ç¼“å†²å¯¹è±¡ï¼Œç”¨æ¥ç®¡ç†å†…å­˜ã€‚çœ‹ä¸‹é¢çš„ä»£ç ï¼Œå°±æ˜¯ä½¿ç”¨**glGenBuffers**å‡½æ•°ç”Ÿæˆä¸€ä¸ªå¸¦æœ‰ç¼“å†²IDçš„VBOå¯¹è±¡ã€‚\n\n```java\nunsigned int VBO;\nglGenBuffers(1, &VBO);\n```\n\n> ğŸ§  ä¸ºä»€ä¹ˆ VBO æ˜¯ä¸€ä¸ª `unsigned int` å˜é‡ï¼Ÿ\n>\n> â€”â€”å› ä¸ºåœ¨ OpenGL çš„å†…éƒ¨è®¾è®¡ä¸­ï¼Œæ¯ä¸€ä¸ªâ€œå¯¹è±¡â€ï¼ˆæ¯”å¦‚ç¼“å†²åŒºå¯¹è±¡ã€çº¹ç†å¯¹è±¡ã€ç€è‰²å™¨å¯¹è±¡ï¼‰éƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„æ•°å­— IDï¼Œè¿™ä¸ª ID å°±æ˜¯ä¸€ä¸ªæ•´æ•°ã€‚OpenGL å¹¶ä¸ç›´æ¥è¿”å›ä¸€ä¸ªâ€œæŒ‡é’ˆâ€æˆ–è€…â€œç»“æ„ä½“â€ï¼Œå®ƒåªè¿”å›ä¸€ä¸ªæ•´æ•°å€¼ï¼Œç„¶åä½ ä»¥ååªè¦ç”¨è¿™ä¸ªæ•°å­—æ¥å¼•ç”¨è¿™ä¸ªå¯¹è±¡å°±è¡Œäº†ã€‚\n>\n> â“é‚£ VBO æœ¬èº«æ˜¯ç¼“å†²åŒºå—ï¼Ÿ\n>\n> â€”â€”ä¸æ˜¯ã€‚VBOåªæ˜¯ä¸€ä¸ªæ•´æ•°å˜é‡ï¼Œç”¨æ¥å­˜è¿™ä¸ªç¼“å†²åŒºçš„IDï¼ŒçœŸæ­£çš„â€œç¼“å†²åŒºå¯¹è±¡â€æ˜¯åœ¨OpenGLå†…éƒ¨åˆ›å»ºå’Œç®¡ç†çš„ï¼Œä½ åªèƒ½é€šè¿‡è¿™ä¸ªIDæ¥é—´æ¥ä½¿ç”¨å®ƒã€‚\n\n\n\n\n\nâ€‹\tVAOæ˜¯ä»€ä¹ˆï¼Ÿé¡¶ç‚¹æ•°ç»„å¯¹è±¡ï¼Œå¸®ä½ æŠŠä¸€å †â€œé¡¶ç‚¹å±æ€§è®¾ç½®â€çš„çŠ¶æ€ä¿å­˜èµ·æ¥ï¼Œä¸‹æ¬¡æƒ³ç”¨çš„æ—¶å€™ä¸€ç»‘ä¸Šï¼ŒOpenGL å°±çŸ¥é“ä½ çš„é¡¶ç‚¹æ•°æ®é•¿ä»€ä¹ˆæ ·ï¼Œä¸ç”¨ä½ æ¯æ¬¡éƒ½é‡æ–°è®¾ç½®ã€‚\n\n> ## ä¸ºä»€ä¹ˆè¦æœ‰ VAOï¼Ÿ\n>\n> ä½ ç”»ä¸€ä¸ªå›¾å½¢ï¼Œé¡¶ç‚¹æ•°æ®é™¤äº†é¡¶ç‚¹åæ ‡å¤–ï¼Œè¿˜å¯èƒ½æœ‰é¢œè‰²ã€æ³•çº¿ã€çº¹ç†åæ ‡ç­‰ï¼Œæ¯ç§æ•°æ®éƒ½è¦å‘Šè¯‰ OpenGL æ€ä¹ˆè¯»å–ã€‚\n>\n> ä¸¾ä¸ªä¾‹å­ï¼š\n>\n> - ä½ çš„é¡¶ç‚¹åæ ‡æ•°æ®åœ¨ç¼“å†²åŒºé‡Œçš„èµ·å§‹åœ°å€æ˜¯0ï¼Œå¤§å°æ˜¯3ä¸ªfloat\n> - é¢œè‰²æ•°æ®åœ¨ç¼“å†²åŒºé‡Œçš„èµ·å§‹åœ°å€æ˜¯12å­—èŠ‚ï¼Œå¤§å°æ˜¯3ä¸ªfloat\n>\n> æ¯æ¬¡ç»˜åˆ¶ä¹‹å‰ï¼Œä½ å¾—å‘Šè¯‰ OpenGL è¿™äº›æ•°æ®åœ¨å“ªï¼Œæ ¼å¼æ˜¯ä»€ä¹ˆã€‚\n>\n> å¦‚æœæ²¡æœ‰ VAOï¼Œä½ æ¯æ¬¡ç»˜å›¾éƒ½è¦é‡å¤è¿™äº›ç¹ççš„è®¾ç½®ï¼Œéå¸¸éº»çƒ¦ã€‚\n>\n> ------\n>\n> ## VAOçš„ä½œç”¨å°±æ˜¯å¸®ä½ è®°ä½è¿™äº›è®¾ç½®\n>\n> ä½ å…ˆåˆ›å»ºä¸€ä¸ª VAOï¼Œç»‘å®šå®ƒï¼š\n>\n> ```java\n> unsigned int VAO;\n> glGenVertexArrays(1, &VAO);\n> glBindVertexArray(VAO);\n> ```\n>\n> ç„¶åä½ åšå„ç§é¡¶ç‚¹å±æ€§è®¾ç½®ï¼š\n>\n> ```java\n> glBindBuffer(GL_ARRAY_BUFFER, VBO);\n> glVertexAttribPointer(...);\n> glEnableVertexAttribArray(...);\n> ```\n>\n> è¿™äº›è®¾ç½®éƒ½ä¼šè¢« VAO è®°å½•ã€‚\n>\n> ä»¥åä½ åªè¦ï¼š\n>\n> ```java\n> glBindVertexArray(VAO);\n> ```\n>\n> OpenGLå°±è‡ªåŠ¨çŸ¥é“æ‰€æœ‰é¡¶ç‚¹å±æ€§è®¾ç½®ï¼Œä½ å¯ä»¥ç›´æ¥ç”»å›¾äº†ã€‚\n>\n> ------\n>\n> ## ç®€å•æ¯”å–»\n>\n> - **æ²¡æœ‰ VAO**ï¼šæ¯æ¬¡ç”»ç”»éƒ½è¦é‡æ–°å‘Šè¯‰ç”»ç¬”é¢œè‰²ã€ç²—ç»†ã€ä½ç½®ï¼Œéº»çƒ¦åˆå®¹æ˜“å‡ºé”™ã€‚\n> - **æœ‰äº† VAO**ï¼šæŠŠç”»ç¬”çš„è®¾ç½®å­˜å¥½ï¼Œä¸‹æ¬¡ç›´æ¥æ‹¿å‡ºæ¥ç”¨ï¼Œç”»ç”»å¿«åˆæ–¹ä¾¿ã€‚\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n------\n\n\n\n### ç¤ºä¾‹ä»£ç è®²è§£ï¼ˆæ³¨é‡Šç‰ˆï¼‰\n\n```c++\n#include<glad/glad.h>\n#include<GLFW/glfw3.h>\n\n#include<iostream>\n\n//å›è°ƒå‡½æ•°å£°æ˜ï¼Œå½“çª—å£å¤§å°æ”¹å˜å°±ä¼šè°ƒç”¨\nvoid framebuffer_size_callback(GLFWwindow* window, int width, int height);\n\n\nint main()\n{\n    glfwInit();\n    //å‘Šè¯‰GLFWæˆ‘ä»¬ä½¿ç”¨OpenGL3.3 Core Profile\n    glfwWindowHint(GLFW_CONTEXT_VERSION_MAJOR, 3);\n    glfwWindowHint(GLFW_CONTEXT_VERSION_MINOR, 3);\n    glfwWindowHint(GLFW_OPENGL_PROFILE, GLFW_OPENGL_CORE_PROFILE);\n    //glfwWindowHint(GLFW_OPENGL_FORWARD_COMPAT, GL_TRUE);\n\n    GLFWwindow* window = glfwCreateWindow(800, 600, \"LearnOpenGL\", NULL, NULL);\t//åˆ›å»ºçª—å£\n    \n    if (window == NULL)\t//æ£€æŸ¥çª—å£åˆ›å»ºçŠ¶æ€\n    {\n        std::cout << \"Failed to create GLFW window\" << std::endl;\n        glfwTerminate();\n        return -1;\n    }\n    glfwMakeContextCurrent(window);\t//æŠŠOpenGLä¸Šä¸‹æ–‡è®¾ç½®ä¸ºè¿™ä¸ªçª—å£\n\n    if (!gladLoadGLLoader((GLADloadproc)glfwGetProcAddress))\t//åˆå§‹åŒ–GLAD\n    {\n        std::cout << \"Failed to initialize GLAD\" << std::endl;\n        return -1;\n    }\n\n    glViewport(0, 0, 800, 600);\t\t//è®¾ç½®è§†å£\n\n    glfwSetFramebufferSizeCallback(window, framebuffer_size_callback);\t//æ³¨å†Œçª—å£å¤§å°å˜åŒ–çš„å›è°ƒå‡½æ•°\n\n    while (!glfwWindowShouldClose(window))\t // åªè¦çª—å£æ²¡è¢«å…³é—­ï¼Œå°±ä¸€ç›´å¾ªç¯\n    {\n        glfwSwapBuffers(window);\t\t// äº¤æ¢é¢œè‰²ç¼“å†²ï¼ˆæŠŠæ¸²æŸ“çš„å›¾åƒæ˜¾ç¤ºåˆ°å±å¹•ä¸Šï¼‰\n        glfwPollEvents();\t\t// å¤„ç†é”®ç›˜é¼ æ ‡ç­‰äº‹ä»¶\n    }\n    glfwTerminate();\t// æ¸…ç†å¹¶é€€å‡º GLFW\n    return 0;\n}\n\nvoid framebuffer_size_callback(GLFWwindow* window, int width, int height)\n{\n    glViewport(0, 0, width, height);\t\t// æ ¹æ®æ–°çš„çª—å£å¤§å°é‡æ–°è®¾ç½®è§†å£\n}\n```\n\n\n\n\n\n### ä½œä¸šä¸€\n\n\n\n- **ç»˜åˆ¶æ¸å˜è‰²çš„ä¸‰è§’å½¢**\n\n```c++\n#include <glad/glad.h>\n#include <GLFW/glfw3.h>\n#include <iostream>\n\n// çª—å£å¤§å°å˜åŒ–æ—¶è°ƒæ•´è§†å£\nvoid framebuffer_size_callback(GLFWwindow* window, int width, int height)\n{\n    glViewport(0, 0, width, height);\n}\n\n// æ£€æŸ¥ç€è‰²å™¨ç¼–è¯‘é”™è¯¯\nvoid checkCompileErrors(unsigned int shader, std::string type)\n{\n    int success;\n    char infoLog[1024];\n    if (type != \"PROGRAM\")\n    {\n        glGetShaderiv(shader, GL_COMPILE_STATUS, &success);\n        if (!success)\n        {\n            glGetShaderInfoLog(shader, 1024, NULL, infoLog);\n            std::cout << \"ERROR::SHADER_COMPILATION_ERROR of type: \" << type << \"\\n\"\n                << infoLog << \"\\n -- --------------------------------------------------- -- \" << std::endl;\n        }\n    }\n    else\n    {\n        glGetProgramiv(shader, GL_LINK_STATUS, &success);\n        if (!success)\n        {\n            glGetProgramInfoLog(shader, 1024, NULL, infoLog);\n            std::cout << \"ERROR::PROGRAM_LINKING_ERROR of type: \" << type << \"\\n\"\n                << infoLog << \"\\n -- --------------------------------------------------- -- \" << std::endl;\n        }\n    }\n}\n\nint main()\n{\n    // 1. åˆå§‹åŒ– GLFW\n    glfwInit();\n    glfwWindowHint(GLFW_CONTEXT_VERSION_MAJOR, 3); // OpenGL 3.x\n    glfwWindowHint(GLFW_CONTEXT_VERSION_MINOR, 3); // OpenGL x.3\n    glfwWindowHint(GLFW_OPENGL_PROFILE, GLFW_OPENGL_CORE_PROFILE); // æ ¸å¿ƒæ¨¡å¼\n\n#ifdef __APPLE__\n    glfwWindowHint(GLFW_OPENGL_FORWARD_COMPAT, GL_TRUE); // MacOS éœ€è¦è¿™å¥\n#endif\n\n    // 2. åˆ›å»ºçª—å£\n    GLFWwindow* window = glfwCreateWindow(800, 600, \"Colored Triangle\", NULL, NULL);\n    if (window == NULL)\n    {\n        std::cout << \"Failed to create GLFW window\\n\";\n        glfwTerminate();\n        return -1;\n    }\n    glfwMakeContextCurrent(window);\n\n    // 3. åˆå§‹åŒ– GLAD\n    if (!gladLoadGLLoader((GLADloadproc)glfwGetProcAddress))\n    {\n        std::cout << \"Failed to initialize GLAD\\n\";\n        return -1;\n    }\n\n    // 4. è®¾ç½®è§†å£å’Œçª—å£å¤§å°å›è°ƒ\n    glViewport(0, 0, 800, 600);\n    glfwSetFramebufferSizeCallback(window, framebuffer_size_callback);\n\n    // 5. å®šä¹‰é¡¶ç‚¹æ•°æ®ï¼ˆä½ç½® + é¢œè‰²ï¼‰\n    float vertices[] = {\n        // ä½ç½®           // é¢œè‰²(R, G, B)\n         0.0f,  0.5f, 0.0f,  0.0f, 0.0f, 1.0f,  // é¡¶ç‚¹1 è“è‰²\n        -0.5f, -0.5f, 0.0f,  0.0f, 1.0f, 0.0f,  // é¡¶ç‚¹2 ç»¿è‰²\n         0.5f, -0.5f, 0.0f,  1.0f, 0.0f, 0.0f   // é¡¶ç‚¹3 çº¢è‰²\n    };\n\n    // 6. ç¼–å†™é¡¶ç‚¹ç€è‰²å™¨æºç \n    const char* vertexShaderSource = R\"glsl(\n        #version 330 core\n        layout (location = 0) in vec3 aPos;   // ä½ç½®å±æ€§\n        layout (location = 1) in vec3 aColor; // é¢œè‰²å±æ€§\n\n        out vec3 ourColor; // è¾“å‡ºç»™ç‰‡å…ƒç€è‰²å™¨çš„é¢œè‰²å˜é‡\n\n        void main()\n        {\n            gl_Position = vec4(aPos, 1.0); // è®¾ç½®é¡¶ç‚¹ä½ç½®\n            ourColor = aColor;              // ä¼ é€’é¢œè‰²åˆ°ç‰‡å…ƒç€è‰²å™¨\n        }\n    )glsl\";\n\n    // 7. ç¼–å†™ç‰‡å…ƒç€è‰²å™¨æºç \n    const char* fragmentShaderSource = R\"glsl(\n        #version 330 core\n        in vec3 ourColor;       // ä»é¡¶ç‚¹ç€è‰²å™¨ä¼ æ¥çš„é¢œè‰²\n\n        out vec4 FragColor;     // è¾“å‡ºé¢œè‰²\n\n        void main()\n        {\n            FragColor = vec4(ourColor, 1.0); // è®¾ç½®ç‰‡å…ƒé¢œè‰²ï¼Œalphaä¸º1ï¼ˆä¸é€æ˜ï¼‰\n        }\n    )glsl\";\n\n    // 8. ç¼–è¯‘é¡¶ç‚¹ç€è‰²å™¨\n    unsigned int vertexShader = glCreateShader(GL_VERTEX_SHADER);\n    glShaderSource(vertexShader, 1, &vertexShaderSource, NULL);\n    glCompileShader(vertexShader);\n    checkCompileErrors(vertexShader, \"VERTEX\");\n\n    // 9. ç¼–è¯‘ç‰‡å…ƒç€è‰²å™¨\n    unsigned int fragmentShader = glCreateShader(GL_FRAGMENT_SHADER);\n    glShaderSource(fragmentShader, 1, &fragmentShaderSource, NULL);\n    glCompileShader(fragmentShader);\n    checkCompileErrors(fragmentShader, \"FRAGMENT\");\n\n    // 10. é“¾æ¥ç€è‰²å™¨ç¨‹åº\n    unsigned int shaderProgram = glCreateProgram();\n    glAttachShader(shaderProgram, vertexShader);\n    glAttachShader(shaderProgram, fragmentShader);\n    glLinkProgram(shaderProgram);\n    checkCompileErrors(shaderProgram, \"PROGRAM\");\n\n    // 11. åˆ é™¤ç€è‰²å™¨å¯¹è±¡ï¼Œå·²ç»é“¾æ¥åˆ°ç¨‹åºé‡Œäº†\n    glDeleteShader(vertexShader);\n    glDeleteShader(fragmentShader);\n\n    // 12. åˆ›å»ºé¡¶ç‚¹ç¼“å†²å’Œé¡¶ç‚¹æ•°ç»„å¯¹è±¡\n    unsigned int VBO, VAO;\n    glGenVertexArrays(1, &VAO);\n    glGenBuffers(1, &VBO);\n\n    // ç»‘å®š VAO\n    glBindVertexArray(VAO);\n\n    // ç»‘å®šå¹¶å¡«å…… VBO\n    glBindBuffer(GL_ARRAY_BUFFER, VBO);\n    glBufferData(GL_ARRAY_BUFFER, sizeof(vertices), vertices, GL_STATIC_DRAW);\n\n    // ä½ç½®å±æ€§\n    glVertexAttribPointer(0, 3, GL_FLOAT, GL_FALSE, 6 * sizeof(float), (void*)0);\n    glEnableVertexAttribArray(0);\n\n    // é¢œè‰²å±æ€§\n    glVertexAttribPointer(1, 3, GL_FLOAT, GL_FALSE, 6 * sizeof(float), (void*)(3 * sizeof(float)));\n    glEnableVertexAttribArray(1);\n\n    // è§£ç»‘\n    glBindBuffer(GL_ARRAY_BUFFER, 0);\n    glBindVertexArray(0);\n\n    // 13. æ¸²æŸ“å¾ªç¯\n    while (!glfwWindowShouldClose(window))\n    {\n        // å¤„ç†è¾“å…¥ï¼ˆè¿™é‡Œæ²¡å†™è¾“å…¥ï¼Œåç»­å¯ä»¥åŠ ï¼‰\n\n        // æ¸…å±ï¼Œè®¾ç½®èƒŒæ™¯é¢œè‰²\n        glClearColor(0.2f, 0.3f, 0.3f, 1.0f);\n        glClear(GL_COLOR_BUFFER_BIT);\n\n        // ä½¿ç”¨ç€è‰²å™¨ç¨‹åº\n        glUseProgram(shaderProgram);\n\n        // ç»‘å®š VAO\n        glBindVertexArray(VAO);\n\n        // ç»˜åˆ¶ä¸‰è§’å½¢\n        glDrawArrays(GL_TRIANGLES, 0, 3);\n\n        // äº¤æ¢ç¼“å†²åŒºå’Œè½®è¯¢äº‹ä»¶\n        glfwSwapBuffers(window);\n        glfwPollEvents();\n    }\n\n    // 14. é‡Šæ”¾èµ„æº\n    glDeleteVertexArrays(1, &VAO);\n    glDeleteBuffers(1, &VBO);\n    glDeleteProgram(shaderProgram);\n\n    // 15. é€€å‡º GLFW\n    glfwTerminate();\n    return 0;\n}\n```\n\n\n\n![image-20250625101600766](/pictures/OpenGL/image-20250625101600766.png)\n\n\n\n\n\n### ç»ƒä¹ \n\n- æ·»åŠ æ›´å¤šé¡¶ç‚¹åˆ°æ•°æ®ä¸­ï¼Œä½¿ç”¨glDrawArraysï¼Œå°è¯•ç»˜åˆ¶ä¸¤ä¸ªå½¼æ­¤ç›¸è¿çš„ä¸‰è§’å½¢ã€‚\n\nâ€‹\tç›¸è¾ƒäºä¸Šé¢çš„ä»£ç ï¼Œåªéœ€ä¿®æ”¹ä¸¤å¤„å³å¯ï¼šæ·»åŠ é¡¶ç‚¹ï¼ˆåæ ‡å’Œé¢œè‰²å±æ€§ï¼‰ã€ç»˜åˆ¶6ä¸ªé¡¶ç‚¹ã€‚\n\n```java\nfloat vertices[] = {\n\t-0.9f, -0.5f, 0.0f, 0.0f, 0.0f, 1.0f,\n\t-0.0f, -0.5f, 0.0f, 0.0f, 1.0f, 0.0f,\n\t-0.45f, 0.5f, 0.0f, 1.0f, 0.0f, 0.0f,\n\t 0.0f, -0.5f, 0.0f, 0.0f, 0.0f, 1.0f, \n\t 0.9f, -0.5f, 0.0f, 0.0f, 1.0f, 0.0f,\n\t 0.45f, 0.5f, 0.0f, 1.0f, 0.0f, 0.0f\n};\n\nglDrawArrays(GL_TRIANGLES, 0, 6);\t//ç”¨é¡¶ç‚¹æ•°ç»„ä»ç¬¬ 0 ä¸ªé¡¶ç‚¹å¼€å§‹ï¼ŒæŒ‰ä¸‰è§’å½¢æ–¹å¼ï¼Œç»˜åˆ¶ 6ä¸ªé¡¶ç‚¹ç»„æˆçš„ä¸¤ä¸ªä¸‰è§’å½¢ã€‚\n```\n\n![image-20250626135154793](/pictures/OpenGL/image-20250626135154793.png)\n\n\n\n\n\n\n\n- åˆ›å»ºç›¸åŒçš„ä¸¤ä¸ªä¸‰è§’å½¢ï¼Œä½†å¯¹å®ƒä»¬çš„æ•°æ®ä½¿ç”¨ä¸åŒçš„VAOå’ŒVBOã€‚\n\nâ€‹\tå…¶ä»–éƒ¨åˆ†ä¸å˜ï¼Œæ”¹åŠ¨å¦‚ä¸‹ï¼šåˆ›å»ºæ—¶ä½¿ç”¨æ•°ç»„å­˜å‚¨å¤šä¸ªVAOå’ŒVBOã€ä¸¤ä¸ªä¸‰è§’å½¢é¡¶ç‚¹æ•°æ®åˆ†ä¸ºä¸åŒæ•°ç»„å­˜å‚¨ã€åˆ†å¼€ç»‘å®šå¹¶ä¸”ä¼ è¾“æ•°æ®è§£ææ•°æ®ã€åˆ†å¼€ç»˜åˆ¶ã€‚\n\n```java\nunsigned int VBOs[2], VAOs[2];\nglGenVertexArrays(2, VAOs); // we can also generate multiple VAOs or buffers at the same time\nglGenBuffers(2, VBOs);\n\nfloat firstTriangle[] = {\n    -0.9f, -0.5f, 0.0f,  // left \n    -0.0f, -0.5f, 0.0f,  // right\n    -0.45f, 0.5f, 0.0f,  // top \n};\nfloat secondTriangle[] = {\n     0.0f, -0.5f, 0.0f,  // left\n     0.9f, -0.5f, 0.0f,  // right\n     0.45f, 0.5f, 0.0f   // top \n};\n\nglBindVertexArray(VAOs[0]);\nglBindBuffer(GL_ARRAY_BUFFER, VBOs[0]);\nglBufferData(GL_ARRAY_BUFFER, sizeof(firstTriangle), firstTriangle, GL_STATIC_DRAW);\nglVertexAttribPointer(0, 3, GL_FLOAT, GL_FALSE, 3 * sizeof(float), (void*)0);\t// Vertex attributes stay the same\nglEnableVertexAttribArray(0);\n\nglBindVertexArray(VAOs[1]);\t// ç»‘å®šæ–°çš„VAO\nglBindBuffer(GL_ARRAY_BUFFER, VBOs[1]);\t//ç»‘å®šæ–°çš„VBO\nglBufferData(GL_ARRAY_BUFFER, sizeof(secondTriangle), secondTriangle, GL_STATIC_DRAW); //ä¼ è¾“æ•°æ®åˆ°VBOä»£è¡¨çš„ç¼“å†²åŒº\nglVertexAttribPointer(0, 3, GL_FLOAT, GL_FALSE, 0, (void*)0); \t\t//æŒ‡å®šè¯»å–æ–¹å¼\nglEnableVertexAttribArray(0);\t\t\t//å¯ç”¨é¡¶ç‚¹å±æ€§\n\nglBindVertexArray(VAOs[0]);\nglDrawArrays(GL_TRIANGLES, 0, 3);\n        // then we draw the second triangle using the data from the second VAO\nglBindVertexArray(VAOs[1]);\nglDrawArrays(GL_TRIANGLES, 0, 3);\n```\n\nâ€‹\t**glVertexAttribPointer**å‡½æ•°çš„å‚æ•°è›®å¤šï¼Œå»ºè®®è¾¹çœ‹LearnOpenGLé¡¹ç›®ã€‚\n\n\n\n\n\n\n\n- åˆ›å»ºä¸¤ä¸ªç€è‰²å™¨ç¨‹åºï¼Œç¬¬äºŒä¸ªç¨‹åºä½¿ç”¨ä¸€ä¸ªä¸åŒçš„ç‰‡æ®µç€è‰²å™¨ï¼Œè¾“å‡ºé»„è‰²ï¼›å†æ¬¡ç»˜åˆ¶è¿™ä¸¤ä¸ªä¸‰è§’å½¢ï¼Œè®©å…¶ä¸­ä¸€ä¸ªè¾“å‡ºä¸ºé»„è‰²ã€‚\n\nâ€‹\t\n\nâ€‹\tåœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šï¼Œåˆ›å»ºä¸¤ä¸ª**shaderProgram**ã€**fragmentshader**ï¼Œç„¶åç¼–è¯‘å¥½ä¸‰ä¸ªç€è‰²å™¨ï¼ˆåŒ…æ‹¬ä¸€ä¸ªå…±ç”¨çš„é¡¶ç‚¹ç€è‰²å™¨ï¼‰ï¼Œä¹‹ååˆ†ç»„é“¾æ¥åˆ°**shaderProgram**ä¸­ï¼Œæœ€å**while**å¾ªç¯ä¸­ï¼Œåˆ†åˆ«ä½¿ç”¨**glUseProgram**å‡½æ•°æŒ‡å®šæ¸²æŸ“ç¨‹åºè¿›è¡Œç»˜ç”»ã€‚","tags":["OpenGL"],"categories":["å¼€å‘"]},{"title":"é˜…è¯»APPé¡¹ç›®å­¦ä¹ â€”â€”4","url":"/2025/06/24/é˜…è¯»é¡¹ç›®å­¦ä¹ /å®‰å“é¡¹ç›®å­¦ä¹ 4/","content":"\n\n\n\n\n### æ­£æ–‡\n\nâ€‹\t\n\nâ€‹\t**BaseFragment**æŠ½è±¡ç±»ï¼Œæ˜¯ä¸€ä¸ªåŸºç¡€çš„Fragmentç±»å®ç°ï¼Œç»§æ‰¿è‡ª `RxFragment`ï¼ˆè¿™æ˜¯ä¸€ä¸ªæ”¯æŒ RxJava ç”Ÿå‘½å‘¨æœŸç®¡ç†çš„ Fragmentï¼‰ï¼Œç”±äºè¯¥çˆ¶ç±»å®ç°äº†IViewçš„æ–¹æ³•ï¼Œæ‰€ä»¥å¯ä»¥ä¸å†å®ç°ã€‚\n\nâ€‹\t**BaseFragment<T extends IPresenter>**ï¼šè¿™æ˜¯ä¸€ä¸ªæ³›å‹ç±»ï¼Œæ³›å‹å‚æ•° `T` å¿…é¡»æ˜¯ **IPresenter** æ¥å£çš„å­ç±»ã€‚è¯´æ˜è¿™ä¸ª Fragment ä¼šå’ŒæŸä¸ª Presenter å…³è”ï¼Œç¬¦åˆ MVP æ¶æ„è®¾è®¡æ¨¡å¼ã€‚\n\n```java\nprotected View view;\t\t\t\t//ä¿å­˜å½“å‰Fragmentçš„æ ¹å¸ƒå±€è§†å›¾\nprotected Bundle savedInstanceState;\t\t//ä¿å­˜ Fragment çŠ¶æ€æ•°æ®\n@Nullable\n@Override\npublic View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {\n\tthis.savedInstanceState = savedInstanceState;\n\tinitSDK();\n\tview = createView(inflater, container);\n\tinitData();\n\tbindView();\n\tbindEvent();\n\tfirstRequest();\n\treturn view;\n}\n    /**\n     * äº‹ä»¶è§¦å‘ç»‘å®š\n     */\n    protected void bindEvent() {\n\n    }\n    /**\n     * æ§ä»¶ç»‘å®š\n     */\n    protected void bindView() {\n\n    }\n    /**\n     * æ•°æ®åˆå§‹åŒ–\n     */\n    protected void initData() {\n\n    }\n    /**\n     * é¦–æ¬¡é€»è¾‘æ“ä½œ\n     */\n    protected void firstRequest() {\n\n    }\n    /**\n     * åŠ è½½å¸ƒå±€\n     */\n    protected abstract View createView(LayoutInflater inflater, ViewGroup container);\n    /**\n     * ç¬¬ä¸‰æ–¹SDKåˆå§‹åŒ–\n     */\n    protected void initSDK() {\n\n    }\n```\n\nâ€‹\t`onCreateView` æ˜¯ Fragment åˆ›å»ºè§†å›¾æ—¶è°ƒç”¨çš„å›è°ƒæ–¹æ³•ï¼ˆç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼‰ï¼Œå®ƒè´Ÿè´£åŠ è½½å¹¶è¿”å› Fragment çš„å¸ƒå±€è§†å›¾ã€‚\n\n\n\n\n\n\n\n\n\nâ€‹\t**BaseModelImpl**ç±»ç”¨æ¥åˆ›å»ºç½‘ç»œè¯·æ±‚å®¢æˆ·ç«¯çš„åŸºç¡€æ¨¡å‹ç±»ï¼Œå®ƒä¸»è¦è´Ÿè´£é…ç½®å¹¶ç”Ÿæˆ Retrofit å®ä¾‹ï¼Œæ–¹ä¾¿å…¶ä»–æ¨¡å—è°ƒç”¨ç½‘ç»œæ¥å£ã€‚ä½¿ç”¨OkHttpçš„**OkHttpClient.Builder**æ¥åˆ›å»ºå®¢æˆ·ç«¯ï¼Œè®¾ç½®äº†è¿æ¥è¶…æ—¶ã€å†™è¶…æ—¶ã€è¯»è¶…æ—¶ï¼Œå’Œä¸€ä¸ªè‡ªå®šä¹‰çš„ç½‘ç»œæ‹¦æˆªå™¨ï¼Œç”¨äºè¯·æ±‚å¤±è´¥åçš„é‡è¯•é€»è¾‘ã€‚\n\nâ€‹\t**getRetrofitObject**æ–¹æ³•ç”¨æ¥åˆ›å»ºä¸€ä¸ªRetrofitå®ä¾‹ï¼Œä¼ å…¥åŸºç¡€çš„URLã€‚\n\nâ€‹\t**getRetrofitString**å’Œä¸Šé¢çš„æ–¹æ³•ç±»ä¼¼ï¼Œç”¨æ¥å¤„ç†ä¸åŒç¼–ç ï¼ˆ`encode`ï¼‰çš„å­—ç¬¦ä¸²è½¬æ¢ã€‚\n\n```java\npublic class BaseModelImpl {\n\n    protected OkHttpClient.Builder clientBuilder = new OkHttpClient.Builder()\n            .connectTimeout(10, TimeUnit.SECONDS)\n            .writeTimeout(10, TimeUnit.SECONDS)\n            .readTimeout(10, TimeUnit.SECONDS)\n            .addNetworkInterceptor(new RetryIntercepter(1));\n\n    protected Retrofit getRetrofitObject(String url) {\n        return new Retrofit.Builder().baseUrl(url)\n                //å¢åŠ è¿”å›å€¼ä¸ºå­—ç¬¦ä¸²çš„æ”¯æŒ(ä»¥å®ä½“ç±»è¿”å›)\n                .addConverterFactory(ScalarsConverterFactory.create())\n                //å¢åŠ è¿”å›å€¼ä¸ºOservable<T>çš„æ”¯æŒ\n                .addCallAdapterFactory(RxJava2CallAdapterFactory.create())\n                .client(clientBuilder.build())\n                .build();\n    }\n\n    protected Retrofit getRetrofitString(String url, String encode) {\n        return new Retrofit.Builder().baseUrl(url)\n                //å¢åŠ è¿”å›å€¼ä¸ºå­—ç¬¦ä¸²çš„æ”¯æŒ(ä»¥å®ä½“ç±»è¿”å›)\n                .addConverterFactory(EncodoConverter.create(encode))\n                //å¢åŠ è¿”å›å€¼ä¸ºOservable<T>çš„æ”¯æŒ\n                .addCallAdapterFactory(RxJava2CallAdapterFactory.create())\n                .client(clientBuilder.build())\n                .build();\n    }\n}\n```\n\n> 1. Retrofit æ˜¯ä»€ä¹ˆï¼Ÿ\n>\n> - Retrofit æ˜¯ç”± Square å…¬å¸å¼€å‘çš„ä¸€ä¸ª **Android å’Œ Java** å¹³å°ä¸Šçš„ç½‘ç»œè¯·æ±‚åº“ã€‚\n> - å®ƒå¸®åŠ©ä½ å¾ˆæ–¹ä¾¿åœ°è°ƒç”¨ç½‘ç»œä¸Šçš„ **HTTP æ¥å£**ï¼ˆAPIï¼‰ï¼Œä»æœåŠ¡å™¨æ‹¿æ•°æ®ã€‚\n> - å®ƒå¸®ä½ æŠŠç½‘ç»œè¯·æ±‚å’Œå“åº”å˜å¾—â€œåƒè°ƒç”¨æœ¬åœ°æ–¹æ³•â€ä¸€æ ·ç®€å•ã€‚\n\n\n\n\n\n\n\n\n\n\n\n\n\nâ€‹\t**BasePresenterImpl**æŠ½è±¡ç±»å®ç°äº†attachViewåŠŸèƒ½ï¼Œå¹¶ä¸”é€šè¿‡æ¨¡æ¿Tæ¥è¿›è¡Œç±»å‹è½¬æ¢ï¼Œæ˜¯ä¸€ä¸ªPresenteråŸºç±»ã€‚\n\n```java\npublic abstract class BasePresenterImpl<T extends IView> implements IPresenter{\n    protected T mView;\n\n    @Override\n    public void attachView(@NonNull IView iView) {\n        mView = (T) iView;\n    }\n}\n```\n\n\n\n\n\n\n\n\n\nâ€‹\t**RetryIntercepter**ç±»æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„ **OkHttp æ‹¦æˆªå™¨**ï¼Œå…¶ä¸­`Request` ä»£è¡¨è¿™æ¬¡ç½‘ç»œè¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ¯”å¦‚è¯·æ±‚çš„åœ°å€ã€è¯·æ±‚æ–¹æ³•ï¼ˆGETã€POSTï¼‰ã€è¯·æ±‚å¤´ã€è¯·æ±‚ä½“ç­‰ç­‰ã€‚\n\n> ## ä¸ºä»€ä¹ˆè¦è¿™æ ·å†™ï¼Ÿ\n>\n> æ‹¦æˆªå™¨å°±æ˜¯â€œè¯·æ±‚å’Œå“åº”ä¹‹é—´çš„ä¸­é—´äººâ€ï¼Œå®ƒèƒ½ï¼š\n>\n> - **æ‹¿åˆ°è¯·æ±‚**ï¼ˆ`chain.request()`ï¼‰\n> - **å¯¹è¯·æ±‚åšç‚¹äº‹**ï¼ˆæ¯”å¦‚åŠ ä¸ªå¤´ï¼Œæ”¹æ”¹å‚æ•°ï¼Œæˆ–è€…æ‰“å°æ—¥å¿—ï¼‰\n> - **å‘å‡ºè¯·æ±‚**ï¼ˆ`chain.proceed(request)`ï¼‰\n> - **æ‹¿åˆ°å“åº”**ï¼Œè¿˜å¯ä»¥å¯¹å“åº”åšç‚¹äº‹ï¼ˆæ¯”å¦‚åˆ¤æ–­å¤±è´¥é‡è¯•ï¼‰\n\n```java\npublic class RetryIntercepter implements Interceptor {\n    public int maxRetry;//æœ€å¤§é‡è¯•æ¬¡æ•°\n    private int retryNum = 0;//å‡å¦‚è®¾ç½®ä¸º3æ¬¡é‡è¯•çš„è¯ï¼Œåˆ™æœ€å¤§å¯èƒ½è¯·æ±‚4æ¬¡ï¼ˆé»˜è®¤1æ¬¡+3æ¬¡é‡è¯•ï¼‰\n\n    public RetryIntercepter(int maxRetry) {\n        this.maxRetry = maxRetry;\n    }\n\n    @Override\n    public Response intercept(Chain chain) throws IOException {\n        Request request = chain.request();\n        Response response = chain.proceed(request);\n        while (!response.isSuccessful() && retryNum < maxRetry) {\n            retryNum++;\n            response = chain.proceed(request);\n        }\n        return response;\n    }\n}\n```\n\n\n\n\n\n\n\n\n\nâ€‹\tbasemvplibåˆ†æå®Œäº†ï¼Œä¸‹ä¸€æ­¥è¦åˆ†æmonkyåŒ…ã€‚å…ˆå¤§ä½“é€šè¿‡AIé¢„æµ‹ä¸€æ³¢å„ä¸ªæ–‡ä»¶å¤¹çš„å«ä¹‰å’Œå…¶ä¸­ç±»çš„ä½œç”¨ã€‚\n\n> â€‹\t**base**æ–‡ä»¶å¤¹é¡¹ç›®æ˜¯åŸºç¡€ä»£ç ï¼Œæ¯”å¦‚åŸºç±»ï¼ˆBaseActivityã€BaseFragmentã€BasePresenterç­‰ï¼‰ï¼Œå…¬å…±æŠ½è±¡å±‚ï¼Œç”¨æ¥å¤ç”¨å’Œç»Ÿä¸€è§„èŒƒã€‚\n>\n> â€‹\t**bean**æ–‡ä»¶å¤¹å­˜æ”¾æ•°æ®æ¨¡å‹ç±»ï¼ˆå®ä½“ç±»ï¼‰ï¼Œç”¨æ¥è¡¨ç¤ºä¸šåŠ¡æ•°æ®ï¼Œæ¯”å¦‚ä¹¦ç±ä¿¡æ¯ã€ç”¨æˆ·ä¿¡æ¯ç­‰ã€‚é€šå¸¸å’Œæ•°æ®åº“è¡¨ç»“æ„æˆ–è€…æ¥å£è¿”å›æ•°æ®å¯¹åº”ã€‚\n>\n> â€‹\t**cache**ç¼“å­˜ç›¸å…³çš„ä»£ç ï¼Œè´Ÿè´£æ•°æ®ç¼“å­˜é€»è¾‘ã€‚\n>\n> â€‹\t**common**é…ç½®çš„æ˜¯è®¿é—®å°è¯´ç½‘ç«™çš„APIæ¥å£ã€‚\n>\n> â€‹\t**dao**æ˜¯ Data Access Objectï¼ˆæ•°æ®è®¿é—®å¯¹è±¡ï¼‰ çš„ç¼©å†™ï¼Œæ•°æ®è®¿é—®å±‚ï¼Œå°è£…æ•°æ®åº“æ“ä½œï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰ï¼Œé€šå¸¸å¯¹åº”å®ä½“beanï¼Œæœ‰ä¸“é—¨çš„æ¥å£æˆ–ç±»å¤„ç†æ•°æ®å­˜å–ã€‚\n>\n> â€‹\t**listener**å®šä¹‰è·å–ç« èŠ‚åˆ—è¡¨çš„å›è°ƒé€šçŸ¥ã€‚\n>\n> â€‹\t**model**ä¸šåŠ¡é€»è¾‘å±‚ï¼Œå¤„ç†å…·ä½“çš„æ•°æ®æ“ä½œå’Œä¸šåŠ¡è§„åˆ™ã€‚\n>\n> â€‹\t**presenter**è¿™é‡Œæ˜¯ Presenter å±‚ï¼Œè´Ÿè´£è¿æ¥ View å’Œ Modelï¼Œå®ç°ä¸šåŠ¡é€»è¾‘ï¼Œå¤„ç†ç•Œé¢å’Œæ•°æ®çš„äº¤äº’ã€‚\n>\n> â€‹\t**service**ä¸€èˆ¬æ”¾åå°æœåŠ¡ç›¸å…³ä»£ç ï¼Œæ¯”å¦‚ Android çš„ Service ç±»ï¼ŒåšæŒç»­åå°ä»»åŠ¡ï¼Œæˆ–è€…å°è£…ç½‘ç»œè¯·æ±‚ã€ç³»ç»ŸæœåŠ¡æ“ä½œç­‰ã€‚\n>\n> â€‹\t**utils**å·¥å…·ç±»åŒ…ï¼Œå­˜æ”¾å„ç§è¾…åŠ©ç±»å’Œé™æ€æ–¹æ³•ã€‚\n>\n> â€‹\t**view**è‡ªå®šä¹‰çš„è§†å›¾ç±»ï¼Œæˆ–è€…è·Ÿç•Œé¢ç›¸å…³çš„ç±»ï¼ˆä¸åŒ…æ‹¬ç‰¹æ®Šæ§ä»¶ï¼‰ï¼Œä¸€èˆ¬ç”¨æ¥å°è£…ç•Œé¢é€»è¾‘æˆ–å¤ç”¨ç•Œé¢ç»„ä»¶ã€‚\n>\n> â€‹\t**widget**è‡ªå®šä¹‰æ§ä»¶æˆ–è€… UI ç»„ä»¶ï¼Œæ¯”å¦‚è‡ªå®šä¹‰æŒ‰é’®ã€åˆ—è¡¨ã€åŠ¨ç”»æ§ä»¶ç­‰ï¼Œæ‰©å±•ç³»ç»Ÿæ§ä»¶åŠŸèƒ½ã€‚\n\nâ€‹\t**BitIntentDataManager**ç®¡ç† Intent ä¼ é€’çš„æ•°æ®ï¼Œå°è£… Intent æ•°æ®å¤„ç†é€»è¾‘ï¼Œæ–¹ä¾¿ Activity/Fragment ä¹‹é—´ä¼ å‚ã€‚\n\nâ€‹\t**ErrorAnalyContentManager**é”™è¯¯å†…å®¹åˆ†æç®¡ç†å™¨ï¼Œå¯èƒ½æ˜¯æ—¥å¿—æ”¶é›†ã€é”™è¯¯ä¿¡æ¯å¤„ç†æˆ–è€…é”™è¯¯æŠ¥å‘Šç”Ÿæˆç›¸å…³çš„ç±»ã€‚\n\nâ€‹\t**MApplication**è‡ªå®šä¹‰çš„ Application ç±»ï¼Œåº”ç”¨å…¥å£ï¼Œåˆå§‹åŒ–å…¨å±€å˜é‡ã€SDKã€å•ä¾‹ç­‰ã€‚\n\nâ€‹\t**ProxyManager**ä»£ç†ç®¡ç†å™¨ï¼Œå¯èƒ½ç”¨æ¥å®ç°æŸç§ä»£ç†æ¨¡å¼ï¼ŒåŠ¨æ€ä»£ç†å¯¹è±¡ï¼Œæˆ–è€…è´Ÿè´£ç½‘ç»œä»£ç†ã€è¯·æ±‚ä»£ç†ç­‰åŠŸèƒ½ã€‚\n\nâ€‹\t**ReadBookControl**è¯»ä¹¦æ§åˆ¶å™¨ï¼Œè´Ÿè´£ä¹¦ç±é˜…è¯»ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ¯”å¦‚ç¿»é¡µã€å­—ä½“å¤§å°ã€é˜…è¯»è¿›åº¦ç®¡ç†ç­‰ã€‚\n\n\n\n\n\nâ€‹\tæ”¹å¤©å†ç³»ç»Ÿåˆ†æå§ï¼Œä¸‹é¢åœ¨AIé—®åˆ°äº†ä¸€å¥—æ¯”è¾ƒç³»ç»Ÿçš„åˆ†ææµç¨‹ã€‚\n\n> ## ğŸ§­ ä¸€å¥—ç³»ç»Ÿçš„ MVP é¡¹ç›®åˆ†ææµç¨‹ï¼ˆä» UI åˆ°æ•°æ®ï¼‰\n>\n> ------\n>\n> ### âœ… **ç¬¬ä¸€é˜¶æ®µï¼šææ¸…æ¥šç»“æ„å’Œé¡µé¢å…¥å£**\n>\n> #### æ­¥éª¤ 1ï¼šæ‰“å¼€é¡¹ç›®ï¼Œçœ‹ `åŒ…ç»“æ„`\n>\n> - çœ‹åŒ…åä¸‹æœ‰å“ªäº›æ¨¡å—ï¼ˆä½ å‰é¢æåˆ°çš„ `view/`, `presenter/`, `model/`, `dao/` ç­‰ç­‰ï¼‰ã€‚\n> - äº†è§£é¡¹ç›®æ˜¯ä¸æ˜¯ä½¿ç”¨äº† MVP/MVVM æ¶æ„ï¼ˆä» `presenter/` å’Œ `model/` ç›®å½•å¯ä»¥çœ‹å‡ºï¼‰ã€‚\n>\n> #### æ­¥éª¤ 2ï¼šæ‰¾â€œé¦–é¡µ Activityâ€æˆ–ä¸»å…¥å£é¡µé¢\n>\n> - æ‰¾ `MainActivity`, `LauncherActivity`, `SplashActivity` ç­‰ã€‚\n> - å®ƒä¸€èˆ¬ä¼šæ˜¯ä½ å¯åŠ¨ App åçœ‹åˆ°çš„ç¬¬ä¸€ä¸ªé¡µé¢ã€‚\n>\n> ------\n>\n> ### âœ… **ç¬¬äºŒé˜¶æ®µï¼šä» View å±‚å…¥æ‰‹åˆ†æä¸€ä¸ªé¡µé¢**\n>\n> #### æ­¥éª¤ 3ï¼šä» `Activity` æˆ– `Fragment` å¼€å§‹çœ‹\n>\n> - å…³æ³¨ `onCreate()` æˆ– `onCreateView()` æ–¹æ³•ã€‚\n>\n> - çœ‹å®ƒç»‘å®šäº†å“ªä¸ª Presenterï¼Œä¾‹å¦‚ï¼š\n>\n>   ```java\n>   presenter = new ReadBookPresenter();\n>   presenter.attachView(this);\n>   ```\n>\n> - æŸ¥çœ‹å“ªäº›ç”¨æˆ·æ“ä½œï¼ˆæŒ‰é’®ç‚¹å‡»ã€æ»‘åŠ¨ç­‰ï¼‰è§¦å‘äº†å“ªäº›é€»è¾‘ï¼š\n>\n>   ```java\n>   button.setOnClickListener(v -> presenter.doSomething());\n>   ```\n>\n> #### æ­¥éª¤ 4ï¼šæŸ¥æ‰¾ç»‘å®šçš„ View å’Œè‡ªå®šä¹‰æ§ä»¶\n>\n> - æŸ¥çœ‹ XML å¸ƒå±€æ–‡ä»¶å’Œ `findViewById()` ç»‘å®šäº†å“ªäº›æ§ä»¶ã€‚\n> - å¦‚æœå‘ç°æœ‰ `PageWidget`ã€`ReadSettingView` è¿™ç±»è‡ªå®šä¹‰æ§ä»¶ï¼š\n>   - å…ˆäº†è§£å®ƒçš„å¤§è‡´ä½œç”¨ï¼ˆæ¯”å¦‚ç¿»é¡µã€æ˜¾ç¤ºæ–‡å­—ï¼‰\n>   - å†å†³å®šæ˜¯å¦æ·±å…¥çœ‹å®ƒçš„ç»˜å›¾æˆ–æ‰‹åŠ¿é€»è¾‘ï¼ˆå¾ˆå¤šæ—¶å€™å¯ä»¥ç•¥è¿‡ï¼‰\n>\n> ------\n>\n> ### âœ… **ç¬¬ä¸‰é˜¶æ®µï¼šæ·±å…¥ Presenter å±‚ï¼Œåˆ†æä¸šåŠ¡é€»è¾‘**\n>\n> #### æ­¥éª¤ 5ï¼šæ‰“å¼€å¯¹åº”çš„ `Presenter` ç±»\n>\n> - çœ‹è¿™ä¸ª Presenter çš„æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ\n> - ä½ åœ¨ View å±‚ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œæ˜¯è°ƒç”¨çš„å“ªä¸ªæ–¹æ³•ï¼Ÿ\n>\n> ç¤ºä¾‹ï¼š\n>\n> ```java\n> public void loadBook() {\n>     model.getBookData(new Callback() {\n>         @Override\n>         public void success(BookShelfBean bean) {\n>             view.showContent(bean);\n>         }\n>     });\n> }\n> \n> ```\n>\n> - Presenter æ˜¯ **æ ¸å¿ƒé€»è¾‘ä¸­æ¢**ï¼Œè¿æ¥ View å’Œ Modelã€‚\n>\n> ------\n>\n> ### âœ… **ç¬¬å››é˜¶æ®µï¼šæŸ¥çœ‹ Model å±‚ï¼Œæ•°æ®ä»å“ªæ¥ï¼Ÿ**\n>\n> #### æ­¥éª¤ 6ï¼šæ‰“å¼€ `Model` æˆ– `ModelImpl` ç±»\n>\n> - çœ‹å®ƒæ˜¯ä» **å“ªé‡Œæ‹¿æ•°æ®** çš„ï¼š\n>\n>   - ç½‘ç»œè¯·æ±‚ï¼Ÿï¼ˆæ¯”å¦‚ç”¨ Retrofitï¼‰\n>   - æ•°æ®åº“ï¼Ÿï¼ˆæ¯”å¦‚ç”¨ Daoã€GreenDAOï¼‰\n>   - ç¼“å­˜ï¼Ÿï¼ˆæ¯”å¦‚ç”¨ CacheManagerï¼‰\n>\n> - æŸ¥çœ‹å…·ä½“çš„æ•°æ®æ¥æºï¼Œæ¯”å¦‚ï¼š\n>\n>   ```\n>   RetrofitHelper.getApi().getChapters(bookId);\n>   ```\n>\n> ------\n>\n> ### âœ… **ç¬¬äº”é˜¶æ®µï¼šå¾€ä¸‹çœ‹æ•°æ®æ”¯æ’‘å±‚ï¼ˆå¯é€‰ï¼‰**\n>\n> #### æ­¥éª¤ 7ï¼šæŸ¥çœ‹ Beanã€Daoã€Utils å·¥å…·ç±»\n>\n> - `bean/`ï¼šå®šä¹‰äº†å“ªäº›æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚ `BookShelfBean`, `ChapterBean`ï¼Ÿ\n> - `dao/`ï¼šä½ å¯ä»¥çœ‹çœ‹ `BookShelfBeanDao` æ˜¯å¦‚ä½•å­˜/å–ä¹¦çš„æ•°æ®çš„ã€‚\n> - `utils/`ï¼šåªåœ¨ä½ çœ‹åˆ°ç”¨åˆ°çš„æ—¶å€™å†æ·±å…¥çœ‹ï¼Œæ¯”å¦‚å¤„ç†æ—¥æœŸã€æ–‡ä»¶ã€ç½‘ç»œçŠ¶æ€ç­‰ã€‚\n>\n> ------\n>\n> ### âœ… **ç¬¬å…­é˜¶æ®µï¼šæŸ¥æ‰¾å›è°ƒæœºåˆ¶ä¸äº‹ä»¶æµ**\n>\n> - é¡¹ç›®ä¸­å¯èƒ½ä¼šæœ‰ä¸€äº›å›è°ƒæ¥å£ï¼ˆåƒä½ ä¹‹å‰æåˆ°çš„ `OnGetChapterListListener`ï¼‰\n> - åˆ†æå®ƒä»¬æ˜¯æ€ä¹ˆä¼ å€¼ã€è§¦å‘é€»è¾‘çš„ã€‚\n\n","tags":["å®‰å“å¼€å‘å­¦ä¹ "],"categories":["å¼€å‘"]},{"title":"é˜…è¯»APPé¡¹ç›®å­¦ä¹ â€”â€”3","url":"/2025/06/23/é˜…è¯»é¡¹ç›®å­¦ä¹ /å®‰å“é¡¹ç›®å­¦ä¹ 3/","content":"\n\n\n### å‰è¨€\n\nâ€‹\tåˆ†æå¤æ‚ä¸€ç‚¹çš„åŠŸèƒ½ï¼Œéœ€è¦ç†Ÿæ‚‰é¢å‘å¯¹è±¡çš„ç¼–ç¨‹æ€æƒ³ï¼Œç†Ÿæ‚‰æ›´åŠ åŸºç¡€çš„ä»£ç ï¼Œæˆ‘æ„Ÿè§‰æœ‰ç‚¹åŠ›ä¸ä»å¿ƒï¼Œååˆ†éš¾ä»¥ä¸‹æ‰‹ï¼Œè€ƒè™‘è¦ä¸è¦ä»åŸºç¡€ç±»ä¸€ç‚¹ç‚¹å­¦ä¹ ï¼Œåˆ†æå…¶ä½œç”¨ã€ä¸ºä»€ä¹ˆè¦è¿™æ ·å†™ä¹‹ç±»çš„é—®é¢˜ï¼Œèƒ½å­¦åˆ°å¾ˆå¤šçŸ¥è¯†ç‚¹ï¼Œè¿™æ ·æ˜¯ä¸æ˜¯ä¼šæ›´åŠ æœ‰åˆ©äºæˆ‘çš„å¼€å‘ç»éªŒå­¦ä¹ ï¼Œæ¯•ç«Ÿâ€œè½®å­â€çš„ä»£ç éƒ½è¿˜æ²¡ææ˜ç™½ä¸ºä»€ä¹ˆè¿™ä¹ˆå†™ï¼Œç›´æ¥å»è§£æåœ¨æ­¤åŸºç¡€ä¸Šçš„å…¶ä»–åŠŸèƒ½ä¼šè®©æˆ‘æœ‰ç‚¹ä¸è„šè¸å®åœ°çš„æ„Ÿè§‰ã€‚\n\nâ€‹\tå¦å¤–ï¼Œå› ä¸ºé”™è¯¯çš„æ“ä½œï¼ŒæŠŠèµ„æºæ–‡ä»¶ç»™æä¹±äº†ï¼Œåˆå¾—æ–°å»ºé¡¹ç›®é‡æ–°copyäº†ï¼Œæœ‰ç‚¹çƒ¦ã€‚\n\n\n\nâ€‹\t\n\n### æ­£æ–‡\n\nâ€‹\tå…ˆä»basemvplibçš„æ–‡ä»¶å¼€å§‹å§ï¼ŒIViewå’ŒIPresenterçš„åŸºç¡€æ€æƒ³å·²ç»å­¦ä¹ è¿‡äº†ï¼Œå†ä»**AppActivityManager**ã€**BaseApplication**ã€**EncodoConverter**è¿™ä¸‰ä¸ªç±»å¼€å§‹å§ã€‚\n\nâ€‹\t\n\nâ€‹\t**AppActivityManager**ç±»æ˜¯ç®¡ç†é¡¹ç›®ä¸­æ‰€æœ‰Activityçš„å·¥å…·ç±»ï¼Œæ–¹ä¾¿åœ¨åº”ç”¨ä¸­ç»Ÿä¸€æ§åˆ¶ Activity ç”Ÿå‘½å‘¨æœŸï¼Œæ¯”å¦‚æ‰¹é‡å…³é—­æŸç±» Activity æˆ–æ£€æµ‹ Activity æ˜¯å¦åœ¨æ ˆä¸­ã€‚\n\nâ€‹\t`private static List<WeakReference<Activity>> activities;`ä½¿ç”¨å¼±å¼•ç”¨å­˜å‚¨Activityï¼Œå½“ Activity è¢«ç³»ç»Ÿå›æ”¶æ—¶ï¼Œå¼±å¼•ç”¨ä¸ä¼šé˜»æ­¢å®ƒçš„å›æ”¶ï¼Œé¿å…å¼ºå¼•ç”¨å¯¼è‡´å†…å­˜æ³„æ¼ã€‚\n\n\n\nâ€‹\té€šè¿‡åŒé‡æ£€æŸ¥å®ç°çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼ï¼Œä¿è¯AppActivityManageråœ¨æ•´ä¸ªåº”ç”¨ä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚\n\n```java\npublic static AppActivityManager getInstance(){\n        if(null == instance){\n            synchronized (AppActivityManager.class){\n                if(null == instance){\n                    instance = new AppActivityManager();\n                }\n            }\n        }\n        return instance;\n    }\n\n```\n\n\n\nâ€‹\tæä¾›äº†addã€removeæ–¹æ³•ï¼Œå…¶ä¸­æœ‰ä¸¤ç§ç§»é™¤æ–¹å¼ï¼šæä¾›Activityå®ä¾‹å’ŒActivityç±»åã€‚\n\nâ€‹\tæä¾›äº†finishæ–¹æ³•ï¼Œå¯ä»¥å…³é—­æŒ‡å®šçš„Activityå®ä¾‹æˆ–å…³é—­æŒ‡å®šç±»å‹çš„Activityã€‚\n\nâ€‹\tæä¾›isExistæ–¹æ³•ï¼Œèƒ½å¤Ÿåˆ¤æ–­æŸä¸ªActivityç±»æ˜¯å¦å­˜åœ¨ã€‚\n\n\n\n> ### ç®€å•ç†è§£ï¼š\n>\n> - **Application.onCreate()**\n>    æ˜¯æ•´ä¸ªåº”ç”¨ç¨‹åºçš„â€œå¯åŠ¨å…¥å£â€ï¼Œåœ¨åº”ç”¨ä¸€å¯åŠ¨æ—¶è°ƒç”¨ï¼Œåªè°ƒç”¨ä¸€æ¬¡ã€‚\n>    ä½ å¯ä»¥åœ¨è¿™é‡Œåšä¸€äº›**å…¨å±€åˆå§‹åŒ–**ï¼Œæ¯”å¦‚åˆå§‹åŒ–æ•°æ®åº“ã€ç½‘ç»œåº“ã€ç¬¬ä¸‰æ–¹SDKç­‰ï¼Œæ‰€æœ‰é¡µé¢éƒ½èƒ½ç”¨ã€‚\n> - **Activity.onCreate()**\n>    æ˜¯æŸä¸ªå…·ä½“é¡µé¢ï¼ˆActivityï¼‰åˆ›å»ºæ—¶è°ƒç”¨ã€‚æ¯æ‰“å¼€ä¸€ä¸ªæ–°é¡µé¢ï¼Œå°±ä¼šè°ƒç”¨å®ƒã€‚\n>    ä½ å¯ä»¥åœ¨è¿™é‡Œåšè¿™ä¸ªé¡µé¢ä¸“å±çš„åˆå§‹åŒ–ï¼Œæ¯”å¦‚åŠ è½½å¸ƒå±€ã€è®¾ç½®æŒ‰é’®äº‹ä»¶ç­‰ã€‚\n\n\n\nâ€‹\t**BaseApplication**æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„Applicationç±»ï¼Œæ˜¯å®‰å“åº”ç”¨çš„å…¥å£ç±»ï¼Œæ˜¯åº”ç”¨å¯åŠ¨æ—¶åˆ›å»ºçš„å…¨å±€å…¥å£ï¼Œç”¨æ¥åšå…¨å±€åˆå§‹åŒ–å’Œç®¡ç†ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºç¡€æ¡†æ¶ç±»ï¼Œåªå®ç°äº†onCreateæ–¹æ³•ï¼Œè°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ã€‚\n\n\n\nâ€‹\t**EncodoConverter**ç»§æ‰¿äº† `retrofit2.Converter.Factory`ï¼Œç”¨äºåˆ›å»ºæ•°æ®è½¬æ¢å™¨ï¼›æœ‰ä¸€ä¸ªç§æœ‰å­—æ®µ `encode`ï¼Œé»˜è®¤ç¼–ç æ˜¯ `\"utf-8\"`ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰ä¼ å…¥ç¼–ç ï¼›æä¾›äº†ä¸¤ä¸ªé™æ€æ–¹æ³• `create()` ç”¨äºåˆ›å»ºè¯¥è½¬æ¢å™¨å®ä¾‹ï¼Œå¯ä»¥ç”¨é»˜è®¤ç¼–ç ï¼Œä¹Ÿå¯ä»¥ç”¨è‡ªå®šä¹‰ç¼–ç ï¼›é‡å†™äº† `responseBodyConverter()` æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ª `Converter<ResponseBody, String>`ï¼Œè¿™ä¸ªè½¬æ¢å™¨å°±æ˜¯æŠŠå“åº”ä½“æ•°æ®è¯»å–ä¸ºæŒ‡å®šç¼–ç çš„å­—ç¬¦ä¸²ã€‚\n\nâ€‹\tè¿™æ®µä»£ç å°±æ˜¯ç»™ Retrofit å®šåˆ¶ä¸€ä¸ªå“åº”ä½“çš„ç¼–ç è½¬æ¢å™¨ï¼Œè®©å®ƒå¯ä»¥ç”¨æŒ‡å®šç¼–ç æŠŠæœåŠ¡å™¨è¿”å›çš„å­—èŠ‚æµè½¬æˆå­—ç¬¦ä¸²ã€‚\n\n\n\nâ€‹\t**Retrofit** æ˜¯ä¸€ä¸ªç”¨äº Android å’Œ Java çš„ç½‘ç»œè¯·æ±‚åº“ï¼Œå®ƒå¸®ä½ å¾ˆæ–¹ä¾¿åœ°å‘æœåŠ¡å™¨å‘é€ HTTP è¯·æ±‚ï¼Œè·å–æ•°æ®ï¼Œç„¶åè‡ªåŠ¨æŠŠæœåŠ¡å™¨è¿”å›çš„ JSON æˆ– XML è½¬æ¢æˆä½ å®šä¹‰çš„ Java å¯¹è±¡ï¼Œçœå»äº†ä½ è‡ªå·±å†™å¾ˆå¤šè§£æä»£ç ã€‚\n\n\n\n\n\n\n\nâ€‹\tå†çœ‹**BaseActivity**ç±»ï¼Œå®ƒæ˜¯æ‰€æœ‰Activityçš„åŸºç±»ï¼Œç»Ÿä¸€å°è£…ç”Ÿå‘½å‘¨æœŸæ–¹æ³•å’ŒPresenterç®¡ç†ï¼Œä½¿ç”¨äº†æ³›å‹<T extends IPresenter> è¡¨ç¤ºä¼ å…¥çš„ Presenter ç±»å‹ï¼Œå®ç°äº†IViewã€‚\n\nâ€‹\té¡µé¢åˆå§‹åŒ–æµç¨‹ï¼Œä¸éœ€è¦çš„æ–¹æ³•å¯ä»¥ä¸å®ç°ã€‚\n\n```java\n    /**\n     * ç”Ÿå‘½å‘¨æœŸ onCreateï¼ŒActivity å¯åŠ¨æ—¶è°ƒç”¨ã€‚\n     * è¿™é‡Œç»Ÿä¸€è°ƒç”¨äº†ä¸€ç³»åˆ—åˆå§‹åŒ–æ–¹æ³•ï¼Œä¸‹é¢ä¼šè§£é‡Šæ¯ä¸ªæ–¹æ³•ä½œç”¨ã€‚\n     */\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        this.savedInstanceState = savedInstanceState;\n\n        // è·å–æ˜¯å¦ä½¿ç”¨è½¬åœºåŠ¨ç”»\n        if(getIntent()!=null){\n            startShareAnim = getIntent().getBooleanExtra(start_share_ele,false);\n        }\n\n        // æ·»åŠ åˆ°å…¨å±€Activityç®¡ç†å™¨ä¸­ï¼ˆæ–¹ä¾¿ç»Ÿä¸€å…³é—­ã€ç®¡ç†Activityï¼‰\n        AppActivityManager.getInstance().add(this);\n\n        // ç¬¬ä¸€æ­¥ï¼šåˆå§‹åŒ–ç¬¬ä¸‰æ–¹SDKï¼ˆå¯é€‰ï¼‰\n        initSDK();\n\n        // ç¬¬äºŒæ­¥ï¼šè®¾ç½®å¸ƒå±€ï¼Œæ¯”å¦‚ setContentView(R.layout.xxx)\n        onCreateActivity();\n\n        //ç¬¬ä¸‰æ­¥ï¼šåˆ›å»º Presenter å¯¹è±¡\n        mPresenter = initInjector();\n\n        // ç¬¬å››æ­¥ï¼šå°†å½“å‰Viewç»‘å®šåˆ°Presenterä¸Šï¼ˆç”¨äºé€šçŸ¥åˆ·æ–°ï¼‰\n        attachView();\n\n        // ç¬¬äº”æ­¥ï¼šåˆå§‹åŒ–æ•°æ®ï¼ˆå¦‚é€‚é…å™¨ã€å˜é‡ç­‰ï¼‰\n        initData();\n\n        // ç¬¬å…­æ­¥ï¼šç»‘å®šæ§ä»¶ï¼ˆfindViewByIdï¼‰\n        bindView();\n\n        // ç¬¬ä¸ƒæ­¥ï¼šç»‘å®šäº‹ä»¶ï¼ˆç‚¹å‡»ã€åˆ·æ–°ç­‰é€»è¾‘ï¼‰\n        bindEvent();\n\n        // ç¬¬å…«æ­¥ï¼šå‘èµ·é¦–æ¬¡è¯·æ±‚ï¼Œæ¯”å¦‚ç½‘ç»œåŠ è½½ä¹¦æ¶\n        firstRequest();\n    }\n```\n\nâ€‹\tè¿˜å†™å¥½äº†é¡µé¢çš„è·³è½¬åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯å¯åŠ¨æ–°Activityå¹¶å¸¦åŠ¨ç”»æ•ˆæœçš„æ–¹æ³•ï¼Œæœ‰å¤šç§ï¼Œé€‚é…å¤šç§æƒ…å†µä¸‹çš„ä½¿ç”¨éœ€æ±‚ã€‚\n\n```java\n////////////////////////////////å¯åŠ¨Activityè½¬åœºåŠ¨ç”»/////////////////////////////////////////////\n\n    protected void startActivityForResultByAnim(Intent intent, int requestCode, int animIn, int animExit) {\n        startActivityForResult(intent, requestCode);\n        overridePendingTransition(animIn, animExit);\n    }\n\n\n\n    //protectedä»£è¡¨å®ƒçš„å­ç±»å¯ä»¥è°ƒç”¨\n    protected void startActivityByAnim(Intent intent, int animIn, int animExit) {\n        startActivity(intent);\n        overridePendingTransition(animIn, animExit);\n    }\n\n    protected void startActivityForResultByAnim(Intent intent, int requestCode, @NonNull View view, @NonNull String transitionName, int animIn, int animExit) {\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {\n            startActivityForResult(intent, requestCode, ActivityOptions.makeSceneTransitionAnimation(this, view, transitionName).toBundle());\n        } else {\n            startActivityForResultByAnim(intent, requestCode, animIn, animExit);\n        }\n    }\n\n    protected void startActivityByAnim(Intent intent, @NonNull View view, @NonNull String transitionName, int animIn, int animExit) {\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {\n            intent.putExtra(start_share_ele,true);\n            startActivity(intent, ActivityOptions.makeSceneTransitionAnimation(this, view, transitionName).toBundle());\n        } else {\n            startActivityByAnim(intent, animIn, animExit);\n        }\n    }\n\n    public Context getContext(){\t\t//å®ç°çš„IViewæ–¹æ³•\n        return this;\n    }\n\n    public Boolean getStart_share_ele() {\n        return startShareAnim;\n    }\n```\n\nâ€‹\tä»€ä¹ˆæ˜¯â€œå…±äº«å…ƒç´ åŠ¨ç”»â€ï¼Ÿç®€å•è¯´ï¼Œå°±æ˜¯ä¸¤ä¸ªé¡µé¢**â€œå…±ç”¨ä¸€ä¸ªä¸œè¥¿â€**ï¼Œè¿™ä¸ªä¸œè¥¿åœ¨åˆ‡æ¢é¡µé¢æ—¶ä¼š**åŠ¨èµ·æ¥ï¼Œçœ‹èµ·æ¥å¾ˆè‡ªç„¶ã€é…·ç‚«**ã€‚æ›´åŠ è¯¦ç»†çš„è®²è§£å¯ä»¥ç™¾åº¦ã€‚\n\n\n\n\n\n\n\nâ€‹\tåé¢è¿˜æœ‰**BaseFragment**ã€**BaseModelImpl**ã€**BasePresenterImpl**ã€**RetryIntercepter**ç±»ï¼Œæ”¹å¤©å†è§£æï¼Œä»Šå¤©å­¦ä¹ ä»»åŠ¡ç»“æŸï¼\n","tags":["å®‰å“å¼€å‘å­¦ä¹ "],"categories":["å¼€å‘"]},{"title":"é˜…è¯»APPé¡¹ç›®å­¦ä¹ â€”â€”2","url":"/2025/06/22/é˜…è¯»é¡¹ç›®å­¦ä¹ /å®‰å“é¡¹ç›®å­¦ä¹ 2/","content":"\nâ€‹\tæ¬¢è¿é¡µå¼€å§‹åï¼Œå°±è¿›å…¥ä¸»ä½“**MainActivity**ä¸­ï¼ŒæŸ¥çœ‹æºç å¯ä»¥å‘ç°ï¼Œå…¶ä½¿ç”¨äº†ä¼—å¤šè‡ªå®šä¹‰çš„å…¶ä»–ç±»ã€‚\n\nâ€‹\t\n\n### æ¦‚è¿°\n\nâ€‹\tå…ˆå¤§ä½“é€šè¿‡AIåˆ†æä¸€æ³¢ï¼Œçœ‹çœ‹è¿™ä¸ªä¸»é¡µé¢åœ¨å¹²ä»€ä¹ˆã€‚\n\n- é¡µé¢åˆå§‹åŒ–å’Œå¸ƒå±€è®¾ç½®ï¼šç»§æ‰¿è‡ª **MBaseActivity<IMainPresenter>**ï¼Œé‡‡ç”¨ MVP æ¶æ„è®¾è®¡ï¼ˆè§†å›¾å±‚ **MainActivity** è´Ÿè´£UIï¼Œ**IMainPresenter** è´Ÿè´£ä¸šåŠ¡é€»è¾‘ï¼‰ã€‚åˆå§‹åŒ–é¡µé¢ä¸Šçš„æ§ä»¶ï¼Œå¦‚åº”ç”¨logoã€å‡ ä¸ªåŠŸèƒ½æŒ‰é’®ï¼ˆæ‰“èµã€è®¾ç½®ã€ä¹¦åº“ã€æ·»åŠ ä¹¦ç±ã€ä¸‹è½½ï¼‰ã€åˆ·æ–°åˆ—è¡¨æ§ä»¶ï¼ˆ**RefreshRecyclerView**ï¼‰ç­‰ã€‚\n\n- æ˜¾ç¤ºä¹¦æ¶åˆ—è¡¨ï¼šä½¿ç”¨**RefreshRecyclerView**æ¥å±•ç¤ºä¹¦æ¶å†…å®¹ï¼Œä½¿ç”¨è‡ªå®šä¹‰çš„**BookShelfAdapter**ä½œä¸ºåˆ—è¡¨çš„é€‚é…å™¨ï¼Œå†é€šè¿‡å¸ƒå±€ç®¡ç†å™¨**LinearLayoutManager**æ¥æ§åˆ¶**RecyclerView**å¸ƒå±€ã€‚\n- åˆ·æ–°å’ŒåŠ è½½æ•°æ®ï¼šç»‘å®šåˆ·æ–°ç›‘å¬å™¨ï¼ˆ**OnRefreshWithProcessListener**ï¼‰æ¥å®ç°ä¸‹æ‹‰åˆ·æ–°ä¹¦æ¶æ•°æ®ï¼Œåˆ·æ–°æ—¶è°ƒç”¨**mPresenter.queryBookShelf(true)**è¯·æ±‚æœ€æ–°æ•°æ®ã€‚åŒæ—¶å¤„ç†åˆ·æ–°å®Œæˆå’Œåˆ·æ–°é”™è¯¯çš„å›è°ƒï¼Œå¹¶æ›´æ–°UIå’Œè¿›åº¦æ¡ã€‚\n- äº‹ä»¶å¤„ç†ï¼šç»™é¦–é¡µçš„å„ä¸ªæŒ‰é’®ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼šè®¾ç½®æŒ‰é’®å¼¹å‡ºä»£ç†è®¾ç½®çª—å£ï¼›ä¸‹è½½æŒ‰é’®å¼¹å‡ºä¸‹è½½åˆ—è¡¨çª—å£ï¼›ä¹¦åº“æŒ‰é’®è·³è½¬åˆ°ä¹¦åº“ç•Œé¢ï¼ˆ**LibraryActivity**ï¼‰ï¼›æ·»åŠ ä¹¦ç±æŒ‰é’®è·³è½¬åˆ°å¯¼å…¥ä¹¦ç±ç•Œé¢ï¼›æ‰“èµæŒ‰é’®é¢„ç•™äº†ç‚¹å‡»äº‹ä»¶ï¼Œå…·ä½“é€»è¾‘æ²¡å†™ã€‚ç»™ä¹¦æ¶åˆ—è¡¨çš„æ¯ä¸ªä¹¦ç±ç»‘å®šäº†ç‚¹å‡»äº‹ä»¶ï¼šç‚¹å‡»è·³è½¬åˆ°é˜…è¯»ç•Œé¢ï¼›é•¿æŒ‰è·³è½¬åˆ°ä¹¦ç±è¯¦æƒ…ç•Œé¢ï¼Œå¹¶å¸¦åŠ¨ç”»æ•ˆæœã€‚ä¹¦æ¶ä¸­ç‚¹å‡»â€œå»é€‰ä¹¦â€ä¼šè·³è½¬åˆ°ä¹¦åº“ã€‚\n- ç®¡ç†è­¦å‘Šä¿¡æ¯å¼¹çª—ï¼šé¡µé¢ä¸Šæœ‰ä¸€ä¸ªè­¦å‘Šä¿¡æ¯åŒºåŸŸï¼ˆ**flWarn**ï¼‰ï¼Œå¯ä»¥é€šè¿‡å…³é—­æŒ‰é’®éšè—ã€‚\n- å¤„ç†ç³»ç»ŸæŒ‰é”®äº‹ä»¶ï¼šæ•è·è¿”å›é”®ï¼Œå®ç°â€œè¿ç»­ä¸¤æ¬¡æŒ‰è¿”å›é”®é€€å‡ºåº”ç”¨â€çš„äº¤äº’é€»è¾‘ã€‚\n- ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼šåœ¨ **onDestroy** é‡Œåšèµ„æºé”€æ¯ï¼Œæ¯”å¦‚å…³é—­å¼¹çª—ã€‚\n\n\n\n> â€‹\tä¸Šé¢æ¯”è¾ƒé™Œç”Ÿçš„æ¦‚å¿µæœ‰â€œé€‚é…å™¨â€ï¼Œè¿™æ˜¯ä»€ä¹ˆä¸œè¥¿å•Šï¼Ÿ\n>\n> â€‹\tä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼šä½ æƒ³åœ¨å®¶é‡Œçš„ä¹¦æ¶ä¸Šæ‘†ä¹¦ï¼ŒRecyclerViewå°±æ˜¯ä¹¦æ¶ï¼Œé€‚é…å™¨å°±æ˜¯æŒ‰é¡ºåºæ‹¿ä¹¦ï¼Œä¸€æœ¬ä¸€æœ¬æ‘†æ”¾ä¹¦ç±çš„äººï¼Œä¹¦æœ¬çš„æ•°æ®å°±æ˜¯ä½ æ‰‹é‡Œçš„ä¹¦ã€‚æ²¡æœ‰é€‚é…å™¨ï¼Œä½ çš„ä¹¦æ¶å°±ä¸çŸ¥é“æ‘†å“ªäº›ä¹¦ï¼Œä¹Ÿä¸çŸ¥é“æ€ä¹ˆæ‘†ã€‚\n\n\n\n\n\n### é€»è¾‘è§£è¯»\n\nâ€‹\t\n\n```java\n//æˆå‘˜å˜é‡å£°æ˜\n    private ImageView ivLogo;           //åº”ç”¨logoå›¾æ ‡\n    private ImageButton ibMoney;        //æ‰“èµæŒ‰é’®\n    private ImageButton ibSettings;     //è®¾ç½®æŒ‰é’®\n    private ImageButton ibLibrary;      //ä¹¦åº“æŒ‰é’®\n    private ImageButton ibAdd;          //æ·»åŠ ä¹¦ç±æŒ‰é’®\n    private ImageButton ibDownload;     //ä¸‹è½½æŒ‰é’®\n\n    private RefreshRecyclerView rfRvShelf;\n    private BookShelfAdapter bookShelfAdapter;\n\n    private FrameLayout flWarn;         //è­¦å‘Šä¿¡æ¯å¸ƒå±€ï¼ˆå¼¹å‡ºæ¡†ï¼‰\n    private ImageView ivWarnClose;      //å…³é—­è­¦å‘ŠæŒ‰é’®\n\n    private DownloadListPop downloadListPop;        //ä¸‹è½½åˆ—è¡¨å¼¹çª—å¯¹è±¡\n    private ProxyPop proxyPop;          //ä»£ç†è®¾ç½®å¼¹çª—å¯¹è±¡\n```\n\nâ€‹\tImageViewæ˜¯å®‰å“é‡Œé¢ç”¨æ¥æ˜¾ç¤ºå›¾ç‰‡çš„æ§ä»¶ï¼Œå°±æ˜¯ä¸€ä¸ªâ€å›¾ç‰‡æ¡†â€œï¼Œä¸“é—¨ç”¨æ¥åœ¨ç•Œé¢ä¸Šå±•ç¤ºå›¾ç‰‡ï¼Œæ¯”å¦‚åº”ç”¨å›¾æ ‡ã€ç…§ç‰‡ã€æŒ‰é’®å›¾æ ‡ç­‰ç­‰ï¼Œåªè´Ÿè´£æ˜¾ç¤ºå›¾ç‰‡ï¼Œä¸å“åº”ç‚¹å‡»äº‹ä»¶ï¼ˆå½“ç„¶ï¼Œä½ å¯ä»¥ç»™å®ƒåŠ ç‚¹å‡»äº‹ä»¶ï¼Œè®©å®ƒåƒæŒ‰é’®ä¸€æ ·ç”¨ï¼‰ã€‚\n\nâ€‹\tImageButtonå°±æ˜¯æœ‰å›¾ç‰‡çš„æŒ‰é’®ã€‚\n\nâ€‹\tå…¶ä»–å°±æ˜¯è‡ªå®šä¹‰çš„ç»„ä»¶äº†ã€‚\n\n\n\nâ€‹\t\n\nâ€‹\tçœ‹åˆ°å…·ä½“çš„æ–¹æ³•ï¼Œ**initInjector**æ˜¯åœ¨åˆå§‹åŒ–ä¸€ä¸ªPresenterå¯¹è±¡ï¼Œç„¶åè¿”å›ä¸€ä¸ª**MainPresenterImpl**å®ä¾‹ï¼Œè´Ÿè´£ä¸ç•Œé¢ä¸šåŠ¡é€»è¾‘äº¤äº’ã€‚\n\nâ€‹\t**onCreateActivity**è®¾ç½®ç•Œé¢çš„å¸ƒå±€æ–‡ä»¶ã€‚\n\nâ€‹\t**initData**åˆå§‹åŒ–æ•°æ®ï¼Œåˆ›å»ºä¹¦æ¶é€‚é…å™¨å®ä¾‹ã€‚\n\nâ€‹\t**dispatchTouchEvent**å¤„ç†è§¦æ‘¸äº‹ä»¶ï¼Œè°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼Œå¥—å£³å‡½æ•°ã€‚\n\nâ€‹\t**bindView**ç»‘å®šç•Œé¢æ§ä»¶ï¼ˆæ‰¾æ§ä»¶ã€å®ä¾‹åŒ–ï¼‰ï¼Œæ‰¾åˆ°å¸ƒå±€é‡Œçš„å„ç§æ§ä»¶ï¼ˆæŒ‰é’®ã€åˆ—è¡¨ã€å¼¹çª—ç­‰ï¼‰ï¼Œå¹¶å…³è”åˆ°å˜é‡ï¼Œç»™ä¹¦æ¶åˆ—è¡¨ `RecyclerView` è®¾ç½®é€‚é…å™¨å’Œå¸ƒå±€ç®¡ç†å™¨ã€‚\n\nâ€‹\t**bindEvent**ç»‘å®šå„ç§äº‹ä»¶ç›‘å¬å™¨ã€‚\n\nâ€‹\t**bindRvShelfEvent**ç»™ä¹¦æ¶çš„åˆ·æ–°æ§ä»¶ç»‘å®šåˆ·æ–°ç›‘å¬ã€‚\n\nâ€‹\t**firstRequest**é¦–æ¬¡åŠ è½½æ•°æ®ï¼Œåº”ç”¨æ‰“å¼€æ—¶è°ƒç”¨ã€‚\n\nâ€‹\t**refreshBookShelf**å°†æ–°çš„ä¹¦ç±åˆ—è¡¨æ•°æ®ä¼ ç»™é€‚é…å™¨ï¼Œæ›´æ–°æ˜¾ç¤ºã€‚\n\nâ€‹\t**activityRefreshView**è§¦å‘ä¹¦æ¶åˆ·æ–°åŠ¨ä½œï¼Œè®©åˆ·æ–°æ§ä»¶å¼€å§‹åˆ·æ–°åŠ¨ç”»å¹¶è°ƒç”¨åˆ·æ–°é€»è¾‘ã€‚\n\nâ€‹\t**refreshFinish**åˆ·æ–°ç»“æŸï¼Œéšè—åˆ·æ–°åŠ¨ç”»ã€‚\n\nâ€‹\t**refreshError**åˆ·æ–°é”™è¯¯æ—¶è°ƒç”¨ã€‚\n\nâ€‹\t**refreshRecyclerViewItemAdd**åˆ·æ–°æ—¶è¿›åº¦æ¡+1ã€‚\n\nâ€‹\t**setRecyclerMaxProgress**è®¾ç½®åˆ·æ–°è¿›åº¦æ¡çš„æœ€å¤§å€¼ã€‚\n\nâ€‹\t**onKeyDown**æŒ‰é”®äº‹ä»¶å¤„ç†ï¼Œç”¨æˆ·æŒ‰è¿”å›é”®æ—¶ï¼Œè°ƒç”¨ `exit()` æ–¹æ³•ï¼Œå®ç°â€œå†æŒ‰ä¸€æ¬¡é€€å‡ºç¨‹åºâ€çš„é€»è¾‘ã€‚\n\nâ€‹\t**onDestroy**èµ„æºé”€æ¯æ—¶è°ƒç”¨ï¼Œæ¸…ç†ä¸€äº›å¼¹çª—çš„èµ„æºï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚\n\nâ€‹\t**exit**é€€å‡ºç¨‹åºçš„é€»è¾‘ï¼Œå¦‚æœ2ç§’å†…ç¬¬äºŒæ¬¡æŒ‰è¿”å›é”®ï¼Œåˆ™é€€å‡ºç¨‹åºï¼Œå¦åˆ™æç¤ºâ€œå†æŒ‰ä¸€æ¬¡é€€å‡ºç¨‹åºâ€ã€‚\n\n\n\n\n\n### å‰ç«¯é¡µé¢å¤ç°\n\nâ€‹\tçœ‹åˆ°XMLæ–‡ä»¶ï¼Œé‡Œé¢ä½¿ç”¨åˆ°ä¸€ä¸ªè‡ªå®šä¹‰çš„ç»„ä»¶**com.monke.monkeybook.widget.refreshview.RefreshRecyclerView**ï¼Œ\n\nä¸‹å›¾ä¸­çš„ç©ºç™½åŒºåŸŸå°±æ˜¯è¿™ä¸ªç»„ä»¶çš„ä½ç½®ã€‚å½“ç„¶ä¹ŸåŒ…æ‹¬ä¸€ä¸ªä½œè€…è‡ªå·±å¼€æºçš„æ²‰æµ¸æ¡†ï¼Œéœ€è¦å¼•ç”¨ä¾èµ–ã€‚\n\nâ€‹\té‡Œé¢çš„å¸ƒå±€å¾ˆæ¸…æ™°æ˜äº†ï¼Œæ²‰æµ¸æ¡†åŒ…è£¹æœ€å¤–å±‚ï¼Œç„¶åä¸€ä¸ªå‚ç›´æ–¹å‘çš„çº¿æ€§å¸ƒå±€æ¥éš”åˆ†ä¸Šä¸‹é¡µé¢ï¼Œé‡Œé¢å†ç”±æ°´å¹³çš„çº¿æ€§å¸ƒå±€æ¥å±•ç¤ºé¡¶éƒ¨ï¼Œä¸‹é¢å°±æ˜¯ä¹¦æ¶åŒºã€‚\n\n![image-20250622115453885](/pictures/novelReader_app/image-20250622115453885.png)\n\nâ€‹\téœ€è¦å¯¼å…¥å¯¹åº”çš„drawableé‡Œé¢çš„XMLæ–‡ä»¶ã€layouté‡Œé¢çš„å…¶ä»–XMLæ–‡ä»¶ã€valuesé‡Œé¢çš„XMLæ–‡ä»¶ã€‚ç„¶åå†™å…¥**RefreshRecyclerView**ç±»ã€**RefreshProgressBar**ç±»ã€**RefreshRecyclerViewAdapter**æŠ½è±¡ç±»ã€**OnRefreshWithProgressListener**æ¥å£ã€**OnLoadMoreListener**æ¥å£ã€**BaseRefreshListener**æ¥å£ï¼Œè¿˜æœ‰**BookContentView**ç±»ï¼Œå› ä¸ºè¿™ä¸ªç±»åˆå¼•å‡ºä¸€å †å…¶ä»–çš„ç±»å’Œæ¥å£ã€‚å¤ªéº»çƒ¦äº†ã€‚\n\nâ€‹\tå…ˆæ”¾ç€BookContentViewä¸ç®¡å§ï¼Œè¿˜æœ‰å…¶ä»–å‡ ä¸ª**BitIntentDataManager**ã€**MApplication**ã€**ReadBookControl**éƒ½æœ‰ç‚¹é—®é¢˜å•Šï¼è¿™æ ·åˆ†æä¹Ÿå¤ªéº»çƒ¦äº†ã€‚ä¸èƒ½æŒ‰ç…§è¿™ä¸ªé€»è¾‘æä¸‹å»ã€‚\n\n\n\n\n\n### å…·ä½“åŠŸèƒ½æµç¨‹åˆ†æ\n\nâ€‹\tå…ˆä»æœ€ç®€å•çš„é€€å‡ºåŠŸèƒ½æ¥è¯´å§ï¼Œä¸ç„¶éƒ½æ²¡æ³•è¯»ä¸‹å»äº†ã€‚\n\n```java\n\t@Override\n    public boolean onKeyDown(int keyCode, KeyEvent event) {\n        if (keyCode == KeyEvent.KEYCODE_BACK) {\n            exit();\n            return true;\n        }\n        return super.onKeyDown(keyCode, event);\n    }\n\n\tprivate long exitTime = 0;\n\tpublic void exit() {\n        if ((System.currentTimeMillis() - exitTime) > 2000) {\n            Toast.makeText(getApplicationContext(), \"å†æŒ‰ä¸€æ¬¡é€€å‡ºç¨‹åº\",\n                    Toast.LENGTH_SHORT).show();\n            exitTime = System.currentTimeMillis();\n        } else {\n            finish();\n            System.exit(0);\n        }\n    }\n```\n\nâ€‹\tå½“ç”¨æˆ·æ‘ä¸‹â€è¿”å›é”®â€œï¼Œè§¦å‘onKeyDownæ–¹æ³•ï¼Œä¼šè°ƒç”¨exitæ–¹æ³•ï¼Œå¯¼è‡´é€€å‡ºç¨‹åºã€‚keyCodeè¡¨ç¤ºå½“å‰è¢«æŒ‰ä¸‹çš„æŒ‰é”®çš„ä»£ç ï¼ˆç¼–å·ï¼‰ï¼ŒKeyEvent.KEYCODE_BACKæ˜¯å®‰å“ç³»ç»Ÿå®šä¹‰çš„å¸¸é‡ï¼Œä»£è¡¨â€è¿”å›é”®â€œçš„æŒ‰é”®ä»£ç ã€‚System.currentTimeMillisæ–¹æ³•è¿”å›ä¸€ä¸ªâ€longâ€œç±»å‹çš„æ•°å­—ï¼Œè¡¨ç¤ºä»â€œ1970å¹´1æœˆ1æ—¥åˆå¤œâ€ï¼ˆç§°ä¸ºâ€œUnixçºªå…ƒâ€ï¼‰å¼€å§‹ï¼Œåˆ°å½“å‰æ—¶åˆ»æ‰€ç»è¿‡çš„æ¯«ç§’æ•°ã€‚\n\nâ€‹\tç¬¬ä¸€æ¬¡æ‘ä¸‹â€è¿”å›é”®â€œä¼šè®¾ç½®exitTimeä¸ºå½“å‰æ—¶é—´ï¼Œç„¶åéœ€è¦åœ¨ä¸¤ç§’å†…å†æ‘ä¸€æ¬¡ï¼Œæ‰è¿›å…¥elseé‡Œé¢ã€‚\n\nâ€‹\tfinishæ–¹æ³•ï¼Œ**åªæ˜¯å‘Šè¯‰ç³»ç»Ÿâ€œå…³é—­è¿™ä¸ªActivityâ€ï¼Œä½†å®ƒæ˜¯å¼‚æ­¥çš„ï¼Œä¸ä¼šç«‹å³åœæ­¢å½“å‰æ–¹æ³•çš„æ‰§è¡Œ**ã€‚`finish()` ä¼šè¯·æ±‚ç³»ç»Ÿå»é”€æ¯Activityï¼ˆè§¦å‘ç”Ÿå‘½å‘¨æœŸ`onPause() -> onStop() -> onDestroy()`ï¼‰ï¼Œä½†æ˜¯è¿™ä¸ªè¿‡ç¨‹æ˜¯åœ¨ç³»ç»Ÿæ¶ˆæ¯é˜Ÿåˆ—ä¸­æ’é˜Ÿæ‰§è¡Œçš„ï¼Œå¹¶ä¸ä¼šé©¬ä¸Šè·³å‡ºå½“å‰æ–¹æ³•æˆ–ç»ˆæ­¢çº¿ç¨‹ï¼Œä½†æ˜¯è¿™ä¸ªè¿‡ç¨‹æ˜¯åœ¨ç³»ç»Ÿæ¶ˆæ¯é˜Ÿåˆ—ä¸­æ’é˜Ÿæ‰§è¡Œçš„ï¼Œå¹¶ä¸ä¼šé©¬ä¸Šè·³å‡ºå½“å‰æ–¹æ³•æˆ–ç»ˆæ­¢çº¿ç¨‹ã€‚\n\n\n\n\n\n\n\n### AIæ€»ç»“ä¸»é¡µé¢åŠŸèƒ½\n\nâ€‹\tåé¢å°±æ ¹æ®è¿™äº›åŠŸèƒ½ï¼Œå¼€å§‹è¿›è¡Œåˆ†å—è®²è§£ï¼ŒåŒ…æ‹¬ä»£ç è·Ÿè¸ªè®²è§£ï¼Œè¿™æ ·ä¼šæ›´åŠ è®©æˆ‘ä¸“æ³¨äºåŠŸèƒ½çš„å®ç°ã€‚\n\n> ### 1. ç•Œé¢åˆå§‹åŒ–å’Œè§†å›¾ç»‘å®š\n>\n> - **åŠ è½½ç•Œé¢å¸ƒå±€**ï¼ˆ`setContentView`ï¼‰ï¼Œè®©é¡µé¢æ˜¾ç¤ºå‡ºæ¥\n> - **æŸ¥æ‰¾å¹¶ç»‘å®šæ§ä»¶**ï¼Œæ¯”å¦‚logoå›¾æ ‡ã€æŒ‰é’®ã€ä¹¦æ¶åˆ—è¡¨ç­‰\n> - **åˆå§‹åŒ–ä¹¦æ¶é€‚é…å™¨**ï¼Œç®¡ç†ä¹¦ç±åˆ—è¡¨çš„æ˜¾ç¤º\n>\n> ### 2. æ•°æ®å±•ç¤ºå’Œåˆ·æ–°\n>\n> - **å±•ç¤ºä¹¦æ¶åˆ—è¡¨æ•°æ®**ï¼ŒæŠŠæ•°æ®åŠ è½½åˆ°ä¹¦æ¶é€‚é…å™¨é‡Œï¼Œæ˜¾ç¤ºåœ¨åˆ—è¡¨ä¸­\n> - **æ”¯æŒä¸‹æ‹‰åˆ·æ–°**ï¼Œç”¨æˆ·ä¸‹æ‹‰åˆ—è¡¨æ—¶ï¼Œé‡æ–°è¯·æ±‚æ•°æ®ï¼Œåˆ·æ–°ä¹¦æ¶å†…å®¹\n> - **åˆ·æ–°è¿›åº¦åé¦ˆ**ï¼Œé€šè¿‡è¿›åº¦æ¡æ˜¾ç¤ºåˆ·æ–°è¿›åº¦ï¼Œæé«˜ç”¨æˆ·ä½“éªŒ\n>\n> ### 3. ç”¨æˆ·äº¤äº’å¤„ç†\n>\n> - **æŒ‰é’®ç‚¹å‡»äº‹ä»¶**\n>   - ç‚¹å‡»â€œè®¾ç½®â€æŒ‰é’®å¼¹å‡ºä»£ç†è®¾ç½®çª—å£\n>   - ç‚¹å‡»â€œä¸‹è½½â€æŒ‰é’®å¼¹å‡ºä¸‹è½½åˆ—è¡¨\n>   - ç‚¹å‡»â€œæ‰“èµâ€æŒ‰é’®è§¦å‘æ‰“èµæ“ä½œï¼ˆè¿™é‡Œæ²¡å®ç°å…·ä½“é€»è¾‘ï¼‰\n>   - ç‚¹å‡»â€œä¹¦åº“â€æŒ‰é’®è¿›å…¥ä¹¦åº“é¡µé¢\n>   - ç‚¹å‡»â€œæ·»åŠ ä¹¦ç±â€æŒ‰é’®è¿›å…¥å¯¼å…¥ä¹¦ç±é¡µé¢\n> - **ä¹¦æ¶ä¹¦ç±ç‚¹å‡»**\n>   - ç‚¹å‡»ä¹¦ç±è·³è½¬åˆ°é˜…è¯»é¡µé¢ï¼Œæ‰“å¼€ä¹¦ç±\n>   - é•¿æŒ‰ä¹¦ç±è·³è½¬åˆ°ä¹¦ç±è¯¦æƒ…é¡µé¢ï¼Œå¸¦åŠ¨ç”»æ•ˆæœ\n>\n> ### 4. å¼¹çª—ä¸æç¤º\n>\n> - å¼¹å‡ºä»£ç†è®¾ç½®å’Œä¸‹è½½åˆ—è¡¨å¼¹çª—ï¼Œæ–¹ä¾¿ç”¨æˆ·æ“ä½œ\n> - è­¦å‘Šä¿¡æ¯æ¡†çš„æ˜¾ç¤ºå’Œå…³é—­ï¼Œæé†’ç”¨æˆ·é‡è¦ä¿¡æ¯\n>\n> ### 5. ç”Ÿå‘½å‘¨æœŸä¸é€€å‡º\n>\n> - ç›‘å¬æ‰‹æœºè¿”å›é”®ï¼Œé˜²æ­¢è¯¯æ“ä½œé€€å‡º\n> - å®ç°â€œåŒå‡»è¿”å›é”®é€€å‡ºç¨‹åºâ€çš„é€»è¾‘ï¼Œæé«˜ç”¨æˆ·ä½“éªŒ\n> - é€€å‡ºæ—¶é‡Šæ”¾èµ„æºï¼Œé˜²æ­¢å†…å­˜æ³„æ¼\n>\n> â€‹\t\t","tags":["å®‰å“å¼€å‘å­¦ä¹ "],"categories":["å¼€å‘"]},{"title":"é˜…è¯»APPé¡¹ç›®å­¦ä¹ â€”â€”1","url":"/2025/06/21/é˜…è¯»é¡¹ç›®å­¦ä¹ /å®‰å“é¡¹ç›®å­¦ä¹ 1/","content":"\n# \tå‰è¨€\n\nâ€‹\tè¯¥é˜…è¯»é¡¹ç›®æ˜¯[MONKOVEL](https://github.com/ZhangQinhao/MONKOVEL)ï¼Œæˆ‘å°†åˆ†æå­¦ä¹ å…¶é¡¹ç›®è®¾è®¡å’ŒJAVAä»£ç ï¼Œæˆ‘æ²¡ä»€ä¹ˆè¯­è¨€åŸºç¡€ï¼Œä¹Ÿæ²¡æœ‰å¼€å‘ç»éªŒï¼Œæ­¤ç³»åˆ—å°†è®°å½•æˆ‘åœ¨è¿™ä¸ªé¡¹ç›®ä¸­è‡ªå­¦åˆ°çš„çŸ¥è¯†ã€‚\n\nâ€‹\t\n\n# \tæ­£æ–‡\n\nâ€‹\tå…ˆçœ‹åˆ°`AndroidManifest.xml`æ–‡ä»¶ï¼ŒæŸ¥çœ‹APPå­˜åœ¨å¤šå°‘ä¸ªActivityï¼ˆç•Œé¢ï¼‰ï¼š`WelcomeActivity`ç±»è´Ÿè´£æ¬¢è¿ç•Œé¢ï¼Œå®ç°ä¸€ä¸ªåŠ¨ç”»çš„æ•ˆæœã€‚\n\n```xml\n<activity\n            android:name=\".view.impl.WelcomeActivity\"\n            android:screenOrientation=\"portrait\">\n            <intent-filter>\n                <action android:name=\"android.intent.action.MAIN\" />\n\n                <category android:name=\"android.intent.category.LAUNCHER\" />\n            </intent-filter>\n        </activity>\n```\n\nâ€‹\tä¹‹åä¼šè·³è½¬åˆ°ä¸»ç•Œé¢ã€‚\n\n```java\npublic void onAnimationEnd(Animator animation) {\n                startActivityByAnim(new Intent(WelcomeActivity.this, MainActivity.class), android.R.anim.fade_in, android.R.anim.fade_out);\n                finish();\n            }\n```\n\n\n\nâ€‹\t`MainActivity`è´Ÿè´£ä¸»é¡µé¢çš„å‘ˆç°ï¼Œå±•ç¤ºä»å„ä¸ªç½‘ç«™è§£ææ¥çš„ä¹¦ç±ï¼›`SearchActivity`ç±»è´Ÿè´£å…³é”®è¯æœç´¢ï¼Œå¯èƒ½ä¼šè°ƒç”¨ç½‘ç»œæ¥å£æˆ–æœ¬åœ°æ•°æ®åº“æŸ¥è¯¢ï¼›`DownloadService`è´Ÿè´£åå°ä¸‹è½½ä»»åŠ¡ï¼Œé€šå¸¸æ˜¯serviceç±»å‹ï¼Œä¸é˜»å¡UIï¼Œç®¡ç†ä¸‹è½½é˜Ÿåˆ—ï¼Œå¤„ç†æ–­ç‚¹ç»­ä¼ ç­‰ç­‰ï¼›è¿˜æœ‰`LibraryActivity`ä¹¦æ¶é¡µé¢ã€`ChoiceBookActivity`ä¹¦ç±é€‰æ‹©é¡µé¢ã€`BookDetailActivity`ä¹¦çš„è¯¦ç»†è¯¦ç»†ã€`ReadBookActivity`è´Ÿè´£é˜…è¯»ç•Œé¢ã€`ImportBookActivity`è´Ÿè´£æœ¬åœ°å¯¼å…¥ä¹¦ç±ã€‚\n\n\n\n\n\n## å¤ç°\n\nâ€‹\té¦–å…ˆå¯ä»¥å•ç‹¬å¤ç°å‡ºwelcomeç•Œé¢ï¼Œå…ˆå¤„ç†å¥½xmlæ–‡ä»¶ï¼Œä¼šéœ€è¦å¯¼å…¥åŒ…ï¼šæ³¨æ„æ–°çš„å†™æ³•æ˜¯`implementation(\"...\")`ã€‚å†™å…¥`activity_welcome.xml`æ–‡ä»¶ï¼Œå¤åˆ¶å›¾ç‰‡èµ„æºåˆ°resç›®å½•ä¸‹ï¼Œæ”¹å†™ç³»ç»Ÿé»˜è®¤çš„`AndroidManifest.xml`æ–‡ä»¶ï¼Œåˆ é™¤ç³»ç»Ÿç»™çš„`MainActivity`éƒ¨åˆ†ã€‚åé¢ä»`view.impl.WelcomeActivity`å¼€å§‹æ…¢æ…¢æŠ„å…¥å…¶ä»–æ–‡ä»¶ï¼Œæš‚æ—¶ä¸éœ€è¦çš„åŠŸèƒ½å¯ä»¥æ³¨é‡Šæ‰ã€‚\n\nâ€‹\t\n\n### MVPæ¶æ„\n\nâ€‹\tå®ç°`IView`å’Œ`IPresenter`æ¥å£ï¼Œè¿™æ˜¯MVPè®¾è®¡æ¶æ„ä¸­å¸¸è§çš„åŸºç¡€æ¥å£ã€‚\n\n> MVPçš„æ€æƒ³æ˜¯ï¼šViewï¼ˆè§†å›¾ï¼‰ï¼šè´Ÿè´£â€œæ˜¾ç¤ºâ€å’Œâ€œç”¨æˆ·äº¤äº’â€ã€‚\n>\n> â€‹\t\tPresenterï¼ˆä¸­é—´äººï¼‰ï¼šè´Ÿè´£â€œå¤„ç†é€»è¾‘â€å’Œâ€œæ²Ÿé€šâ€ã€‚\n>\n> â€‹\t\tModelï¼ˆæ¨¡å‹ï¼‰ï¼šè´Ÿè´£â€œæ•°æ®å’Œä¸šåŠ¡é€»è¾‘â€ã€‚\n>\n> MVP å°±æ˜¯æŠŠâ€œæ˜¾ç¤ºç•Œé¢â€å’Œâ€œä¸šåŠ¡é€»è¾‘â€æ‹†å¼€ï¼Œè®©ä»£ç æ›´æ•´æ´ã€æ›´å®¹æ˜“ç»´æŠ¤\n\n> #### çœŸå®å¼€å‘ä¸­ï¼š\n>\n> - ä½ çš„æ‰‹æœºç•Œé¢å°±æ˜¯ Viewï¼Œè´Ÿè´£æ˜¾ç¤ºæŒ‰é’®ã€åˆ—è¡¨ç­‰\n> - ä»£ç é‡Œå†™çš„ Presenter è´Ÿè´£ç›‘å¬æŒ‰é’®ï¼Œå¤„ç†ä¸šåŠ¡é€»è¾‘\n> - Model è´Ÿè´£æ•°æ®å­˜å–ï¼Œæ¯”å¦‚ä»æ•°æ®åº“æ‹¿æ•°æ®ï¼Œæˆ–è€…è°ƒç”¨ç½‘ç»œæ¥å£\n\nâ€‹\t\n\nâ€‹\t\n\n```java\npublic interface IView {\n    public Context getContext();\n}\n```\n\nâ€‹\tçœ‹åˆ°`IView`çš„æ¥å£æ–¹æ³•ï¼Œ`getContext`æ–¹æ³•ï¼Œä»€ä¹ˆæ˜¯Contextï¼Ÿçœ‹ä¸€ä¸‹ChatGptçš„çœ‹æ³•ã€‚\n\n> - **Context å°±åƒæ‰‹æœºé‡Œçš„â€œä¸‡èƒ½é’¥åŒ™â€æˆ–è€…â€œå·¥å…·ç®±â€**ï¼Œå®ƒå‘Šè¯‰ä½ â€œç°åœ¨åœ¨å“ªä¸ªç¯å¢ƒä¸‹â€ï¼Œå¯ä»¥å¸®ä½ è®¿é—®å¾ˆå¤šç³»ç»ŸæœåŠ¡ã€èµ„æºï¼Œç”šè‡³æ‰“å¼€æ–°é¡µé¢ã€æ˜¾ç¤ºæç¤ºæ¶ˆæ¯ã€‚\n> - å‡è®¾ä½ åœ¨ä¸€ä¸ªå¤§å•†åœºé‡Œï¼ŒContext å°±åƒä½ çš„å•†åœºä¼šå‘˜å¡ï¼Œä½ æ‹¿ç€ä¼šå‘˜å¡ï¼Œå•†åœºæ‰çŸ¥é“ä½ æ˜¯è°ã€ä½ åœ¨å“ªä¸ªåº—é“ºã€ä½ å¯ä»¥ç”¨å“ªäº›ä¼˜æƒ ï¼Œé€šè¿‡ä¼šå‘˜å¡ï¼Œä½ å¯ä»¥å»ä¸åŒçš„æŸœå°ï¼ˆæœåŠ¡ï¼‰åŠäº‹æƒ…ï¼Œæ¯”å¦‚ä¹°ä¸œè¥¿ã€é€€è´§ã€æŸ¥ä½™é¢ã€‚\n> - åœ¨ä»£ç é‡Œ Context èƒ½åšä»€ä¹ˆï¼Ÿæ‰“å¼€æ–°ç•Œé¢ã€æ˜¾ç¤ºå¼¹çª—ã€è®¿é—®èµ„æºã€è·å–ç³»ç»ŸæœåŠ¡ï¼ˆæ¯”å¦‚ç½‘ç»œã€ä¼ æ„Ÿå™¨ï¼‰ã€è®¿é—®æ–‡ä»¶ã€æ•°æ®åº“ç­‰ç­‰ã€‚\n> - ä¸¾ä¸ªç®€å•ä¾‹å­ï¼Œ`Toast.makeText(context, \"Hello!\", Toast.LENGTH_SHORT).show();`ï¼Œè¿™å¥è¯çš„ `context` å°±å‘Šè¯‰ç³»ç»Ÿï¼Œâ€œä½ ç°åœ¨åœ¨å“ªä¸ªç¯å¢ƒä¸‹æ˜¾ç¤ºè¿™ä¸ªå¼¹çª—â€ï¼Œç³»ç»Ÿæ‰èƒ½æ­£ç¡®åœ°æŠŠå¼¹çª—æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚\n> - å¸¸è§çš„ Context ç±»å‹ï¼š**Activity**ï¼Œå®ƒæœ¬èº«å°±æ˜¯ä¸€ä¸ª Contextï¼Œä»£è¡¨ä¸€ä¸ªç•Œé¢ï¼›**Application**ï¼Œæ•´ä¸ªåº”ç”¨ç¨‹åºçš„å…¨å±€ Contextï¼›**Service**ï¼Œåå°æœåŠ¡çš„ Contextã€‚\n\nâ€‹\t`getContext`æ˜¯ç»™è°ç”¨çš„ï¼Ÿâ€”â€”â€”â€”ç»™ **Presenterï¼ˆä¸šåŠ¡é€»è¾‘å±‚ï¼‰ç”¨çš„**ï¼ŒPresenter é€šè¿‡ `IView.getContext()` æ‹¿åˆ°è¿™ä¸ªç¯å¢ƒï¼ˆContextï¼‰ï¼Œå°±èƒ½åšå¾ˆå¤šäº‹æƒ…ã€‚\n\nâ€‹\tçœ‹çœ‹ä¾‹å­ï¼Œå¾ˆæ¸…æ¥šã€‚\n\n```java\npublic class MainPresenter implements IPresenter {\n    private IView view;\n    @Override\n    public void attachView(@NonNull IView iView) {\n        this.view = iView;\n    }\n    @Override\n    public void detachView() {\n        this.view = null;\n    }\n    public void showMessage() {\n        // é€šè¿‡viewæ‹¿Contextæ¥æ˜¾ç¤ºToast\n        Toast.makeText(view.getContext(), \"Hello MVP!\", Toast.LENGTH_SHORT).show();\n    }\n}\n```\n\n\n\n\n\n\n\n```java\npublic interface IPresenter {\n    /**\n     * æ³¨å…¥Viewï¼Œä½¿ä¹‹èƒ½å¤Ÿä¸Viewç›¸äº’å“åº”\n     */\n    void attachView(@NonNull IView iView);\n    /**\n     * é‡Šæ”¾èµ„æºï¼Œå¦‚æœä½¿ç”¨äº†ç½‘ç»œè¯·æ±‚ å¯ä»¥åœ¨æ­¤æ‰§è¡ŒIModel.cancelRequest()\n     */\n    void detachView();\n}\n```\n\nâ€‹\tçœ‹åˆ°`IPresenter`æ¥å£ï¼Œ`attachview`å°±æ˜¯æä¾›çš„ç”¨æ¥ç»‘å®šviewå’Œpresenterçš„æ–¹æ³•ã€‚\n\nâ€‹\tä»€ä¹ˆæ—¶å€™ä¼šè°ƒç”¨ï¼Ÿ  ä¸€èˆ¬æ˜¯åœ¨ç•Œé¢åˆšåˆ›å»ºæˆ–åˆšå‡†å¤‡å¥½è·Ÿ Presenter äº¤äº’çš„æ—¶å€™è°ƒç”¨ï¼Œæ¯”å¦‚ `Activity` çš„ `onCreate()` æˆ– `onStart()` é‡Œã€‚\n\nâ€‹\tè°æ¥è°ƒç”¨ï¼Ÿ  é€šå¸¸æ˜¯ **Viewï¼ˆç•Œé¢å±‚ï¼Œæ¯”å¦‚ Activityï¼‰è‡ªå·±è°ƒç”¨**ï¼Œæˆ–è€…æœ‰æ—¶æ˜¯åœ¨åˆ›å»º Presenter çš„æ—¶å€™ç”±æ¡†æ¶æˆ–ä»£ç è°ƒç”¨ã€‚\n\nâ€‹\tä¸ºä»€ä¹ˆï¼Ÿ  å› ä¸º Presenter éœ€è¦çŸ¥é“å®ƒæœåŠ¡çš„æ˜¯å“ªä¸ª Viewï¼Œæ‰èƒ½è®© View æ˜¾ç¤ºæ•°æ®æˆ–è€…å“åº”ç”¨æˆ·æ“ä½œã€‚\n\n\n\nâ€‹\tä¸‹é¢æ˜¯AIä¸¾å¾—å°ä¾‹å­ï¼Œå¾ˆäº†ç„¶äº†ã€‚\n\n```java\npublic class MainActivity extends AppCompatActivity implements IView {\n    private IPresenter presenter;\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        presenter = new MainPresenter();\n        presenter.attachView(this);  // æŠŠè‡ªå·±ï¼ˆViewï¼‰ä¼ ç»™Presenterï¼Œç»‘å®šå…³ç³»å»ºç«‹\n    }\n    @Override\n    protected void onDestroy() {\n        super.onDestroy();\n        presenter.detachView();  // è§£ç»‘ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼\n    }\n    // å®ç°IViewçš„æ–¹æ³•\n    @Override\n    public Context getContext() {\n        return this;\n    }\n}\n```\n\n\n\nâ€‹\tæˆ‘ä»¬æŸ¥çœ‹presenterå’Œviewæ–‡ä»¶å¤¹ä¹Ÿå‘ç°äº†è¿™ä¸ªä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼Œé™¤äº†æ¬¢è¿ç•Œé¢ï¼ˆå› ä¸ºæ²¡æœ‰äº¤äº’ï¼Œæ‰€ä»¥ä¸éœ€è¦ï¼‰ã€‚\n\n![image-20250621210554075](/pictures/novelReader_app/image-20250621210554075.png)\n\n\n\n### å…¶ä»–å­ç±»è®¾è®¡\n\nâ€‹\t`BaseApplication`åŸºç¡€ç±»ã€‚\n\nâ€‹\t`AppActivityManager`æ˜¯ä¸€ä¸ªâ€œActivityç®¡ç†å·¥å…·ç±»â€ï¼šè®°å½•ã€ç®¡ç†å½“å‰æ‰€æœ‰çš„Activityï¼Œèƒ½å…³é—­æŒ‡å®šçš„Activityã€èƒ½åˆ¤æ–­Activityæ˜¯å¦å­˜åœ¨ã€é€šè¿‡å¼±å¼•ç”¨é¿å…å†…å­˜æ³„éœ²ã€‚\n\nâ€‹\t`BaseActivity`æ˜¯â€œé€šç”¨Activityæ¨¡æ¿â€ï¼Œå®ƒå°è£…äº† Activity å¸¸ç”¨çš„åŠŸèƒ½ã€ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€å’Œ Presenter çš„ç»‘å®šé€»è¾‘ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯ï¼šæŠŠæ¯ä¸ªé¡µé¢éƒ½è¦é‡å¤å†™çš„ä»£ç ï¼ˆå¦‚å›ºå®šçš„æ–¹æ³•è°ƒç”¨ï¼ŒActivityè½¬åœºåŠ¨ç”»è°ƒç”¨ç­‰ç­‰ï¼‰ï¼Œç»Ÿä¸€å†™åœ¨è¿™ä¸ªâ€œçˆ¶ç±»â€é‡Œï¼Œå­ç±»åªéœ€è¦å…³æ³¨é¡µé¢è‡ªå·±çš„åŠŸèƒ½å®ç°ï¼Œçœæ—¶çœåŠ›ï¼\n\nâ€‹\t`MBaseActivity`æ˜¯ç»§ç»­æ·»åŠ å‹ç›Ÿç»Ÿè®¡çš„ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œèƒ½å¤Ÿç»Ÿè®¡ç”¨æˆ·çš„ä½¿ç”¨æƒ…å†µã€‚\n\nâ€‹\t\n\n\n\nâ€‹\tå†æŠ„ä¸‹`activity_welcome.xml`å¸ƒå±€æ–‡ä»¶ï¼Œåº”è¯¥å°±å¯ä»¥å±•ç¤ºç¬¬ä¸€ä¸ªç•Œé¢çš„æ•ˆæœäº†ã€‚\n","tags":["å®‰å“å¼€å‘å­¦ä¹ "],"categories":["å¼€å‘"]},{"title":"ISCTF2024","url":"/2025/06/05/ISCTF2024/RE/","content":"\n# Ezre\n\n> â€‹\tä¸€ä¸ªç®€å•çš„ç»´å‰å°¼äºšåŠ å¯†ï¼Œçœ‹äº†åŠå¤©æ²¡çœ‹å‡ºæ¥ï¼Œåœ¨å¼ºè¡Œå†™è§£å¯†ç®—æ³•åï¼Œæ‰çªç„¶å‘ç°ã€‚\n\n------\n\n\n\n# ã€Šå›å¿†å®‰é­‚æ›²ã€‹ä¸‰â€”â€”mainn.exe\n\n\n\n> â€‹\tè¿·å®«ç±»é¢˜ç›®ï¼Œæ— å£³64ä½ã€‚æ§½ç‚¹å°±æ˜¯å°†ç§»åŠ¨é”®æ¢æˆäº†â€œloveâ€å››ä¸ªå­—ç¬¦ï¼Œç„¶åè¿·å®«å¯¹åº”çš„å­—ç¬¦ä¸²åœ¨ç»“å°¾å¤šç»™äº†å‡ ä¸ªï¼Œèµ·åˆ°è¿·æƒ‘æ€§æ•ˆæœï¼Œå·®ç‚¹è®©æˆ‘æä¸æ¸…è¡Œåˆ—æ•°ï¼Œè¿˜æœ‰è¡Œåæ ‡ä»0å¼€å§‹ï¼Œåˆ—åæ ‡ä»0å¼€å§‹ï¼Œèµ·å§‹ç‚¹åæ ‡ï¼ˆ1ï¼Œ1ï¼‰ã€‚å¼€å§‹ç›´æ¥æŠŠæˆ‘ç»•æ™•ã€‚\n>\n> â€‹\tç¡®å®šè¿·å®«åï¼Œåˆå¤ä¹ äº†DFSç®—æ³•ã€‚æ”¶è·ä¸å°‘ã€‚\n\n```python\nmaze_str = \"\"\"###############################P#...............#...#.......#.#####.###.#####.#.###.#####.#.....#...#.#.....#...#.#...#.#####.#.###.#.#######.#.#.###.#C..#.#.#...#.#...#...#.#.#...#.#.#.#.#.###.#.#.#.###.#.#.#.#.#.#.#.#...#...#.#.......#.#.#.###.#.###.#####.#########.###.#...#...#.....#.#.......#...#.#.#####.#####.#.#.#####.###.#...#...#...#...#...#...#.#...#.###.#.###.#.#######.#.#.#.#.#...#.#.#...#.#...#...#...#.#.###.#.#.#####.#.#.#.#######.###.#...#.....#...#.#.#...#.....#.#########.#####.#.###.#.###.#.#.....#.#...#...#...#...#.#.#.#.#.#.#.###.#.#####.###.#.#.#...#.#...#.#...#...#...#...#.#.###.###.#.#####.#.###.###.#.#...#.#.#.......#.#...#.#...#.#####.#.#######.#.#####.#.###.#...#.#.......#.#...#...#.#..E#.#.#.#.#######.###.#.#####.#.#.#...#.............#.....#.#.#.###############.#######.#.#.#.........#...#...#.....#...#.#.#######.#.#.#####.#.#######.#.......#...#.......#.........\"\"\"\n\nfor i in range(30):\n    for j in range(30):\n        print(maze_str[i*30+j], end=' ')\n    print()\n\n\nmaze = []\nfor i in range(30):\n    maze_row = []\n    for j in range(30):\n        maze_row.append(maze_str[i*30+j])\n    maze.append(maze_row)\n\nstart = (1,1)\n\ndef dfs(maze, x, y,path):\n    if maze[x][y] == 'E':\n        return True\n    if x < 0 or x >= len(maze) or y < 0 or y >= len(maze[0]) or maze[x][y] == '#' or maze[x][y] == 'C':\n        return False\n\n    maze[x][y] = '#'\n\n    directions = [(-1,0), (0,-1), (1,0), (0,1)]\n    directions_str = ['l', 'v', 'o', 'e']\n    for i in range(4):\n        dx = directions[i][0]\n        dy = directions[i][1]\n        path.append(directions_str[i])\n        if dfs(maze, x+dx, y+dy,path):\n            return True\n        path.pop()\n\n    maze[x][y] = '.'\n    return False\n\ndef find_path():\n    path = []\n    if dfs(maze, start[0], start[1], path):\n        return path\n    else:\n        return \"No path found\"\n\nans = find_path()\nans = ''.join(ans)\nprint(ans)\n```\n\n------\n\n\n\n# **æ‰¾å•Šæ‰¾**â€”â€”zhao.exe\n\n> â€‹\tç›´æ¥æ‹–å…¥IDAå‘ç°åªæœ‰å¾ˆå°‘å‡ ä¸ªå‡½æ•°ï¼Œäºæ˜¯å»æŸ¥å£³å‘ç°UPXå£³ï¼Œç„¶åç›´æ¥-dè„±å£³å¤±è´¥ï¼Œæ‹–å…¥HxDå‘ç°æ ‡å¿—ä½è¢«æ”¹æˆAPKäº†ï¼Œæ”¹å›æ¥å°±æˆåŠŸè„±å£³äº†ã€‚\n>\n> â€‹\tå†æ‹–å…¥IDAä¸­å°±æ­£å¸¸äº†ï¼Œé€»è¾‘å¾ˆç®€å•ï¼ŒæŸ¥çœ‹åŠ å¯†é€»è¾‘ï¼Œå…ˆå¤§å°å†™å­—æ¯æ›¿æ¢ï¼Œå†å¼‚æˆ–ä¸€ä¸‹ã€‚é™æ€åˆ†ææ—¶ç›´æ¥å»æ•°æ®èŠ‚æŸ¥çœ‹æ—¶ï¼Œå¾—åˆ°ä¸€ç»„æ•°æ®ï¼Œç„¶åå†™pythonä»£ç ï¼Œè·‘å‡ºæ¥æç¤ºä¸ºé”™è¯¯çš„flagï¼Œæ˜¯å‡ºé¢˜äººæŒ–çš„ä¸€ä¸ªå‘ã€‚\n>\n> â€‹\tåå¤æŸ¥çœ‹åŠ å¯†é€»è¾‘å‘ç°æ²¡æœ‰é—®é¢˜ï¼Œæœ€ååŠ¨æ€è°ƒè¯•ï¼Œåœ¨æ¯”è¾ƒä¹‹å‰æŸ¥çœ‹æ•°æ®ï¼Œå‘ç°ç¨‹åºé‡Œå­˜å‚¨çš„åŠ å¯†æ•°æ®è¢«æ”¹äº†ï¼Œçœ‹æ¥æ˜¯ç¨‹åºåœ¨è¿è¡Œåˆå§‹åŒ–æ—¶æ‰ç»™å‡ºçœŸæ­£çš„åŠ å¯†flagã€‚å–å‡ºæ•°æ®ï¼Œè·‘è§£å¯†è„šæœ¬å°±okäº†ã€‚\n>\n> â€‹\tè¿˜æ˜¯åŠ¨è°ƒå‘ç°é—®é¢˜ã€‚\n\n------\n\n\n\n# pyä¸å¥½ï¼Œä¼šè¢«ban\n\n\n\n> â€‹\tpythonçš„exeç¨‹åºã€‚å…ˆä½¿ç”¨Pyinstxtractorè§£å‡ºpycï¼Œç„¶åç›´æ¥æ‰˜åœ¨çº¿å¹³å°è§£å‡ºpyã€‚æˆ‘å¼€å§‹æ‰¾çš„å¹³å°è§£ä¸å‡ºæ¥ï¼Œæˆ‘è¿˜åœ¨çŒœæ˜¯ä¸æ˜¯é¢˜ç›®åŠ éš¾åº¦äº†ï¼Œå¯¼è‡´æ–‡ä»¶è¿›è¡Œäº†ä¸€å®šçš„ä¿®æ”¹ï¼Œä¸èƒ½ç›´æ¥è§£å‡ºæ¥ã€‚åŸæ¥æ˜¯å·¥å…·ä¸è¡Œï¼æœ€åçœ‹wpæ‰å‘ç°è¿™ä¸ªç½‘ç«™ã€‚\n>\n> â€‹\tè§£å‡ºpyåç›´æ¥åå‘å†™è§£å¯†é€»è¾‘å³å¯è§£å¯†ã€‚\n\n\n\n------\n\n\n\n# ä½ çŸ¥é“.elfæ–‡ä»¶å—\n\n> â€‹\tè·‘ä¸èµ·æ¥ï¼Œç­¾åˆ°é¢˜ï¼Œæ²¡æœ‰æŠ€æœ¯å«é‡ï¼Œç®—äº†ã€‚\n\n\n\n------\n\n\n\n# ã€Šå›å¿†å®‰é­‚æ›²ã€‹äºŒâ€”â€”test11\n\n> â€‹\tä¸€ä¸ªELFæ–‡ä»¶ï¼Œä½¿ç”¨IDAè¿œç¨‹è°ƒè¯•ï¼Œæ”¶è·åˆ°äº†IDAè°ƒè¯•ELFç¨‹åºçš„æ–¹æ³•ï¼Œè¿›ä¸€æ­¥å¢åŠ äº†åŠ¨æ€è°ƒè¯•çš„ç»éªŒï¼Œè®¤è¯†åˆ°ä¸€ç§å¹²æ‰°ç¼–è¯‘çš„æ–¹æ³•ï¼Œå°±æ˜¯åœ¨è°ƒç”¨ç¨‹åºæ—¶ï¼Œä¸ç›´æ¥ä½¿ç”¨callï¼Œè€Œæ˜¯å°†å‡½æ•°é¦–åœ°å€åŠ è½½è¿›å¯„å­˜å™¨ï¼Œç„¶åä½¿ç”¨callå¯„å­˜å™¨è°ƒç”¨ï¼Œè¿™æ ·IDAåˆ†æä¸å‡ºæ¥ï¼Œåªæœ‰åŠ¨è°ƒèƒ½çœ‹åˆ°å…¶ä¸­çš„è·³è½¬é€»è¾‘ã€‚\n>\n> â€‹\tæŸ¥é˜…çŸ¥é“ï¼Œè¿™æ˜¯ä¸€ç§â€œæ§åˆ¶æµå¹³å¦åŒ–â€çš„åç¼–è¯‘æŠ€æœ¯ï¼Œé€šè¿‡ä¸»åˆ†å‘å™¨æ¥æ§åˆ¶ç¨‹åºåŸºæœ¬å—çš„æ‰§è¡Œæµç¨‹ã€‚\n>\n> â€‹\tå¾—çŸ¥flagé•¿åº¦ä¸º36ä½ï¼Œç„¶åencåŠ å¯†ï¼ŒåŠ¨æ€è°ƒè¯•åˆ†æåŠ å¯†é€»è¾‘ã€‚ç¡®å®šæ˜¯é€å­—èŠ‚åŠ å¯†ï¼Œå‡è®¾å½“å‰å­—ç¬¦ä¸‹æ ‡ä¸ºiï¼Œå­—ç¬¦ä¸²æ•°ç»„ä¸ºstrã€‚æœ‰ä¸ªå¯†é’¥keyä¸ºå­—ç¬¦ä¸²â€œi_can_reverse_but_i_can_not_have_youâ€œã€‚\n>\n> â€‹\tæœ€ç»ˆå¾—åˆ°çš„åŠ å¯†æ•°æ®ä¸ºï¼š[234, 12, 26, 17, 246, 44, 29, 62, 23, 53, 49, 41, 244, 57, 57, 211, 195, 45, 0, 16, 48, 61, 204, 0, 211, 192, 75, 198, 17, 199, 41, 62, 186, 96, 144, 52]\n>\n> - str[i] = str[i] ^ (0x66 + i) ^ 0x52\n>- str[i] = str[i] + 6\n> - str[i] = str[i] ^ (key[i] + i)\n\n```python\nenc = [234, 12, 26, 17, 246, 44, 29, 62, 23, 53, 49, 41, 244, 57, 57, 211, 195, 45, 0, 16, 48, 61, 204, 0, 211, 192, 75, 198, 17, 199, 41, 62, 186, 96, 144, 52]\nkey = 'i_can_reverse_but_i_can_not_have_you'\n\nfor i in range(len(enc)):\n    enc[i] = (enc[i] ^ (ord(key[i]) + i)) & 0xff\n    enc[i] = (enc[i] - 6) & 0xff\n    enc[i] = (enc[i] ^ 0x52 ^(0x66 + i)) & 0xff\n    print(chr(enc[i]), end='')\n    #ISCTF{as_her_never_will_come_back!!}\n```\n\n------\n\n\n\n# ã€Šå›å¿†å®‰é­‚æ›²ã€‹å››â€”â€”æ–‡ä»¶å¤¹ï¼šåˆè¯†é£ä»™å„¿\n\n> â€‹\tè§£å‹å¾—åˆ°ä¸€ä¸ªmain.pyå’Œsoæ–‡ä»¶ã€‚è¿™æ˜¯ä¸€ä¸ª`Cpython`é€†å‘é¢˜ï¼Œæˆ‘æ˜¯ç¬¬ä¸€æ¬¡é‡è§ï¼Œå…ˆè·Ÿç€WPå­¦ä¹ ï¼Œä½†æ˜¯ç¬¬ä¸€æ­¥é€šè¿‡pythonä¸­çš„`helpå‡½æ•°`æŸ¥çœ‹æ¨¡å—å°±å‡ºé—®é¢˜äº†ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Œå› ä¸ºå‡ ä¸ªè™šæ‹Ÿæœºçš„pythonç‰ˆæœ¬ä¸å¯¹ï¼Œéœ€è¦3.10çš„ï¼Œè€Œä¸”æœ¬æœºæ˜¯windowsç³»ç»Ÿï¼Œä¸€ç›´æ˜¯è¦ä¹ˆå¯¼å…¥é”™ç³»ç»Ÿtestæ¨¡å—ï¼Œè¦ä¹ˆå¯¼å…¥ä¸è¿›ï¼Œå”‰ï¼Œç¯å¢ƒæ„æ­»äººï¼ä¸‹è½½python3.10è¿˜æŠŠæˆ‘çš„ubuntu20.04ç»™å¹²å´©äº†ï¼Œè¢«æˆ‘ç›´æ¥åˆ äº†ã€‚**ä¹‹åå†å¹²è¿™ç§æ´»è¦æ‹å¿«ç…§äº†**ï¼æœ€ååœ¨ubuntu24.04ä¸­ä¸‹è½½å¥½äº†ï¼Œç„¶åå°±å¯¼å…¥è¿›å»äº†ã€‚çœŸçš„è¢«ç¯å¢ƒæŠ˜ç£¨æƒ¨äº†å•Šã€‚\n>\n> â€‹\tçœ‹äº†æ•™ç¨‹ï¼Œéƒ½æ˜¯ç¥ä»™ï¼Œæœ‰çš„ç›´æ¥çŒœå‡ºåŠ å¯†ç®—æ³•ï¼Œæœ‰çš„ä¸€ç‚¹ç‚¹æ­»çœ‹IDAä¸­çš„å‡ åƒè¡Œ`Cythonä»£ç `ï¼Œæœ‰çš„å‡­ç©ºç”Ÿæˆäº†soå¯¹åº”çš„pythonæºä»£ç ã€‚ä¸€ä¸ªéƒ½è¡Œä¸é€šï¼Œæœ€ååœ¨ç½‘ä¸Šæ‰¾äº†ä¸ªAIä»£ç è°ƒæ•´ï¼ŒæŠŠåŸæœ¬çš„å‡ åƒè¡Œ`Cython`ç»™ä¼˜åŒ–äº†ï¼Œå‡ºäº†ä¸€ä¸ªç®€åŒ–çš„Cè¯­è¨€ç‰ˆï¼Œå¹¶ä¸”æ•´ç†å‡ºäº†æ ¸å¿ƒé€»è¾‘ï¼Œäºæ˜¯æˆ‘ç›´æ¥çœ‹æ ¸å¿ƒåŠ å¯†é€»è¾‘ï¼Œå¾ˆæ¸…æ™°ï¼Œç„¶åå†™è§£å¯†å°±å‡ºäº†ã€‚\n\n```python\nhack_data = [27, 16, 43, 29, 127, 46, 51, 102, 50, 1, 112, 50, 53, 101, 57, 1] \nkey = 'H1m' sbox = [1, 14, 4, 13, 10, 2, 5, 8, 7, 6, 9, 12, 15, 3, 11, 0]  \nflag_list = [0] * 16  \nfor i in range(len(sbox)):\n    tmp = hack_data[i] ^ ord(key[i % len(key)])\n    flag_list[sbox[i]] = tmp\nfor i in range(len(flag_list)):\n    print(chr(flag_list[i]), end='')\n```\n\n------\n\n\n\n# MIPS\n\n> â€‹\tä¸€ç§æ–°çš„æŒ‡ä»¤é›†ï¼Œå¯¹åº”çš„æ±‡ç¼–è¯­è¨€ä¹Ÿä¸ä¸€æ ·ï¼Œéœ€è¦é‡æ–°å­¦ä¹ ã€‚\n\nâ€‹\tå•ç‹¬å‡ºä¸€ä¸ªwpæ¥è®°å½•å­¦ä¹ è¿‡ç¨‹ä¸­å¾—åˆ°çš„çŸ¥è¯†ã€‚\n\n------\n\n\n\n\n\n# æ¡€æ¡€æ¡€\n\n> â€‹\t`rep stosdæ˜¯ä¸€æ¡é«˜æ•ˆçš„å­—ç¬¦ä¸²æ“ä½œæŒ‡ä»¤ï¼Œé€‚ç”¨äºå¿«é€Ÿåˆå§‹åŒ–æˆ–å¡«å……å†…å­˜åŒºåŸŸï¼Œediä¿å­˜å¡«å……åœ°å€ï¼Œecxä¿å­˜å¡«å……æ¬¡æ•°ï¼Œeaxä¿å­˜å•æ¬¡å¡«å……å€¼ã€‚`\n>\n> â€‹\tè¿™ä¸€é¢˜å¾ˆæœ‰æ„æ€å•Šï¼Œæœ‰èŠ±æŒ‡ä»¤ã€TLSã€ä¼ªéšæœºæ•°å’Œé­”æ”¹teaï¼Œæœ‰å¾ˆå¤šå¯å­¦çš„ç‚¹ï¼Œåœ¨åšé¢˜çš„æ—¶å€™ï¼Œç”±äºå¯¹èŠ±æŒ‡ä»¤çš„ä¸å¤Ÿå…¨é¢çš„äº†è§£ï¼Œå’Œå¯¹TLSçš„ä¸å…¨é¢äº†è§£ï¼Œå¯¼è‡´æˆ‘ä¸€ç›´å›°åœ¨å¯¹éæ ¸å¿ƒéƒ¨åˆ†çš„æ¢ç´¢å­¦ä¹ ä¸­ï¼Œå§‹ç»ˆæœªèƒ½æŠ“ä½ä¸»è¦é€»è¾‘ï¼Œæœ€åå¯¼è‡´èº«å¿ƒç–²æƒ«ã€‚\n>\n> â€‹\täºæ˜¯å†³å®šå‚ç…§WPå’Œç½‘ä¸Šçš„èµ„æ–™ï¼Œå¥½å¥½æ¶è¡¥ä¸€ä¸‹è¿™äº›æ–¹é¢çš„çŸ¥è¯†ï¼Œå¹¶ä¸”è®°å½•ä¸‹æ¥ã€‚\n\n```python\nfor i in range(0x4119E2, 0x4119E7):\t\t#IDAçš„patchè„šæœ¬ï¼Œè®°ä½ä½¿ç”¨åˆ°çš„å‡½æ•°åå°±å¥½ã€‚\n    idc.patch_byte(i, 0x90)\n```\n\nä¸“é—¨å‡ºä¸€ä¸ªWPï¼Œè®°å½•ä¸€ä¸‹è¿™äº›éš¾é¢˜ã€‚\n\n------\n\n\n\n# å˜¿å˜¿å˜¿\n\nâ€‹\tæ— å£³ï¼ŒéªŒè¯é•¿åº¦32ä½ï¼Œç„¶åè¿›å…¥140001850ï¼Œæœ‰SMCä¿æŠ¤æŠ€æœ¯ï¼Œæˆ‘ä»¬ä¿®æ”¹æ ‡å¿—ä½ç»•è¿‡åè°ƒè¯•ï¼Œ\n\n![image-20250521110206759](/pictures/ISCTF2024/image-20250521110206759.png)\n\n![image-20250521110250703](/pictures/ISCTF2024/image-20250521110250703.png)\n\nâ€‹\tè¿™é‡Œä¹Ÿæ²¡æœ‰è°ƒç”¨ï¼Œæˆ‘ä»¬å…ˆä¸ç”¨ç®¡140001A0å‡½æ•°ï¼Œç»§ç»­å»mainå‡½æ•°ä¸­çœ‹ç¨‹åºé€»è¾‘ã€‚çœ‹åˆ°1400017B0å‡½æ•°ï¼Œé©¬ä¸Šå°±è°ƒç”¨äº†è§£å¯†å‡ºçš„å‡½æ•°ï¼Œå‚æ•°åˆ†åˆ«æ˜¯å­—ç¬¦ä¸²\"Welcome_to_ISCTF\"ï¼Œè¿˜æœ‰ä¸¤ä¸ªç©ºæ•°ç»„ã€‚\n\n![image-20250521110613803](/pictures/ISCTF2024/image-20250521110613803.png)\n\nâ€‹\tå…ˆçœ‹140001440ï¼Œå¯¹å­—ç¬¦ä¸²è¿›è¡Œå¼‚æˆ–ï¼Œå­˜å‚¨åˆ°a2ä¸­ï¼Œ140003270æ•°æ®å¯ä»¥ç›´æ¥çœ‹åˆ°ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨IDAä¸­æ•°æ®ä»¥å°ç«¯ä¿å­˜ï¼Œå°½ç®¡å­—ç¬¦ä¸²æ˜¾ç¤ºçš„é¡ºåºæ˜¯â€œWelcome_to_ISCTFâ€ï¼Œä½†åœ¨æ ˆå¸§ä¸­ä¿å­˜çš„é¡ºåºå…¶å®æ˜¯cleW......ï¼Œéœ€è¦æ¯4ä¸ªå­—èŠ‚é€†åºï¼Œè¿™æ ·æ‰æ˜¯a1[i]çš„å€¼ã€‚\n\n![image-20250521110827346](/pictures/ISCTF2024/image-20250521110827346.png)\n\n![image-20250521110918291](/pictures/ISCTF2024/image-20250521110918291.png)\n\nâ€‹\tæ¥ç€è¿›å…¥1400014A0å‡½æ•°ï¼Œa1æ˜¯ç©ºæ•°ç»„ï¼Œa2æ˜¯æ‰åŠ å¯†çš„ä¸­é—´å¯†é’¥çš„æŒ‡é’ˆã€‚å¦‚æœåªæ˜¯å‡ºflagçš„è¯ï¼Œè¿™é‡Œæ²¡æœ‰å¿…è¦æ·±å…¥åˆ†æäº†ï¼Œç›´æ¥å–æœ€ç»ˆå¯†é’¥å°±è¡Œäº†ã€‚\n\n![image-20250521104520689](/pictures/ISCTF2024/image-20250521104520689.png)\n\nâ€‹\tå›åˆ°ä¸»å‡½æ•°ï¼Œ1400017B0å‡½æ•°æ‰æ˜¯åŠ å¯†çš„åœ°æ–¹ï¼Œç»§ç»­çœ‹140001630ï¼Œç”±äºæ˜¯å¯¹æ˜æ–‡è¿›è¡Œäº†åˆ†å—çš„ï¼Œåˆ†æˆ2ä¸ª16å­—èŠ‚åŠ å¯†çš„ã€‚\n\n![image-20250521113825145](/pictures/ISCTF2024/image-20250521113825145.png)\n\nâ€‹\té‡Œé¢ä¸¤ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªåŠ å¯†ï¼Œä¸€ä¸ªé€†åºå¤åˆ¶ã€‚\n\n![image-20250521112328705](/pictures/ISCTF2024/image-20250521112328705.png)\n\nâ€‹\tåŠ å¯†ä»¥4å­—èŠ‚ä¸ºä¸€ä¸ªå•ä½ï¼Œå°†16å­—èŠ‚åˆ†ä¸º4ä¸ªå…ƒç´ ï¼ŒåŠ å¯†32è½®ï¼Œæ•´ä½“åŠ å¯†32/4=8è½®ã€‚åŠ å¯†æ–¹å¼å°±æ˜¯å¼‚æˆ–1400013F0çš„è¿”å›å€¼ã€‚\n\n![image-20250521112403260](/pictures/ISCTF2024/image-20250521112403260.png)\n\nâ€‹\t\ta2ç¡®å®šæ˜¯1ã€‚a1æ˜¯é‚£ç¾¤å¼‚æˆ–å¾—åˆ°çš„å€¼ã€‚\n\n![image-20250521113204681](/pictures/ISCTF2024/image-20250521113204681.png)\n\nâ€‹\tè¿™é‡Œæœ‰ä¸€ä¸ªæ˜ å°„è¡¨ï¼Œ256å­—èŠ‚ã€‚\n\n![image-20250521113218351](/pictures/ISCTF2024/image-20250521113218351.png)\n\nâ€‹\tæ˜ å°„åçš„å€¼ä¸ºa1.\n\n![image-20250521113233640](/pictures/ISCTF2024/image-20250521113233640.png)\n\nâ€‹\tè¿™é‡Œå…¶å®æ˜¯ä¸€ç§æ‰©å±•çš„å·¦ç§»å¹¶è®°å½•æº¢å‡ºä½çš„æ“ä½œã€‚\n\n![image-20250521113401853](/pictures/ISCTF2024/image-20250521113401853.png)\n\nå†çœ‹è¿™ä¸ªå‡½æ•°ï¼Œä»¥4å­—èŠ‚ä¸ºæ•´ä½“è¿›è¡Œé€†åºï¼Œå› ä¸ºæ¯æ¬¡åŠ å¯†åªæœ‰16å­—èŠ‚å‚ä¸ï¼Œæ‰€ä»¥åªéœ€è¦ç§»åŠ¨4æ¬¡ã€‚\n\n![image-20250521113539461](/pictures/ISCTF2024/image-20250521113539461.png)\n\nçœ‹å›ä¸»å‡½æ•°ï¼Œé€šè¿‡è°ƒè¯•ç¡®å®šï¼Œæ¯”å¯¹çš„æ—¶å€™å¯†æ–‡ç«¯åºä¸å˜ï¼Œè§£å¯†è„šæœ¬ä¸­å°±ç›´æ¥ä½¿ç”¨æ•°æ®ã€‚\n\n![image-20250521113646251](/pictures/ISCTF2024/image-20250521113646251.png)\n\næœ€åå®Œå…¨ä¸çœ‹WPï¼Œè‡ªå·±å†™å‡ºæ¥äº†ï¼ŒExpå¦‚ä¸‹ã€‚èŠ±äº†4ä¸ªå°æ—¶å§ã€‚\n\n```c\n#include <stdio.h>\n#include <stdlib.h> \n#include <stdint.h>\n\n//å¯†é’¥åœ¨åŠ¨è°ƒçš„æ—¶å€™å–å‡ºå°±è¡Œäº†ã€‚\nuint8_t key[128] = {64, 219, 65, 24, 40, 193, 230, 145, 203, 169, 18, 125, 170, 192, 199, 159, 157, 38, 46, 6, 157, 90, 123, 166, 146, 16, 175, 171, 169, 249, 251, 160, 135, 168, 171, 240, 25, 222, 93, 91, 231, 26, 172, 17, 30, 69, 73, 82, 201, 42, 246, 134, 66, 49, 108, 95, 150, 236, 129, 102, 94, 24, 255, 27, 69, 188, 182, 179, 250, 225, 54, 233, 113, 90, 12, 164, 92, 131, 61, 232, 59, 85, 99, 174, 230, 155, 235, 1, 32, 36, 55, 178, 65, 89, 177, 99, 76, 98, 54, 100, 188, 139, 221, 165, 68, 157, 191, 115, 242, 75, 56, 38, 65, 13, 123, 99, 220, 204, 61, 124, 51, 252, 15, 10, 176, 107, 255, 109};\n\n\n//å–å‡ºå°±è¡Œäº†ã€‚\nuint8_t map[256] = {214, 144, 233, 254, 204, 225, 61, 183, 22, 182, 20, 194, 40, 251, 44, 5, 43, 103, 154, 118, 42, 190, 4, 195, 170, 68, 19, 38, 73, 134, 6, 153, 156, 66, 80, 244, 145, 239, 152, 122, 51, 84, 11, 67, 237, 207, 172, 98, 228, 179, 28, 169, 201, 8, 232, 149, 128, 223, 148, 250, 117, 143, 63, 166, 71, 7, 167, 252, 243, 115, 23, 186, 131, 89, 60, 25, 230, 133, 79, 168, 104, 107, 129, 178, 113, 100, 218, 139, 248, 235, 15, 75, 112, 86, 157, 53, 30, 36, 14, 94, 99, 88, 209, 162, 37, 34, 124, 59, 1, 33, 120, 135, 212, 0, 70, 87, 159, 211, 39, 82, 76, 54, 2, 231, 160, 196, 200, 158, 234, 191, 138, 210, 64, 199, 56, 181, 163, 247, 242, 206, 249, 97, 21, 161, 224, 174, 93, 164, 155, 52, 26, 85, 173, 147, 50, 48, 245, 140, 177, 227, 29, 246, 226, 46, 130, 102, 202, 96, 192, 41, 35, 171, 13, 83, 78, 111, 213, 219, 55, 69, 222, 253, 142, 47, 3, 255, 106, 114, 109, 108, 91, 81, 141, 27, 175, 146, 187, 221, 188, 127, 17, 217, 92, 65, 31, 16, 90, 216, 10, 193, 49, 136, 165, 205, 123, 189, 45, 116, 208, 18, 184, 229, 180, 176, 137, 105, 151, 74, 12, 150, 119, 126, 101, 185, 241, 9, 197, 110, 198, 132, 24, 240, 125, 236, 58, 220, 77, 32, 121, 238, 95, 62, 215, 203, 57, 72};\n\n\nuint32_t sub_1400012F0(uint32_t a1, int16_t a2){\n    for(int16_t i=0;i<a2;i++){\n        a1 = a1 / 0x80000000 + 2 * a1;\n    }\n    return a1;\n}\n\nuint32_t sub_140001340(uint32_t a1){\n    return sub_1400012F0(a1,24) ^ sub_1400012F0(a1, 18) ^ sub_1400012F0(a1, 10) ^ sub_1400012F0(a1, 2) ^ a1;\n}\n\n//å®Œå…¨ç…§æŠ„åŠ å¯†æ—¶çš„é€»è¾‘å°±è¡Œï¼Œè¿™é‡Œæ˜¯æ±‚å¼‚æˆ–å€¼çš„åœ°æ–¹ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯è¦æ‰¾å‡ºä¸€æ ·çš„å¼‚æˆ–å€¼ï¼Œæ‰€ä»¥è¦å’ŒåŠ å¯†æ—¶çš„é€»è¾‘ä¸€æ ·ã€‚\nuint32_t get_xor(uint32_t seed){\n    uint32_t t = map[(uint8_t)seed] + (map[(uint8_t)(seed>>8)] << 8) + (map[(uint8_t)(seed>>16)] << 16) + (map[(uint8_t)(seed>>24)] << 24);\n    return sub_140001340(t);\n\n}\n\n\n//ä»¿ç…§åŠ å¯†è¿‡ç¨‹ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªå¼‚æˆ–æ“ä½œï¼Œåªæ˜¯è¿™ä¸ªå¼‚æˆ–çš„å¯†é’¥ç»è¿‡å¤æ‚çš„è¿ç®—å¾—å‡ºçš„\nvoid  decrypt(uint32_t *enc, uint8_t *key){\n    uint32_t *k = (uint32_t*)key;\n    for(int i=31;i>=0;i--){\n        enc[i%4] ^= get_xor(k[i] ^ enc[(i+3)%4] ^ enc[(i+2)%4] ^ enc[(i+1)%4]);\n    }\n}\n\n\nint main(){\n    \n    //å¯†æ–‡æœ€å¥½æ˜¯è°ƒè¯•çš„æ—¶å€™çœ‹ï¼Œæ–­ç‚¹ä¸‹åœ¨æ¯”è¾ƒçš„åœ°æ–¹ã€‚\n    uint32_t enc[] = \t\t\t\t{0xA8F44759,0xCDB824F2,0x32FB3C01,0x42BEFFE1,0x3EC30B40,0xE094AA46,0x2AEA2B,0x362C0888};\n    uint32_t enc1[8];\n    \n    \n    for(int i=0;i<8;i++){\n        int j = i % 4;\n        enc1[i] = enc[(i/4)*4 + (3-j)];\n    }\n\n    for(int i=0;i<2;i++){\n        decrypt(enc1+i*4,key);\n    }\n\n    for(int i=0;i<8;i++){\t\t\t\t\t//è¿™é‡Œå¼€å§‹æ˜¯åçš„ï¼Œè¿˜æé”™äº†ã€‚å­—ç¬¦ä¸²çš„å¤§å°ç«¯æ€»æ˜¯è®©æˆ‘æ‘¸ä¸ç€å¤´è„‘ã€‚\n        printf(\"%c\",enc1[i]&0xFF);\n        printf(\"%c\",enc1[i]>>8&0xFF);\n        printf(\"%c\",enc1[i]>>16&0xFF);\n        printf(\"%c\",enc1[i]>>24&0xFF);\n    }\n\n    return 0;\n}\n```\n\n------\n\n# èåœå­çš„èƒèŸ¹\n\nâ€‹\t\tRUSTè¯­è¨€ç¨‹åºï¼Œå¯ä»¥ä½¿ç”¨IDAåç¼–è¯‘æ‰“å¼€ï¼Œéš¾ç‚¹å°±æ˜¯åç¼–è¯‘ä»£ç å¾ˆéš¾çœ‹ï¼Œéœ€è¦é…åˆåŠ¨è°ƒç¡®å®šç¨‹åºçš„è¿è¡Œé€»è¾‘ã€‚æœ‰ç‚¹ç´¯äº†ï¼Œæ”¹å¤©å†å†™ã€‚\n\nâ€‹\tåŠ¨è°ƒè¿˜æ˜¯ç»éªŒå¤ªå°‘äº†ï¼Œè¶æ­¤æœºä¼šï¼Œå¥½å¥½ç…§ç€WPå­¦ä¹ ä¸€ä¸‹åŠ¨è°ƒçš„ç»éªŒã€‚ä¸‹é¢åªæ€»ç»“äº†æ”¶è·çš„ç»éªŒï¼Œå®Œæ•´WPéƒ½æœ‰ã€‚\n\n\n\n- #### é€šè¿‡æç¤ºå­—ç¬¦ä¸²çš„äº¤å‰å¼•ç”¨æ‰¾åˆ°ç¨‹åºçš„ä¸»è¦é€»è¾‘å‡½æ•°ã€‚\n\n- #### çœ‹åˆ°å¦‚ä¸‹å›¾æ‰€ç¤ºçš„è¿™ç§ä¹±ä¸ƒå…«ç³Ÿçš„å‡½æ•°åï¼Œçœ‹åˆ°å¦‚æ­¤éš¾ä»¥è¯»æ‡‚çš„ä¼ªä»£ç ï¼Œå…ˆå•æ­¥è°ƒè¯•æ‰¾åˆ°inputå‡½æ•°ã€‚å¹¶ä¸”ï¼Œæ ¹æ®inputå‡½æ•°ä¸­çš„å‚æ•°å€¼ï¼Œæ‰¾åˆ°å­˜å‚¨è¾“å…¥flagçš„åœ°å€ã€‚å‚æ•°æ˜¯æŒ‡é’ˆï¼Œè¦é€šè¿‡Gé”®è·³è½¬åˆ°å¯¹åº”çš„å†…å­˜åœ°å€å¤„æŸ¥çœ‹ã€‚\n\n![image-20250522122253781](/pictures/ISCTF2024/image-20250522122253781.png)\n\n- #### æ‰¾åˆ°INPUTä¹‹åï¼Œå†é…Œæƒ…åˆ†æç¨‹åºè¿˜æœ‰å“ªäº›é‡è¦éƒ¨åˆ†ã€‚ç„¶åå¿½ç•¥å…¶ä»–æ“ä½œï¼Œé™¤å¼€ä¸è¾“å…¥flagç›¸å…³çš„éƒ¨åˆ†ï¼Œå…¶ä»–éƒ½å¯ä»¥ä¸ç®¡ï¼Œéœ€è¦ä»€ä¹ˆå¯ä»¥é åŠ¨è°ƒç›´æ¥è¯»å–å€¼ã€‚\n\n- #### çœ‹åˆ°é•¿åº¦æ¯”è¾ƒå’Œèµ‹å€¼éƒ¨åˆ†ï¼Œè¿™ä¸€å¤§å †æ•°æ®å¾ˆå¯èƒ½å°±æ˜¯å¯†æ–‡ï¼Œä½†æ˜¯ä¸èƒ½ç€æ€¥ï¼Œå¯†æ–‡ä¹Ÿæ˜¯å¯ä»¥åšå¤„ç†çš„ï¼Œä¸åˆ°æœ€åæ¯”å¯¹çš„æ—¶å€™éƒ½ä¸è¦å®Œå…¨ç¡®å®šå¯†æ–‡ã€‚\n\n![image-20250522122710905](/pictures/ISCTF2024/image-20250522122710905.png)\n\n- #### çœ‹åˆ°ä¸‹é¢å‰ä¸¤ä¸ªå‡½æ•°éƒ½æ˜¯å¯¹å¯†æ–‡è¿›è¡Œæ“ä½œï¼Œv35->v40->v36ï¼Œä¸ç”¨ç®¡ã€‚æˆ‘ä»¬åªéœ€è¦é”å®šä½æˆ‘ä»¬çš„è¾“å…¥å³å¯ï¼Œv29å°±æ˜¯è¾“å…¥å­—ç¬¦ä¸²çš„æŒ‡é’ˆï¼Œæˆ‘ä»¬çœ‹åˆ°v29åªåœ¨405F80å‚æ•°å¤„å‡ºç°äº†ï¼Œè€Œä¸”ä¸‹é¢å°±æ˜¯æ¯”å¯¹äº†ã€‚æ‰€ä»¥è¯¥é¢˜åº”è¯¥åªåœ¨è¿™ä¸ªå‡½æ•°é‡Œé¢è¿›è¡Œäº†å¤„ç†ã€‚\n\n![image-20250522122830052](/pictures/ISCTF2024/image-20250522122830052.png)\n\n- #### ä¸‹é¢çš„æ¯”å¯¹æ“ä½œï¼Œéœ€è¦ç®€å•è·Ÿè¸ªå˜é‡å€¼ç¡®å®šå˜é‡ä»£è¡¨çš„å«ä¹‰ï¼Œåœ¨è¿›å…¥406AA0æ—¶ä¸‹æ–­ç‚¹å–å‡ºå¯†æ–‡å€¼å³å¯ã€‚\n\n![image-20250522123228352](/pictures/ISCTF2024/image-20250522123228352.png)\n\n- #### é‡ç‚¹æ˜¯æ€ä¹ˆçŸ¥é“å¯¹è¾“å…¥çš„æ“ä½œæ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Œåœ¨ä¸Šé¢çš„v29å¤„æ‰¾åˆ°è¾“å…¥çš„flagï¼Œæ‰“ä¸‹å†…å­˜æ–­ç‚¹ï¼Œè¿™æ ·æ¯å½“ç¨‹åºå»è®¿é—®è¿™ä¸ªåœ°å€æ—¶å°±ä¼šè§¦å‘æ–­ç‚¹ï¼Œåˆ†åˆ«æˆ‘ä»¬åˆ†æç¨‹åºå¯¹flagåšäº†ä»€ä¹ˆå¤„ç†ã€‚å…·ä½“æ“ä½œå°±æ˜¯åœ¨æ•°æ®å¤´æ‘ä¸‹F2ä¸‹æ–­ç‚¹ï¼Œç„¶åå¡«ä¸‹æ•°æ®é•¿åº¦å°±è¡Œã€‚\n\n![image-20250522123655696](/pictures/ISCTF2024/image-20250522123655696.png)\n\n- #### ä¹‹åå°±å¯ä»¥çœ‹æƒ…å†µF9ç­–é©¬å¥”è…¾äº†ï¼Œæ³¨æ„ntdllæœ‰æ—¶å€™å›è®¿é—®è¿™ä¸ªå†…å­˜åœ°å€çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹æ–­ç‚¹è¡¨ï¼Œéšæ—¶å¼€å¯æˆ–å…³é—­æ–­ç‚¹ï¼Œè®°å¾—é…åˆç¨‹åºæ–­ç‚¹ï¼Œå…³é—­å†…å­˜æ–­ç‚¹ï¼Œç›´æ¥F9æ¥è·³è¿‡ntdllçš„è®¿é—®ï¼Œæˆ‘ä»¬åªå…³å¿ƒä¸»è¦é€»è¾‘å¯¹è¯¥åœ°å€çš„è®¿é—®ã€‚è·³å‡ºntdllåï¼Œå†å¼€å¯å†…å­˜æ–­ç‚¹ã€‚\n\n![image-20250522123845878](/pictures/ISCTF2024/image-20250522123845878.png)\n\n![image-20250522123934610](/pictures/ISCTF2024/image-20250522123934610.png)\n\n\n\nâ€‹\tæœ€åå¤ç°WPï¼Œè‡ªå·±æ‰‹åŠ¨æ‰¾åˆ°æ•°æ®ï¼Œè§£å¯†æˆåŠŸã€‚\n\nâ€‹\té€šè¿‡æœ¬é¢˜ï¼Œæˆ‘å­¦ä¹ åˆ°äº†å†…å­˜æ–­ç‚¹æ‰¾åŠ å¯†æ“ä½œçš„æ–¹æ³•ï¼Œå‘ç°äº†é€šè¿‡Gé”®è¿›è¡Œå†…å­˜è·³è½¬çš„åŠŸèƒ½ã€‚\n\n```python\ndata = \"A\" * 52\nenc_data = [105, 170, 63, 98, 219, 177, 5, 252, 176, 134, 189, 146, 177, 222, 70, 219, 183, 31, 150, 151, 6, 229, 101, 231, 47, 223, 159, 159, 159, 228, 116, 102, 218, 205, 139, 51, 99, 178, 172, 136, 66, 138, 47, 12, 150, 246, 201, 34, 207, 27, 86, 152]\n\nxor_key = []\nfor i in range(52):\n    xor_key.append(enc_data[i] ^ ord(data[i]))\n\n\nenc_flag =[97, 184, 61, 119, 220, 139, 54, 200, 130, 179, 163, 226, 196, 192, 106, 255, 155, 110, 165, 175, 20, 197, 66, 195, 49, 242, 191, 144, 185, 250, 19, 1, 196, 245, 165, 7, 125, 179, 159, 172, 92, 140, 94, 34, 179, 232, 200, 60, 220, 57, 35, 164]\nflag = \"\"\n\nfor i in range(52):\n    flag += chr(enc_flag[i] ^ xor_key[i])\n\nprint(flag)\n```\n","tags":["å¤ç°WP"],"categories":["CTF"]},{"title":"BaseCTF2024","url":"/2025/06/04/BaseCTF/BaseCTF2024_RE/","content":"\n\n\n------\n\n> **UPX mimiï¼š**\n>\n> â€‹\tåˆæ­¥æ¥è§¦åˆ°äº†UPXåŠ å£³ä¿æŠ¤çš„çŸ¥è¯†å’Œå¯¹åº”çš„è„±å£³å·¥å…·ï¼Œè¿™æ˜¯ä¸€ç§â€œå‹ç¼©â€ä¿æŠ¤å£³ï¼Œå³å°†æºç¨‹åºä»£ç è¿›è¡Œå‹ç¼©ï¼Œç„¶åé…ä¸Šè§£å‹ç¼©ä»£ç ï¼Œç»„æˆæ–°çš„ç¨‹åºï¼Œå³â€œUPXè§£å‹ä»£ç â€+â€œå‹ç¼©çš„æºæ–‡ä»¶â€ã€‚åœ¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œä¼šå…ˆæ‰§è¡ŒUPXçš„è§£å‹ä»£ç ï¼Œå¾—åˆ°è§£å‹åçš„æºæ–‡ä»¶ï¼Œç„¶åå°†æ§åˆ¶æµè½¬ç§»åˆ°æºæ–‡ä»¶ã€‚\n\n> **ez_maze:**\n>\n> â€‹\tæœ€åŸºç¡€çš„è¿·å®«é¢˜ç›®ï¼Œä»IDAä¸­å¯ä»¥ç›´æ¥çœ‹åˆ°è¿·å®«ï¼Œäººå·¥å°±èƒ½å¾—åˆ°è·¯å¾„ã€‚\n\n> **BasePlus:**\n>\n> â€‹\tæ— ä¿æŠ¤ï¼Œç›´æ¥æ‹–å…¥IDAï¼Œè€ƒå¯ŸåŸºç¡€çš„é˜…è¯»ä»£ç çš„èƒ½åŠ›ï¼ŒåŠ å¯†å‡½æ•°ä¸ºBase64çš„ä¸€ç‚¹ç‚¹å˜åŒ–ï¼Œå¯¹Base64åŠ å¯†åç»§ç»­å¼‚æˆ–ä¸€ä¸‹ã€‚å¾ˆåŸºç¡€ã€‚ç¬¬ä¸€æ¬¡è®¤çœŸæ“Base64çš„cè¯­è¨€ä»£ç ï¼Œæ”¶è·ä¸å°‘ã€‚\n\n> **Ez_Xor:**\n>\n> â€‹\tå¤ä¹ äº†å¤§å°ç«¯åºçš„çŸ¥è¯†ã€‚\n>\n> â€‹\tâ€œå°ç«¯åºâ€ï¼šä½ä½æœ‰æ•ˆå­—èŠ‚ä¿å­˜åœ¨å°åœ°å€ã€‚å¦‚0xDEADBEEFåœ¨å†…å­˜ä¸­çš„é¡ºåºæ˜¯ï¼ˆå°åœ°å€ï¼‰EF BE AD DEï¼ˆå¤§åœ°å€ï¼‰ã€‚â€œå¤§ç«¯åºâ€ç›¸åã€‚\n>\n> â€‹\tæœ¬é¢˜å°±æ˜¯ç®€å•çš„æµåŠ å¯†ï¼Œç”Ÿæˆå¯†é’¥æµç„¶ååŠ å¯†ã€‚å¯¹åº”è§£å¯†å³å¯ã€‚\n\n> **UPX:**\n>\n> â€‹\tæœ‰å£³ï¼Œç›´æ¥è„±å£³æŠ¥é”™ã€‚å­¦ä¹ åˆ°äº†ï¼Œæ”¹æ ‡å¿—ä½æ¥ä¿æŠ¤åŠ å£³ç¨‹åºçš„æ‰‹æ®µï¼Œæˆ‘ä»¬çš„ååˆ¶æ“ä½œå°±æ˜¯æ‰“å¼€æ–‡ä»¶ï¼Œå°†å¯¹åº”çš„æ ‡å¿—ä½ä»å°å†™æ”¹å›å¤§å†™ã€‚ä¹‹åå°±å¯ä»¥æ­£å¸¸è„±å£³äº†ã€‚\n>\n> â€‹\tæ‹–å…¥IDAåï¼Œè€ƒå¯Ÿçš„æ˜¯æ¢è¡¨çš„Base64ã€‚å”¯ä¸€éœ€è¦æ³¨æ„çš„ç‚¹å°±æ˜¯å› ä¸ºé¢˜ç›®æºç æ˜¯Cè¯­è¨€ï¼Œåœ¨IDAå­—ç¬¦ä¸²æ˜¾ç¤ºä¸­ç»™åŒå¼•å·å…¨é¢åŠ äº†è½¬ä¹‰ç¬¦å·çš„ï¼Œä¸è¦æé”™äº†ã€‚\n\n![image-20250425170632940](/pictures/BaseCTF2024/image-20250425170632940.png)\n\n> **lk:**\n>\n> â€‹\tæ¯”è¾ƒå¤§çš„çº¿æ€§æ–¹ç¨‹ç»„ï¼Œè€ƒå¯Ÿpythonçš„z3solveråº“ä½¿ç”¨ã€‚\n\n> **å–æ¯ä¸‹åˆèŒ¶ï¼š**\n>\n> â€‹\tæ ‡å‡†çš„TeaåŠ å¯†ï¼Œç¬¬ä¸€æ¬¡ä½¿ç”¨Cè¯­è¨€å®ç°äº†è¯¥ç®—æ³•ï¼Œæ”¶è·ä¸å°‘ã€‚\n\n> **Ezpy:**\n>\n> â€‹\tè€ƒå¯Ÿpythonæ‰“åŒ…å‡ºçš„EXEç¨‹åºã€‚åç¼–è¯‘å‡ºæºç ã€‚\n>\n> â€‹\tå†è€ƒå¯ŸRC4åŠ å¯†ã€‚\n\n> **æœ€ç®€å•çš„ç¼–ç ï¼š**\n>\n> â€‹\tæ— ä¿æŠ¤æŠ€æœ¯ï¼Œçº¯è€ƒéªŒä¼ªä»£ç çš„é˜…è¯»æ°´å¹³ï¼Œè€ä¸‹å¿ƒæ¥åˆ†æå°±å¥½äº†ã€‚\n\n> **neuroçˆ±æ•°å­¦ï¼š**\n>\n> â€‹\t\n\n> **RivestCipher:**\n>\n> â€‹\tè€ƒå¯Ÿæ ‡å‡†RC4åŠ å¯†ç®—æ³•ã€‚\n\n> **ezAndroid:**\n>\n> â€‹\tæ”¶è·åˆ°äº†é€†å‘apkå®‰è£…åŒ…çš„è½¯ä»¶jadxï¼Œæ¥è§¦åˆ°äº†soæ–‡ä»¶ï¼ˆå…±äº«åº“ï¼‰é€†å‘ï¼Œæ˜¯ä¸€äº›æ²¡æœ‰æ¥è§¦è¿‡çš„æ“ä½œã€‚åˆè¦è¯»å¥‡æ€ªçš„ä»£ç ã€‚å”‰ï¼\n\n------\n\n# **UPX PRO MAX**\t\n\nâ€‹\tç›´æ¥è¿è¡ŒEXEç¨‹åºï¼Œä¼šå‡ºç°ä¸‹å›¾çš„æ˜¾ç¤ºã€‚\n\n![image-20250506132159230](/pictures/BaseCTF2024/image-20250506132159230.png)\n\nDIEä¹Ÿçœ‹åˆ°UPXå£³ã€‚\n\n![image-20250506132311405](/pictures/BaseCTF2024/image-20250506132311405.png)\n\nç›´æ¥ä¸Šå·¥å…·æ˜¯ä¸è¡Œçš„å•Šï¼ŒæŠ¥é”™äº†ã€‚\n\nè·Ÿç€WPå­¦ä¹ â€”â€”**åˆ©ç”¨ESPå®šå¾‹x64dbgæ‰‹è„±UPXå£³**ã€‚\n\n> â€œESPå®šå¾‹â€ä¹Ÿç§°â€œå †æ ˆå¹³è¡¡å®šå¾‹â€\n>\n> ç”±äºåœ¨ç¨‹åºè‡ªè§£å¯†æˆ–è€…è‡ªè§£å‹è¿‡ç¨‹ä¸­, å¤šæ•°å£³ä¼šå…ˆå°†å½“å‰å¯„å­˜å™¨çŠ¶æ€å‹æ ˆ, å¦‚ä½¿ç”¨`pushad`, è€Œåœ¨è§£å‹ç»“æŸå, ä¼šå°†ä¹‹å‰çš„å¯„å­˜å™¨å€¼å‡ºæ ˆ, å¦‚ä½¿ç”¨`popad`. å› æ­¤åœ¨å¯„å­˜å™¨å‡ºæ ˆæ—¶, å¾€å¾€ç¨‹åºä»£ç è¢«æ¢å¤, æ­¤æ—¶ç¡¬ä»¶æ–­ç‚¹è§¦å‘ï¼ˆè¿™å°±æ˜¯æˆ‘ä»¬è¦ä¸‹ç¡¬ä»¶æ–­ç‚¹çš„åŸå› ï¼‰ï¼Œç„¶ååœ¨ç¨‹åºå½“å‰ä½ç½®, åªéœ€è¦ä¸€äº›å•æ­¥æ“ä½œ, å°±ä¼šåˆ°è¾¾æ­£ç¡®çš„OEPä½ç½®ã€‚\n>\n> 1. ç¨‹åºåˆšè½½å…¥å¼€å§‹ `pushad/pushfd`\n> 2. å°†å…¨éƒ¨å¯„å­˜å™¨å‹æ ˆåå°±è®¾å¯¹ ESP å¯„å­˜å™¨è®¾ç¡¬ä»¶æ–­ç‚¹\n> 3. è¿è¡Œç¨‹åº, è§¦å‘æ–­ç‚¹\n> 4. åˆ é™¤ç¡¬ä»¶æ–­ç‚¹å¼€å§‹åˆ†æ\n\nåœ¨x64dbgä¸­ï¼ŒF9ä¸¤æ¬¡åæ¥åˆ°è¿™ä¸ªå‹æ ˆçš„æ“ä½œå¤„ã€‚æ¥ç€å•æ­¥è¿è¡Œä¸€æ¬¡ï¼Œçœ‹åˆ°ESPçš„å€¼ä¸ºçº¢è‰²ï¼Œä»£è¡¨å…¶å€¼è¢«ä¿®æ”¹äº†ï¼Œæˆ‘ä»¬å³é”®é€‰æ‹©â€œåœ¨å†…å­˜çª—å£ä¸­è½¬åˆ°â€ï¼Œç„¶ååœ¨æ ˆä¸­æ‰“ä¸‹ç¡¬ä»¶æ–­ç‚¹ã€‚\n\n![image-20250506133643545](/pictures/BaseCTF2024/image-20250506133643545.png)\n\n![image-20250506134057787](/pictures/BaseCTF2024/image-20250506134057787.png)\n\n![image-20250506134312068](/pictures/BaseCTF2024/image-20250506134312068.png)\n\nä¹‹åF9ï¼Œè§¦å‘æ–­ç‚¹åå•æ­¥è¿è¡Œå‡ ä¸‹å°±æ‰¾åˆ°OEPäº†ï¼Œå³ç¨‹åºå…¥å£ç‚¹ã€‚å¯ä»¥çœ‹åˆ°è¿™ä¸ªåœ°æ–¹çš„å¤šæ¬¡popæŒ‡ä»¤ã€‚\n\næ ¹æ®wpä¸­çš„æç¤ºï¼Œ0X41CF65è·³è½¬çš„åœ°æ–¹å°±æ˜¯ç¨‹åºçš„å…¥å£ç‚¹äº†ã€‚åº”è¯¥æ˜¯äº†ã€‚\n\n![image-20250506134519180](/pictures/BaseCTF2024/image-20250506134519180.png)\n\nä¸‹é¢æ ¹æ®WPä¸­çš„æ“ä½œä»‹ç»ä¸€æ­¥æ­¥å°±å¯ä»¥è„±å‡ºæ— å£³çš„ç¨‹åºäº†ï¼Œå«UPX_PRO_MAX_dump_SCY.exeã€‚\n\n> `scylla`æ’ä»¶ï¼šåœ¨ x64dbg ä¸­å†…ç½®çš„ Scylla æ’ä»¶å¯ç”¨äº dump è¿›ç¨‹ï¼Œ**å³å°†å†…å­˜ä¸­çš„ç¨‹åºæ•°æ®è½¬å‚¨åˆ°ç£ç›˜ä¸Š**ï¼Œå½¢æˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶çš„å‰¯æœ¬ï¼Œæ–¹ä¾¿åç»­å¯¹ç¨‹åºçš„åˆ†æå’Œç ”ç©¶ã€‚\n>\n> `IAT AutoSearch`ï¼š åœ¨åˆ†æç»è¿‡åŠ å£³æˆ–åŠ å¯†çš„ç¨‹åºæ—¶ï¼Œç¨‹åºçš„å¯¼å…¥è¡¨å¯èƒ½è¢«ç ´åæˆ–éšè—ï¼ŒIAT AutoSearch å¯ä»¥è‡ªåŠ¨æ‰«æå†…å­˜æˆ–ä»£ç æ®µï¼Œå¯»æ‰¾å¯èƒ½çš„å¯¼å…¥å‡½æ•°åœ°å€ï¼Œå¸®åŠ©é€†å‘å·¥ç¨‹å¸ˆå¿«é€Ÿæ‰¾åˆ°ç¨‹åºæ‰€è°ƒç”¨çš„å¤–éƒ¨å‡½æ•°ã€‚\n\n> ç¨‹åºçš„å¯¼å…¥è¡¨æ˜¯ç¨‹åºçš„å…³é”®æ•°æ®ç»“æ„ï¼Œç”¨äºåˆ—å‡ºç¨‹åºè¿è¡Œæ—¶éœ€è¦ä»å…¶ä»–æ¨¡å—ï¼ˆé€šå¸¸æ˜¯ DLLï¼‰ä¸­å¯¼å…¥çš„å‡½æ•°å’Œå˜é‡ã€‚ä»¥ä¸‹æ˜¯å¯¼å…¥è¡¨çš„è¯¦ç»†ä»‹ç»ï¼š\n>\n>   * å¯¼å…¥è¡¨æ˜¯ç¨‹åºçš„ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œå®ƒåŒ…å«äº†ä¸€ç³»åˆ—çš„å¼•ç”¨ä¿¡æ¯ï¼ŒæŒ‡å‘ç¨‹åºè¿è¡Œæ—¶éœ€è¦è°ƒç”¨çš„å¤–éƒ¨å‡½æ•°å’Œå˜é‡æ‰€åœ¨çš„æ¨¡å—åŠå…¶å…·ä½“åœ°å€ã€‚\n>\n> \n>\n>   * **ä¾¿äºè°ƒç”¨å¤–éƒ¨æ¨¡å—åŠŸèƒ½** ï¼šç¨‹åºé€šå¸¸ä¸ä¼šå°†æ‰€æœ‰åŠŸèƒ½éƒ½è‡ªå·±å®ç°ï¼Œè€Œæ˜¯é€šè¿‡è°ƒç”¨ç³»ç»Ÿæˆ–ç¬¬ä¸‰æ–¹æä¾›çš„ DLL ä¸­çš„å‡½æ•°å’Œå˜é‡æ¥å®ç°å¤æ‚çš„åŠŸèƒ½ã€‚å¯¼å…¥è¡¨å°±åƒä¸€ä¸ªç›®å½•ï¼Œå‘Šè¯‰æ“ä½œç³»ç»Ÿç¨‹åºéœ€è¦ä»å“ªäº› DLL ä¸­ä½¿ç”¨å“ªäº›åŠŸèƒ½ã€‚\n>   * **ä¾¿äºç¨‹åºçš„åŠ¨æ€é“¾æ¥** ï¼šå®ƒæ”¯æŒç¨‹åºçš„åŠ¨æ€é“¾æ¥æœºåˆ¶ã€‚ç¨‹åºåœ¨ç¼–è¯‘æ—¶ä¸ä¼šç›´æ¥å°† DLL ä¸­çš„å‡½æ•°å’Œå˜é‡ä»£ç åŒ…å«è¿›æ¥ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶è£…è½½æ‰€éœ€çš„ DLLï¼Œå¹¶é€šè¿‡å¯¼å…¥è¡¨æ‰¾åˆ°å…·ä½“çš„å‡½æ•°å’Œå˜é‡åœ°å€ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ç¨‹åºè‡ªèº«çš„ä½“ç§¯ï¼ŒåŒæ—¶æ–¹ä¾¿å¯¹ DLL è¿›è¡Œæ›´æ–°å’Œå…±äº«ã€‚\n>\n> \n>\n>   * **å¯¼å…¥æ¨¡å—åè¡¨** ï¼šå­˜æ”¾äº†ç¨‹åºéœ€è¦å¯¼å…¥çš„å„ä¸ªæ¨¡å—çš„åå­—ï¼Œæ¯”å¦‚ â€œkernel32.dllâ€â€œuser32.dllâ€ ç­‰ã€‚\n>   * **å¯¼å…¥å‡½æ•°åè¡¨** ï¼šå¯¹äºæ¯ä¸ªå¯¼å…¥æ¨¡å—ï¼Œéƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„å¯¼å…¥å‡½æ•°åè¡¨ï¼Œåˆ—å‡ºäº†ä»è¯¥æ¨¡å—ä¸­å¯¼å…¥çš„å…·ä½“å‡½æ•°åç§°ï¼Œå¦‚ â€œMessageBoxAâ€â€œCreateFileAâ€ ç­‰ã€‚\n>   * **å¯¼å…¥å‡½æ•°åœ°å€è¡¨ï¼ˆIATï¼‰** ï¼šåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†æ¯ä¸ªå¯¼å…¥å‡½æ•°çš„å®é™…å†…å­˜åœ°å€å¡«å…¥è¿™ä¸ªè¡¨ä¸­ï¼Œç¨‹åºé€šè¿‡è¿™ä¸ªè¡¨ä¸­çš„åœ°å€æ¥è°ƒç”¨ç›¸åº”çš„å‡½æ•°ã€‚\n\nè„±å£³åçš„ç¨‹åºå¯¼å…¥IDAä¸­ï¼Œå¾ˆæ¸…æ™°çš„åŠ å¯†é€»è¾‘ã€‚ç›´æ¥é€†å‘å†™è„šæœ¬å°±è¡Œã€‚\n\n![image-20250506141212651](/pictures/BaseCTF2024/image-20250506141212651.png)\n\nä½†æ˜¯è¿™é‡Œå‡ºç°äº†ä¸€ä¸ªå‘ï¼š`sub_401550`å‡½æ•°å…¶å®å°±æ˜¯ä¸€äº›åŠ å¯†å­—ç¬¦ä¸²ç§»åŠ¨æ“ä½œï¼Œåˆ†æˆå‡ éƒ¨åˆ†å­˜å‚¨åœ¨å‡ ä¸ªå˜é‡ä¸­ã€‚ä½†æ˜¯åœ¨éªŒè¯å‡½æ•°ä¸­ï¼Œå…¨ç¨‹åªç”¨åˆ°äº†a1å’Œa2éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯sub_401550ä¸­çš„a2å’Œa3ï¼Œä¸æ˜¯å®Œæ•´çš„å¯†æ–‡ï¼Œæˆ‘è§‰å¾—è¿™é‡Œæ˜¯ä¸­é—´å‡ºäº†é—®é¢˜ï¼Œè€Œä¸”è¿™ä¸ªæå–å‡ºæ¥çš„exeç¨‹åºæ— æ³•æ­£å¸¸è¿è¡Œï¼ŒIDAä¸­ä¹Ÿè°ƒè¯•ä¸è¡Œï¼Œåªèƒ½é™æ€åˆ†æã€‚æ‰€ä»¥è¿˜æ˜¯æœ‰ç‚¹ä¸é è°±çš„ä¸œè¥¿å­˜åœ¨ã€‚\n\n![image-20250506142108769](/pictures/BaseCTF2024/image-20250506142108769.png)\n\n![image-20250506141429954](/pictures/BaseCTF2024/image-20250506141429954.png)\n\n------\n\n# EZ_VM\n\nâ€‹\tåŸºæœ¬ä¿¡æ¯ï¼š`pyinstaller`æ‰“åŒ…çš„`ELF64`ä½ç¨‹åºï¼Œä½¿ç”¨`pydumpck`è§£åŒ…å¾—åˆ°`py`æ–‡ä»¶ã€‚\n\nâ€‹\tåŠ å¯†é€»è¾‘åœ¨`what.py`æ–‡ä»¶ï¼Œæ‰“å¼€ï¼Œé‡Œé¢å‡½æ•°åç§°å’Œå˜é‡åéƒ½æ˜¯ç”¨æ•°å­—ä»£æ›¿çš„ï¼Œè¿˜æœ‰ä¸€äº›å°é”™è¯¯ï¼Œæ¯”å¦‚æœ¬æ¥çš„â€œwhileâ€è¯­å¥å˜æˆâ€œifâ€ï¼Œéœ€è¦æ”¹è¿‡æ¥ã€‚\n\nâ€‹\tä»£ç çš„é€»è¾‘å°±æ˜¯ï¼šåˆ†åˆ«ä½¿ç”¨ä¸€ä¸ªæ•°ç»„å˜é‡å’Œä¸€ä¸ªå­—å…¸æ¥æ¨¡æ‹Ÿä¸€ä¸ªæ ˆå’Œå†…å­˜ï¼Œä½¿ç”¨å˜é‡æ¨¡æ‹Ÿå¯„å­˜å™¨ï¼Œé€šè¿‡æ•°ç»„çš„`pop`å’Œ`push`æ¨¡æ‹Ÿæ ˆçš„æ“ä½œï¼Œä½¿ç”¨å‡½æ•°å®šä¹‰å„ç§æ±‡ç¼–æŒ‡ä»¤ï¼Œå¦‚pushã€popã€addã€subç­‰ç­‰ï¼Œéƒ½æ˜¯ç»Ÿä¸€æ“ä½œæ•°é•¿åº¦ã€‚å°±è¿™æ ·å®šä¹‰äº†ä¸€ä¸ªèƒ½å¤Ÿé€šè¿‡æ±‡ç¼–æŒ‡ä»¤è¿›è¡Œè¿è¡Œçš„â€œè™šæ‹Ÿæœºâ€ï¼Œé‡Œé¢å­˜åœ¨å‡ºé¢˜äººé¢„å…ˆå†™å¥½çš„ä¸€æ®µé™æ€æ±‡ç¼–ä»£ç ï¼Œä½œä¸ºåŠ å¯†å‡½æ•°ã€‚\n\n> 1. æˆ‘ä»¬é¦–è¦ä»»åŠ¡å°±æ˜¯ç»™æºpythonä»£ç è¿›è¡Œé‡å‘½åå’Œæ˜æ˜¾çš„é”™è¯¯çº æ­£ã€‚ï¼ˆéœ€è¦è¶³å¤Ÿç†Ÿæ‚‰æ±‡ç¼–æŒ‡ä»¤ï¼Œèµ·ç çš„è¦çŸ¥é“ã€‚è½¬ç§»æŒ‡ä»¤è¿˜æ²¡é‚£ä¹ˆé‡è¦ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å…³å¿ƒç¨‹åºçš„æ‰§è¡Œæµç¨‹ï¼Œæˆ‘ä»¬åªéœ€è¦æ³¨æ„å¯†æ–‡çš„æ¥å¤„å³å¯ã€‚ï¼‰\n> 2. ç„¶ååœ¨å…¶ä¸­æ’å…¥printè°ƒè¯•è¯­å¥è¾“å‡ºæ“ä½œæŒ‡ä»¤ã€æ ˆå’Œå†…å­˜çš„å€¼ï¼Œé”å®šå¯†æ–‡çš„å­˜å‚¨åœ°æ–¹ï¼Œè§‚å¯ŸåŠ å¯†æ–¹æ³•ã€‚\n> 3. æ ¹æ®åŠ å¯†æ–¹æ³•å†™é€†å‘è„šæœ¬ã€‚\n\nâ€‹\t\n\n```python\nenc_flag = [\n    35,\n    18,\n    22,\n    38,\n    23,\n    18,\n    61,\n    25,\n    83,\n    4,\n    0,\n    5,\n    5,\n    83,\n    95,\n    20,\n    29,\n    83,\n    82,\n    1,\n    29,\n    25,\n    0,\n    0,\n    81,\n    72,\n    76,\n    85,\n    3,\n    85,\n    79,\n    73,\n    83,\n    0,\n    15,\n    9,\n    85,\n    7,\n    80,\n    82,\n    0,\n    5,\n    84,\n    77,\n    130]\n\n\nclass Opcode:\n    vm_push = 240\n    vm_pop = 241\n    vm_and = 242\n    vm_or = 243\n    vm_not = 244\n    vm_xor = 245\n    vm_jmp = 246\n    vm_jz = 247\n    vm_label = 248\n    vm_strlen = 249\n    vm_loadchar = 250\n    vm_store = 251\n    vm_load = 252\n    vm_add = 253\n    vm_sub = 254\n\n\nclass VM:\n\n    def __init__(self):\n        self.stack = []\n        self.bytecode = []\n        self.pc = 0\n        self.labels = {}\n        self.memory = {}\n\n    def push(self, value):\n        self.stack.append(value)\n\n    def pop(self):\n        if not self.stack:\n            raise IndexError('something wrong..')\n        return self.stack.pop()\n\n    def _scan_labels(self):\n        labels = {}\n        pc = 0\n        while pc < len(self.bytecode):\n            if self.bytecode[pc] == Opcode.vm_label:\n                label_name = self.bytecode[pc + 1]\n                labels[label_name] = pc\n                pc += 2\n            else:\n                pc += 1\n\n        return labels\n\n    def vm_and(self):\n        a = self.pop()\n        b = self.pop()\n        self.push(b & a)\n\n    def vm_or(self):\n        a = self.pop()\n        b = self.pop()\n        self.push(b | a)\n\n    def vm_not(self):\n        b = self.pop()\n        self.push(~b)\n\n    def vm_xor(self):\n        a = self.pop()\n        b = self.pop()\n        self.push(b ^ a)\n\n    def vm_jmp(self):\n        label_name = self.bytecode[self.pc]\n        self.pc = self.labels[label_name]\n\n    def vm_jz(self):\n        label_name = self.bytecode[self.pc]\n        self.pc += 1\n        a = self.pop()\n        b = self.pop()\n        if a == b:\n            self.pc = self.labels[label_name]\n\n    def vm_strlen(self):\n        string = self.pop()\n        self.push(len(string))\n\n    def vm_loadchar(self):\n        string = self.pop()\n        index = self.pop()\n        self.push(ord(string[index]))\n\n    def vm_store(self):\n        value = self.pop()\n        key = self.bytecode[self.pc]\n        if key == 'r':\n            if key not in self.memory:\n                self.memory[key] = []\n            self.memory[key].append(value)\n        else:\n            self.memory[key] = value\n        self.pc += 1\n\n    def vm_load(self):\n        key = self.bytecode[self.pc]\n        self.push(self.memory[key])\n        self.pc += 1\n\n    def vm_add(self):\n        a = self.pop()\n        b = self.pop()\n        self.push(b + a)\n\n    def vm_sub(self):\n        a = self.pop()\n        b = self.pop()\n        self.push(b - a)\n\n    def run(self, bytecode):\n        self.bytecode = bytecode\n        self.pc = 0\n        self.labels = self._scan_labels()\n        while self.pc < len(self.bytecode):\n            opcode = self.bytecode[self.pc]\n            self.pc += 1\n            if opcode == Opcode.vm_push:\n                value = self.bytecode[self.pc]\n                self.pc += 1\n                self.push(value)\n            elif opcode == Opcode.vm_pop:\n                self.pop()\n            elif opcode == Opcode.vm_and:\n                self.vm_and()\n            elif opcode == Opcode.vm_or:\n                self.vm_or()\n            elif opcode == Opcode.vm_not:\n                self.vm_not()\n            elif opcode == Opcode.vm_xor:\n                self.vm_xor()\n            elif opcode == Opcode.vm_jmp:\n                self.vm_jmp()\n            elif opcode == Opcode.vm_jz:\n                self.vm_jz()\n            elif opcode == Opcode.vm_label:\n                self.pc += 1\n            elif opcode == Opcode.vm_strlen:\n                self.vm_strlen()\n            elif opcode == Opcode.vm_loadchar:\n                self.vm_loadchar()\n            elif opcode == Opcode.vm_store:\n                self.vm_store()\n            elif opcode == Opcode.vm_load:\n                self.vm_load()\n            elif opcode == Opcode.vm_add:\n                self.vm_add()\n            elif opcode == Opcode.vm_sub:\n                self.vm_sub()\n            else:\n                raise ValueError('something wrong')\n            print(f\"pc: {self.pc}| opcode: {get_opcode_name(opcode)}, stack: {self.stack}, memory: {self.memory}\")\n\n    def encrypt(self, serial):\n        bytecode = [\n            Opcode.vm_push, serial,\n            Opcode.vm_strlen,\n            Opcode.vm_store, 'l1',\n            Opcode.vm_push, 0,\n            Opcode.vm_store, 'i',\n            Opcode.vm_label, 's',\n            Opcode.vm_load, 'l1',\n            Opcode.vm_push, 1,\n            Opcode.vm_sub,\n            Opcode.vm_load, 'i',\n            Opcode.vm_jz, 'e',\n            Opcode.vm_load, 'i',\n            Opcode.vm_push, serial,\n            Opcode.vm_loadchar,\n            Opcode.vm_load, 'i',\n            Opcode.vm_push, 1,\n            Opcode.vm_add,\n            Opcode.vm_push, serial,\n            Opcode.vm_loadchar,\n            Opcode.vm_xor,\n            Opcode.vm_store, 'r',\n            Opcode.vm_load, 'i',\n            Opcode.vm_push, 1,\n            Opcode.vm_add,\n            Opcode.vm_store, 'i',\n            Opcode.vm_jmp, 's',\n            Opcode.vm_label, 'e',\n            Opcode.vm_load, 'i',\n            Opcode.vm_push, serial,\n            Opcode.vm_loadchar,\n            Opcode.vm_push, 255,\n            Opcode.vm_xor,\n            Opcode.vm_store, 'r'\n        ]\n        self.run(bytecode)\n        enc = self.memory['r']\n        return enc\n\ndef get_opcode_name(opcode):\n    for name, value in Opcode.__dict__.items():\n        if value == opcode:\n            return name\n    return None\n\nvm = VM()\ntest_flag = \"BaseCTF{VM_is_awesome}\"\nenc = vm.encrypt(test_flag)\nprint(f\"encrypted test_flag: {enc}\")\nprint(f\"original flag: {enc_flag}\")\n```\n\næ ¹æ®WPæç¤ºé‡å‘½ååï¼Œè§‚å¯Ÿä¼ è¾“çš„è°ƒè¯•ä¿¡æ¯ã€‚çœ‹ä¸€ä¸‹å¼€å¤´å’Œç»“å°¾å°±è¡Œã€‚\n\n![image-20250509160138052](/pictures/BaseCTF2024/image-20250509160138052.png)\n\n![image-20250509160305470](/pictures/BaseCTF2024/image-20250509160305470.png)\n\nâ€‹\tæ‰€ä»¥çŒœåˆ°åŠ å¯†é€»è¾‘æ˜¯ï¼šä»å‰å¾€åï¼Œç›¸é‚»ä¸¤ä½å¼‚æˆ–ï¼Œå°¾éƒ¨å’Œ255å¼‚æˆ–ã€‚\n\nè¿™é‡Œç»™å‡ºæˆ‘çš„è§£å¯†è„šæœ¬ã€‚\n\n```python\nenc_flag = [35, 18, 22, 38, 23,  18,61, 25,  83,4,0, 5, 5,83,95,  20,  29, 83,82,  1, 29, 25, 0,0,81,72,76,85,3,85,79,73,83,0,15,9,85,7,80,82,0,5,84,77,130,255]\n\nflag = \"\"\nfor i in range(len(enc_flag)):\n    char = enc_flag[i]\n    for j in range(i+1, len(enc_flag)):\n        char = char ^ enc_flag[j]\n\n    flag += chr(char)\n\nprint(flag)\n```\n\n------\n\n# Microgame\n\nâ€‹\tä¸ç†è§£ï¼Œä¸ä¼šæ¸¸æˆé€†å‘ï¼Œåé¢å¾—å­¦å•Šã€‚ä¸“é—¨åšäº†ä¸€ä¸ªCEçš„å­¦ä¹ ã€‚\n\nâ€‹\tå­¦ä¹ å®ŒCEï¼Œä¸“é—¨å‡ºä¸ªWPæ¥åšã€‚\n\n------\n\n# neuroçˆ±æ•°å­¦\n\nâ€‹\tç›´æ¥æ‰“å¼€IDAçœ‹çœ‹`main`å‡½æ•°ï¼Œç¨‹åºæ— å£³ï¼Œå°±æ˜¯è€ƒå¯Ÿæ•°å­¦é—®é¢˜ã€‚\n\n![image-20250512120720066](/pictures/BaseCTF2024/image-20250512120720066.png)\n\n![image-20250512130852846](/pictures/BaseCTF2024/image-20250512130852846.png)\n\n![image-20250512130953971](/pictures/BaseCTF2024/image-20250512130953971.png)\n\n```c\n#include<stdio.h>\n#include<stdint.h>\n#include<intrin.h>\n\nint main(){\t\t\t\t\t\t\t\t//æ³¨æ„ï¼šå„ä¸ªå˜é‡å’Œå‡½æ•°çš„ç±»å‹æ˜¯å…³é”®ï¼Œä¸èƒ½æé”™ï¼Œéœ€è¦å¯¹ç…§IDAä¼ªä»£ç \n    int64_t v5=0x400C0210000001;\t\t\t//è¿™ä¸ªå€¼æ˜¯å›ºå®šçš„ï¼Œä½†æ˜¯éœ€è¦åŠ¨è°ƒç¨‹åºå¾—åˆ°è¿™ä¸ªå€¼ã€‚\n\n    for(int i=-60; i<=59; i++){\n        if(i == 44 || i == 58){\n            printf(\"ç¬¦åˆæ¡ä»¶çš„iå€¼ä½ï¼š%d/n\", i);\n            continue;\n        }\n\n        unsigned int v12 = (unsigned int)(i + 37);\n        if(v12 <= 54 && _bittest64((int64_t*)&v5,(unsigned int)v12) != 0){\n            printf(\"ç¬¦åˆæ¡ä»¶çš„iå€¼ä¸ºï¼š%d/n\", i);\n        }\n\n    }\n\n    return 0;\n}\n\n```\n\n![image-20250512131328904](/pictures/BaseCTF2024/image-20250512131328904.png)\n\nç„¶åä½¿ç”¨pythonè„šæœ¬å±•å¼€å¤šé¡¹å¼å¾—åˆ°ç³»æ•°ã€‚\n\n````python\nfrom sympy import symbols, expand\n\n# å®šä¹‰ç¬¦å·å˜é‡\nx = symbols('x')\n\n# æ„é€ å¤šé¡¹å¼\npolynomial = (x - 44) * (x - 58) * (x - 5) * (x + 37) * (x - 17) * (x + 9) * (x - 6) * (x + 4)\n\n# å±•å¼€å¤šé¡¹å¼\nexpanded_polynomial = expand(polynomial)\n\n# æå–å¹¶æ‰“å°ç³»æ•°\nstandard_form = expanded_polynomial.as_poly()  # è·å–æ ‡å‡†å½¢å¼çš„å¤šé¡¹å¼\ncoefficients = standard_form.all_coeffs()    # è·å–æ‰€æœ‰ç³»æ•°\n\n# æ‰“å°ç³»æ•°é€†åºï¼ˆä»å¸¸æ•°é¡¹åˆ°æœ€é«˜æ¬¡é¡¹ï¼‰ã€‚å› ä¸ºæ­£å¸¸æ˜¯ä»é«˜æ¬¡é¡¹åˆ°ä½æ¬¡é¡¹ã€‚\nprint(coefficients[::-1])\n#[-1733624640, 134045088, 122783468, -12168520, -1364231, 121272, -358, -80, 1]\n````\n\n![æµ‹è¯•å›¾ç‰‡](/pictures/BaseCTF2024/image-20250512131708984.png)\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["å¤ç°WP"],"categories":["CTF"]},{"title":"éŸ³ä¹é¦†","url":"/music/index.html"},{"url":"/json/music.json","content":"[\n  {\n    \"name\": \"é’èŠ±ç“·\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.4/é’èŠ±ç“·/é’èŠ±ç“·.mp3\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000002eFUFm2XYZ7z_2.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.4/é’èŠ±ç“·/é’èŠ±ç“·.lrc\"\n  },\n  {\n    \"name\": \"ç¨»é¦™\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.1/å‘¨æ°ä¼¦/ç¨»é¦™/ç¨»é¦™.mp3\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000002Neh8l0uciQZ_1.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.1/å‘¨æ°ä¼¦/ç¨»é¦™/ç¨»é¦™.lrc\"\n  },\n  {\n    \"name\": \"æ™´å¤©\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.2/æ™´å¤©/æ™´å¤©.mp3\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000000MkMni19ClKG_3.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.2/æ™´å¤©/æ™´å¤©.lrc\"\n  },\n  {\n    \"name\": \"ä¸ƒé‡Œé¦™\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.2/ä¸ƒé‡Œé¦™/ä¸ƒé‡Œé¦™.mp3\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000003DFRzD192KKD_1.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.2/ä¸ƒé‡Œé¦™/ä¸ƒé‡Œé¦™.lrc\"\n  },\n  {\n    \"name\": \"èŠ±æµ·\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music-jay@1.0.1/èŠ±æµ·/èŠ±æµ·.flac\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000002Neh8l0uciQZ_1.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music-jay@1.0.1/èŠ±æµ·/èŠ±æµ·.lrc\"\n  },\n  {\n    \"name\": \"åæ–¹å‘çš„é’Ÿ\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music-jay@1.0.1/åæ–¹å‘çš„é’Ÿ/åæ–¹å‘çš„é’Ÿ.flac\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000000f01724fd7TH_1.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music-jay@1.0.1/åæ–¹å‘çš„é’Ÿ/åæ–¹å‘çš„é’Ÿ.lrc\"\n  },\n  {\n    \"name\": \"å…°äº­åº\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.1/å‘¨æ°ä¼¦/å…°äº­åº/å…°äº­åº.mp3\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000002Neh8l0uciQZ_1.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.1/å‘¨æ°ä¼¦/å…°äº­åº/å…°äº­åº.lrc\"\n  },\n  {\n    \"name\": \"è¯´å¥½çš„è¾›ç¦å‘¢\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.2/è¯´å¥½çš„è¾›ç¦å‘¢/è¯´å¥½çš„è¾›ç¦å‘¢.mp3\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000002Neh8l0uciQZ_1.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.2/è¯´å¥½çš„è¾›ç¦å‘¢/è¯´å¥½çš„å¹¸ç¦å‘¢.lrc\"\n  },\n  {\n    \"name\": \"ç­‰ä½ ä¸‹è¯¾ (with æ¨ç‘ä»£)\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.1/å‘¨æ°ä¼¦/ç­‰ä½ ä¸‹è¯¾/ç­‰ä½ ä¸‹è¯¾.mp3\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000003bSL0v4bpKAx_1.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.1/å‘¨æ°ä¼¦/ç­‰ä½ ä¸‹è¯¾/ç­‰ä½ ä¸‹è¯¾.lrc\"\n  },\n  {\n    \"name\": \"æˆ‘è½æ³ªæƒ…ç»ªé›¶ç¢\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.2/æˆ‘è½æ³ªæƒ…ç»ªé›¶ç¢/æˆ‘è½æ³ªæƒ…ç»ªé›¶ç¢.mp3\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000000bviBl4FjTpO_1.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.2/æˆ‘è½æ³ªæƒ…ç»ªé›¶ç¢/æˆ‘è½æ³ªæƒ…ç»ªé›¶ç¢.lrc\"\n  },\n  {\n    \"name\": \"å¬å¦ˆå¦ˆçš„è¯\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.2/å¬å¦ˆå¦ˆçš„è¯/å¬å¦ˆå¦ˆçš„è¯.mp3\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000002jLGWe16Tf1H_1.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.2/å¬å¦ˆå¦ˆçš„è¯/å¬å¦ˆå¦ˆçš„è¯.lrc\"\n  },\n  {\n    \"name\": \"æ˜æ˜å°±\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music-jay@1.0.1/æ˜æ˜å°±/æ˜æ˜å°±.flac\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000003Ow85E3pnoqi_1.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music-jay@1.0.1/æ˜æ˜å°±/æ˜æ˜å°±.lrc\"\n  },\n  {\n    \"name\": \"æˆ‘æ˜¯å¦‚æ­¤ç›¸ä¿¡\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music-jay@1.0.1/æˆ‘æ˜¯å¦‚æ­¤ç›¸ä¿¡/æˆ‘æ˜¯å¦‚æ­¤ç›¸ä¿¡.flac\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000001hGx1Z0so1YX_1.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music-jay@1.0.1/æˆ‘æ˜¯å¦‚æ­¤ç›¸ä¿¡/æˆ‘æ˜¯å¦‚æ­¤ç›¸ä¿¡.lrc\"\n  },\n  {\n    \"name\": \"å‘å¦‚é›ª\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.3/å‘å¦‚é›ª/å‘å¦‚é›ª.mp3\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M0000024bjiL2aocxT_3.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.3/å‘å¦‚é›ª/å‘å¦‚é›ª.lrc\"\n  },\n  {\n    \"name\": \"ä»¥çˆ¶ä¹‹å\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.3/ä»¥çˆ¶ä¹‹å/ä»¥çˆ¶ä¹‹å.mp3\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000000MkMni19ClKG_3.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.3/ä»¥çˆ¶ä¹‹å/ä»¥çˆ¶ä¹‹å.lrc\"\n  },\n  {\n    \"name\": \"å›­æ¸¸ä¼š\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.3/å›­æ¸¸ä¼š/å›­æ¸¸ä¼š.flac\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000003DFRzD192KKD_1.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.3/å›­æ¸¸ä¼š/å›­æ¸¸ä¼š.lrc\"\n  },\n  {\n    \"name\": \"æœ¬è‰çº²ç›®\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.4/æœ¬è‰çº²ç›®/æœ¬è‰çº²ç›®.mp3\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000002jLGWe16Tf1H_1.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.4/æœ¬è‰çº²ç›®/æœ¬è‰çº²ç›®.lrc\"\n  },\n  {\n    \"name\": \"é¾™å·é£\",\n    \"artist\": \"å‘¨æ°ä¼¦\",\n    \"url\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.4/é¾™å·é£/é¾™å·é£.mp3\",\n    \"cover\": \"https://y.qq.com/music/photo_new/T002R300x300M000000f01724fd7TH_1.jpg?max_age=2592000\",\n    \"lrc\": \"https://npm.elemecdn.com/anzhiyu-music@1.0.4/é¾™å·é£/é¾™å·é£.lrc\"\n  }\n]"},{"title":"å…³äº","url":"/about/index.html","content":"\n\n\n"},{"url":"/static/css/index_media.css","content":"/* index ï¼Œä¸»é¡µé¢åŠ¨ç”»*/\n\n  #home-media-container {\n    position: fixed; /* æ”¹ä¸ºå›ºå®šå®šä½ */\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n    z-index: 0;\n    \n    /* æ·»åŠ åº•éƒ¨å‘ä¸Šæ¸å˜é®ç½© */\n    -webkit-mask-image: linear-gradient(to top, transparent 0%, black 0%);\n    mask-image: linear-gradient(to top, transparent 0%, black 0%);\n  }\n  \n  .home-media {\n    position: fixed; /* åŒæ­¥æ”¹ä¸ºå›ºå®šå®šä½ */\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n    \n    /* æ·»åŠ é€æ˜åº¦è¿‡æ¸¡ */\n    transition: opacity 0.5s ease;\n    opacity: 1;\n  }\n  \n    /* è‡ªå®šä¹‰åŠ è½½åŠ¨ç”»å®¹å™¨ */\n  .custom-loader {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    z-index: 10; /* ç¡®ä¿åœ¨è§†é¢‘ä¸Šæ–¹ */\n    pointer-events: none; /* é˜²æ­¢é˜»æŒ¡è§†é¢‘äº¤äº’ */\n    transition: opacity 0.5s ease; /* æ·¡å‡ºåŠ¨ç”» */\n  }\n\n  /* åŠ è½½åŠ¨ç”»å…ƒç´  */\n  .loader-animation {\n    width: 18%;\n    height: 18%;\n    min-width: 128px;\n    min-height: 128px;\n    background-size: contain; /* ä¿æŒæ¯”ä¾‹ */\n    background-position: center;\n    background-repeat: no-repeat;\n    animation: pulse 1.5s infinite ease-in-out;\n  }\n\n  /* å‘¼å¸åŠ¨ç”»æ•ˆæœ */\n  @keyframes pulse {\n    0% { transform: scale(1); opacity: 0.8; }\n    50% { transform: scale(1.1); opacity: 1; }\n    100% { transform: scale(1); opacity: 0.8; }\n  }\n"},{"title":"æ ‡ç­¾","url":"/tags/index.html"},{"title":"åˆ†ç±»","url":"/categories/index.html"},{"url":"/static/js/index_media.js","content":"// ======================= æ¨ªç«–å±è‡ªé€‚åº”èƒŒæ™¯åª’ä½“åŠ è½½å™¨ =======================\nlet lastOrientation = null; // è®°å½•ä¸Šä¸€æ¬¡çš„æ–¹å‘çŠ¶æ€\n\n// ================= æ–°å¢æ»šåŠ¨æ¸å˜æ•ˆæœå‡½æ•° =================\nfunction initScrollFadeEffect() {\n  const mediaContainer = document.getElementById('home-media-container');\n  if (!mediaContainer) return;\n  \n  const mediaElement = mediaContainer.querySelector('.home-media');\n  if (!mediaElement) return;\n  \n  // èŠ‚æµå‡½æ•°ä¼˜åŒ–æ€§èƒ½\n  function throttle(func, limit) {\n    let lastFunc, lastRan;\n    return function() {\n      const context = this;\n      const args = arguments;\n      if (!lastRan) {\n        func.apply(context, args);\n        lastRan = Date.now();\n      } else {\n        clearTimeout(lastFunc);\n        lastFunc = setTimeout(function() {\n          if ((Date.now() - lastRan) >= limit) {\n            func.apply(context, args);\n            lastRan = Date.now();\n          }\n        }, limit - (Date.now() - lastRan));\n      }\n    }\n  }\n\n  // å¤„ç†æ»šåŠ¨æ—¶çš„é€æ˜åº¦å˜åŒ–\n  function handleScrollFade() {\n    const scrollY = window.scrollY;\n    const windowHeight = window.innerHeight;\n    \n    // è®¡ç®—é€æ˜åº¦ï¼šä»1ï¼ˆå®Œå…¨ä¸é€æ˜ï¼‰åˆ°0ï¼ˆå®Œå…¨é€æ˜ï¼‰\n    // å½“æ»šåŠ¨åˆ°ä¸€å±é«˜åº¦æ—¶ï¼Œé€æ˜åº¦å˜ä¸º0\n    let opacity = 1 - (scrollY / windowHeight);\n    opacity = Math.max(0, Math.min(1, opacity)); // é™åˆ¶åœ¨0-1èŒƒå›´\n    \n    mediaElement.style.opacity = opacity;\n  }\n\n  // èŠ‚æµå¤„ç†æ»šåŠ¨äº‹ä»¶ï¼ˆæ¯50msæ£€æŸ¥ä¸€æ¬¡ï¼‰\n  const throttledScrollHandler = throttle(handleScrollFade, 50);\n  \n  // æ·»åŠ æ»šåŠ¨ç›‘å¬\n  window.addEventListener('scroll', throttledScrollHandler);\n  \n  // åˆå§‹åŒ–æ—¶æ‰§è¡Œä¸€æ¬¡\n  handleScrollFade();\n  \n  // å­˜å‚¨å½“å‰æ»šåŠ¨å¤„ç†å™¨ä»¥ä¾¿åç»­ç§»é™¤\n  return throttledScrollHandler;\n}\n\n\n// ================= æ»šåŠ¨æ¸å˜æ•ˆæœå‡½æ•°ç»“æŸ =================\n\n// ================= æ–°å¢åº•éƒ¨é®ç½©å±‚æ§åˆ¶å‡½æ•° =================\nfunction initScrollMaskEffect() {\n  const mediaContainer = document.getElementById('home-media-container');\n  if (!mediaContainer) return;\n  \n  // èŠ‚æµå‡½æ•°ä¼˜åŒ–æ€§èƒ½\n  function throttle(func, limit) {\n    let lastFunc, lastRan;\n    return function() {\n      const context = this;\n      const args = arguments;\n      if (!lastRan) {\n        func.apply(context, args);\n        lastRan = Date.now();\n      } else {\n        clearTimeout(lastFunc);\n        lastFunc = setTimeout(function() {\n          if ((Date.now() - lastRan) >= limit) {\n            func.apply(context, args);\n            lastRan = Date.now();\n          }\n        }, limit - (Date.now() - lastRan));\n      }\n    }\n  }\n\n  // å¤„ç†æ»šåŠ¨æ—¶çš„é®ç½©å˜åŒ–\n  function handleScrollMask() {\n    const scrollY = window.scrollY;\n    const windowHeight = window.innerHeight;\n    \n    // è®¡ç®—é®ç½©é«˜åº¦ï¼ˆ0-100%ï¼‰\n    let maskHeight = (scrollY / windowHeight) * 100;\n    maskHeight = Math.min(100, Math.max(0, maskHeight));\n    \n    // åŠ¨æ€è®¾ç½®é®ç½©å±‚é«˜åº¦\n    mediaContainer.style.setProperty('--mask-height', `${maskHeight}%`);\n  }\n\n  // èŠ‚æµå¤„ç†æ»šåŠ¨äº‹ä»¶ï¼ˆæ¯50msæ£€æŸ¥ä¸€æ¬¡ï¼‰\n  const throttledScrollHandler = throttle(handleScrollMask, 50);\n  \n  // æ·»åŠ æ»šåŠ¨ç›‘å¬\n  window.addEventListener('scroll', throttledScrollHandler);\n  \n  // åˆå§‹åŒ–æ—¶æ‰§è¡Œä¸€æ¬¡\n  handleScrollMask();\n  \n  // è¿”å›å¤„ç†å™¨ä»¥ä¾¿åç»­ç§»é™¤\n  return throttledScrollHandler;\n}\n\n\nfunction initResponsiveBackground() {\n  const mediaContainer = document.getElementById('home-media-container');\n  if (!mediaContainer) {\n    console.error('[èƒŒæ™¯åŠ è½½å™¨] æœªæ‰¾åˆ°åª’ä½“å®¹å™¨å…ƒç´ ');\n    return;\n  }\n\n  // æ£€æµ‹å½“å‰å±å¹•æ–¹å‘\n  const currentIsPortrait = window.innerHeight > window.innerWidth;\n  const currentOrientation = currentIsPortrait ? 'portrait' : 'landscape';\n  \n  // å¦‚æœæ–¹å‘æœªæ”¹å˜ï¼Œåˆ™ç›´æ¥è¿”å›\n  if (lastOrientation === currentOrientation) {\n    console.log('[èƒŒæ™¯åŠ è½½å™¨] æ–¹å‘æœªæ”¹å˜ï¼Œæ— éœ€é‡æ–°åŠ è½½');\n    return;\n  }\n  \n  // æ›´æ–°æ–¹å‘è®°å½•\n  lastOrientation = currentOrientation;\n  console.log(`[èƒŒæ™¯åŠ è½½å™¨] æ–¹å‘å˜åŒ–: ${currentOrientation}`);\n\n  // æ¸…é™¤ç°æœ‰åª’ä½“å…ƒç´ å’ŒåŠ è½½åŠ¨ç”»\n  const existingMedia = mediaContainer.querySelector('.home-media');\n  const existingLoader = mediaContainer.querySelector('.custom-loader');\n  if (existingMedia) existingMedia.remove();\n  if (existingLoader) existingLoader.remove();\n\n  // æ ¹æ®æ–¹å‘é€‰æ‹©èµ„æº\n  let mediaSrc, posterSrc, mediaType;\n  if (currentIsPortrait) {\n    mediaSrc = mediaContainer.dataset.portraitVideo || mediaContainer.dataset.portraitImg;\n    posterSrc = mediaContainer.dataset.portraitPoster;\n    mediaType = mediaContainer.dataset.portraitVideo ? 'video' : 'img';\n  } else {\n    mediaSrc = mediaContainer.dataset.landscapeVideo || mediaContainer.dataset.landscapeImg;\n    posterSrc = mediaContainer.dataset.landscapePoster;\n    mediaType = mediaContainer.dataset.landscapeVideo ? 'video' : 'img';\n  }\n\n  if (!mediaSrc) {\n    console.error('[èƒŒæ™¯åŠ è½½å™¨] æœªæ‰¾åˆ°æœ‰æ•ˆåª’ä½“èµ„æº');\n    return;\n  }\n\n  console.log(`[èƒŒæ™¯åŠ è½½å™¨] ä½¿ç”¨èµ„æº: ${mediaSrc} (ç±»å‹: ${mediaType})`);\n\n  // åˆ›å»ºåª’ä½“å…ƒç´ \n  const mediaElement = document.createElement(mediaType);\n  mediaElement.className = 'home-media';\n  mediaElement.style.cssText = 'width:100%;height:100%;object-fit:cover';\n  \n  // ================= è®¾ç½®åˆå§‹é€æ˜åº¦ =================\n  mediaElement.style.opacity = '1';\n  mediaElement.style.transition = 'opacity 0.5s ease';\n  // ================================================\n  \n  // åœ¨åª’ä½“å®¹å™¨æ·»åŠ åª’ä½“å…ƒç´ åè°ƒç”¨æ•ˆæœå‡½æ•°\n  mediaContainer.appendChild(mediaElement);\n  addMediaEffects(mediaElement, mediaType); // æ·»åŠ æ–°åŠŸèƒ½\n   \n  console.log('[èƒŒæ™¯åŠ è½½å™¨] åª’ä½“å…ƒç´ å·²åˆ›å»º');\n   \n  // åˆ›å»ºè‡ªå®šä¹‰åŠ è½½åŠ¨ç”»å®¹å™¨\n  const loaderContainer = document.createElement('div');\n  loaderContainer.className = 'custom-loader';\n  mediaContainer.prepend(loaderContainer);\n  \n  // åˆ›å»ºåŠ è½½åŠ¨ç”»å…ƒç´ \n  const loaderElement = document.createElement('div');\n  loaderElement.className = 'loader-animation';\n  \n  // è®¾ç½®åŠ è½½åŠ¨ç”»æ ·å¼ï¼ˆä½¿ç”¨GIFï¼‰\n  loaderElement.style.backgroundImage = `url(${posterSrc})`;\n  loaderContainer.appendChild(loaderElement);\n  \n  // è§†é¢‘ç‰¹æ®Šå¤„ç†\n  if (mediaType === 'video') {\n    mediaElement.autoplay = true;\n    mediaElement.muted = true;\n    mediaElement.loop = true;\n    mediaElement.playsInline = true;\n    mediaElement.setAttribute('playsinline', '');\n    mediaElement.setAttribute('webkit-playsinline', '');\n    \n    // å¤šæºæ”¯æŒ\n    const source = document.createElement('source');\n    source.src = mediaSrc;\n    source.type = 'video/mp4';\n    mediaElement.appendChild(source);\n    \n    // å¤„ç†è‡ªåŠ¨æ’­æ”¾é™åˆ¶\n    const playPromise = mediaElement.play();\n    if (playPromise !== undefined) {\n      playPromise.catch(error => {\n        console.warn('[èƒŒæ™¯åŠ è½½å™¨] è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢:', error);\n        mediaElement.muted = true;\n        mediaElement.play();\n      });\n    }\n    \n    // è§†é¢‘åŠ è½½å®Œæˆåç§»é™¤åŠ è½½åŠ¨ç”»\n    mediaElement.addEventListener('loadeddata', () => {\n      loaderContainer.style.opacity = '0';\n      setTimeout(() => {\n        if (loaderContainer.parentNode) {\n          loaderContainer.parentNode.removeChild(loaderContainer);\n        }\n      }, 500); // æ·¡å‡ºåŠ¨ç”»æŒç»­æ—¶é—´\n    });\n  } else {\n    mediaElement.src = mediaSrc;\n    mediaElement.loading = 'eager';\n    \n    // å›¾ç‰‡åŠ è½½å®Œæˆåç§»é™¤åŠ è½½åŠ¨ç”»\n    mediaElement.addEventListener('load', () => {\n      loaderContainer.style.opacity = '0';\n      setTimeout(() => {\n        if (loaderContainer.parentNode) {\n          loaderContainer.parentNode.removeChild(loaderContainer);\n        }\n      }, 500);\n    });\n  }\n\n  // é”™è¯¯å¤„ç†\n  mediaElement.onerror = function() {\n    console.error(`[èƒŒæ™¯åŠ è½½å™¨] èµ„æºåŠ è½½å¤±è´¥: ${mediaSrc}`);\n    this.style.display = 'none';\n    \n    // å°è¯•å›é€€åˆ°å¤‡ç”¨ç±»å‹\n    console.warn('[èƒŒæ™¯åŠ è½½å™¨] å°è¯•å›é€€åˆ°å¤‡ç”¨åª’ä½“');\n    const fallbackType = mediaType === 'video' ? 'img' : 'video';\n    const fallbackSrc = currentIsPortrait ? \n      (mediaContainer.dataset.portraitImg || mediaContainer.dataset.portraitVideo) :\n      (mediaContainer.dataset.landscapeImg || mediaContainer.dataset.landscapeVideo);\n    \n    if (fallbackSrc && fallbackSrc !== mediaSrc) {\n      console.log(`[èƒŒæ™¯åŠ è½½å™¨] ä½¿ç”¨å¤‡ç”¨èµ„æº: ${fallbackSrc}`);\n      mediaElement.src = fallbackSrc;\n      mediaElement.style.display = 'block';\n    }\n  };\n\n  mediaContainer.appendChild(mediaElement);\n  console.log('[èƒŒæ™¯åŠ è½½å™¨] åª’ä½“å…ƒç´ å·²åˆ›å»º');\n  \n  // ================= åˆå§‹åŒ–æ»šåŠ¨æ¸å˜æ•ˆæœ =================\n  initScrollFadeEffect();\n}\n\nfunction addMediaEffects(mediaElement, mediaType) {\n  if (mediaType === 'video') {\n    // è·å–å½“å‰æ–¹å‘\n    const currentIsPortrait = window.innerHeight > window.innerWidth;\n\n    // ç«–å±æ¨¡å¼ä¸‹å›ºå®šæ”¾å¤§105%\n    const baseScale = currentIsPortrait ? 1.05 : 1.2;\n    mediaElement.style.transform = `scale(${baseScale})`;\n    \n    // æ£€æµ‹æ˜¯å¦ä¸ºiOSè®¾å¤‡\n    function isIOS() {\n      return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;\n    }\n\n    // å¦‚æœæ˜¯iOSè®¾å¤‡ï¼Œç›´æ¥ç¦ç”¨æ‰€æœ‰è§†å·®æ•ˆæœ\n    if (isIOS()) {\n      console.log('[è§†å·®æ•ˆæœ] åœ¨iOSè®¾å¤‡ä¸Šï¼Œç¦ç”¨æ‰€æœ‰è§†å·®æ•ˆæœ');\n      return; // ç›´æ¥è¿”å›ï¼Œä¸åˆå§‹åŒ–ä»»ä½•è§†å·®æ•ˆæœ\n    }\n    // 1. æ·»åŠ ç¼©æ”¾åŠ¨ç”»æ•ˆæœ\n    mediaElement.style.transform = 'scale(1.2)'; // åˆå§‹æ”¾å¤§110%\n    mediaElement.style.transition = 'transform 0.5s ease-out';\n    \n    // åœ¨è§†é¢‘åŠ è½½å®Œæˆåè§¦å‘ç¼©æ”¾åŠ¨ç”»\n    mediaElement.addEventListener('loadeddata', () => {\n      // ç«–å±æ¨¡å¼ä¿æŒ105%ç¼©æ”¾ï¼Œä¸éœ€è¦åŠ¨ç”»\n      if (currentIsPortrait) {\n        mediaElement.style.transform = 'scale(1.05)';\n      } \n      // æ¨ªå±æ¨¡å¼æ‰§è¡Œç¼©æ”¾åŠ¨ç”»åˆ°æ­£å¸¸å¤§å°\n      else {\n        setTimeout(() => {\n          mediaElement.style.transform = 'scale(1)';\n        }, 100);\n      }\n    });\n    \n    // 2. æ·»åŠ è§†å·®æ•ˆæœï¼ˆé¼ æ ‡/é™€èºä»ªï¼‰\n    const mediaContainer = document.getElementById('page-header');\n    mediaContainer.style.overflow = 'hidden';\n    mediaElement.style.transformOrigin = 'center center';\n    \n    // è§†å·®æ•ˆæœå‚æ•°\n    const parallaxIntensity = 0.05;\n    const scaleIntensity = 0.05;\n    let isGyroActive = false;\n    \n    // ================= æ–°å¢é™€èºä»ªæ”¯æŒ =================\n    // æ£€æµ‹é™€èºä»ªæ”¯æŒ\n    function initGyroParallax() {\n      if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {\n        // iOS 13+ éœ€è¦æƒé™\n        DeviceOrientationEvent.requestPermission()\n          .then(permissionState => {\n            if (permissionState === 'granted') {\n              setupGyroListeners();\n              isGyroActive = true;\n            }\n          })\n          .catch(console.error);\n      } else if ('DeviceOrientationEvent' in window) {\n        // Androidå’Œå…¶ä»–æ”¯æŒè®¾å¤‡\n        setupGyroListeners();\n        isGyroActive = true;\n      }\n      \n      return isGyroActive;\n    }\n    \n    // è®¾ç½®é™€èºä»ªç›‘å¬\n    function setupGyroListeners() {\n      window.addEventListener('deviceorientation', handleOrientation);\n    }\n    \n    // å¤„ç†é™€èºä»ªæ•°æ®\n    function handleOrientation(event) {\n      // ç«–å±æ¨¡å¼ä½¿ç”¨105%åŸºç¡€ç¼©æ”¾\n      const baseScaleValue = currentIsPortrait ? 1.05 : 1;\n      if (!isGyroActive) return;\n      \n      // è·å–é™€èºä»ªæ•°æ®ï¼ˆbeta: å‰åå€¾æ–œ, gamma: å·¦å³å€¾æ–œï¼‰\n      const beta = event.beta || 0;  // å‰åå€¾æ–œï¼ˆ-180åˆ°180ï¼‰\n      const gamma = event.gamma || 0; // å·¦å³å€¾æ–œï¼ˆ-90åˆ°90ï¼‰\n      \n      // å°†è§’åº¦è½¬æ¢ä¸ºç™¾åˆ†æ¯”åç§»ï¼ˆå½’ä¸€åŒ–å¤„ç†ï¼‰\n      const moveX = (gamma / 90) * parallaxIntensity * 100; // -100% åˆ° 100%\n      const moveY = (beta / 180) * parallaxIntensity * 100; \n      \n      // åº”ç”¨è§†å·®æ•ˆæœ\n      mediaElement.style.transform = `\n        translate(${moveX}%, ${moveY}%)\n        scale(${baseScaleValue + scaleIntensity})\n      `;\n    }\n    \n    // ================= é¼ æ ‡è§†å·®æ•ˆæœ =================\n    function initMouseParallax() {\n      mediaContainer.addEventListener('mousemove', (e) => {\n        const rect = mediaContainer.getBoundingClientRect();\n        const x = (e.clientX - rect.left) / rect.width;\n        const y = (e.clientY - rect.top) / rect.height;\n        \n        const moveX = (x - 0.5) * parallaxIntensity * 100;\n        const moveY = (y - 0.5) * parallaxIntensity * 100;\n        \n        mediaElement.style.transform = `\n          translate(${moveX}%, ${moveY}%)\n          scale(${1 + scaleIntensity})\n        `;\n      });\n      \n      mediaContainer.addEventListener('mouseleave', () => {\n        mediaElement.style.transform = 'scale(1)';\n      });\n    }\n    \n    // ================= æ ¹æ®è®¾å¤‡ç±»å‹åˆå§‹åŒ– =================\n    // æ£€æµ‹ç§»åŠ¨è®¾å¤‡\n    const isMobile = /Mobi|Android/i.test(navigator.userAgent);\n    \n    if (isMobile) {\n      // ç§»åŠ¨è®¾å¤‡ä¼˜å…ˆä½¿ç”¨é™€èºä»ª\n      if (!initGyroParallax()) {\n        // ä¸æ”¯æŒé™€èºä»ªåˆ™å›é€€åˆ°è§¦æ‘¸äº‹ä»¶\n        initTouchParallax();\n      }\n    } else {\n      // PCè®¾å¤‡ä½¿ç”¨é¼ æ ‡äº‹ä»¶\n      initMouseParallax();\n    }\n    \n    // ================= è§¦æ‘¸äº‹ä»¶å›é€€æ–¹æ¡ˆ =================\n    function initTouchParallax() {\n      mediaContainer.addEventListener('touchmove', (e) => {\n        e.preventDefault();\n        const touch = e.touches[0];\n        const rect = mediaContainer.getBoundingClientRect();\n        const x = (touch.clientX - rect.left) / rect.width;\n        const y = (touch.clientY - rect.top) / rect.height;\n        \n        const moveX = (x - 0.5) * parallaxIntensity * 50; // ç§»åŠ¨å¼ºåº¦å‡åŠ\n        const moveY = (y - 0.5) * parallaxIntensity * 50;\n        \n        mediaElement.style.transform = `\n          translate(${moveX}%, ${moveY}%)\n          scale(${1 + scaleIntensity * 0.5}) // ç¼©æ”¾å¼ºåº¦å‡åŠ\n        `;\n      });\n      \n      mediaContainer.addEventListener('touchend', () => {\n        mediaElement.style.transform = 'scale(1)';\n      });\n    }\n    \n    // ================= æ€§èƒ½ä¼˜åŒ– =================\n    // é¡µé¢ä¸å¯è§æ—¶æš‚åœé™€èºä»ª\n    document.addEventListener('visibilitychange', () => {\n      if (document.visibilityState === 'hidden') {\n        isGyroActive = false;\n      } else if (isMobile) {\n        isGyroActive = initGyroParallax();\n      }\n    });\n  }\n}\n\n// åœ¨initMediaå‡½æ•°ä¸­è°ƒç”¨æ–°åŠŸèƒ½\nfunction initMedia() {\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', function() {\n      initResponsiveBackground();\n      initScrollFadeEffect(); // æ·»åŠ è°ƒç”¨\n    });\n  } else {\n    initResponsiveBackground();\n    initScrollFadeEffect(); // æ·»åŠ è°ƒç”¨\n  }\n}\n\n\n// ======================= æ‰§è¡Œå…¥å£ =======================\ninitMedia();\n\n// é˜²æŠ–å¤„ç†çª—å£å˜åŒ–\nlet resizeTimer;\nwindow.addEventListener('resize', () => {\n  clearTimeout(resizeTimer);\n  resizeTimer = setTimeout(() => {\n    // è®¡ç®—å½“å‰æ–¹å‘çŠ¶æ€\n    const currentIsPortrait = window.innerHeight > window.innerWidth;\n    const currentOrientation = currentIsPortrait ? 'portrait' : 'landscape';\n    \n    // åªæœ‰æ–¹å‘å®é™…æ”¹å˜æ—¶æ‰æ‰§è¡Œé‡è½½\n    if (lastOrientation !== currentOrientation) {\n      console.log('[èƒŒæ™¯åŠ è½½å™¨] çª—å£å¤§å°å˜åŒ–ï¼Œé‡æ–°åŠ è½½åª’ä½“');\n      initResponsiveBackground();\n    } else {\n      console.log('[èƒŒæ™¯åŠ è½½å™¨] çª—å£å¤§å°å˜åŒ–ä½†æ–¹å‘æœªæ”¹å˜');\n      // ================= æ–¹å‘æœªå˜æ—¶é‡ç½®é€æ˜åº¦ =================\n      initScrollFadeEffect();\n    }\n  }, 500);\n});\n\n// é¡µé¢å¯è§æ€§å˜åŒ–å¤„ç†\ndocument.addEventListener('visibilitychange', () => {\n  if (document.visibilityState === 'visible') {\n    const video = document.querySelector('#home-media-container video');\n    if (video && video.paused) {\n      console.log('[èƒŒæ™¯åŠ è½½å™¨] é¡µé¢æ¢å¤å¯è§ï¼Œé‡æ–°æ’­æ”¾è§†é¢‘');\n      video.play().catch(e => console.warn('è§†é¢‘æ¢å¤æ’­æ”¾å¤±è´¥:', e));\n    }\n    // ================= é¡µé¢æ¢å¤å¯è§æ—¶é‡ç½®é€æ˜åº¦ =================\n    initScrollFadeEffect();\n  }\n});\n\n// ========== æ–°å¢ä¿®å¤ä»£ç ï¼ˆç›´æ¥åŠ åœ¨ç°æœ‰ä»£ç åé¢ï¼‰ ========== //\n\n// 1. ç¼“å­˜æ¢å¤æ£€æµ‹ï¼ˆæ ¸å¿ƒä¿®å¤ï¼‰\nwindow.addEventListener('pageshow', event => {\n  if (event.persisted && location.pathname === '/') {\n    console.log('[ä¿®å¤] æ£€æµ‹åˆ°ç¼“å­˜æ¢å¤ä¸»é¡µï¼Œå¼ºåˆ¶é‡ç½®');\n    lastOrientation = null;\n    initResponsiveBackground();\n    // ================= ç¼“å­˜æ¢å¤æ—¶é‡ç½®é€æ˜åº¦ =================\n    setTimeout(initScrollFadeEffect, 300);\n  }\n});\n\n// 2. è·¯ç”±å˜åŒ–ç›‘å¬ï¼ˆSPAå…¼å®¹ï¼‰\nwindow.addEventListener('popstate', () => {\n  if (location.pathname === '/') {\n    console.log('[ä¿®å¤] æ£€æµ‹åˆ°è¿”å›ä¸»é¡µ');\n    setTimeout(() => {\n      // æ£€æŸ¥åª’ä½“å…ƒç´ æ˜¯å¦å­˜åœ¨\n      const container = document.getElementById('home-media-container');\n      if (!container?.querySelector('.home-media')) {\n        lastOrientation = null;\n        initResponsiveBackground();\n      }\n      // ================= è¿”å›ä¸»é¡µæ—¶é‡ç½®é€æ˜åº¦ =================\n      initScrollFadeEffect();\n    }, 300); // å»¶è¿Ÿç¡®ä¿DOMæ›´æ–°\n  }\n});\n\n// 3. åª’ä½“çŠ¶æ€è‡ªæ£€ï¼ˆå…œåº•æ–¹æ¡ˆï¼‰\nfunction checkMediaStatus() {\n  if (location.pathname !== '/') return;\n  \n  const container = document.getElementById('home-media-container');\n  if (!container) return;\n  \n  const hasMedia = container.querySelector('.home-media');\n  if (!hasMedia) {\n    console.log('[ä¿®å¤] è‡ªæ£€å‘ç°åª’ä½“ä¸¢å¤±');\n    lastOrientation = null;\n    initResponsiveBackground();\n  }\n  // ================= åª’ä½“è‡ªæ£€æ—¶é‡ç½®é€æ˜åº¦ =================\n  initScrollFadeEffect();\n}\n\n// æ¯0.5ç§’æ£€æŸ¥ä¸€æ¬¡ï¼ˆè½»é‡çº§æ£€æµ‹ï¼‰\nsetInterval(checkMediaStatus, 500);\n\n// 4. å¢å¼ºé”™è¯¯å¤„ç†ï¼ˆåœ¨initResponsiveBackgroundå‡½æ•°å†…ä¿®æ”¹ï¼‰\n// åœ¨mediaElement.onerrorå‡½æ•°å†…æ·»åŠ ï¼š\nsetTimeout(() => {\n  if (!mediaElement.parentNode) {\n    console.warn('[ä¿®å¤] å°è¯•å®Œå…¨é‡å»º');\n    lastOrientation = null;\n    initResponsiveBackground();\n    // ================= é”™è¯¯é‡å»ºæ—¶é‡ç½®é€æ˜åº¦ =================\n    setTimeout(initScrollFadeEffect, 500);\n  }\n}, 1000);\n\n\n"}]