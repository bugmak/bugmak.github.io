<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>bugmak_blog</title>
  
  <subtitle>Welcome to bugmak&#39;s blog!!!</subtitle>
  <link href="http://bumak.github.io/rss.xml" rel="self"/>
  
  <link href="http://bumak.github.io/"/>
  <updated>2025-07-14T13:46:54.834Z</updated>
  <id>http://bumak.github.io/</id>
  
  <author>
    <name>zhike w</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>极客大挑战2024-Math</title>
    <link href="http://bumak.github.io/2025/07/14/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982024/Math/"/>
    <id>http://bumak.github.io/2025/07/14/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982024/Math/</id>
    <published>2025-07-14T13:46:13.000Z</published>
    <updated>2025-07-14T13:46:54.834Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>​在官方WP中，这题是被分在了<strong>crypto</strong>板块，所以官方认为这个题更倾向于是考察密码学的知识，和逆向涉及的不多。一方面我是在复现，另一方面这又是没学过的新知识，那么我们只能照着答案去努力地理解过程了。</p><p>​本题涉及到的密码学知识有<strong>离散对数DLP解决方法之一“Pohlig-Hellman算法”</strong>、<strong>RSA Modular Binomial 推导</strong>、<strong>base64换表</strong>。</p><h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><h3 id="数学基础——定义"><a href="#数学基础——定义" class="headerlink" title="数学基础——定义"></a>数学基础——定义</h3><p>​<strong>离散对数</strong>：给定一个素数p，一个生成元g，和一个值h，求一个整数x，使得<strong>g ^ x &#x3D; h mod p</strong>，这个x就是模p的离散对数，记作<strong>a&#x3D;log_g_h mod p</strong>。举例说明，假如求<strong>2 ^ x &#x3D; 8 mod 11</strong>是比较简单的</p><p>​<strong>生成元</strong>：在一个模p（素数）的乘法群中，生成元的幂次能生成群中所有非零元素。</p><p>​<strong>乘法群</strong>：所有小于n（一般选的是质数，会有说明。<strong>质数</strong>等价于<strong>素数</strong>）且与n互素的整数（不包括0），在模n意义下组成的集合，配上模n乘法运算，构成的群，记作<strong>Zn</strong>*。</p><p>​<strong>群</strong>：一个集合和一个运算构成一个群，需要满足4种性质：封闭性、结合律、单位元、逆元。</p><p>​<strong>封闭性</strong>：对于任意a、b属于集合G，有<strong>a·b</strong>也属于集合G，其中**·**是表示群中的运算。</p><p>​<strong>结合律</strong>：即**(a·b)·c &#x3D; a·(b·c)**。</p><p>​<strong>单位元</strong>：存在单位元e属于集合G，使得对于G中任意元素a，都有<strong>a·e&#x3D;a</strong>。</p><p>​<strong>逆元</strong>：集合G中的每个元素a，都存在一个属于G的元素b，使得<strong>a·b&#x3D;e</strong>，则b称为a的逆元。</p><p>​<strong>Fp</strong>：这是一个<strong>有限域</strong>，也叫<strong>素域</strong>，定义为<strong>Fp&#x3D;{0,1,2,…,p−1}</strong>，其中p是一个质数，加法和乘法运算都是“模p”进行的。</p><p>​<strong>Fp</strong><em>：就是<strong>Fp</strong>去掉了0的部分，这就是在模 p 意义下的*<em>非零元素构成的乘法群</em></em>。</p><p>​<strong>域</strong>：一个集合 F 和两个运算：加法 <strong>+</strong>、乘法 *****，构成一个<strong>域</strong>，如果满足以下性质：<strong>加法构成交换群</strong>（比群多一个交换律）、<strong>非零元素构成乘法交换群</strong>、<strong>乘法对加法分配律</strong>。</p><p>​写的比较简陋，需要一点高中数学基础，有不懂可以维基百科。</p><h3 id="GMP知识补充"><a href="#GMP知识补充" class="headerlink" title="GMP知识补充"></a>GMP知识补充</h3><p>​在IDA中看到这样的代码， 觉得比较奇怪，不禁发问：既然使用了<strong>gmp_randseed_ui</strong>函数生成随机种子了，为什么后面的<strong>gmpz_urandomb</strong>函数还要带上<strong>v65</strong>呢？我很自然的将它们与<strong>srand</strong>和<strong>rand</strong>函数的使用进行了一个对比，然后查资料知道了它们的不同之处。</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c">__gmp_randinit_default(v65);<br>v4 = time(<span class="hljs-number">0LL</span>);<br>__gmp_randseed_ui(v65, v4);<br>......<br>__gmpz_urandomb(v26, v65, <span class="hljs-number">512LL</span>);<span class="hljs-comment">//补充，这里是位数512是指二进制数的位数</span><br></code></pre></td></tr></table></figure><p>​<strong>srand</strong>和<strong>gmp_randseed_ui</strong>都是设置随机状态的种子，都是使用一个整数来作为种子，但是我们发现<strong>srand</strong>是在设置随机状态的同时，将该状态全局化了，在后续使用中对用户隐藏了内部状态，有全局唯一的特性，没有线程安全；而<strong>gmp_randseed_ui</strong>是将随机状态保存到一个变量<strong>v65</strong>中去了，它其实是一个<strong>gmp_randstate_t</strong>类型的结构体变量，内部保存了当前种子、算法内部参数、生成器的进度等等信息，从而实现独立状态对象的保存，结合<strong>gmpz_urandomb</strong>一起保证了线程安全。</p><p>​举例说明，在多线程程序中，如果两个线程中设置随机数种子的整数完全相同，那么在独立使用时，它们就能得到同样的随机数序列，而在使用rand就会造成竞争。</p><h2 id="逆向分析"><a href="#逆向分析" class="headerlink" title="逆向分析"></a>逆向分析</h2><h3 id="源码和脚本呈现"><a href="#源码和脚本呈现" class="headerlink" title="源码和脚本呈现"></a>源码和脚本呈现</h3><p>​IDA打开，看到main函数，看到一个很抽象的RSA系列，各种套锁，<strong>sub_1409</strong>函数是一个换表的base64编码。最好整体上对加密过程有一个了解，能够总结出hint1等输出的数学表达式。</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c">__int64 __fastcall <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> a1, <span class="hljs-type">char</span> **a2, <span class="hljs-type">char</span> **a3)</span><br>&#123;<br>  <span class="hljs-type">time_t</span> v4; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v5; <span class="hljs-comment">// eax</span><br>  __int64 ui; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *str; <span class="hljs-comment">// [rsp+0h] [rbp-380h]</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v8; <span class="hljs-comment">// [rsp+8h] [rbp-378h]</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v9; <span class="hljs-comment">// [rsp+10h] [rbp-370h]</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v10; <span class="hljs-comment">// [rsp+18h] [rbp-368h]</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v11; <span class="hljs-comment">// [rsp+20h] [rbp-360h]</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v12; <span class="hljs-comment">// [rsp+28h] [rbp-358h]</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v13; <span class="hljs-comment">// [rsp+30h] [rbp-350h]</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v14; <span class="hljs-comment">// [rsp+38h] [rbp-348h]</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v15; <span class="hljs-comment">// [rsp+40h] [rbp-340h]</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v16; <span class="hljs-comment">// [rsp+48h] [rbp-338h]</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v17; <span class="hljs-comment">// [rsp+50h] [rbp-330h]</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v18; <span class="hljs-comment">// [rsp+58h] [rbp-328h]</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v19; <span class="hljs-comment">// [rsp+60h] [rbp-320h]</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v20; <span class="hljs-comment">// [rsp+68h] [rbp-318h]</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v21; <span class="hljs-comment">// [rsp+70h] [rbp-310h]</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v22; <span class="hljs-comment">// [rsp+78h] [rbp-308h]</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v23; <span class="hljs-comment">// [rsp+80h] [rbp-300h]</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v24; <span class="hljs-comment">// [rsp+88h] [rbp-2F8h]</span><br>  _BYTE v25[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+90h] [rbp-2F0h] BYREF</span><br>  _BYTE v26[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+A0h] [rbp-2E0h] BYREF</span><br>  _BYTE v27[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+B0h] [rbp-2D0h] BYREF</span><br>  _BYTE v28[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+C0h] [rbp-2C0h] BYREF</span><br>  _BYTE v29[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+D0h] [rbp-2B0h] BYREF</span><br>  _BYTE v30[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+E0h] [rbp-2A0h] BYREF</span><br>  _BYTE v31[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+F0h] [rbp-290h] BYREF</span><br>  _BYTE v32[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+100h] [rbp-280h] BYREF</span><br>  _BYTE v33[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+110h] [rbp-270h] BYREF</span><br>  _BYTE v34[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+120h] [rbp-260h] BYREF</span><br>  _BYTE v35[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+130h] [rbp-250h] BYREF</span><br>  _BYTE v36[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+140h] [rbp-240h] BYREF</span><br>  _BYTE v37[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+150h] [rbp-230h] BYREF</span><br>  _BYTE v38[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+160h] [rbp-220h] BYREF</span><br>  _BYTE v39[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+170h] [rbp-210h] BYREF</span><br>  _BYTE v40[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+180h] [rbp-200h] BYREF</span><br>  _BYTE v41[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+190h] [rbp-1F0h] BYREF</span><br>  _BYTE v42[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+1A0h] [rbp-1E0h] BYREF</span><br>  _BYTE v43[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+1B0h] [rbp-1D0h] BYREF</span><br>  _BYTE v44[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+1C0h] [rbp-1C0h] BYREF</span><br>  _BYTE v45[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+1D0h] [rbp-1B0h] BYREF</span><br>  _BYTE v46[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+1E0h] [rbp-1A0h] BYREF</span><br>  _BYTE v47[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+1F0h] [rbp-190h] BYREF</span><br>  _BYTE v48[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+200h] [rbp-180h] BYREF</span><br>  _BYTE v49[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+210h] [rbp-170h] BYREF</span><br>  _BYTE v50[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+220h] [rbp-160h] BYREF</span><br>  _BYTE v51[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+230h] [rbp-150h] BYREF</span><br>  _BYTE v52[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+240h] [rbp-140h] BYREF</span><br>  _BYTE v53[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+250h] [rbp-130h] BYREF</span><br>  _BYTE v54[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+260h] [rbp-120h] BYREF</span><br>  _BYTE v55[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+270h] [rbp-110h] BYREF</span><br>  _BYTE v56[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+280h] [rbp-100h] BYREF</span><br>  _BYTE v57[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+290h] [rbp-F0h] BYREF</span><br>  _BYTE v58[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+2A0h] [rbp-E0h] BYREF</span><br>  _BYTE v59[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+2B0h] [rbp-D0h] BYREF</span><br>  _BYTE v60[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+2C0h] [rbp-C0h] BYREF</span><br>  _BYTE v61[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+2D0h] [rbp-B0h] BYREF</span><br>  _BYTE v62[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+2E0h] [rbp-A0h] BYREF</span><br>  _BYTE v63[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+2F0h] [rbp-90h] BYREF</span><br>  _BYTE v64[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+300h] [rbp-80h] BYREF</span><br>  <span class="hljs-type">char</span> v65[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+310h] [rbp-70h] BYREF</span><br>  <span class="hljs-type">char</span> s[<span class="hljs-number">8</span>]; <span class="hljs-comment">// [rsp+330h] [rbp-50h] BYREF</span><br>  __int64 v67; <span class="hljs-comment">// [rsp+338h] [rbp-48h]</span><br>  __int64 v68; <span class="hljs-comment">// [rsp+340h] [rbp-40h]</span><br>  __int64 v69; <span class="hljs-comment">// [rsp+348h] [rbp-38h]</span><br>  __int64 v70; <span class="hljs-comment">// [rsp+350h] [rbp-30h]</span><br>  __int64 v71; <span class="hljs-comment">// [rsp+358h] [rbp-28h]</span><br>  __int64 v72; <span class="hljs-comment">// [rsp+360h] [rbp-20h]</span><br>  __int64 v73; <span class="hljs-comment">// [rsp+368h] [rbp-18h]</span><br>  <span class="hljs-type">int</span> v74; <span class="hljs-comment">// [rsp+370h] [rbp-10h]</span><br>  <span class="hljs-type">unsigned</span> __int64 v75; <span class="hljs-comment">// [rsp+378h] [rbp-8h]</span><br><br>  v75 = __readfsqword(<span class="hljs-number">0x28u</span>);<br>  *(_QWORD *)s = <span class="hljs-number">0LL</span>;<br>  v67 = <span class="hljs-number">0LL</span>;<br>  v68 = <span class="hljs-number">0LL</span>;<br>  v69 = <span class="hljs-number">0LL</span>;<br>  v70 = <span class="hljs-number">0LL</span>;<br>  v71 = <span class="hljs-number">0LL</span>;<br>  v72 = <span class="hljs-number">0LL</span>;<br>  v73 = <span class="hljs-number">0LL</span>;<br>  v74 = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Reverse And Crypto Are Best, Isn&#x27;t It?&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Please input your flag(hex format):&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;The hex format python code is:&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;======================================&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(off_5010);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;======================================&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Give it to me:&quot;</span>);<br>  __isoc99_scanf(<span class="hljs-string">&quot;%68s&quot;</span>, s);<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">strlen</span>(s) == <span class="hljs-number">68</span> )<br>  &#123;<br>    __gmp_randinit_default(v65);<br>    v4 = time(<span class="hljs-number">0LL</span>);<br>    __gmp_randseed_ui(v65, v4);<br>    v5 = time(<span class="hljs-number">0LL</span>);<br>    srand(v5);<br>    __gmpz_init_set_str(v25, s, <span class="hljs-number">16LL</span>);<br>    __gmpz_init(v26);<br>    __gmpz_init(v27);<br>    __gmpz_init(v28);<br>    __gmpz_init(v29);<br>    __gmpz_init(v30);<br>    __gmpz_urandomb(v26, v65, <span class="hljs-number">512LL</span>);<br>    __gmpz_nextprime(v26, v26);<span class="hljs-comment">// v26 = p</span><br>    __gmpz_urandomb(v27, v65, <span class="hljs-number">512LL</span>);<br>    __gmpz_nextprime(v27, v27); <span class="hljs-comment">// v27 = q</span><br>    __gmpz_mul(v29, v26, v27);<span class="hljs-comment">// v29 = n = p * q</span><br>    __gmpz_urandomb(v28, v65, <span class="hljs-number">32LL</span>);<br>    __gmpz_nextprime(v28, v28);<span class="hljs-comment">// v28 = e (32-bit 公钥指数)</span><br>    __gmpz_powm(v30, v25, v28, v29);<span class="hljs-comment">// c = flag^e mod n</span><br>    str = (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)__gmpz_get_str(<span class="hljs-number">0LL</span>, <span class="hljs-number">16LL</span>, v30);<br>    v8 = sub_1409(str);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;c_output=&#x27;%s&#x27;&quot;</span>, v8);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\n#========================================================================&quot;</span>);<br>    __gmpz_init(v31);<br>    __gmpz_init(v32);<br>    __gmpz_init(v33);<br>    __gmpz_init(v34);<br>    __gmpz_init(v35);<br>    __gmpz_init(v36);<br>    __gmpz_urandomb(v31, v65, <span class="hljs-number">512LL</span>);<br>    __gmpz_nextprime(v31, v31);<br>    __gmpz_urandomb(v32, v65, <span class="hljs-number">512LL</span>);<br>    __gmpz_nextprime(v32, v32);<br>    __gmpz_mul(v33, v31, v32);<br>    __gmpz_set_ui(v34, <span class="hljs-number">39847LL</span>);<span class="hljs-comment">// 公钥 e = 39847</span><br>    __gmpz_init(v37);<br>    __gmpz_init(v38);<br>    __gmpz_init(v39);<br>    __gmpz_sub_ui(v38, v31, <span class="hljs-number">1LL</span>);<br>    __gmpz_sub_ui(v39, v32, <span class="hljs-number">1LL</span>);<br>    __gmpz_mul(v37, v38, v39);<span class="hljs-comment">// φ(n)</span><br>    __gmpz_init(v40);<br>    __gmpz_gcd(v40, v34, v37);<span class="hljs-comment">// 检查 gcd(e, φ(n)) == 1</span><br>    <span class="hljs-keyword">if</span> ( __gmpz_get_ui(v40) != <span class="hljs-number">1</span> )<br>      <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>    __gmpz_powm(v35, v26, v34, v33); <span class="hljs-comment">// c1 = m^e mod n，  这里的m是前面第一轮用到的 p</span><br>    v9 = (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)__gmpz_get_str(<span class="hljs-number">0LL</span>, <span class="hljs-number">16LL</span>, v33);<br>    v10 = sub_1409(v9);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;n1_output=&#x27;%s&#x27;\n&quot;</span>, v10);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\n#========================================================================&quot;</span>);<br>    v11 = (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)__gmpz_get_str(<span class="hljs-number">0LL</span>, <span class="hljs-number">16LL</span>, v35);<br>    v12 = sub_1409(v11);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;c1_output=&#x27;%s&#x27;\n&quot;</span>, v12);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\n#========================================================================&quot;</span>);<br>    __gmpz_init(v41);<br>    __gmpz_set_ui(v41, <span class="hljs-number">2023LL</span>);<br>    __gmpz_init(v42);<br>    __gmpz_mul(v42, v41, v31);<br>    __gmpz_init(v43);<br>    __gmpz_set_ui(v43, <span class="hljs-number">2024LL</span>);<br>    __gmpz_init(v44);<br>    __gmpz_add(v44, v42, v43);<span class="hljs-comment">//v44 = 2023 * v31 + 2024</span><br>    __gmpz_powm(v36, v44, v32, v33);<span class="hljs-comment">//v36 = v44^v32 mod n1，这里v32是第二轮的q</span><br>    v13 = (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)__gmpz_get_str(<span class="hljs-number">0LL</span>, <span class="hljs-number">16LL</span>, v36);<br>    v14 = sub_1409(v13);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;hint1_output=&#x27;%s&#x27;\n&quot;</span>, v14);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\n#========================================================================&quot;</span>);<br>    __gmpz_init(v45);<br>    __gmpz_init(v46);<br>    __gmpz_init(v47);<br>    __gmpz_init(v48);<br>    __gmpz_init(v49);<br>    __gmpz_init(v50);<br>    __gmpz_init(v51);<br>    __gmpz_urandomb(v45, v65, <span class="hljs-number">512LL</span>);<br>    __gmpz_nextprime(v45, v45);<br>    __gmpz_urandomb(v46, v65, <span class="hljs-number">512LL</span>);<br>    __gmpz_nextprime(v46, v46);<br>    __gmpz_mul(v47, v45, v46);<span class="hljs-comment">//n2 = v45 * v46</span><br>    __gmpz_set_ui(v48, <span class="hljs-number">44021LL</span>);<span class="hljs-comment">//e = 44021</span><br>    __gmpz_init(v52);<br>    __gmpz_sub_ui(v38, v45, <span class="hljs-number">1LL</span>);<br>    __gmpz_sub_ui(v39, v46, <span class="hljs-number">1LL</span>);<br>    __gmpz_mul(v52, v38, v39);<br>    __gmpz_init(v40);<br>    __gmpz_gcd(v40, v48, v52);<br>    <span class="hljs-keyword">if</span> ( __gmpz_get_ui(v40) != <span class="hljs-number">1</span> )<br>      <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>    __gmpz_powm(v49, v27, v48, v47);<span class="hljs-comment">//v49 = q^e mod n2       ， q 是前面第一轮的素数 v27</span><br>    __gmpz_init(v53);<br>    __gmpz_mul(v53, v41, v45);<br>    __gmpz_init(v54);<br>    __gmpz_mul(v54, v43, v46);<br>    __gmpz_init(v55);<br>    __gmpz_add(v55, v53, v54);<br>    __gmpz_init_set_str(v56, <span class="hljs-string">&quot;2323&quot;</span>, <span class="hljs-number">10LL</span>);<br>    __gmpz_powm(v50, v55, v56, v47);<br>    __gmpz_init(v57);<br>    __gmpz_mul(v57, v43, v45);<br>    __gmpz_init(v58);<br>    __gmpz_mul(v58, v41, v46);<br>    __gmpz_init(v59);<br>    __gmpz_add(v59, v57, v58);<br>    __gmpz_init_set_str(v60, <span class="hljs-string">&quot;2424&quot;</span>, <span class="hljs-number">10LL</span>);<br>    __gmpz_powm(v51, v59, v60, v47);<br>    v15 = (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)__gmpz_get_str(<span class="hljs-number">0LL</span>, <span class="hljs-number">16LL</span>, v47);<br>    v16 = sub_1409(v15);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;n2_output=&#x27;%s&#x27;\n&quot;</span>, v16);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\n#========================================================================&quot;</span>);<br>    v17 = (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)__gmpz_get_str(<span class="hljs-number">0LL</span>, <span class="hljs-number">16LL</span>, v49);<br>    v18 = sub_1409(v17);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;c2_output=&#x27;%s&#x27;\n&quot;</span>, v18);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\n#========================================================================&quot;</span>);<br>    v19 = (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)__gmpz_get_str(<span class="hljs-number">0LL</span>, <span class="hljs-number">16LL</span>, v50);<br>    v20 = sub_1409(v19);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;hint2_output=&#x27;%s&#x27;\n&quot;</span>, v20);<span class="hljs-comment">//hint2 = ((2023 * v45) + (2024 * v46)) ^ 2323 mod n2</span><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\n#========================================================================&quot;</span>);<br>    v21 = (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)__gmpz_get_str(<span class="hljs-number">0LL</span>, <span class="hljs-number">16LL</span>, v51);<br>    v22 = sub_1409(v21);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;hint3_output=&#x27;%s&#x27;\n&quot;</span>, v22);<span class="hljs-comment">//hint3 = ((2024 * v45) + (2023 * v46)) ^ 2424 mod n2</span><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\n#========================================================================&quot;</span>);<br>    __gmpz_init(v61);<br>    __gmpz_init(v63);<br>    __gmpz_init(v64);<br>    ui = __gmpz_get_ui(v28);<span class="hljs-comment">//后面是在泄露e</span><br>    __gmpz_set_ui(v61, ui);<br>    __gmpz_init_set_str(<br>      v62,<br>      <span class="hljs-string">&quot;9c5ab7c1cc9a4f60b1d53afafd7016d00e811e5a1c6fb258c75a246a0630a75644100828e21757de1d9a5ff99ebd05257aa9d895c1de40a2eb&quot;</span><br>      <span class="hljs-string">&quot;619fa52f32b38acb52669841d528351df863137b0a14f4aff6506cf0c7cdf1801c2bd3d7fb4e583811f4f771f7e5c0e5f42a85839affed38df&quot;</span><br>      <span class="hljs-string">&quot;8b913fa6a4e782adc028e5e86162f&quot;</span>,<br>      <span class="hljs-number">16LL</span>);<br>    __gmpz_init_set_str(v63, <span class="hljs-string">&quot;488d156b0cbef000f1bf6c47006a3595&quot;</span>, <span class="hljs-number">16LL</span>);<br>    __gmpz_powm(v64, v63, v61, v62);<br>    v23 = (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)__gmpz_get_str(<span class="hljs-number">0LL</span>, <span class="hljs-number">16LL</span>, v64);<br>    v24 = sub_1409(v23);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;a_output=&#x27;%s&#x27;\n&quot;</span>, v24);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\n#========================================================================&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Invalid input.&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>​完整的WP解密脚本如下。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> gcd<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt_changedbase64</span>(<span class="hljs-params">encodedata</span>):<br>    <span class="hljs-keyword">import</span> base64<br>    changed_base64 = (<span class="hljs-string">&quot;CDEqrIJKNOPABdefghijklmQRSTstuvwxyz01VWXYZabcnop456L23FGHUM789+/&quot;</span>)<br>    base = (<span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>)<br>    right_encode = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(encodedata)):<br>        <span class="hljs-keyword">if</span> encodedata[i] == <span class="hljs-string">&quot;=&quot;</span>:<br>            right_encode += <span class="hljs-string">&quot;=&quot;</span><br>            <span class="hljs-keyword">continue</span><br>        idx = changed_base64.find(encodedata[i])<br>        <span class="hljs-keyword">if</span> idx == -<span class="hljs-number">1</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;error&quot;</span>)<br>        right_encode += base[idx]<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">eval</span>(<span class="hljs-string">&quot;0x&quot;</span>+base64.b64decode(right_encode).decode())<br><br>c_output =<span class="hljs-string">&quot;d0BURFg2dLNFBLDySWN5RmrUS0k2ejDzdJRLSJkLR0gGBqIVSmR3RLR5RmI1BqRLdqlWemk4Bqr4B0rLdqD0S01HemS0Bqx6d01LS0t2djt5dWO1BLV1Bqr3dL1LSjR6RWk4eq15BFh0R0x6R0OzdWBHSmg3dWg5dmr2RFB6BLDyd0DVRjrHdmg3ejdyeqkHR0gGB0tFRLg4BFBGemNFSJr6BFN3d0IzB0C4B013RjyySJhzRjuydqxFd0D1BjuyemlVS0B6BWk2BLDzejBURml0RLh0RjD0BJR2SWd0BqCLdjN2RFh0RjRHR0uzSj1Ldj1FBWR2R0hySqy0RmS1dg==&quot;</span><br><span class="hljs-comment"># ========================================================================</span><br>n1_output =<span class="hljs-string">&quot;BjI1S0t5djR4dj14dWBURFS0ejCFSWIWdJg4BWrLeqDzejgHemSVeq14ejk6RFSzRLtGBjdyS0xGBqB5R0R5RjhyBFr4SjO0dqSzRjxUSmR2d0OyBFrGdFhVS0u1dmhVBJr4Rjr4R0d1BjB4BFIWRLCFSmgGRWBUS0CGSjC5Sj1HeqdzBqS0SjrGRLNUBJSVdjk4eqg2RFRUBqNHS0k4d0g6Sjg5ejD0RFN5BFd1S0DzR0C2ejdVdqBGRLk2Smk5dLR2BLN4BWd0BmNLdjt2BjN4eq13dFlzdWB5eqgLB01UR0g2eqDVdWgLBWrLBjI1SjSWSqSWdJNUSqVVeJSyRx==&quot;</span><br><span class="hljs-comment"># ========================================================================</span><br>c1_output =<span class="hljs-string">&quot;dmrGd0yVeJkLSjhVSWk3BmR3d0S1dLu1SqVyBjB5BWR3BL1HRWBUSjIWRjhVeqNHRWkFRjdzdWIyd0r4emhVBqO0dJlVRLk6dJk6BFOWBqxLdWNGR0N3S0kLdJr2B01GdqhVejx4RWh0BFI0SqtGRjx5BLd0djgLSmr5RFR2S0gFd0lWRWg2dWO0B0I1BLyVSJgFBJrFeqt4BquVBqtUejx4RFI0ejuVBjCUejR5BJIVRFlVSjdzSWR5BLgHBLBUdWr2RFSzBqR5SJRGSqlzRFkURLuWRWrFRmk5dJSzSmI1dmR3dWIyej14S0NLSmkURFOVeJrHSWB4d0S1dmSy&quot;</span><br><span class="hljs-comment"># ========================================================================</span><br>hint1_output =<span class="hljs-string">&quot;RLdWSqx2RWlVR0NLd0d1dqr2eqgHSWhydjxUeq1Gd0R6dmO0RWNUd0BGejx6S0xLeqkLRjS0ejSVd0h0eJl0ejgFdqk2BqVzdLCLdWkLR0rHdFl0S01LBJk6ejhWRLg2eJB2RmBFRWSyej12djCGeqB4BJN5d0rURWBUeJg5BLNGdjtGBJR3d0NHdLh0dFS1BLxURWrUSmR2SjC3BqrUd0BLdjRFSjR3RWrUdmk3RjB4SjNURjg3R0tUdLt2RLSyRml1eqVyRjgLBjC3djCHSjxFeq12BmBHBjxFBjr6BJR3BJSVBjx6SjBLR0x4dLC5SjrGBjg6BqkGdjVWBLx4&quot;</span><br><span class="hljs-comment"># ========================================================================</span><br><br>n2_output =<span class="hljs-string">&quot;BFd0BqCFSjD1Smr4dFRHBLg2Bjx5BqVyRLy0Bmr2dqt6djy0dFhyBqr6B0B5BquWSqN3djB4BLR5BFdVemSWRLdWRmrGdqx6BFr6eJlyBmk6BjIyBLh0BLgUS0N4R0gURWN4Bqg2dLtGdFk2SquWdjrLejN5emkFBWSzej1LdjR6S0uVdLC3SjCUBjV0RFO0dqr2ejkFSjyydWd0BFk4Bjx5BWdydWlzBjC3djx4d0DWSjDWdFB4dWhyd0dVdmgFBjRUSmr3dL14SjxFS0dVBWkHBqh1BL1USqr2B013B0V1BLCLBjtLeJR5BLhVd0rURjD1Smd0Sjr6RWhVdJd1&quot;</span><br><span class="hljs-comment"># ========================================================================</span><br>c2_output =<span class="hljs-string">&quot;BWhVdmg3Bj15RWR6dLVzRjdVRjBLeJO1dqBUBJr5eJg4B0BLSJrUSjC3BJNLRmr6d0g2Rj12B0uVSWRGequzdJgGdJIyBFBGSJBLdqyWB0r2B0gGej1GRmkLBWSzeqR2B0xUBLlVd0r6BLhWemlWd0dVemN3d0O0dqDzdWN4dFBUBjBLRFI1dqRGBWBURmrGS0k5dmgLS0u1BqRGR0R5equ1BLDVdqB2dWB2RmSVRFlySjCLBmBLBjrFRFdWejuyRFI1SJN6RmR2BWg2djV0d0I0SjD1S0uzdjS0SjIVBJOyBjl0S0NHRml1djg5djR5dmIyejBUeJSzdq12Sjlz&quot;</span><br><span class="hljs-comment"># ========================================================================</span><br>hint2_output =<span class="hljs-string">&quot;BWh1BLDzBqxFS0I0eJSydLxFBJl1dmd1SjIVBqOyBqR6SjxGB0OySj1HB0B3dLVWdLR2Sql1RjxFSmB6djDzBWhWSmkFejB2dqRLRjCFR0rLBFgGejI0BFdWRWk3S0xHRjgLRWSySjuWB0l0SWNLSmSzd0I0BjDyRjt5BJIydLSVB0N6ejN2Bj1HdWSzBjSWBmIVBLhyeqRGRFNGRWrFdqI1djRLdFNGBJrUB0C6dLgGemkURLrHSqrLdLN4djVydJk4dJrGB01HRLlzB0tUSWrFSqx2RmO0BmN2d0SzB0VzRWrHRjIyBWlyemkHRmg3d0y0BjhyS0rGRLhWdjDV&quot;</span><br><span class="hljs-comment"># ========================================================================</span><br>hint3_output =<span class="hljs-string">&quot;BLkGdjr2BqO1Sjd0R0DWd0gHBjg3BmrGR0BFd0lzBFh1Sqr3RLVWBJI1BqtLejy0dJlVBLl0BqIWS016dWh1B0k2dmh0dqI1dj15SWdydjyzdqx3Sjd0Sqr5dJgGRLDyd0t5ejSWejlWRFlzRL1LejIWBjD0eqV1Smg6R0IVS0dVdjC5dJIzeJSVdmlyBLdVBWIWR0I0SqVyS0u1eqhWRFr5dFk3dWkGdjVzBjBFdjtHRLNUS0RGemrFdJR4SjN4d0C2ejOVSmk6d0yyS0NLBqhWdFBFeqVVRFkFBJrUdqIzRjx5BqD1SqD1BWIWBmr2djgUemIWSqr4RFRUSmIy&quot;</span><br><br>c = decrypt_changedbase64(c_output)<br>n1 = decrypt_changedbase64(n1_output)<br>c1 = decrypt_changedbase64(c1_output)<br>hint1 = decrypt_changedbase64(hint1_output)<br>n2 = decrypt_changedbase64(n2_output)<br>c2 = decrypt_changedbase64(c2_output)<br>hint2 = decrypt_changedbase64(hint2_output)<br>hint3 = decrypt_changedbase64(hint3_output)<br><br><span class="hljs-comment"># hint1求p</span><br>p1 = gcd(hint1 - <span class="hljs-built_in">pow</span>(<span class="hljs-number">2024</span>, n1, n1), n1)<br><span class="hljs-keyword">assert</span> n1 % p1 == <span class="hljs-number">0</span><br>q1 = n1 // p1<br>phi1 = (p1 - <span class="hljs-number">1</span>) * (q1 - <span class="hljs-number">1</span>)<br>e1 = <span class="hljs-number">39847</span><br>d1 = <span class="hljs-built_in">pow</span>(e1, -<span class="hljs-number">1</span>, phi1)<br>p = <span class="hljs-built_in">pow</span>(c1, d1, n1)<br><span class="hljs-comment"># print(p)</span><br><br><br><span class="hljs-comment"># hint2和hint3求q</span><br>A=<span class="hljs-built_in">pow</span>(<span class="hljs-built_in">pow</span>(<span class="hljs-number">2024</span>,<span class="hljs-number">2424</span>,n2)*hint3,<span class="hljs-number">2323</span>,n2)<br>B=<span class="hljs-built_in">pow</span>(<span class="hljs-built_in">pow</span>(<span class="hljs-number">2023</span>,<span class="hljs-number">2323</span>,n2)*hint2,<span class="hljs-number">2424</span>,n2)<br>p2=gcd(A-B,n2)<br><span class="hljs-keyword">assert</span> n2%p2 ==<span class="hljs-number">0</span><br>q2=n2//p2<br>phi2=(p2-<span class="hljs-number">1</span>)*(q2-<span class="hljs-number">1</span>)<br>e2=<span class="hljs-number">44021</span><br>d2=<span class="hljs-built_in">pow</span>(e2,-<span class="hljs-number">1</span>,phi2)<br>q=<span class="hljs-built_in">pow</span>(c2,d2,n2)<br><span class="hljs-comment">#print(q)</span><br><br><span class="hljs-comment">#DLPPohlig-Hellman求e（注释中是sage脚本）</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">#solve_e.sage</span><br><span class="hljs-string">def decrypt_changedbase64(encodedata):</span><br><span class="hljs-string">    importbase64</span><br><span class="hljs-string">changed_base64=&quot;CDEqrIJKNOPABdefghijklmQRSTstuvwxyz01VWXYZabcnop456L23FGHUM789+/&quot; #变表</span><br><span class="hljs-string">base=&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;  #标准码表</span><br><span class="hljs-string">    #标准码表是从(A-Z)+(a-z)+(0-9)+(+/)right_encode=&#x27;&#x27;</span><br><span class="hljs-string">    for i in range(len(encodedata)):</span><br><span class="hljs-string">        if encodedata[i] == &quot;=&quot;:</span><br><span class="hljs-string">            right_encode += &quot;=&quot;</span><br><span class="hljs-string">            continue</span><br><span class="hljs-string">        idx = changed_base64.find(encodedata[i])</span><br><span class="hljs-string">        if idx == -1:</span><br><span class="hljs-string">            print(&quot;error&quot;)</span><br><span class="hljs-string">        right_encode += base[idx]</span><br><span class="hljs-string">    return eval(&quot;0x&quot;+base64.b64decode(right_encode).decode())</span><br><span class="hljs-string"></span><br><span class="hljs-string">a_output=&#x27;RLC6eJIWBLOVdj14ejyWBjx6BqkUSjCUSqg2d0d0BLhydLIzdmhzejy1BJg3BLxLBqk5BqO0SjRHRFhydLOWd0xUdLR4dWS1eJgUBLdzdjrFBLdVd0d0d0dzSjkURFBLdqk2Sjy1Bqh1B0xGSmhyBLkLdmR6BmrHRL12ejSWemk3R0R6Smh0eqIVR01GBmg3dmNUSmd0B0DzdJgFd0t5dLCUSjtLRmR5BjD1BmOVS012BjdVejtHd0CLBWg6d0yWSqu1B0gLSqC5RFdzSJOVR0CGdjuVdmr3RmSWRWBUdLSVeqdWeqlzSJkFeqkFBjy1dj16SWk6BFgGdjgUBjVyBx==&#x27;</span><br><span class="hljs-string">a=eval(&#x27;0x&#x27;+decrypt_changedbase64(a_output).decode())</span><br><span class="hljs-string">def r(h,g,N,p,qi):</span><br><span class="hljs-string">    #N:p-1</span><br><span class="hljs-string">#qi:N中的素因子</span><br><span class="hljs-string">Zp = Zmod(p)</span><br><span class="hljs-string">h = pow(h,N//qi,p)</span><br><span class="hljs-string">g = pow(g,N//qi,p)</span><br><span class="hljs-string">ri = discrete_log(Zp(h),Zp(g))</span><br><span class="hljs-string">    return int(ri)</span><br><span class="hljs-string"></span><br><span class="hljs-string">#a=base^x(modmyord)</span><br><span class="hljs-string">base=96436963965527068665018503742725174677</span><br><span class="hljs-string">myord=</span><br><span class="hljs-string">175673231937827198365546095853626563313271412461374548920405071660759307612029006669618363768855962020052726076366337037841350576518137201775814117879715010262005279090904911433542854863843980498534654892339483752906939827411026620552149927 1733197384646112456211369819887858630437075169226364135089414464738863</span><br><span class="hljs-string">factors=[10529,65777,344417,503777,549247,730447,859927,860113,927233,1034233]</span><br><span class="hljs-string">rlist=[]</span><br><span class="hljs-string">for qi in factors:</span><br><span class="hljs-string">    tmp = r(a,base,myword-1,myword,qi)</span><br><span class="hljs-string">    r_list.append(tmp)</span><br><span class="hljs-string">x = crt(r_list,factors)</span><br><span class="hljs-string">module=1</span><br><span class="hljs-string">for i in factors:</span><br><span class="hljs-string">    module *= i</span><br><span class="hljs-string">while True:</span><br><span class="hljs-string">    if int(pow(base,x,myword)) == a :</span><br><span class="hljs-string">        print(&#x27;e=&#x27;,x)</span><br><span class="hljs-string">        break</span><br><span class="hljs-string">    x += module</span><br><span class="hljs-string"></span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br>e = <span class="hljs-number">3035716141</span><br><br><span class="hljs-comment">#最后求m</span><br>n=p*q<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>phi=(p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br>d=<span class="hljs-built_in">pow</span>(e,-<span class="hljs-number">1</span>,phi)<br><span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-built_in">pow</span>(c,d,n)))<span class="hljs-comment">#flag&#123;IKnowYouLikeReverseAndCrypto&#125;</span><br></code></pre></td></tr></table></figure><p>​</p><h3 id="hint1求解p"><a href="#hint1求解p" class="headerlink" title="hint1求解p"></a>hint1求解p</h3><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># hint1求p，n1已经输出</span><br>p1 = gcd(hint1 - <span class="hljs-built_in">pow</span>(<span class="hljs-number">2024</span>, n1, n1), n1)<br><span class="hljs-keyword">assert</span> n1 % p1 == <span class="hljs-number">0</span><span class="hljs-comment">#使用断言验证，若出现非预期解，程序直接退出。</span><br>q1 = n1 // p1<br>phi1 = (p1 - <span class="hljs-number">1</span>) * (q1 - <span class="hljs-number">1</span>)<br>e1 = <span class="hljs-number">39847</span><br>d1 = <span class="hljs-built_in">pow</span>(e1, -<span class="hljs-number">1</span>, phi1)<br>p = <span class="hljs-built_in">pow</span>(c1, d1, n1)<br></code></pre></td></tr></table></figure><p>​</p><p>而加密过程中有<br>$$<br>\text{hint1} &#x3D; \left(2023 \cdot p_1 + 2024 \right)^{q_1} \bmod n_1<br>$$<br>​而$2023 \cdot p_1 + 2024 \equiv 2024 \pmod{p_1}$是无疑的，我们设$b &#x3D; 2023 \cdot p_1 + 2024$，那么$hint1 &#x3D; b^{q_1}\equiv2024^{q_1} \pmod{p_1}$，那么$hint1 - 2024^{q_1}$一定是$p_1$的倍数，并且因为${n_1} &#x3D; {p_1} \cdot {q_1}$，那么取两者的最大公因数会是$q_1$。这里就会问了，为什么不可能恰好是$n_1$呢？那么我们不妨假设$gcd(hint1-2024^{q_1},n_1)&#x3D;n_1$，那么说明${n_1} \mid (hint1-2024^{q_1})$，那么$hint1\equiv2024^{q_1}\pmod{n_1}$了，但是$hint&#x3D;b^{q_1}$，$b \not\equiv 2024 \pmod{n_1}$（除非$q_1 &#x3D; 2023$），这也是极不可能的，故假设不成立。</p><p>​后续因为$c_1 &#x3D; p^{39847} \bmod{n_1}$，我们解出$p_1$和$q_1$后，就可以解出私钥，解密出<strong>p</strong>了。</p><h3 id="hint2、hint3求解q"><a href="#hint2、hint3求解q" class="headerlink" title="hint2、hint3求解q"></a>hint2、hint3求解q</h3><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># hint2和hint3求q</span><br>A=<span class="hljs-built_in">pow</span>(<span class="hljs-built_in">pow</span>(<span class="hljs-number">2024</span>,<span class="hljs-number">2424</span>,n2)*hint3,<span class="hljs-number">2323</span>,n2)<br>B=<span class="hljs-built_in">pow</span>(<span class="hljs-built_in">pow</span>(<span class="hljs-number">2023</span>,<span class="hljs-number">2323</span>,n2)*hint2,<span class="hljs-number">2424</span>,n2)<br>p2=gcd(A-B,n2)<br><span class="hljs-keyword">assert</span> n2%p2 ==<span class="hljs-number">0</span><br>q2=n2//p2<br>phi2=(p2-<span class="hljs-number">1</span>)*(q2-<span class="hljs-number">1</span>)<br>e2=<span class="hljs-number">44021</span><br>d2=<span class="hljs-built_in">pow</span>(e2,-<span class="hljs-number">1</span>,phi2)<br>q=<span class="hljs-built_in">pow</span>(c2,d2,n2)<br><span class="hljs-comment">#print(q)</span><br></code></pre></td></tr></table></figure><p>​从加密代码中我们知道<br>$$<br>hint2 &#x3D; (2023\cdot{p_2}+2024\cdot{q_2})^{2323} \bmod{n_2}<br>$$</p><p>$$<br>hint3 &#x3D; (2024\cdot{p_2}+2023\cdot{q_2})^{2424}\bmod{n_2}<br>$$</p><p>​那么我们假设$a&#x3D;2023\cdot{p_2}+2024\cdot{q_2}$和$b&#x3D;2024\cdot{p_2}+2023\cdot{q_2}$，那么$hint2&#x3D;a^{2323} \bmod n_2$，$hint3&#x3D;b^{2424}\bmod n_2$。</p><p>​</p><p>​而$A&#x3D;((2024^{2424}\bmod{n_2}) \cdot hint3)^{2323} \bmod{n_2} &#x3D; (2024^{2424}\cdot hint3)^{2323}\bmod{n_2}&#x3D;2024^{2424\cdot2323}\cdot b^{2424\cdot2323}\bmod{n_2}$了，我们设${e_2}&#x3D;2424\cdot2323$，那么$A&#x3D;2024^{e_2}\cdot b^{e_2}\bmod{n_2}$了。</p><p>​同理，$B&#x3D;2023^{e_2}\cdot a^{e_2}\bmod n_2$。</p><p>​</p><p>​继续推导，由于$a\equiv 2024\cdot{q_2} \pmod{p_2}$，$b\equiv 2023\cdot{q_2} \pmod{p_2}$，那么$A\bmod p_2 &#x3D; 2024^{e_2}\cdot b^{e_2}&#x3D;2024^{e_2}\cdot (2023q_2)^{e_2}&#x3D;(2024\cdot 2023q_2)^{e_2}\bmod p_2$，同理，$B \bmod p_2 &#x3D;(2023\cdot 2024q_2)^{e_2}\bmod p_2$。</p><p>所以在模$p_2$的“世界”里面，A和B是相等的，那么它们的差值一定是$p_2$的倍数，和$n_2$取公约数就是$p_2$了。</p><p>​这里就是不证明为什么不是$n_2$了。</p><p>​我们也知道<br>$$<br>c2 &#x3D; q^{44021}\bmod n_2<br>$$<br>​也就能解出<strong>q</strong>的值了。</p><h3 id="DLP—Pohlig-Hellman算法求e"><a href="#DLP—Pohlig-Hellman算法求e" class="headerlink" title="DLP—Pohlig-Hellman算法求e"></a>DLP—Pohlig-Hellman算法求e</h3><p>​这里就不讲解算法原理了，有兴趣自查，我们只解析一遍运算过程。</p><p>​由加密代码知<br>$$<br>a_output &#x3D; (0x488d156b0cbef000f1bf6c47006a3595)^e \bmod{(0x9c5ab7c1cc9a4f60…..)}<br>$$<br>​这里是转换成离散对数问题，求解e。</p><p>​抽象出$a&#x3D;base^x\bmod N$的形式。</p><p>​第一步找<strong>N-1</strong>的质因子，即<strong>factors</strong>。</p><p>​第二步将问题分解为一个个小问题求解，现阶段看不懂了，下去再补数学知识吧，也不太好写在博客上了，我写的也不一定别人能看懂。所以没有写的必要了。</p><h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><p>​<a href="https://www.ruanx.net/pohlig-hellman/">Pohlig-Hellman 算法</a>、<a href="https://oi-wiki.org/math/number-theory/crt/">中国剩余定理</a>。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;​	在官方WP中，这题是被分在了&lt;strong&gt;crypto&lt;/strong&gt;板块，所以官方认为这个题更倾向于是考察密码学的知识，和逆向涉及</summary>
      
    
    
    
    <category term="CTF" scheme="http://bumak.github.io/categories/CTF/"/>
    
    
    <category term="Reverse" scheme="http://bumak.github.io/tags/Reverse/"/>
    
    <category term="Crypto" scheme="http://bumak.github.io/tags/Crypto/"/>
    
  </entry>
  
  <entry>
    <title>CE入门关卡记录（部分）</title>
    <link href="http://bumak.github.io/2025/07/10/CE/"/>
    <id>http://bumak.github.io/2025/07/10/CE/</id>
    <published>2025-07-10T11:27:31.000Z</published>
    <updated>2025-07-10T11:28:53.567Z</updated>
    
    <content type="html"><![CDATA[<h1 id="第八关"><a href="#第八关" class="headerlink" title="第八关"></a>第八关</h1><p>​多级指针很重要，需要深入理解。</p><blockquote><p>​如果是最简单的指针，假设不存在偏移的情况，那么指针1就能直接指向指针2，指针2就能直接指向指针3，指针3就会指向数值。但是程序不是这么运行的，数据是通过基址+偏移的形式访问的，通常我们直接搜索对应的地址是找不到的，在访问时是有使用偏移的，所以我们看访问&#x2F;写入该地址的指令，就是为了确定偏移量的。</p></blockquote><p>​CE锁住值是通过不断的写入而实现的，所以我们需要知道访问动态地址的方式就可以了，也就是静态地址。</p><blockquote><p>​我们必须要知道为什么要找静态指针————因为，游戏中的动态地址（比如血量和坐标）在游戏每次启动时都会变换，这是因为操作系统给程序分配的内存地址是不固定的。而静态指针总是能够通过多级指针指向动态地址，由于程序代码是固定不变的，代表着多级指针指向的时候，使用的偏移也是不变的，所以我们只要能够确定静态地址，就能稳定锁定到动态地址和对应数值。</p><p>例如：</p><p>​通过静态地址得到的值+offset1 &#x3D; 二级指针的地址</p><p>​通过二级指针的地址得到的值+offset2 &#x3D; 一级指针的地址</p><p>​通过一级指针的地址得到的值+offset3 &#x3D; 动态地址</p><p>​通过动态地址就能找到对应的数据了。</p></blockquote><p>最简单的模型如下。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/40bf52da61346cbbfc3da2d98c46b980/image-20250527163203294.png" alt="image-20250527163203294"><ul><li>第一步，通过精确数值或者层层筛选，我们要先找出动态数值存储的地址，也就是下面的0x014BB4B8。</li></ul><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/40bf52da61346cbbfc3da2d98c46b980/image-20250527161457800.png" alt="image-20250527161457800"><ul><li>第二步，查看什么指令修改了这个地址。看到红色的mov指令，eax是写入的数值，[rsi+18]是一种内存表示方式，是基址+偏移的形式。程序的固定不变的，我们去找，哪个地址保存了0x014BB4A0的值，说明这个地址就是我们需要的指针。</li></ul><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/40bf52da61346cbbfc3da2d98c46b980/image-20250527161655153.png" alt="image-20250527161655153"><ul><li>通过精确值搜索找到了这个地址。</li></ul><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/40bf52da61346cbbfc3da2d98c46b980/image-20250527163618998.png" alt="image-20250527163618998"><ul><li>接下来我们要看哪个程序访问了该地址，而不是写入，因为程序运行中动态地址暂时是固定的，我们要看程序是怎么通过上级指针找到这个地址，而取出其值的。这里我们找到了两个指令访问了该地址，</li></ul><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/40bf52da61346cbbfc3da2d98c46b980/image-20250527163915502.png" alt="image-20250527163915502"><p>​先看下面一条，这里直接通过rsi取出其值了，没有偏移量，说明了上级指针是直接指向该地址的。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/40bf52da61346cbbfc3da2d98c46b980/image-20250527163955530.png" alt="image-20250527163955530"><p>​看另外一个访问方式也可以确定偏移量为0.</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/40bf52da61346cbbfc3da2d98c46b980/image-20250527164230391.png" alt="image-20250527164230391"><p>下面同理，一层层找到静态地址了，然后手动添加地址，修改值（CE能自己通过层层指针写入到动态地址处），锁住就行。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/40bf52da61346cbbfc3da2d98c46b980/image-20250527165227755.png" alt="image-20250527165227755"><h1 id="第九关"><a href="#第九关" class="headerlink" title="第九关"></a>第九关</h1><h2 id="成功复现"><a href="#成功复现" class="headerlink" title="成功复现"></a>成功复现</h2><p>​首先根据教程，找到了生命值对应的结构体部分，看到了阵营在C偏移处。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/40bf52da61346cbbfc3da2d98c46b980/image-20250523120317203.png" alt="image-20250523120317203"><p>​接下来就是写作弊脚本（CEAA）了。</p><p>这里先使用cmp比较阵营，[rbx+14]是根据[rbx+08+0C]计算出来的。可以实现无敌和一键秒杀功能。也成功通过这一关。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/40bf52da61346cbbfc3da2d98c46b980/image-20250523120802780.png" alt="image-20250523120802780"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/40bf52da61346cbbfc3da2d98c46b980/image-20250523120912434.png" alt="image-20250523120912434"><hr><h2 id="意外情况（意外变成正常情况了；）"><a href="#意外情况（意外变成正常情况了；）" class="headerlink" title="意外情况（意外变成正常情况了；）"></a>意外情况（意外变成正常情况了；）</h2><hr><h2 id="另外一种解"><a href="#另外一种解" class="headerlink" title="另外一种解"></a>另外一种解</h2><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/40bf52da61346cbbfc3da2d98c46b980/image-20250523123458611.png" alt="image-20250523123458611"><p>​开始搞错了，mov是取值操作，不是地址操作。这个代码是错误的啊！！！！</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/40bf52da61346cbbfc3da2d98c46b980/image-20250523125350431.png" alt="image-20250523125350431"><p>​这个代码才是正确的，同样可以通过。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/40bf52da61346cbbfc3da2d98c46b980/image-20250523131006134.png" alt="image-20250523131006134"><hr><h1 id="进阶1"><a href="#进阶1" class="headerlink" title="进阶1"></a>进阶1</h1><h2 id="学习经验"><a href="#学习经验" class="headerlink" title="学习经验"></a>学习经验</h2><ul><li>在查找某个数据的地址时，在不知道精确值的情况下，选择“未知的初始值”，通过不断的变大变小趋势，去锁定该数据。</li><li>在根据精确值多次查找后，仍然无法找到，那么很可能显示出来的值并不直接是程序中存储的值，很可能是个“假值”。比如说，植物大战僵尸中金币数永远是10的倍数，外部显示的是500，那么程序里面存储的就是50。从程序中的值到显示中的值经过了一些计算，可以理解为映射、函数等等。</li></ul><hr><h1 id="进阶2"><a href="#进阶2" class="headerlink" title="进阶2"></a>进阶2</h1><p>​这个地方遇到一个问题，写入的代码是sub语句，我们代码注入时需要替换sub指令为jmp指令，但是jmp指令是5字节，会覆盖ret和下一个函数的add指令，导致程序崩溃，所以我们要选择上面一点的mov指令进行自动汇编，这样就会在mov指令进行替换，就只占用了mov和sub指令的位置（多出jmp的用nop补）。</p><p>​在newmen处就是我们跳转过来的代码执行处，而originalcode、exit也是附加带的。因为mov是指针操作，我们需要让它一定能执行。反正理解前面一点后就很简单了，直接看代码就行。分阵营的方法和第九关一样的，去找结构体，看区分的偏移为多少，cmp指令比较就行。</p><p>​再就是可以将脚本保存到CT表（作弊表），随时手动激活，更加方便使用。不要一直点执行了。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/40bf52da61346cbbfc3da2d98c46b980/image-20250523173054319.png" alt="image-20250523173054319"><hr><h1 id="进阶3"><a href="#进阶3" class="headerlink" title="进阶3"></a>进阶3</h1><h2 id="通关技巧"><a href="#通关技巧" class="headerlink" title="通关技巧"></a>通关技巧</h2><p>​浮点数xy坐标，反复筛选，x是左负右正；y是上负下正。还有一个表示重力的值，会随着上下跳跃而变化。</p><p>​还有一个记录绿格子的值，通过不变和增加就能筛选出来。最后直接跑到门那里，设置全变绿就可以了。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;第八关&quot;&gt;&lt;a href=&quot;#第八关&quot; class=&quot;headerlink&quot; title=&quot;第八关&quot;&gt;&lt;/a&gt;第八关&lt;/h1&gt;&lt;p&gt;​	多级指针很重要，需要深入理解。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;​	如果是最简单的指针，假设不存在偏移的情况，那么指针1</summary>
      
    
    
    
    
    <category term="CE" scheme="http://bumak.github.io/tags/CE/"/>
    
  </entry>
  
  <entry>
    <title>ISCTF2024-MIPS</title>
    <link href="http://bumak.github.io/2025/07/10/ISCTF2024/MIPS_WP/"/>
    <id>http://bumak.github.io/2025/07/10/ISCTF2024/MIPS_WP/</id>
    <published>2025-07-10T11:22:29.000Z</published>
    <updated>2025-07-10T11:22:54.589Z</updated>
    
    <content type="html"><![CDATA[<h1 id="MIPS"><a href="#MIPS" class="headerlink" title="MIPS"></a>MIPS</h1><p>​栈指针是指向栈顶，高地址，<strong>SP</strong>；帧指针是指向栈底，低地址，<strong>FP</strong>。</p><p>​其实指针的操作还是和x86-64指令集架构相似的，还是又被调用者来维护指针和恢复栈帧。</p><p>​人工脑读汇编还是太累了，需要深厚的汇编基础和经验。于是查看WP，发现MIPS.s文件居然可以链接成为ELF程序，只需要使用工具命令<code>mips-linux-gnu-gcc -o MIPS MIPS.s</code>，而这个工具下载可以使用命令<code>sudo apt install gcc-mips-linux-gnu</code>。是在<strong>CTF-OS</strong>虚拟机里面下载的。得到ELF文件，使用IDA反编译。</p><p>​“氛围组”输出。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/b9b81f22a9aa7bf95dfe22317fc5e1dd/image-20250520134118502.png" alt="image-20250520134118502"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/b9b81f22a9aa7bf95dfe22317fc5e1dd/image-20250520134155250.png" alt="image-20250520134155250"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/b9b81f22a9aa7bf95dfe22317fc5e1dd/image-20250520135713172.png" alt="image-20250520135713172"><p>​代码很好看，逻辑很简单。在<code>my_really_lover</code>函数处进行了key的处理，然后再<code>four_c_114</code>函数处，进行RC4加密的处理。不看wp没能发现自己忽略了最后的异或82了，这是一个魔改的rc4.</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/b9b81f22a9aa7bf95dfe22317fc5e1dd/image-20250520135505215.png" alt="image-20250520135505215"><p>看<code>init</code>函数， 明显的S盒混淆处理，和RC4的处理完全一样。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/b9b81f22a9aa7bf95dfe22317fc5e1dd/image-20250520135305097.png" alt="image-20250520135305097"><p>​就是魔改RC4加密，逆向就是复制加密过程，再加密一次。</p><p>​写脚本遇到的坑有点多，还是学习WP的写法。python写这种处理字节的容易出错，C写要好不少，虽然复杂一点，但是一步步来不容易错漏。然后就是IDA的数据表示，究竟什么样子才是对的啊，有时候照抄就行，有时候就要逆序一下，这是为什么啊？有人说存在“小端陷阱”，有时候又没有。最后就是题目的迷惑性，它在最后的验证中只验证了26个字节，但是最终flag是27个字节的。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/b9b81f22a9aa7bf95dfe22317fc5e1dd/image-20250520150010839.png" alt="image-20250520150010839"><h2 id="Exp"><a href="#Exp" class="headerlink" title="Exp"></a>Exp</h2><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *key, <span class="hljs-type">int</span> key_len, <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *s)</span>&#123;<br>    <br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> t[<span class="hljs-number">256</span>];<br><br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">256</span>; i++)&#123;<br>        s[i] = i;<br>        t[i] = key[i%key_len];<br>    &#125;<br><br>    <span class="hljs-type">int</span> j = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">256</span>; i++)&#123;<br>        j = (j + s[i] + t[i]) % <span class="hljs-number">256</span>;<br>        <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> temp = s[i];<br>        s[i] = s[j];<br>        s[j] = temp;<br>    &#125;<br>&#125;<br><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">rc4</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *data, <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *key)</span>&#123;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> s[<span class="hljs-number">256</span>];<br>    <span class="hljs-type">int</span> data_len = <span class="hljs-number">27</span>;<br>    <span class="hljs-type">int</span> key_len = <span class="hljs-number">12</span>;<br>    init(key, key_len, s);<br>    <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;<br>    <span class="hljs-type">int</span> j = <span class="hljs-number">0</span>;<br>    <span class="hljs-type">int</span> t = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span>(t &lt; data_len)&#123;<br>        i = (i + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span>;<br>        j = (j + s[i]) % <span class="hljs-number">256</span>;<br>        <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> temp = s[i];<br>        s[i] = s[j];<br>        s[j] = temp;<br>        <span class="hljs-type">int</span> k = (s[i] + s[j]) % <span class="hljs-number">256</span>;<br>        data[t] ^= s[k] ^<span class="hljs-number">82</span>;<br>        t++;<br>    &#125;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> enc[] = &#123;<span class="hljs-number">0xd6</span>,<span class="hljs-number">0x32</span>,<span class="hljs-number">0x27</span>,<span class="hljs-number">0x4e</span>,<span class="hljs-number">0x77</span>,<span class="hljs-number">0xca</span>,<span class="hljs-number">0xd5</span>,<span class="hljs-number">0x76</span>,<span class="hljs-number">0xa3</span>,<span class="hljs-number">0x21</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x09</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x09</span>,<span class="hljs-number">0x45</span>,<span class="hljs-number">0x89</span>,<span class="hljs-number">0x36</span>,<span class="hljs-number">0x9a</span>,<span class="hljs-number">0xba</span>,<span class="hljs-number">0x90</span>,<span class="hljs-number">0xec</span>,<span class="hljs-number">0x47</span>,<span class="hljs-number">0x98</span>,<span class="hljs-number">0xf8</span>,<span class="hljs-number">0xFE</span>,<span class="hljs-number">0xF0</span>,<span class="hljs-number">0x4B</span>&#125;;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> key1[] = &#123;<span class="hljs-number">0x11</span>,<span class="hljs-number">0x2b</span>,<span class="hljs-number">0x1a</span>,<span class="hljs-number">0x1</span>,<span class="hljs-number">0x20</span>,<span class="hljs-number">0x11</span>,<span class="hljs-number">0x7</span>,<span class="hljs-number">0x24</span>,<span class="hljs-number">0x12</span>,<span class="hljs-number">0x1</span>,<span class="hljs-number">0x25</span>,<span class="hljs-number">0x16</span>&#125;;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> key2[] = &#123;<span class="hljs-number">104</span>,<span class="hljs-number">74</span>,<span class="hljs-number">120</span>&#125;;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">12</span>; i++)&#123;<br>        key1[i] = key1[i] ^ key2[i%<span class="hljs-number">3</span>];<br>    &#125;<br>    rc4(enc, key1);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">27</span>; i++)&#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>, enc[i]);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;   <br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;MIPS&quot;&gt;&lt;a href=&quot;#MIPS&quot; class=&quot;headerlink&quot; title=&quot;MIPS&quot;&gt;&lt;/a&gt;MIPS&lt;/h1&gt;&lt;p&gt;​	栈指针是指向栈顶，高地址，&lt;strong&gt;SP&lt;/strong&gt;；帧指针是指向栈底，低地址，&lt;strong&gt;FP&lt;/st</summary>
      
    
    
    
    <category term="CTF" scheme="http://bumak.github.io/categories/CTF/"/>
    
    
    <category term="Reverse" scheme="http://bumak.github.io/tags/Reverse/"/>
    
  </entry>
  
  <entry>
    <title>ISCTF2024-桀桀桀</title>
    <link href="http://bumak.github.io/2025/07/10/ISCTF2024/%E6%A1%80%E6%A1%80%E6%A1%80/"/>
    <id>http://bumak.github.io/2025/07/10/ISCTF2024/%E6%A1%80%E6%A1%80%E6%A1%80/</id>
    <published>2025-07-10T11:21:26.000Z</published>
    <updated>2025-07-10T11:21:59.284Z</updated>
    
    <content type="html"><![CDATA[<h1 id=""><a href="#" class="headerlink" title=""></a></h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>​之前记录的过程，忘记上了，上一下吧。</p><hr><p>​无壳程序，IDA打开就碰壁了，就这个东西，然后无了，main函数也没有，奇怪的函数命名让我根本找不到程序的主要逻辑链。于是只能找提示字符串了。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/887b345135b8fe85322489fbdcc403bf/image-20250520152537344.png" alt="image-20250520152537344"><p>​找到之后，一堆提示信息输出，然后使用z3求解器求出这个输入的字符串是ISCTF，需要学习Z3的使用。注意：z3求解不支持移位操作，需要使用乘除法替代。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/887b345135b8fe85322489fbdcc403bf/image-20250520163039040.png" alt="image-20250520163039040"><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> z3 <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># 定义变量</span><br>v1, v2, v3, v4, v5 = Ints(<span class="hljs-string">&quot;v1 v2 v3 v4 v5&quot;</span>)<br><br><span class="hljs-comment"># 创建求解器</span><br>solver = Solver()<br><br><span class="hljs-comment"># 添加约束</span><br>solver.add((v2 * v1) * <span class="hljs-number">1024</span> == <span class="hljs-number">0x5EAC00</span>)  <span class="hljs-comment"># 替代 (v2 * v1) &lt;&lt; 10，1024是2^10</span><br>solver.add((v2 + <span class="hljs-number">1</span>) * (v2 - <span class="hljs-number">1</span>) == <span class="hljs-number">0x1AE8</span>)<br>solver.add(v3 + v4 == <span class="hljs-number">0x97</span>)<br>solver.add((v3 * <span class="hljs-number">2048</span>) - v4 == <span class="hljs-number">0x217AC</span>)  <span class="hljs-comment"># 替代 (v3 &lt;&lt; 11)，2048是2^11</span><br>solver.add(v4 + v3 + v2 + v1 + v5 == <span class="hljs-number">0x179</span>)<br><br><span class="hljs-comment"># 求解</span><br><span class="hljs-keyword">if</span> solver.check() == sat:<br>    model = solver.model()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;解：&quot;</span>)<br>    <span class="hljs-comment"># 将结果按 ASCII 转换成字符输出</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;v1 = <span class="hljs-subst">&#123;<span class="hljs-built_in">chr</span>(model[v1].as_long())&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;v2 = <span class="hljs-subst">&#123;<span class="hljs-built_in">chr</span>(model[v2].as_long())&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;v3 = <span class="hljs-subst">&#123;<span class="hljs-built_in">chr</span>(model[v3].as_long())&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;v4 = <span class="hljs-subst">&#123;<span class="hljs-built_in">chr</span>(model[v4].as_long())&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;v5 = <span class="hljs-subst">&#123;<span class="hljs-built_in">chr</span>(model[v5].as_long())&#125;</span>&quot;</span>)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;没有解&quot;</span>)<br></code></pre></td></tr></table></figure><p>​然后要求输入32字节字符串，并每8字节、64位进行分块处理，其密钥为16字节，128位，像是tea加密的特征。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/887b345135b8fe85322489fbdcc403bf/image-20250520173121063.png" alt="image-20250520173121063"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/887b345135b8fe85322489fbdcc403bf/image-20250520171012903.png" alt="image-20250520171012903"><p>​</p><hr><h2 id="首次加密"><a href="#首次加密" class="headerlink" title="首次加密"></a>首次加密</h2><p>​进入函数，发现一个花指令，无效跳转，以及4119E6处，全部<code>nop</code>掉。然后发现<strong>sub_4111B3</strong>是个空壳函数，只进行了跳转，我们需要将跳转后的地方设置位函数，使用P，然后反编译得到函数。很明显的魔改tea特征。ok，我们知道对flag进行了魔改tea加密了。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/887b345135b8fe85322489fbdcc403bf/image-20250520171308676.png" alt="image-20250520171308676"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/887b345135b8fe85322489fbdcc403bf/image-20250520171646153.png" alt="image-20250520171646153"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/887b345135b8fe85322489fbdcc403bf/image-20250520172534695.png" alt="image-20250520172534695"><p>​</p><hr><h2 id="二次加密"><a href="#二次加密" class="headerlink" title="二次加密"></a>二次加密</h2><p>​继续往后看，41128A进去是个<strong>strlen</strong>函数。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/887b345135b8fe85322489fbdcc403bf/image-20250520181206889.png" alt="image-20250520181206889"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/887b345135b8fe85322489fbdcc403bf/image-20250520181218879.png" alt="image-20250520181218879"><p>​！！！大意了，还得是wp，这里还有花指令，导致分析不全。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/887b345135b8fe85322489fbdcc403bf/image-20250520181316203.png" alt="image-20250520181316203"><p>​第一次碰到这种花指令，试着全部<strong>nop</strong>掉。（下图是错误示范，导致for循环变成while循环），实际上应该保留EC处的<strong>jmp</strong>指令。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/887b345135b8fe85322489fbdcc403bf/image-20250520175741631.png" alt="image-20250520175741631"><p>​正确的如下所示。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/887b345135b8fe85322489fbdcc403bf/image-20250520192444429.png" alt="image-20250520192444429"><p>​反编译出伪代码，分奇偶位对字符进行加密。其中的a2参数是什么哩。（wp中是for循环，这里还是while循环，但是逻辑变成一样的了。）</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/887b345135b8fe85322489fbdcc403bf/image-20250520192525705.png" alt="image-20250520192525705"><p>​我们需要看v12处的汇编指令，这里IDA反编译的应该有问题，<strong>sub_41126C</strong>应该无返回值的，中间调用过那么多次，看上去就是一个异常处理的函数，不太可能使用这个函数的返回值做密钥。看到，因为调用<strong>41126C</strong>函数后再移动的<strong>eax</strong>寄存器值，这里应该是一个干扰，<strong>41126C</strong>函数根本没修改<strong>eax</strong>的值。所以v12更有可能是rand参数的返回值。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/887b345135b8fe85322489fbdcc403bf/image-20250520193121784.png" alt="image-20250520193121784"><p>​我们跟进<strong>41126C</strong>函数的汇编代码，验证了我们的猜想，<strong>eax</strong>寄存器根本没变化。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/887b345135b8fe85322489fbdcc403bf/image-20250520193419143.png" alt="image-20250520193419143"><hr><h2 id="密文验证"><a href="#密文验证" class="headerlink" title="密文验证"></a>密文验证</h2><p>​再看<strong>41100A</strong>，点进去就是相等比对。所以v24就是密文，在最开始已经定义了。<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/887b345135b8fe85322489fbdcc403bf/image-20250520173039851.png" alt="image-20250520173039851"></p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/887b345135b8fe85322489fbdcc403bf/image-20250520173312245.png" alt="image-20250520173312245"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/887b345135b8fe85322489fbdcc403bf/image-20250520173416363.png" alt="image-20250520173416363"><p>​</p><hr><h2 id="TLS"><a href="#TLS" class="headerlink" title="TLS"></a>TLS</h2><p>​如果不看wp，就应该是这样做了，但是我们看了wp，知道TLS会修改某些参数，所以我们在exports表找到<strong>TLScallback</strong>，还是有花指令，反编译报错，锁定指令处，进行修改。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/887b345135b8fe85322489fbdcc403bf/image-20250520180453991.png" alt="image-20250520180453991"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/887b345135b8fe85322489fbdcc403bf/image-20250520173626006.png" alt="image-20250520173626006"><p>​这里分析call指令实现跳转，而pop指令完全没有然后作用，pop的值没有被使用，反而会影响栈平衡，不知道什么意思。所以这里从call指令到pop指令全部要nop掉。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/887b345135b8fe85322489fbdcc403bf/image-20250520173705521.png" alt="image-20250520173705521"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/887b345135b8fe85322489fbdcc403bf/image-20250520180610436.png" alt="image-20250520180610436"><hr><p>​马上又看到一个一样的花指令，同样套路去掉。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/887b345135b8fe85322489fbdcc403bf/image-20250520173843006.png" alt="image-20250520173843006"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/887b345135b8fe85322489fbdcc403bf/image-20250520180704418.png" alt="image-20250520180704418"><hr><p>​最后tls返回处还有一个爆红的地方，表示函数的堆栈分析失败，或者IDA无法正常确定栈平衡。<code>retn 0Ch</code>表示函数返回后，要清理调用者栈上的 0Ch（即 12 字节）参数。这里没有搞很明白！</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/887b345135b8fe85322489fbdcc403bf/image-20250520174009104.png" alt="image-20250520174009104"><p>​但是能反编译了，打开看看。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/887b345135b8fe85322489fbdcc403bf/image-20250520195544978.png" alt="image-20250520195544978"><hr><p>​当然，这题没有反调试，可以动调看到密钥的值。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/887b345135b8fe85322489fbdcc403bf/image-20250520195911520.png" alt="image-20250520195911520"><p>​加密逻辑已经清晰了，写逆向脚本了。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/887b345135b8fe85322489fbdcc403bf/image-20250521100900532.png" alt="image-20250521100900532"><hr><h2 id="Exp"><a href="#Exp" class="headerlink" title="Exp"></a>Exp</h2><p>​我的C语言功底还是有点差，编写脚本出现各种低级错误，奇偶位分不清，数据类型不知道怎么定义，最后学习别人的脚本后，才修改成功。</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span> </span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">tea_decrypt</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *v, <span class="hljs-type">int</span> *key)</span>&#123;<br> <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v0 = v[<span class="hljs-number">0</span>];<br><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v1 = v[<span class="hljs-number">1</span>];<br><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> delta = <span class="hljs-number">0x114514</span>;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> sum = <span class="hljs-number">0x9E3779B9</span> * <span class="hljs-number">24</span> + <span class="hljs-number">0x114514</span> * <span class="hljs-number">8</span>;<br><span class="hljs-type">int</span> key1 = key[<span class="hljs-number">2</span>];<br><span class="hljs-type">int</span> key2 = key[<span class="hljs-number">3</span>];<br><span class="hljs-type">int</span> key3 = key[<span class="hljs-number">0</span>];<br><span class="hljs-type">int</span> key4 = key[<span class="hljs-number">1</span>];<br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">31</span>; i&gt;=<span class="hljs-number">0</span>; i--)&#123;<br>v1 -= (key4 + (v0 &gt;&gt; <span class="hljs-number">5</span>)) ^ (sum + v0) ^(key3 + (v0 &lt;&lt; <span class="hljs-number">4</span>));<br>v0 -= (key2 + (v1 &gt;&gt; <span class="hljs-number">5</span>)) ^ (sum + v1) ^(key1 + (v1 &lt;&lt; <span class="hljs-number">4</span>));<br>sum -= delta;<br><span class="hljs-keyword">if</span>(i == <span class="hljs-number">24</span>)&#123;<br>            delta = <span class="hljs-number">0x9E3779B9</span>;<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(i == <span class="hljs-number">16</span>)&#123;<br>key1 = key[<span class="hljs-number">0</span>];<br>key2 = key[<span class="hljs-number">1</span>];<br>key3 = key[<span class="hljs-number">2</span>];<br>key4 = key[<span class="hljs-number">3</span>];<br>        &#125;<br>&#125;<br>v[<span class="hljs-number">0</span>] = v0;<br>v[<span class="hljs-number">1</span>] = v1;<br>&#125;<br><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-type">char</span> *s = <span class="hljs-string">&quot;ISCTF&quot;</span>;<br>    <span class="hljs-comment">//这种分块加密的，保存的时候以字节为单位。</span><br>    <span class="hljs-comment">//IDA中出现在反编译中的uint32_t类型的变量，确实是以小端序保存的。正确的顺序是需要转换为大端序。比如字符串“flag”，小端序中，低位在低地址，也就是栈顶。导致反编译出来的是“galf”（IDA对于数据是从低地址到高地址的方向开始解析的）。</span><br><span class="hljs-type">uint8_t</span> enc[] = &#123;<span class="hljs-number">0xB1</span>,<span class="hljs-number">0xD2</span>,<span class="hljs-number">0xF9</span>,<span class="hljs-number">0x7A</span>,<span class="hljs-number">0x83</span>,<span class="hljs-number">0x4c</span>,<span class="hljs-number">0x51</span>,<span class="hljs-number">0x23</span>,<span class="hljs-number">0xb7</span>,<span class="hljs-number">0xad</span>,<span class="hljs-number">0xa9</span>,<span class="hljs-number">0xbe</span>,<span class="hljs-number">0xe8</span>,<span class="hljs-number">0xfa</span>,<span class="hljs-number">0x24</span>,<span class="hljs-number">0x16</span>,<span class="hljs-number">0x93</span>,<span class="hljs-number">0xfe</span>,<span class="hljs-number">0x42</span>,<span class="hljs-number">0xd7</span>,<span class="hljs-number">0xb0</span>,<span class="hljs-number">0x1f</span>,<span class="hljs-number">0x52</span>,<span class="hljs-number">0xf7</span>,<span class="hljs-number">0x5a</span>,<span class="hljs-number">0x7d</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0xe8</span>,<span class="hljs-number">0x28</span>,<span class="hljs-number">0xfc</span>,<span class="hljs-number">0x41</span>,<span class="hljs-number">0x6f</span>&#125;;<br><span class="hljs-type">int</span> seed = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++)&#123;<br>seed += (<span class="hljs-type">int</span>)s[i] ^ <span class="hljs-number">0xA1</span>;<br>&#125;<br>srand(seed);<br><span class="hljs-type">int</span> key = rand();      <span class="hljs-comment">//3878</span><br><span class="hljs-type">int</span> k1 = key &gt;&gt; <span class="hljs-number">6</span>;<br><span class="hljs-type">int</span> k2 = key - (k1 &lt;&lt; <span class="hljs-number">6</span>);<br><span class="hljs-type">int</span> len = <span class="hljs-keyword">sizeof</span>(enc)/<span class="hljs-keyword">sizeof</span>(enc[<span class="hljs-number">0</span>]);<br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;len;i++)&#123;<br><span class="hljs-keyword">if</span>(i%<span class="hljs-number">2</span>!=<span class="hljs-number">0</span>)&#123;<span class="hljs-comment">//这个地方粗心搞错了，导致后面半天解密失败。</span><br>enc[i] ^= k1;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>enc[i] ^= k2;<br>&#125;<br>&#125;<br><span class="hljs-type">int</span> KEY[] = &#123;<span class="hljs-number">0x6fc6</span>,<span class="hljs-number">0x69d3</span>,<span class="hljs-number">0x68d5</span>,<span class="hljs-number">0x73cc</span>&#125;;<br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;len;i=i+<span class="hljs-number">8</span>)&#123;<br>tea_decrypt((<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *)(enc+i),KEY);<span class="hljs-comment">//奇妙的方法，更换指针类型就可以实现从单字节到块！！善用C语言的指针！</span><br>&#125;<br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;len;i++)&#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>,enc[i]);<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;headerlink&quot; title=&quot;&quot;&gt;&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;​	之前记录的过程，忘</summary>
      
    
    
    
    <category term="CTF" scheme="http://bumak.github.io/categories/CTF/"/>
    
    
    <category term="Reverse" scheme="http://bumak.github.io/tags/Reverse/"/>
    
  </entry>
  
  <entry>
    <title>一道简单VM逆向记录</title>
    <link href="http://bumak.github.io/2025/07/10/VM/"/>
    <id>http://bumak.github.io/2025/07/10/VM/</id>
    <published>2025-07-10T09:22:40.000Z</published>
    <updated>2025-07-10T09:23:02.376Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>​之前比赛做过的一个和虚拟机有关的题目，当时是黑盒分析，取密文，然后破解密码表逆推解出来的。而官方WP有另一种去虚拟化的做法，我记录一下复现过程。</p><p>​</p><h2 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h2><h3 id="工具环境搭建"><a href="#工具环境搭建" class="headerlink" title="工具环境搭建"></a>工具环境搭建</h3><p>​去虚拟化工具，release版<a href="https://github.com/NaC-L/Mergen/releases/tag/0.6">链接</a>。</p><p>​如果需要自己编译，那么给出WP的参考意见。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/9efa1902062d173aeee6bab1c8c4adfe/image-20250710170103640.png" alt="image-20250710170103640"><h3 id="分析过程"><a href="#分析过程" class="headerlink" title="分析过程"></a>分析过程</h3><p>​Windows下运行命令<code>lifter.exe Path_to_exe 0x00000001400011C0</code>，得到<strong>ll</strong>中间代码文件。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/9efa1902062d173aeee6bab1c8c4adfe/image-20250710170947279.png" alt="image-20250710170947279"><p>​其中那个地址是虚拟化函数的地址，通过IDA分析<strong>sub_1400011E0</strong>是加密处。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/9efa1902062d173aeee6bab1c8c4adfe/image-20250710170221291.png" alt="image-20250710170221291"><p>​而其中<strong>sub_1400011C0</strong>就是虚拟化函数，还无法正常反编译。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/9efa1902062d173aeee6bab1c8c4adfe/image-20250710170259398.png" alt="image-20250710170259398"><p>​我们得到了<strong>ll</strong>中间代码，<strong>output.ll</strong>文件内容如下，先将整数常量 <code>1375408</code> 转换为一个指针类型，然后把传入函数的参数 <code>%RCX</code>（64 位整数）写入地址 <code>%0</code>（即 <code>0x14F000</code>），写入时按 4 字节对齐（虽然值是 8 字节）。</p><p>​之后把 <code>%RCX</code> 和十进制 <code>2740963099</code> 做异或，<strong>2740963099 &#x3D; 0xA3501C7B</strong>。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/9efa1902062d173aeee6bab1c8c4adfe/image-20250710170658195.png" alt="image-20250710170658195"><p>​所以清楚的看出来这是一个简单的异或，密钥就是<strong>0xA3501C7B</strong>。</p><p>​当时穷举老费劲了！！！有没有什么能轻易<strong>hook</strong>exe程序的工具啊，求推荐。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;​	之前比赛做过的一个和虚拟机有关的题目，当时是黑盒分析，取密文，然后破解密码表逆推解出来的。而官方WP有另一种去虚拟化的做法，我记录一下复</summary>
      
    
    
    
    <category term="CTF" scheme="http://bumak.github.io/categories/CTF/"/>
    
    
    <category term="Reverse" scheme="http://bumak.github.io/tags/Reverse/"/>
    
  </entry>
  
  <entry>
    <title>GeekChallenge2024-LinkedListModular</title>
    <link href="http://bumak.github.io/2025/07/10/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982024/LinkedListModular/"/>
    <id>http://bumak.github.io/2025/07/10/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982024/LinkedListModular/</id>
    <published>2025-07-10T07:32:42.000Z</published>
    <updated>2025-07-10T07:33:12.235Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>​该题设计到<strong>RSA</strong>加密中<strong>e</strong>和**φ(n)**不互质的情况，本文会解释RSA算法基本的计算流程和部分数学原理，然后参照WP给出的解密脚本，分析解密脚本中所蕴涵的数学原理。（太麻烦了）</p><h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><h3 id="RSA基础知识补充"><a href="#RSA基础知识补充" class="headerlink" title="RSA基础知识补充"></a>RSA基础知识补充</h3><p>​首先生成两个大质数p和q，然后计算出<strong>n&#x3D;p*q</strong>，计算n的欧拉函数<strong>φ(n) &#x3D; (p-1)(q-1)<strong>计算e对于φ(n)的模反元素d。</strong>&#x3D; (p-1)(q-1)</strong>，随机选择一个整数e，条件是<strong>1&lt; e &lt; φ(n)</strong>，且<strong>e与φ(n) 互质</strong>，计算e对于φ(n)的模反元素<strong>d</strong>，那么**(n,e)<strong>就算是公钥，</strong>(n,d)**就是私钥。</p><p>​字母<strong>c</strong>一般代表密文，字母<strong>m</strong>（msg）代表明文，欧拉函数<strong>φ(n)<strong>也可以用符合</strong>phi</strong>代替。</p><p>​加密：<strong>c&#x3D;M^e mod n</strong>、解密：<strong>M&#x3D;c^d mod n</strong>。</p><p>​一般使用流程：如果A要向B传输消息，那么就会申请B的公钥（当然B也会有A的公钥），然后使用B的公钥加密消息，同时会使用自己的私钥签名。那么B就可以用自己的私钥解密消息，并且用A的公钥验证签名。</p><p>​数学证明可以去看其他文章。</p><h3 id="解题脚本"><a href="#解题脚本" class="headerlink" title="解题脚本"></a>解题脚本</h3><p>​综合解密脚本如下，修改路径即可。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> hashlib<br><br>basepath = <span class="hljs-string">r&quot;F:\StudyFiles\CTF\GeekChallenge2024\Reverse\attachment\LinkedListModular\output\\&quot;</span><br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(basepath + <span class="hljs-string">&quot;cmp0.enc&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    cmp0 = f.read()<br>    cmp0 = <span class="hljs-built_in">eval</span>(<span class="hljs-string">&quot;[&quot;</span> + cmp0 + <span class="hljs-string">&quot;]&quot;</span>)<br><span class="hljs-comment"># print(type(cmp0))</span><br><span class="hljs-comment"># print(cmp0)</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(basepath + <span class="hljs-string">&quot;cmp1.enc&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    cmp1 = f.read()<br>    cmp1 = <span class="hljs-built_in">eval</span>(<span class="hljs-string">&quot;[&quot;</span> + cmp1 + <span class="hljs-string">&quot;]&quot;</span>)<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(basepath + <span class="hljs-string">&quot;cmp2.enc&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    cmp2 = f.read()<br>    cmp2 = <span class="hljs-built_in">eval</span>(<span class="hljs-string">&quot;[&quot;</span> + cmp2 + <span class="hljs-string">&quot;]&quot;</span>)<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(basepath + <span class="hljs-string">&quot;cmp3.enc&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    cmp3 = f.read()<br>    cmp3 = <span class="hljs-built_in">eval</span>(<span class="hljs-string">&quot;[&quot;</span> + cmp3 + <span class="hljs-string">&quot;]&quot;</span>)<br><br>key = <span class="hljs-string">&quot;IKnowYouLikeCrypto&quot;</span><br><br>cmp0 = <span class="hljs-built_in">bytes</span>([cmp0[i] ^ <span class="hljs-built_in">ord</span>(key[i % <span class="hljs-number">18</span>]) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(cmp0))])<br>cmp1 = <span class="hljs-built_in">bytes</span>([cmp1[i] ^ <span class="hljs-built_in">ord</span>(key[i % <span class="hljs-number">18</span>]) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(cmp1))])<br>cmp2 = <span class="hljs-built_in">bytes</span>([cmp2[i] ^ <span class="hljs-built_in">ord</span>(key[i % <span class="hljs-number">18</span>]) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(cmp2))])<br>cmp3 = <span class="hljs-built_in">bytes</span>([cmp3[i] ^ <span class="hljs-built_in">ord</span>(key[i % <span class="hljs-number">18</span>]) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(cmp3))])<br><br><span class="hljs-comment"># print(cmp0.decode(&#x27;utf-8&#x27;))</span><br><span class="hljs-comment"># print(cmp1.decode(&#x27;utf-8&#x27;))</span><br><span class="hljs-comment"># print(cmp2.decode(&#x27;utf-8&#x27;))</span><br><span class="hljs-comment"># print(cmp3.decode(&#x27;utf-8&#x27;))</span><br><br>input_str = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-comment"># 当e约去公约数后与phi互素</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">p, q, e, c</span>):<br>    <span class="hljs-keyword">global</span> input_str<br>    n = p * q<br>    phi = (p - <span class="hljs-number">1</span>) * (q - <span class="hljs-number">1</span>)<br>    t = gmpy2.gcd(e, phi)<span class="hljs-comment">#求出e和φ(n)，也就是phi的最大公约数</span><br>    d = gmpy2.invert(e // t, phi)<span class="hljs-comment">#e//t就和phi没有公因子了，就是互质的了，可以求模phi的逆元了。</span><br>    m = <span class="hljs-built_in">pow</span>(c, d, n)<br>    <span class="hljs-built_in">print</span>(m)<br>    msg = gmpy2.iroot(m, t)<span class="hljs-comment">#对m开t次方</span><br>    <span class="hljs-built_in">print</span>(msg)<br>    <span class="hljs-keyword">if</span> msg[<span class="hljs-number">1</span>] :<br>        dec = long_to_bytes(msg[<span class="hljs-number">0</span>]).<span class="hljs-built_in">hex</span>()<br>        input_str += dec<br><br><span class="hljs-comment">#后面每个文件单独解密后，拼接即可得到flag。</span><br>p0,q0,e0,c0 = cmp0.decode(<span class="hljs-string">&quot;utf-8&quot;</span>).split()<br>p1,q1,e1,c1 = cmp1.decode(<span class="hljs-string">&quot;utf-8&quot;</span>).split()<br>p2,q2,e2,c2 = cmp2.decode(<span class="hljs-string">&quot;utf-8&quot;</span>).split()<br>p3,q3,e3,c3 = cmp3.decode(<span class="hljs-string">&quot;utf-8&quot;</span>).split()<br>decrypt(<span class="hljs-built_in">int</span>(p0[<span class="hljs-number">2</span>:],<span class="hljs-number">16</span>), <span class="hljs-built_in">int</span>(q0[<span class="hljs-number">2</span>:],<span class="hljs-number">16</span>), <span class="hljs-built_in">int</span>(e0[<span class="hljs-number">2</span>:],<span class="hljs-number">16</span>), <span class="hljs-built_in">int</span>(c0[<span class="hljs-number">2</span>:],<span class="hljs-number">16</span>))<br>decrypt(<span class="hljs-built_in">int</span>(p1[<span class="hljs-number">2</span>:],<span class="hljs-number">16</span>), <span class="hljs-built_in">int</span>(q1[<span class="hljs-number">2</span>:],<span class="hljs-number">16</span>), <span class="hljs-built_in">int</span>(e1[<span class="hljs-number">2</span>:],<span class="hljs-number">16</span>), <span class="hljs-built_in">int</span>(c1[<span class="hljs-number">2</span>:],<span class="hljs-number">16</span>))<br>decrypt(<span class="hljs-built_in">int</span>(p2[<span class="hljs-number">2</span>:],<span class="hljs-number">16</span>), <span class="hljs-built_in">int</span>(q2[<span class="hljs-number">2</span>:],<span class="hljs-number">16</span>), <span class="hljs-built_in">int</span>(e2[<span class="hljs-number">2</span>:],<span class="hljs-number">16</span>), <span class="hljs-built_in">int</span>(c2[<span class="hljs-number">2</span>:],<span class="hljs-number">16</span>))<br>decrypt(<span class="hljs-built_in">int</span>(p3[<span class="hljs-number">2</span>:],<span class="hljs-number">16</span>), <span class="hljs-built_in">int</span>(q3[<span class="hljs-number">2</span>:],<span class="hljs-number">16</span>), <span class="hljs-built_in">int</span>(e3[<span class="hljs-number">2</span>:],<span class="hljs-number">16</span>), <span class="hljs-built_in">int</span>(c3[<span class="hljs-number">2</span>:],<span class="hljs-number">16</span>))<br><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;flag&#123;&quot;</span> + hashlib.md5(input_str.encode(<span class="hljs-string">&quot;utf-8&quot;</span>)).digest().<span class="hljs-built_in">hex</span>() + <span class="hljs-string">&quot;&#125;&quot;</span>)<br><span class="hljs-comment"># p0,q0,e0,c0 = cmp0.split()</span><br><span class="hljs-comment">#flag&#123;d3f06717efc6c0daf454ffeac9764687&#125;</span><br></code></pre></td></tr></table></figure><p>​分析过程：<strong>cmp.enc</strong>文件都是被异或加密过的，先解密得到其中的<strong>p、q、e、c</strong>。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">r&quot;attachment/output/cmp0.enc&quot;</span>) <span class="hljs-keyword">as</span> f:<br>cmp0 = f.read()<br>cmp0 = <span class="hljs-built_in">eval</span>(<span class="hljs-string">&quot;[&quot;</span> + cmp0 + <span class="hljs-string">&quot;]&quot;</span>)<br><span class="hljs-comment"># print(type(cmp0))</span><br><span class="hljs-comment"># print(cmp0)</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">r&quot;attachment/output/cmp1.enc&quot;</span>) <span class="hljs-keyword">as</span> f:<br>cmp1 = f.read()<br>cmp1 = <span class="hljs-built_in">eval</span>(<span class="hljs-string">&quot;[&quot;</span> + cmp1 + <span class="hljs-string">&quot;]&quot;</span>)<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">r&quot;attachment/output/cmp2.enc&quot;</span>) <span class="hljs-keyword">as</span> f:<br>cmp2 = f.read()<br>cmp2 = <span class="hljs-built_in">eval</span>(<span class="hljs-string">&quot;[&quot;</span> + cmp2 + <span class="hljs-string">&quot;]&quot;</span>)<br>    <br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">r&quot;attachment/output/cmp3.enc&quot;</span>) <span class="hljs-keyword">as</span> f:<br>cmp3 = f.read()<br>cmp3 = <span class="hljs-built_in">eval</span>(<span class="hljs-string">&quot;[&quot;</span> + cmp3 + <span class="hljs-string">&quot;]&quot;</span>)<br>    <br>key = [<span class="hljs-number">73</span>, <span class="hljs-number">75</span>, <span class="hljs-number">110</span>, <span class="hljs-number">111</span>, <span class="hljs-number">119</span>, <span class="hljs-number">89</span>, <span class="hljs-number">111</span>, <span class="hljs-number">117</span>, <span class="hljs-number">76</span>, <span class="hljs-number">105</span>, <span class="hljs-number">107</span>, <span class="hljs-number">101</span>, <span class="hljs-number">67</span>, <span class="hljs-number">114</span>, <span class="hljs-number">121</span>, <span class="hljs-number">112</span>,<br><span class="hljs-number">116</span>, <span class="hljs-number">111</span>]<br><br>cmp0 = <span class="hljs-built_in">bytes</span>([cmp0[i] ^ key[i % <span class="hljs-number">18</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(cmp0))])<br>cmp1 = <span class="hljs-built_in">bytes</span>([cmp1[i] ^ key[i % <span class="hljs-number">18</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(cmp1))])<br>cmp2 = <span class="hljs-built_in">bytes</span>([cmp2[i] ^ key[i % <span class="hljs-number">18</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(cmp2))])<br>cmp3 = <span class="hljs-built_in">bytes</span>([cmp3[i] ^ key[i % <span class="hljs-number">18</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(cmp3))])<br><br><span class="hljs-built_in">print</span>(cmp0.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br><span class="hljs-built_in">print</span>(cmp1.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br><span class="hljs-built_in">print</span>(cmp2.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br><span class="hljs-built_in">print</span>(cmp3.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br></code></pre></td></tr></table></figure><p>​然后是针对RSA的解密函数。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> hashlib<br><br>input_str = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-comment"># 当e约去公约数后与phi互素</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">p, q, e, c</span>):<br><span class="hljs-keyword">global</span> input_str<br>n = p * q<br>phi = (p - <span class="hljs-number">1</span>) * (q - <span class="hljs-number">1</span>)<br>t = gmpy2.gcd(e, phi)<span class="hljs-comment">#求出e和φ(n)，也就是phi的最大公约数</span><br>d = gmpy2.invert(e // t, phi)<span class="hljs-comment">#e//t就和phi没有公因子了，就是互质的了，可以求模phi的逆元了。</span><br>m = <span class="hljs-built_in">pow</span>(c, d, n)<br><span class="hljs-comment"># print(m)</span><br>msg = gmpy2.iroot(m, t)<span class="hljs-comment">#对m开t次方</span><br><span class="hljs-built_in">print</span>(msg)<br><span class="hljs-keyword">if</span> msg[<span class="hljs-number">1</span>] :<br>        dec = long_to_bytes(msg[<span class="hljs-number">0</span>]).<span class="hljs-built_in">hex</span>()<br>        input_str += dec<br><br><span class="hljs-comment">#后面每个文件单独解密后，拼接即可得到flag。</span><br></code></pre></td></tr></table></figure><p>​事先声明：这里考虑的M都是在<strong>mod n</strong>范围内的，大于等于n的M可以通过预处理后再加密。</p><p>​RSA的标准加密是<strong>c &#x3D; (M^e) mod n</strong>，e其实可以表示为<strong>e&#x2F;&#x2F;t * t</strong>（这很正常），所以<strong>c &#x3D; M ^ (e&#x2F;&#x2F;t * t) mod n</strong>，而我们求的<strong>d</strong>是<strong>e&#x2F;&#x2F;t</strong>模<strong>phi</strong>的逆元，那么 <strong>c^d &#x3D; M ^ (e&#x2F;&#x2F;t * t * d) &#x3D; M ^ (e&#x2F;&#x2F;t * d * t) mod n</strong>，而<strong>e&#x2F;&#x2F;t * d &#x3D; 1 mod phi</strong> 等价于<strong>e&#x2F;&#x2F;t * d &#x3D; k*phi + 1</strong>，所以<strong>c^d &#x3D; M ^ [(k*phi + 1)*t]  &#x3D; M^t mod n</strong>，。当然模我省略了。</p><p>​证明<strong>M ^ (k*phi+1) &#x3D; M mod n</strong>就要用到<strong>欧拉定理</strong>了，不知道的可以搜一下，<a href="https://zh.wikipedia.org/wiki/%E6%AC%A7%E6%8B%89%E5%AE%9A%E7%90%86_(%E6%95%B0%E8%AE%BA)">维基百科</a>。但是欧拉定理，只解决了消息<strong>M</strong>和大整数<strong>n</strong>互质的情况，我们的消息是多种多样的，不互质怎么办？</p><p>​不互质时，还是直接去看参考文章，数学公式还不怎么打，算了。</p><h3 id="代码解析"><a href="#代码解析" class="headerlink" title="代码解析"></a>代码解析</h3><p>​分析程序中的代码，打开IDA看到下面的函数，我们使用注释来解读代码。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/0e6feea7243d7c9dbd324b1093ad5125/image-20250710150951959.png" alt="image-20250710150951959"><p>​其中是使用链表来存储每一段数据加密后的<strong>pqec</strong>这些数据的，节点的结构如下图所示。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/0e6feea7243d7c9dbd324b1093ad5125/image-20250710152434831.png" alt="image-20250710152434831"><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> __int64 __fastcall <span class="hljs-title function_">check</span><span class="hljs-params">(<span class="hljs-type">char</span> *flag)</span><br>&#123;<br>  <span class="hljs-type">time_t</span> v1; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v2; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">void</span> *v3; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">void</span> *v4; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">void</span> *v5; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+14h] [rbp-17Ch]</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// [rsp+18h] [rbp-178h]</span><br>  <span class="hljs-type">int</span> j; <span class="hljs-comment">// [rsp+1Ch] [rbp-174h]</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// [rsp+28h] [rbp-168h]</span><br>  <span class="hljs-type">int</span> v11; <span class="hljs-comment">// [rsp+2Ch] [rbp-164h]</span><br>  _QWORD *v12; <span class="hljs-comment">// [rsp+30h] [rbp-160h]</span><br>  _QWORD *v13; <span class="hljs-comment">// [rsp+38h] [rbp-158h]</span><br>  __int64 v14; <span class="hljs-comment">// [rsp+40h] [rbp-150h]</span><br>  _QWORD *Myflag; <span class="hljs-comment">// [rsp+48h] [rbp-148h]</span><br>  _QWORD *v16; <span class="hljs-comment">// [rsp+50h] [rbp-140h]</span><br>  <span class="hljs-type">char</span> *v17; <span class="hljs-comment">// [rsp+60h] [rbp-130h]</span><br>  _QWORD *v18; <span class="hljs-comment">// [rsp+68h] [rbp-128h]//64位</span><br>  <span class="hljs-type">void</span> *s; <span class="hljs-comment">// [rsp+78h] [rbp-118h]</span><br>  <span class="hljs-type">void</span> *str; <span class="hljs-comment">// [rsp+80h] [rbp-110h]</span><br>  <span class="hljs-type">void</span> *v21; <span class="hljs-comment">// [rsp+88h] [rbp-108h]</span><br>  _BYTE v22[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+90h] [rbp-100h] BYREF</span><br>  _BYTE v23[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+A0h] [rbp-F0h] BYREF</span><br>  _BYTE v24[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+B0h] [rbp-E0h] BYREF</span><br>  _BYTE v25[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+C0h] [rbp-D0h] BYREF</span><br>  _BYTE v26[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+D0h] [rbp-C0h] BYREF</span><br>  _BYTE v27[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+E0h] [rbp-B0h] BYREF</span><br>  _BYTE v28[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+F0h] [rbp-A0h] BYREF</span><br>  _BYTE v29[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+100h] [rbp-90h] BYREF</span><br>  _BYTE v30[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+110h] [rbp-80h] BYREF</span><br>  _BYTE v31[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+120h] [rbp-70h] BYREF</span><br>  _BYTE v32[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+130h] [rbp-60h] BYREF</span><br>  _BYTE v33[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+140h] [rbp-50h] BYREF</span><br>  _BYTE v34[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+150h] [rbp-40h] BYREF</span><br>  _QWORD v35[<span class="hljs-number">3</span>]; <span class="hljs-comment">// [rsp+170h] [rbp-20h] BYREF</span><br>  <span class="hljs-type">unsigned</span> __int64 v36; <span class="hljs-comment">// [rsp+188h] [rbp-8h]</span><br><br>  v36 = __readfsqword(<span class="hljs-number">0x28u</span>);<br>  Myflag = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10u</span>LL);<br>  saveinp(Myflag, flag);<span class="hljs-comment">//进行链表存储</span><br>  __gmp_randinit_default(v34);<br>  v1 = time(<span class="hljs-number">0LL</span>);<br>  __gmp_randseed_ui(v34, v1);<span class="hljs-comment">//使用GMP初始化随机数，用当前时间作为种子，确保每次运行的随机数都不同。</span><br>  v2 = time(<span class="hljs-number">0LL</span>);<br>  srand(v2);<br>  v12 = (_QWORD *)Myflag[<span class="hljs-number">1</span>];<br>  v16 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x28u</span>LL);<span class="hljs-comment">//头节点</span><br>  v13 = v16;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">3</span>; ++i )<span class="hljs-comment">//循环处理4段数据</span><br>  &#123;<br>    v18 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x28u</span>LL);<span class="hljs-comment">//创建新节点</span><br>    v18[<span class="hljs-number">4</span>] = <span class="hljs-number">0LL</span>;<span class="hljs-comment">//指向下一个节点的next指针，初始化为0</span><br>    v13[<span class="hljs-number">4</span>] = v18;<br>    v13 = v18;<span class="hljs-comment">//v13指向当前节点</span><br>    <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>    &#123;<br>      v11 = rand() % <span class="hljs-number">65281</span> + <span class="hljs-number">256</span>;<span class="hljs-comment">//生成e</span><br>      __gmpz_init_set_ui(v22, v11);<br>      __gmpz_init(v23);<br>      __gmpz_init(v24);<br>      __gmpz_urandomb(v23, v34, <span class="hljs-number">1024LL</span>);<span class="hljs-comment">//得到一个随机1024位整数</span><br>      __gmpz_urandomb(v24, v34, <span class="hljs-number">1024LL</span>);<br>      __gmpz_nextprime(v23, v23);<span class="hljs-comment">//取整数的下一个素数，即大质数p</span><br>      __gmpz_nextprime(v24, v24);<span class="hljs-comment">//得到大质数q</span><br>      __gmpz_init(v25);<br>      __gmpz_init(v26);<br>      __gmpz_init(v27);<br>      __gmpz_sub_ui(v26, v23, <span class="hljs-number">1LL</span>);<br>      __gmpz_sub_ui(v27, v24, <span class="hljs-number">1LL</span>);<br>      __gmpz_mul(v25, v26, v27);<span class="hljs-comment">//计算欧拉函数(p-1)(q-1)</span><br>      __gmpz_init(v28);<br>      __gmpz_gcd(v28, v22, v25);<span class="hljs-comment">//计算e和欧拉函数的最大公约数t</span><br>      __gmpz_init(v29);<br>      __gmpz_divexact(v29, v22, v28);<span class="hljs-comment">//计算e//t</span><br>      __gmpz_init(v30);<br>      <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)__gmpz_invert(v30, v29, v25) )<span class="hljs-comment">//计算(e//t)关于phi的逆元，不存在返回0</span><br>      &#123;<br>        <span class="hljs-keyword">if</span> ( __gmpz_get_ui(v28) != <span class="hljs-number">1</span> )<span class="hljs-comment">//如果最大公约数t不等于1，可用，退出循环。所以问题在这，这就是e和phi不互质的原因！！！</span><br>          <span class="hljs-keyword">break</span>;<br>      &#125;<br>      __gmpz_clear(v23);<br>      __gmpz_clear(v24);<br>      __gmpz_clear(v25);<br>      __gmpz_clear(v26);<br>      __gmpz_clear(v27);<br>      __gmpz_clear(v28);<br>      __gmpz_clear(v29);<br>      __gmpz_clear(v30);<br>    &#125;<br>    __gmpz_init_set_str(v31, *v12, <span class="hljs-number">16LL</span>);<span class="hljs-comment">//输入的部分字符串转为大整数</span><br>    __gmpz_init(v32);<br>    __gmpz_mul(v32, v23, v24);  <span class="hljs-comment">//计算n=p*q</span><br>    __gmpz_init(v33);<br>    __gmpz_powm(v33, v31, v22, v32);<span class="hljs-comment">//计算c=m^e mod n</span><br>    v3 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x208u</span>LL);<br>    <span class="hljs-built_in">memset</span>(v3, <span class="hljs-number">0</span>, <span class="hljs-number">0x208u</span>LL);<br>    s = (<span class="hljs-type">void</span> *)__gmpz_get_str(<span class="hljs-number">0LL</span>, <span class="hljs-number">16LL</span>, v33);<br>    v4 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x101u</span>LL);<br>    <span class="hljs-built_in">memset</span>(v4, <span class="hljs-number">0</span>, <span class="hljs-number">0x101u</span>LL);<br>    str = (<span class="hljs-type">void</span> *)__gmpz_get_str(<span class="hljs-number">0LL</span>, <span class="hljs-number">16LL</span>, v23);<br>    v5 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x101u</span>LL);<br>    <span class="hljs-built_in">memset</span>(v5, <span class="hljs-number">0</span>, <span class="hljs-number">0x101u</span>LL);<br>    v21 = (<span class="hljs-type">void</span> *)__gmpz_get_str(<span class="hljs-number">0LL</span>, <span class="hljs-number">16LL</span>, v24);<br>    *v18 = s;<span class="hljs-comment">//密文c。</span><br>    v18[<span class="hljs-number">1</span>] = str;<span class="hljs-comment">//p，字符串形式。</span><br>    v18[<span class="hljs-number">2</span>] = v21;<span class="hljs-comment">//q，字符串形式。</span><br>    *((_DWORD *)v18 + <span class="hljs-number">6</span>) = __gmpz_get_ui(v22);<span class="hljs-comment">//等价于v18[3]=e。</span><br>    __gmpz_clear(v31);<br>    __gmpz_clear(v32);<br>    __gmpz_clear(v33);<br>    v12 = (_QWORD *)v12[<span class="hljs-number">1</span>];<br>  &#125;<br>  v14 = v16[<span class="hljs-number">4</span>];<span class="hljs-comment">//v14指向头节点的下一个节点</span><br>  qmemcpy(v35, <span class="hljs-string">&quot;IKnowYouLikeCrypto&quot;</span>, <span class="hljs-number">18</span>);<br>  v8 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">while</span> ( v14 )<br>  &#123;<br>    v17 = (<span class="hljs-type">char</span> *)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x800u</span>LL);<br>    <span class="hljs-keyword">if</span> ( !v17 )<br>    &#123;<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;malloc failed&quot;</span>);<br>      <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>    &#125;<br>    <span class="hljs-built_in">memset</span>(v17, <span class="hljs-number">0</span>, <span class="hljs-number">0x800u</span>LL);<br>    <span class="hljs-built_in">sprintf</span>(<br>      v17,<br>      <span class="hljs-string">&quot;p:0x%s q:0x%s e:%#x c:0x%s&quot;</span>,<br>      *(_QWORD *)(v14 + <span class="hljs-number">8</span>),<br>      *(_QWORD *)(v14 + <span class="hljs-number">16</span>),<br>      *(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *)(v14 + <span class="hljs-number">24</span>),<br>      *(_QWORD *)v14);<span class="hljs-comment">//将pqec存储到v17变量中去</span><br>    v10 = <span class="hljs-built_in">strlen</span>(v17);<br>    <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt; v10; ++j )<br>      v17[j] ^= *((_BYTE *)v35 + j % <span class="hljs-number">18</span>);<span class="hljs-comment">//v17加密</span><br>    write_enc_cmp_to_file(v8, (__int64)v17, v10);<span class="hljs-comment">//写入文件</span><br>    v14 = *(_QWORD *)(v14 + <span class="hljs-number">32</span>);<span class="hljs-comment">//v14=v14[4]指向下一个节点</span><br>    ++v8;<br>  &#125;<br>  <span class="hljs-keyword">return</span> __readfsqword(<span class="hljs-number">0x28u</span>) ^ v36;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> __fastcall <span class="hljs-title function_">write_enc_cmp_to_file</span><span class="hljs-params">(<span class="hljs-type">int</span> a1, __int64 a2, <span class="hljs-type">int</span> a3)</span><span class="hljs-comment">//写入文件</span><br>&#123;<br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+1Ch] [rbp-14h]</span><br>  <span class="hljs-type">void</span> *s; <span class="hljs-comment">// [rsp+20h] [rbp-10h]</span><br>  FILE *stream; <span class="hljs-comment">// [rsp+28h] [rbp-8h]</span><br><br>  s = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x20u</span>LL);<br>  <span class="hljs-built_in">memset</span>(s, <span class="hljs-number">0</span>, <span class="hljs-number">0x20u</span>LL);<br>  <span class="hljs-built_in">sprintf</span>((<span class="hljs-type">char</span> *)s, <span class="hljs-string">&quot;cmp%d.enc&quot;</span>, a1);<br>  stream = fopen((<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)s, <span class="hljs-string">&quot;w&quot;</span>);<br>  <span class="hljs-keyword">if</span> ( !stream )<br>  &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;enc file open failed&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>  &#125;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; a3; ++i )<br>    <span class="hljs-built_in">fprintf</span>(stream, <span class="hljs-string">&quot;0x%02x,&quot;</span>, *(<span class="hljs-type">unsigned</span> __int8 *)(i + a2));<br>  fclose(stream);<br>  <span class="hljs-built_in">free</span>(s);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><p>​<a href="https://www.ruanyifeng.com/blog/2013/07/rsa_algorithm_part_two.html">RSA算法原理（二）</a>，该文章的最下面一部分给出了<strong>M ^ (k*phi + 1) &#x3D; M mod n</strong>的完整证明，非常建议看看。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;​	该题设计到&lt;strong&gt;RSA&lt;/strong&gt;加密中&lt;strong&gt;e&lt;/strong&gt;和**φ(n)**不互质的情况，本文会解释R</summary>
      
    
    
    
    <category term="CTF" scheme="http://bumak.github.io/categories/CTF/"/>
    
    
    <category term="Reverse" scheme="http://bumak.github.io/tags/Reverse/"/>
    
    <category term="Crypto" scheme="http://bumak.github.io/tags/Crypto/"/>
    
  </entry>
  
  <entry>
    <title>极客大挑战2024—Part2</title>
    <link href="http://bumak.github.io/2025/07/09/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982024/WP2/"/>
    <id>http://bumak.github.io/2025/07/09/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982024/WP2/</id>
    <published>2025-07-09T07:18:37.000Z</published>
    <updated>2025-07-09T07:30:41.336Z</updated>
    
    <content type="html"><![CDATA[<h1 id="LinkedListModular"><a href="#LinkedListModular" class="headerlink" title="LinkedListModular"></a>LinkedListModular</h1><p>​这题就应该放在密码板块，后面单独出一篇文章吧。</p><blockquote><p>​公司职员发现关键数据被加密了，请帮忙解密出来，注意e和phi。flag为输入的256长度的hex字符串的md5值，并包裹flag{}提交。该题需要一些逆向基础(C实现的程序，内含链表、gmp库相关)，可与队友联合解题，也可学习些二进制基础，对以后有益。</p></blockquote><p>​还是无壳，打开IDA查看，进到<strong>check</strong>函数分析。</p><p>​<strong>saveinp</strong>分析很简单看出来，是把256位分成4个64位块，形成链表结构。</p><p>​<strong>__gmp_randinit_default</strong>函数没见过，问下AI。</p><hr><blockquote><p><code>__gmp_randinit_default</code> 是 GNU MP（GMP）库中的一个函数，用于<strong>初始化默认的伪随机数生成器（PRNG）状态对象</strong>。这个函数是 GMP 的一部分，而 GMP 是一个用于高精度整数、浮点数和有理数运算的 C&#x2F;C++ 数学库。</p><p>函数原型：void __gmp_randinit_default(gmp_randstate_t state);</p><p>初始化后，你可以使用这个状态对象来生成伪随机 GMP 整数，例如通过 <code>mpz_urandomb</code> 或 <code>mpz_urandomm</code>。</p></blockquote><p>​<strong>__gmpz_urandomb</strong>函数生成长度为n的随机大整数。</p><p>​<strong>__gmpz_nextprime</strong>用于查找一个给定数的下一个素数。</p><p>​<strong>__gmpz_sub_ui</strong>用于执行大整数减去一个无符号长整数的操作，函数原型：<code>void __gmpz_sub_ui(mpz_ptr result, mpz_srcptr op1, unsigned long int op2);</code>。</p><p>​<strong>__gmpz_mul</strong>实行大整数的乘法运算，参数1是result。</p><p>​<strong>__gmpz_gcd</strong>计算两个大整数的最大公约数。</p><p>​<strong>__gmpz_divexact</strong>用于计算两个大整数的整除，前提是被除数能够被除数整除（即没有余数），否则会报错。</p><p>​<strong>__gmpz_invert</strong>计算模逆元，参数为result、op1、op2，其中op2是模数。</p><p>​<strong>__gmpz_get_ui</strong>函数获取 <code>mpz_t</code> 类型大整数的低位无符号整数部分，返回一个 <code>unsigned long</code> 值。如果大整数超出 <code>unsigned long</code> 的范围，只返回低位部分（截断高位）。</p><p>​<strong>__gmpz_init_set_str</strong>用于初始化一个大整数变量并用字符串来设置它的值。</p><p>​<strong>__gmpz_powm</strong>用于计算大整数的<strong>模幂运算</strong>，标准接口原型：<code>void mpz_powm(mpz_t result, const mpz_t base, const mpz_t exp, const mpz_t mod);</code>。</p><p>​<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/599a91cb030cfebf68ca325e0e5b659b/image-20250707102347257.png" alt="image-20250707102347257"></p><p>​<strong>__gmpz_get_str</strong>用于将 GMP 的多精度整数（<code>mpz_t</code> 类型）转换为字符串。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/599a91cb030cfebf68ca325e0e5b659b/image-20250707102512708.png" alt="image-20250707102512708"><p>​</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//使用示例</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;gmp.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">gmp_randstate_t</span> state;<span class="hljs-comment">//定义一个 GMP 随机数生成器的“状态对象”</span><br>    <span class="hljs-type">mpz_t</span> rand_num;<span class="hljs-comment">//定义一个 GMP 多精度整数变量 rand_num，用于存储我们要作为种子的值（这里是 123456）。</span><br><br>    <span class="hljs-comment">// 初始化随机数生成器 state，使用 GMP 默认算法（通常是线性同余生成器 LCG）。</span><br>    __gmp_randinit_default(state);<br><br>    <span class="hljs-comment">// 设置种子</span><br>    mpz_init_set_ui(rand_num, <span class="hljs-number">123456</span>);<span class="hljs-comment">//初始化 rand_num 为 GMP 整数，并赋值为 123456</span><br>    gmp_randseed(state, rand_num);<span class="hljs-comment">//设置随机数生成器 state 的种子为 rand_num（即 123456）。</span><br><br>    <span class="hljs-comment">// 生成一个最大为 100 的随机数</span><br>    <span class="hljs-type">mpz_t</span> result;<br>    mpz_init(result);<span class="hljs-comment">//定义并初始化一个 GMP 多精度整数 result，用于存放生成的随机数。</span><br>    mpz_urandomm(result, state, rand_num);  <span class="hljs-comment">//使用 state 中的随机状态生成一个随机大整数 result，满足 0 &lt;= result &lt; rand_num（即小于 123456）</span><br><br>    gmp_printf(<span class="hljs-string">&quot;Random number: %Zd\n&quot;</span>, result);<br><br>    <span class="hljs-comment">// 清理内存</span><br>    mpz_clear(result);<br>    mpz_clear(rand_num);<br>    gmp_randclear(state);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>​<strong>sprintf</strong>是用来把格式化的数据写入字符串（字符数组）中，而不是直接输出到屏幕。</p><p>​<strong>fprintf</strong>是用于将格式化的数据写入指定的文件流。</p><hr><p>​WC，密码！哎呀，难办哦。数学课，数学课！</p><p>​会不了一点，加密算法都认不出来，直接看WP吧。</p><h1 id="你干嘛"><a href="#你干嘛" class="headerlink" title="你干嘛~~"></a>你干嘛~~</h1><p>​<strong>IsDebuggerPresent</strong>函数反调试直接去掉。</p><p>​下面还有一个经典的花指令，<strong>call loc</strong>时esp是指向返回地址的，36h是段寄存器前缀（SS:），不懂可以问问AI，反正单独在这里使用没啥意义。下面的[esp+10Ch+var_10C]等价于[esp]，也就是返回地址+8。我们原先的返回地址是<strong>421CBF</strong>，就变成了<strong>421CC7</strong>了。我们一路nop到返回地址就行了啊。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/599a91cb030cfebf68ca325e0e5b659b/image-20250707115035416.png" alt="image-20250707115035416"><p>​还有一个使用try catch结构来实现花指令的，try中调用报错的函数，使得进入catch板块，新知识还没学过，搜索一下。不会，学习就是学习，看WP也是学习的一部分。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/599a91cb030cfebf68ca325e0e5b659b/image-20250707121019422.png" alt="image-20250707121019422"><h3 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h3><p>​SEH机制其实和这个题关系不大，只是出现了try语句罢了，下面介绍一种能够反编译的做法，别人WP这样搞的，不知道漏信息了没有。把try模块中的代码nop掉就行，然后可以反编译了。</p><p>​一看，一堆sub，天塌了！</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/599a91cb030cfebf68ca325e0e5b659b/image-20250707174943134.png" alt="image-20250707174943134"><p>​大概分析一下，if里面是假flag啊，要用换表的base64解密。那么正确情况是进入到else块当中，就要满足两个条件：长度是16的倍数，<strong>sub_372180</strong>的返回值非0啊。</p><p>​我是有点迷了，让AI分析一下各个sub函数吧。</p><blockquote><ol><li>sub_6F1020 (输出函数)</li></ol><ul><li>功能：打印字符串到控制台</li><li>用于输出程序提示信息和结果(“wow”)</li></ul><ol start="2"><li>sub_6F1050 (输入函数)</li></ol><ul><li>功能：读取用户输入</li><li>参数：格式化字符串(“%s”)</li><li>将输入存储在Arglist变量中</li></ul><ol start="3"><li>sub_6F1290 (Base64编码函数)</li></ol><ul><li>功能：对输入进行Base64编码</li><li>特征：使用自定义编码表(byte_6F4450)</li><li>处理输入填充和分块</li></ul><ol start="4"><li>sub_6F1A50 (SM4加密核心函数)</li></ol><ul><li>功能：执行SM4加密算法</li><li>参数：输入数据、长度、轮密钥等</li><li>32轮加密运算，使用ROR4移位</li></ul><ol start="5"><li>sub_6F2180 (校验函数)</li></ol><ul><li>功能：比较加密结果与目标值</li><li>关键比较：加密后数据 vs 硬编码目标值</li><li>决定是否输出”wow”</li></ul><ol start="6"><li>sub_6F13B0&#x2F;sub_6F1530 (文件操作函数)</li></ol><ul><li>功能：处理文件操作(当校验成功时)</li><li>可能用于加载或验证附加资源</li></ul></blockquote><p>​然后我测试了一下<strong>sub_F82180</strong>函数，其两个参数都是指针类型的，所以地址一直在变，密文好像就是<strong>216cfda6b682afcc516ad1e2a93ea690</strong>，也就是赋值的那段。</p><p>​<strong>sub_C11A50</strong>函数（里面的参数含义可以调试看，分别是<strong>flag+size+key+iv+buffer</strong>）里面调用<strong>sub_C11830</strong>，这是进行轮密钥扩展的函数，可以根据特征参数判断出来是SM4加密算法的密钥扩展部分。</p><p>​再看主体，整理过部分变量命名的伪C代码。<strong>_byteswap_ulong</strong>是一个字节序转函数，对一个ulong类型（通常是32位）的字节顺序进行反转（字节交换）。<strong>_mm_xor_ps</strong>是对128位进行按位异或。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/599a91cb030cfebf68ca325e0e5b659b/image-20250708162731225.png" alt="image-20250708162731225"><p>​但实际上，不是魔改，而是CBC模式下的SM4，不熟悉ECB、CBC、CFB、OFB等密码学概念的，可以百度一下。其中<strong>v25</strong>代表的是<strong>初始化向量IV</strong>。</p><p>​我们取出<strong>Key</strong>和<strong>IV</strong>，分别是<strong>0O00O0O00OO0O0O0</strong>和<strong>1III1II111I1I1I1</strong>。</p><p>​接下来可以梭哈，得到正确的输入<strong>qwertyuiopasdfgh</strong>。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/599a91cb030cfebf68ca325e0e5b659b/image-20250708163501055.png" alt="image-20250708163501055"><p>​运行程序输入后就发现了<strong>Dusk_witnesses_devout_believers.gif</strong>被修复了，里面的一帧就有flag。<strong>SYC{111_YOU_WIN_THE_FLAG}</strong>。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/599a91cb030cfebf68ca325e0e5b659b/image-20250708163650410.png" alt="image-20250708163650410"><h1 id="贝斯！贝斯！"><a href="#贝斯！贝斯！" class="headerlink" title="贝斯！贝斯！"></a>贝斯！贝斯！</h1><p>​先附上一篇文章，<a href="https://bugwz.com/2019/11/18/basex/">Base家族</a>。</p><p>​打开IDA，看到main函数，首先知道密文是<strong>Str2</strong>，<strong>flag</strong>似乎就只有<strong>sub_401723</strong>和<strong>sub_401C6A</strong>加密，中间的不知道是什么东西。</p><p>​看到<strong>sub_401C6A</strong>函数，其中<strong>v6</strong>似乎是一个替换表，只和Key有关，那就是固定的，调试可以直接提取，不用看逻辑。问了一下AI，知道这是自定义的Base85函数，每4个输入字符转为5个输出字符。</p><p>​<strong>sub_401723</strong>函数先对flag进行对58取余操作，逆序存储在Block块中，然后通过自定义的<strong>v4</strong>表映射，也可以动调取出。</p><p>​但是简单进行base85+base58解码后，没有得到正常的flag，怎么回事？代码好像没有什么遗漏的啊。</p><p>​。。。</p><p>​看了一手wp，才发现我想得太简单了，base58表是会变的，是根据时间戳生成的。大意了，没有看<strong>sub_401550</strong>函数，里面是使用随机数来打乱表的，而且随机数种子当天都是一样的，但是每天都不一样，也就是计算出当天零点的时间戳（从“1970年1月1日 00:00:00 UTC”起，到某个时间点所经过的秒数（或毫秒、微秒））来当做随机数种子。</p><p>​<strong>time64</strong>、<strong>mktime</strong>函数的返回值都是以秒为单位的时间戳。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/599a91cb030cfebf68ca325e0e5b659b/image-20250708175551119.png" alt="image-20250708175551119"><p>​考虑到使用C语言编写的，我还不能使用python解码。烦！</p><p>​下面是配合AI写的代码，base58我还不太会处理大整数乘法，参考了一下。</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;time.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><br><span class="hljs-comment">//这种是常量字符串，不能修改</span><br><span class="hljs-type">char</span> *base85 = <span class="hljs-string">&quot;eM+wr=x8aYZ/[zU$yRB&amp;kbO;%p0P5f*7d(n]1Eug4ojc62AC,v39!h-^qQ.G?s)i:DFlS&lt;&gt;#@HINJTmtKLVWX&quot;</span>;<br><span class="hljs-comment">//这种是可以修改的字符串</span><br><span class="hljs-type">char</span> base58[] = <span class="hljs-string">&quot;123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz&quot;</span>;<br><span class="hljs-comment">//待打乱的字符串</span><br><span class="hljs-type">char</span> *base = <span class="hljs-string">&quot;123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz&quot;</span>;<br><br><span class="hljs-comment">//寻找字符下标</span><br><span class="hljs-type">uint32_t</span> <span class="hljs-title function_">find_char</span><span class="hljs-params">(<span class="hljs-type">char</span> *str, <span class="hljs-type">char</span> c)</span><br>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-built_in">strlen</span>(str); i++)<br>    &#123;<br>        <span class="hljs-keyword">if</span>(str[i] == c)<br>        &#123;<br>            <span class="hljs-keyword">return</span> (<span class="hljs-type">uint32_t</span>)i;<br>        &#125;<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Character not found\n&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">100</span>;<br>&#125;<br><br><span class="hljs-comment">//分块解码</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">base85_decode_block</span><span class="hljs-params">(<span class="hljs-type">char</span> *in, <span class="hljs-type">char</span> *out)</span><br>&#123;<br>    <span class="hljs-type">uint32_t</span> value = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">5</span>; i++)<br>    &#123;<br>        <span class="hljs-type">char</span> c = in[i];<br>        <span class="hljs-type">uint32_t</span> index = find_char(base85, c);<br>        <span class="hljs-keyword">if</span>(index == <span class="hljs-number">100</span>)<br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Invalid base85 character\n&quot;</span>);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        value = value * <span class="hljs-number">85</span> + index;<br>    &#125;<br>    out[<span class="hljs-number">0</span>] = value &gt;&gt; <span class="hljs-number">24</span>;<br>    out[<span class="hljs-number">1</span>] = value &gt;&gt; <span class="hljs-number">16</span>;<br>    out[<span class="hljs-number">2</span>] = value &gt;&gt; <span class="hljs-number">8</span>;<br>    out[<span class="hljs-number">3</span>] = value &amp; <span class="hljs-number">0xff</span>;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">base85_decode</span><span class="hljs-params">(<span class="hljs-type">char</span> *enc, <span class="hljs-type">char</span> *dec)</span><br>&#123;<br>    <span class="hljs-type">size_t</span> len = <span class="hljs-built_in">strlen</span>(enc);<br>    <span class="hljs-keyword">if</span>(len % <span class="hljs-number">5</span> != <span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Invalid base85 string length\n&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-type">size_t</span> blocks = len / <span class="hljs-number">5</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i=<span class="hljs-number">0</span>; i&lt;blocks; i++)<br>    &#123;<br>        base85_decode_block(enc + i*<span class="hljs-number">5</span>, dec + i*<span class="hljs-number">4</span>);<br>    &#125;<br>&#125;<br><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">bignum_mul58_add</span><span class="hljs-params">(<span class="hljs-type">uint8_t</span> *num, <span class="hljs-type">size_t</span> len, <span class="hljs-type">int</span> val)</span><br>&#123;<br>    <span class="hljs-comment">//num表示一个大整数</span><br>    <span class="hljs-comment">//len表示大整数的字节长度</span><br>    <span class="hljs-comment">//val是小整数</span><br>    <br>    <span class="hljs-type">int</span> carry = val;<span class="hljs-comment">//初始化进位，这里是一个字节能表示的最大值访问内的进位</span><br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=(<span class="hljs-type">int</span>)len<span class="hljs-number">-1</span>; i&lt;len; i--)<span class="hljs-comment">//从最低有效字节开始计算</span><br>    &#123;<br>        <span class="hljs-type">int</span> n = num[i] * <span class="hljs-number">58</span> + carry;<br>        num[i] = n &amp; <span class="hljs-number">0xff</span>;<br>        carry = n &gt;&gt; <span class="hljs-number">8</span>;<span class="hljs-comment">//得到高位进位</span><br>    &#125;<br>    <span class="hljs-keyword">return</span> carry;<br>&#125;<br><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">base58_decode</span><span class="hljs-params">(<span class="hljs-type">char</span> *enc, <span class="hljs-type">char</span> *dec)</span><br>&#123;<br>    <span class="hljs-type">size_t</span> len = <span class="hljs-built_in">strlen</span>(enc);<br>    <span class="hljs-type">uint8_t</span> *num = <span class="hljs-built_in">calloc</span>(len, <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">uint8_t</span>));<span class="hljs-comment">//动态分配并初始化内存</span><br>    <span class="hljs-keyword">if</span>(num == <span class="hljs-literal">NULL</span>)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Memory allocation error\n&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i=<span class="hljs-number">0</span>; i&lt;len; i++)<span class="hljs-comment">//从前往后加余数。因为编码时就是将余数从后往前排列的。</span><br>    &#123;<br>        <span class="hljs-type">int</span> index = find_char(base58, enc[i]);<br>        <span class="hljs-keyword">if</span>(index == <span class="hljs-number">100</span>)<br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Invalid base58 character\n&quot;</span>);<br>            <span class="hljs-built_in">free</span>(num);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span>(bignum_mul58_add(num, len, index) != <span class="hljs-number">0</span>)<span class="hljs-comment">//当前sum*58+index（余数）</span><br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Integer overflow\n&quot;</span>);<br>            <span class="hljs-built_in">free</span>(num);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-type">size_t</span> start = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span>(start &lt; len &amp;&amp; num[start] == <span class="hljs-number">0</span>)<br>    &#123;<br>        start++;<br>    &#125;<span class="hljs-comment">//除去前导00字节，有可能是之前填充的</span><br>    <span class="hljs-type">size_t</span> dec_len = len - start;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i=<span class="hljs-number">0</span>; i&lt;dec_len; i++)<br>    &#123;<br>        dec[i] = num[start + i];<br>    &#125;<br>    dec[dec_len] = <span class="hljs-string">&#x27;\0&#x27;</span>;<br>    <span class="hljs-built_in">free</span>(num);<br>&#125;<br><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">shuffle_base58</span><span class="hljs-params">(<span class="hljs-type">time_t</span> time)</span><span class="hljs-comment">//打乱码表，可以抄伪C代码。</span><br>&#123;<br>    srand(time);<br>    <span class="hljs-type">int</span> v4[<span class="hljs-number">60</span>];<br>    <span class="hljs-type">int</span> v6;<br>    <span class="hljs-built_in">memset</span>(v4, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">int</span>)*<span class="hljs-number">60</span>);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">58</span>; i++)<br>    &#123;<br>        <span class="hljs-keyword">do</span>&#123;<br>            v6 = rand() % <span class="hljs-number">58</span>;<br>        &#125;<span class="hljs-keyword">while</span>(v4[v6]);<br>        base58[i] = base[v6];<br>        v4[v6] = <span class="hljs-number">1</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">check</span><span class="hljs-params">(<span class="hljs-type">char</span> *flag)</span><br>&#123;<br>    <span class="hljs-keyword">if</span>(flag[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;S&#x27;</span> &amp;&amp; flag[<span class="hljs-number">1</span>] == <span class="hljs-string">&#x27;Y&#x27;</span> &amp;&amp; flag[<span class="hljs-number">2</span>] == <span class="hljs-string">&#x27;C&#x27;</span> &amp;&amp; flag[<span class="hljs-number">3</span>] == <span class="hljs-string">&#x27;&#123;&#x27;</span>)<br>    &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">char</span> *enc = <span class="hljs-string">&quot;RjB6Myu#,&gt;Bgoq&amp;u.H(nBgdIaOKJbgEYj1GR4S.w&quot;</span>;<br>    <span class="hljs-type">char</span> dec[<span class="hljs-number">100</span>];<br>    <span class="hljs-type">char</span> flag[<span class="hljs-number">1000</span>];<br>    <span class="hljs-built_in">memset</span>(dec, <span class="hljs-number">0</span>, <span class="hljs-number">100</span>);<br>    <span class="hljs-built_in">memset</span>(flag, <span class="hljs-number">0</span>, <span class="hljs-number">1000</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;开始解码Base85\n&quot;</span>);<br>    base85_decode(enc, dec);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, dec);<br>    <span class="hljs-type">int</span> start_year = <span class="hljs-number">2024</span>;<span class="hljs-comment">//根据exe文件的创建文件设置的，思路就是往前的日子爆破</span><br>    <span class="hljs-type">int</span> start_month = <span class="hljs-number">11</span>;<br>    <span class="hljs-type">int</span> start_day = <span class="hljs-number">9</span>;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tm</span> <span class="hljs-title">tm_time</span> =</span> &#123;<span class="hljs-number">0</span>&#125;;<br>    tm_time.tm_year = start_year - <span class="hljs-number">1900</span>;<span class="hljs-comment">// tm_year 是从1900年开始算</span><br>    tm_time.tm_mon = start_month - <span class="hljs-number">1</span>;<span class="hljs-comment">// tm_mon 范围是0-11，所以要减1</span><br>    tm_time.tm_mday = start_day;<span class="hljs-comment">// 天从1开始</span><br>    tm_time.tm_hour = <span class="hljs-number">0</span>;<span class="hljs-comment">// 零点0时0分0秒</span><br>    tm_time.tm_min = <span class="hljs-number">0</span>;<br>    tm_time.tm_sec = <span class="hljs-number">0</span>;<br>    <span class="hljs-type">time_t</span> time = mktime(&amp;tm_time);<span class="hljs-comment">//生成时间戳，单位s</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ok\n&quot;</span>);<span class="hljs-comment">//调试信息</span><br>    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;时间戳是：%d   &quot;</span>, (<span class="hljs-type">int</span>)time);<span class="hljs-comment">//调试信息</span><br>        shuffle_base58(time);<br>        base58_decode(dec, flag);<br>        <span class="hljs-keyword">if</span>(check(flag))&#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, flag);<span class="hljs-comment">//SYC&#123;th1s_ls_an_ez_base&#125;</span><br>            <span class="hljs-keyword">break</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">if</span>(time &gt; <span class="hljs-number">0</span>)&#123;<br>                time -= <span class="hljs-number">60</span>*<span class="hljs-number">60</span>*<span class="hljs-number">24</span>;<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Time out\n&quot;</span>);<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/599a91cb030cfebf68ca325e0e5b659b/image-20250708203026832.png" alt="image-20250708203026832"><h1 id="baby-vm"><a href="#baby-vm" class="headerlink" title="baby_vm"></a>baby_vm</h1><p>​无壳，IDA打开看到<strong>sub_1400013B4</strong>函数，机器码+opcode，经典虚拟机操作。</p><p>​但是也看不出来什么，使用python重写一遍，copy出操作码，输出提示信息看看操作步骤。</p><p>​我真的是太差劲了，python重写能搞半天，中间有小错误一直没找到，导致运行流程不对，最后终于搞好了！！！先使用python重写运行逻辑，输出关键计算，其中有个地方需要优化一下，<strong>case7</strong>的计算式可以通过<strong>德摩根定律</strong>还原成<strong>a&#x3D;a^b</strong>。</p><p>​自己写代码太容易出错了吧，小错误不断………..</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">opcode_list = [<span class="hljs-number">0x46</span>,<span class="hljs-number">0x3f</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x3c</span>,<span class="hljs-number">0x3f</span>,<span class="hljs-number">0x19</span>,<span class="hljs-number">0x3d</span>,<span class="hljs-number">0x3a</span>,<span class="hljs-number">0x3e</span>,<span class="hljs-number">0x3f</span>,<span class="hljs-number">0x53</span>,<span class="hljs-number">0x33</span>,<span class="hljs-number">0x38</span>,<span class="hljs-number">0x3f</span>,<span class="hljs-number">0x59</span>,<span class="hljs-number">0x3e</span>,<span class="hljs-number">0x39</span>,<span class="hljs-number">0x34</span>,<span class="hljs-number">0x3e</span>,<span class="hljs-number">0x3f</span>,<span class="hljs-number">0x43</span>,<span class="hljs-number">0x37</span>,<span class="hljs-number">0x38</span>,<span class="hljs-number">0x40</span>,<span class="hljs-number">0x42</span>,<span class="hljs-number">0x3c</span>,<span class="hljs-number">0x3f</span>,<span class="hljs-number">0x63</span>,<span class="hljs-number">0x3e</span>,<span class="hljs-number">0x3a</span>,<span class="hljs-number">0x37</span>,<span class="hljs-number">0x3e</span>,<span class="hljs-number">0x3f</span>,<span class="hljs-number">0x79</span>,<span class="hljs-number">0x33</span>,<span class="hljs-number">0x38</span>,<span class="hljs-number">0x3f</span>,<span class="hljs-number">0x73</span>,<span class="hljs-number">0x3e</span>,<span class="hljs-number">0x39</span>,<span class="hljs-number">0x34</span>,<span class="hljs-number">0x38</span>,<span class="hljs-number">0x40</span>,<span class="hljs-number">0x42</span>,<span class="hljs-number">0x3c</span>,<span class="hljs-number">0x43</span>,<span class="hljs-number">0x26</span>,<span class="hljs-number">0x3f</span>,<span class="hljs-number">0x31</span>,<span class="hljs-number">0x3c</span>,<span class="hljs-number">0x3f</span>,<span class="hljs-number">0x32</span>,<span class="hljs-number">0x3d</span>,<span class="hljs-number">0x41</span>,<span class="hljs-number">0x3e</span>,<span class="hljs-number">0x39</span>,<span class="hljs-number">0x44</span>,<span class="hljs-number">0x43</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>]<br>index = <span class="hljs-number">0</span><br><br>w_0 = <span class="hljs-number">0</span><br>w_1 = <span class="hljs-number">0</span><br>w_2 = <span class="hljs-number">0</span><br>w_3 = <span class="hljs-number">0</span><br>w_4 = <span class="hljs-number">0</span><br><br>b_3 = <span class="hljs-number">0</span><br><br>dword_14000B0A0 = [<span class="hljs-number">0</span>] * <span class="hljs-number">504</span><br>byte_140007000 = [<span class="hljs-number">0x0e</span>,<span class="hljs-number">0x40</span>,<span class="hljs-number">0x7e</span>,<span class="hljs-number">0x1e</span>,<span class="hljs-number">0x13</span>,<span class="hljs-number">0x34</span>,<span class="hljs-number">0x1a</span>,<span class="hljs-number">0x17</span>,<span class="hljs-number">0x6e</span>,<span class="hljs-number">0x1b</span>,<span class="hljs-number">0x1c</span>,<span class="hljs-number">0x17</span>,<span class="hljs-number">0x2e</span>,<span class="hljs-number">0x0c</span>,<span class="hljs-number">0x1a</span>,<span class="hljs-number">0x30</span>,<span class="hljs-number">0x69</span>,<span class="hljs-number">0x32</span>,<span class="hljs-number">0x26</span>,<span class="hljs-number">0x16</span>,<span class="hljs-number">0x1a</span>,<span class="hljs-number">0x15</span>,<span class="hljs-number">0x25</span>,<span class="hljs-number">0x0e</span>,<span class="hljs-number">0x1c</span>,<span class="hljs-number">0x42</span>,<span class="hljs-number">0x30</span>,<span class="hljs-number">0x32</span>,<span class="hljs-number">0x0b</span>,<span class="hljs-number">0x42</span>,<span class="hljs-number">0x79</span>,<span class="hljs-number">0x17</span>,<span class="hljs-number">0x6e</span>,<span class="hljs-number">0x42</span>,<span class="hljs-number">0x29</span>,<span class="hljs-number">0x17</span>,<span class="hljs-number">0x6e</span>,<span class="hljs-number">0x5a</span>,<span class="hljs-number">0x2d</span>,<span class="hljs-number">0x20</span>,<span class="hljs-number">0x1a</span>,<span class="hljs-number">0x16</span>,<span class="hljs-number">0x26</span>,<span class="hljs-number">0x10</span>,<span class="hljs-number">0x05</span>,<span class="hljs-number">0x15</span>,<span class="hljs-number">0x6e</span>,<span class="hljs-number">0x0d</span>,<span class="hljs-number">0x58</span>,<span class="hljs-number">0x24</span>]<br><br>flag = <span class="hljs-string">&quot;SYC&#123;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_&#125;&quot;</span><br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span> :<br>    opcode = opcode_list[index]<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;index = <span class="hljs-subst">&#123;index&#125;</span>    opcode = &#x27;<span class="hljs-subst">&#123;<span class="hljs-built_in">chr</span>(opcode)&#125;</span>&#x27;    &quot;</span>, end=<span class="hljs-string">&quot;&quot;</span>)<br>    <span class="hljs-keyword">if</span> opcode &gt;= <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;3&#x27;</span>) <span class="hljs-keyword">and</span> opcode &lt;= <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;F&#x27;</span>) :<br>        <span class="hljs-keyword">if</span> opcode == <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;3&#x27;</span>) :<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;W_0 = W_0 + W_3, <span class="hljs-subst">&#123;W_0 + W_3&#125;</span> = <span class="hljs-subst">&#123;W_0&#125;</span> + <span class="hljs-subst">&#123;W_3&#125;</span>&quot;</span>)<br>            W_0 += W_3<br>            index += <span class="hljs-number">1</span><br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">elif</span> opcode == <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;4&#x27;</span>) :<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;W_0 = W_0 - W_3, <span class="hljs-subst">&#123;W_0 - W_3&#125;</span> = <span class="hljs-subst">&#123;W_0&#125;</span> - <span class="hljs-subst">&#123;W_3&#125;</span>&quot;</span>)<br>            W_0 -= W_3<br>            index += <span class="hljs-number">1</span><br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">elif</span> opcode == <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;5&#x27;</span>) :<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;W_0 = W_0 * W_3, <span class="hljs-subst">&#123;W_0 * W_3&#125;</span> = <span class="hljs-subst">&#123;W_0&#125;</span> * <span class="hljs-subst">&#123;W_3&#125;</span>&quot;</span>)<br>            W_0 *= W_3<br>            index += <span class="hljs-number">1</span><br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">elif</span> opcode == <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;6&#x27;</span>) :<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;W_0 = W_0 / W_3, <span class="hljs-subst">&#123;W_0 / W_3&#125;</span> = <span class="hljs-subst">&#123;W_0&#125;</span> / <span class="hljs-subst">&#123;W_3&#125;</span>&quot;</span>)<br>            W_0 /= W_3<br>            index += <span class="hljs-number">1</span><br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">elif</span> opcode == <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;7&#x27;</span>) :<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;W_0 = W_0 ^ W_3, <span class="hljs-subst">&#123;W_0 ^ W_3&#125;</span> = <span class="hljs-subst">&#123;W_0&#125;</span> ^ <span class="hljs-subst">&#123;W_3&#125;</span>&quot;</span>)<br>            W_0 = W_0 ^ W_3<br>            index += <span class="hljs-number">1</span><br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">elif</span> opcode == <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;8&#x27;</span>) :<br>            <span class="hljs-keyword">if</span> b_3 &gt;= <span class="hljs-number">504</span> <span class="hljs-keyword">or</span> b_3 &lt; <span class="hljs-number">0</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;8    Invalid Index&quot;</span>, b_3)<br>                <span class="hljs-keyword">break</span><br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;dword[<span class="hljs-subst">&#123;b_3&#125;</span>] = W_0 = <span class="hljs-subst">&#123;W_0&#125;</span>&quot;</span>)<br>                dword_14000B0A0[b_3] = W_0<br>            b_3 += <span class="hljs-number">1</span><br>            index += <span class="hljs-number">1</span><br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">elif</span> opcode == <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;9&#x27;</span>) :<br>            b_3 -= <span class="hljs-number">1</span><br>            <span class="hljs-keyword">if</span> b_3 &lt; <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> b_3 &gt;= <span class="hljs-number">504</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;9    Invalid Index&quot;</span>, b_3)<br>                <span class="hljs-keyword">break</span><br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;W_0 = dword[<span class="hljs-subst">&#123;b_3&#125;</span>] = <span class="hljs-subst">&#123;dword_14000B0A0[b_3]&#125;</span>&quot;</span>)<br>                W_0 = dword_14000B0A0[b_3]<br>            index += <span class="hljs-number">1</span><br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">elif</span> opcode == <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;:&#x27;</span>) :<br>            <span class="hljs-keyword">if</span> W_1 &gt;= <span class="hljs-built_in">len</span>(flag):<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;:    Invalid Index&quot;</span>, W_1)<br>                <span class="hljs-keyword">break</span><br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;W_0 = flag[<span class="hljs-subst">&#123;W_1&#125;</span>] = <span class="hljs-subst">&#123;<span class="hljs-built_in">ord</span>(flag[W_1])&#125;</span>&quot;</span>)<br>                W_0 = <span class="hljs-built_in">ord</span>(flag[W_1])<br>            index += <span class="hljs-number">1</span><br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">elif</span> opcode == <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;;&#x27;</span>) :<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;W_0 = W_3 = <span class="hljs-subst">&#123;W_3&#125;</span>&quot;</span>)<br>            W_0 = W_3<br>            index += <span class="hljs-number">1</span><br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">elif</span> opcode == <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;&lt;&#x27;</span>) :<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;W_1 = W_0 = <span class="hljs-subst">&#123;W_0&#125;</span>&quot;</span>)<br>            W_1 = W_0<br>            index += <span class="hljs-number">1</span><br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">elif</span> opcode == <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;=&#x27;</span>) :<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;W_2 = W_0 = <span class="hljs-subst">&#123;W_0&#125;</span>&quot;</span>)<br>            W_2 = W_0<br>            index += <span class="hljs-number">1</span><br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">elif</span> opcode == <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;&gt;&#x27;</span>) :<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;W_3 = W_0 = <span class="hljs-subst">&#123;W_0&#125;</span>&quot;</span>)<br>            W_3 = W_0<br>            index += <span class="hljs-number">1</span><br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">elif</span> opcode == <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;?&#x27;</span>) :<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;W_0 = opcode_list[index+1] = <span class="hljs-subst">&#123;opcode_list[index+<span class="hljs-number">1</span>]&#125;</span>&quot;</span>)<br>            W_0 = opcode_list[index+<span class="hljs-number">1</span>]<br>            index += <span class="hljs-number">2</span><br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">elif</span> opcode == <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;@&#x27;</span>) :<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;W_0 = W_1 = <span class="hljs-subst">&#123;W_1&#125;</span>&quot;</span>)<br>            W_0 = W_1<br>            index += <span class="hljs-number">1</span><br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">elif</span> opcode == <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;A&#x27;</span>) :<br>            <span class="hljs-keyword">if</span> W_1 &gt;= <span class="hljs-built_in">len</span>(byte_140007000):<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;A    Invalid Index&quot;</span>, W_1)<br>                <span class="hljs-keyword">break</span><br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;W_0 = byte_140007000[<span class="hljs-subst">&#123;W_1&#125;</span>] = <span class="hljs-subst">&#123;byte_140007000[W_1]&#125;</span>&quot;</span>)<br>                W_0 = byte_140007000[W_1]<br>            index += <span class="hljs-number">1</span><br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">elif</span> opcode == <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;B&#x27;</span>) :<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;W_0 = W_0 + 1, <span class="hljs-subst">&#123;W_0 + <span class="hljs-number">1</span>&#125;</span> = <span class="hljs-subst">&#123;W_0&#125;</span> + 1&quot;</span>)<br>            W_0 += <span class="hljs-number">1</span><br>            index += <span class="hljs-number">1</span><br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">elif</span> opcode == <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;C&#x27;</span>) :<br>            W_2 -= <span class="hljs-number">1</span><br>            <span class="hljs-keyword">if</span> W_2 != <span class="hljs-number">0</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;--W_2=<span class="hljs-subst">&#123;W_2&#125;</span>    index = index - opcode_list[index+1] <span class="hljs-subst">&#123;index - opcode_list[index+<span class="hljs-number">1</span>]&#125;</span> = <span class="hljs-subst">&#123;index&#125;</span> - <span class="hljs-subst">&#123;opcode_list[index+<span class="hljs-number">1</span>]&#125;</span>&quot;</span>)<br>                index = index - opcode_list[index+<span class="hljs-number">1</span>]<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;index = index + 2 = <span class="hljs-subst">&#123;index + <span class="hljs-number">2</span>&#125;</span>&quot;</span>)<br>                index += <span class="hljs-number">2</span><br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">elif</span> opcode == <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;D&#x27;</span>) :<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;比较W_0和W_3是否相等&quot;</span>)<br>            <span class="hljs-keyword">if</span> W_0 != W_3:<br>                W_4 = <span class="hljs-number">1</span><br>            W_1 -= <span class="hljs-number">1</span><br>            index += <span class="hljs-number">1</span><br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">elif</span> opcode == <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;E&#x27;</span>) :<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;W_0 = opcode_list[index+1] = <span class="hljs-subst">&#123;opcode_list[index+<span class="hljs-number">1</span>]&#125;</span>&quot;</span>)<br>            W_0 = opcode_list[index+<span class="hljs-number">1</span>]<br>            index += <span class="hljs-number">2</span><br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">elif</span> opcode == <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;F&#x27;</span>) :<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;输入flag&quot;</span>)<br>            index += <span class="hljs-number">1</span><br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Invalid Opcode&quot;</span>)<br><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">break</span><br><br><span class="hljs-built_in">print</span>(W_4)<br></code></pre></td></tr></table></figure><p>​然后观察计算信息，部分如下图所示，可以看到循环加密的操作步骤，而且继续看会发现是分奇偶位的。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/599a91cb030cfebf68ca325e0e5b659b/image-20250709135141338.png" alt="image-20250709135141338"><p>​看到最后也是循环比对，很容易看出来<strong>byte</strong>数组里面是密文，加密操作都是可逆了，就只有<code>+-^</code>操作，很好写脚本。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/599a91cb030cfebf68ca325e0e5b659b/image-20250709135306361.png" alt="image-20250709135306361"><p>​解密脚本如下，后面看WP也是输出计算信息的，不过输出的是寄存器名称和汇编指令，比较好。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">enc = [<span class="hljs-number">0x0e</span>,<span class="hljs-number">0x40</span>,<span class="hljs-number">0x7e</span>,<span class="hljs-number">0x1e</span>,<span class="hljs-number">0x13</span>,<span class="hljs-number">0x34</span>,<span class="hljs-number">0x1a</span>,<span class="hljs-number">0x17</span>,<span class="hljs-number">0x6e</span>,<span class="hljs-number">0x1b</span>,<span class="hljs-number">0x1c</span>,<span class="hljs-number">0x17</span>,<span class="hljs-number">0x2e</span>,<span class="hljs-number">0x0c</span>,<span class="hljs-number">0x1a</span>,<span class="hljs-number">0x30</span>,<span class="hljs-number">0x69</span>,<span class="hljs-number">0x32</span>,<span class="hljs-number">0x26</span>,<span class="hljs-number">0x16</span>,<span class="hljs-number">0x1a</span>,<span class="hljs-number">0x15</span>,<span class="hljs-number">0x25</span>,<span class="hljs-number">0x0e</span>,<span class="hljs-number">0x1c</span>,<span class="hljs-number">0x42</span>,<span class="hljs-number">0x30</span>,<span class="hljs-number">0x32</span>,<span class="hljs-number">0x0b</span>,<span class="hljs-number">0x42</span>,<span class="hljs-number">0x79</span>,<span class="hljs-number">0x17</span>,<span class="hljs-number">0x6e</span>,<span class="hljs-number">0x42</span>,<span class="hljs-number">0x29</span>,<span class="hljs-number">0x17</span>,<span class="hljs-number">0x6e</span>,<span class="hljs-number">0x5a</span>,<span class="hljs-number">0x2d</span>,<span class="hljs-number">0x20</span>,<span class="hljs-number">0x1a</span>,<span class="hljs-number">0x16</span>,<span class="hljs-number">0x26</span>,<span class="hljs-number">0x10</span>,<span class="hljs-number">0x05</span>,<span class="hljs-number">0x15</span>,<span class="hljs-number">0x6e</span>,<span class="hljs-number">0x0d</span>,<span class="hljs-number">0x58</span>,<span class="hljs-number">0x24</span>]<br><br>case1 = [<span class="hljs-number">83</span>,<span class="hljs-number">89</span>,<span class="hljs-number">67</span>]<span class="hljs-comment">#从opcode中取出的操作数“密钥”</span><br>case2 = [<span class="hljs-number">99</span>,<span class="hljs-number">121</span>,<span class="hljs-number">115</span>]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(enc)):<br>    <span class="hljs-keyword">if</span> i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>:<br>        tmp = enc[i] ^ case1[<span class="hljs-number">2</span>]<br>        tmp = tmp + case1[<span class="hljs-number">1</span>]<br>        tmp = tmp - case1[<span class="hljs-number">0</span>]<br>    <span class="hljs-keyword">else</span>:<br>        tmp = enc[i] + case2[<span class="hljs-number">2</span>]<br>        tmp = tmp - case2[<span class="hljs-number">1</span>]<br>        tmp = tmp ^ case2[<span class="hljs-number">0</span>]<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(tmp), end=<span class="hljs-string">&#x27;&#x27;</span>)<span class="hljs-comment">#SYC&#123;VM_r3verse_I0Oks_llke_yON_@r3_pr37ty_skiLl3d!&#125;</span><br></code></pre></td></tr></table></figure><h1 id="ez-re"><a href="#ez-re" class="headerlink" title="ez_re"></a>ez_re</h1><p>​无壳，IDA打开看到main函数，反编译不了，从开头开始看，有个最简单的插入<strong>E8</strong>花指令，nop掉就可以反编译了。同时去掉反调试。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/599a91cb030cfebf68ca325e0e5b659b/image-20250709143107401.png" alt="image-20250709143107401"><p>​看到有新函数，查一下，<strong>BCryptOpenAlgorithmProvider</strong>、<strong>BCryptSetProperty</strong>、<strong>BCryptGenerateSymmetricKey</strong>是Windows加密API。使用案例如下。</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c">BCRYPT_ALG_HANDLE hAlg;<br>BCRYPT_KEY_HANDLE hKey;<br>BYTE keyData[<span class="hljs-number">16</span>] = &#123; <span class="hljs-number">0</span> &#125;; <span class="hljs-comment">// 16字节密钥，示例全0</span><br>BYTE plaintext[<span class="hljs-number">16</span>] = <span class="hljs-string">&quot;Hello, ChatGPT!&quot;</span>; <span class="hljs-comment">// 16字节明文（不包含结束符）</span><br>BYTE ciphertext[<span class="hljs-number">16</span>] = &#123; <span class="hljs-number">0</span> &#125;;<br>BYTE decrypted[<span class="hljs-number">16</span>] = &#123; <span class="hljs-number">0</span> &#125;;<br>DWORD cbResult;<br><br><span class="hljs-comment">// 1. 打开算法提供者</span><br>BCryptOpenAlgorithmProvider(&amp;hAlg, BCRYPT_AES_ALGORITHM, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>);<br><br><span class="hljs-comment">// 2. 设置链模式 CBC</span><br>BCryptSetProperty(hAlg, BCRYPT_CHAINING_MODE, (PUCHAR)BCRYPT_CHAIN_MODE_CBC, <span class="hljs-keyword">sizeof</span>(BCRYPT_CHAIN_MODE_CBC), <span class="hljs-number">0</span>);<br><br><span class="hljs-comment">// 3. 生成对称密钥</span><br>BCryptGenerateSymmetricKey(hAlg, &amp;hKey, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, keyData, <span class="hljs-keyword">sizeof</span>(keyData), <span class="hljs-number">0</span>);<br><br><span class="hljs-comment">// 4. 加密明文</span><br>BCryptEncrypt(hKey,<br>    plaintext, <span class="hljs-keyword">sizeof</span>(plaintext),<br>    <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>,        <span class="hljs-comment">// 不使用IV，这里仅示例，实际CBC需IV</span><br>    ciphertext, <span class="hljs-keyword">sizeof</span>(ciphertext),<br>    &amp;cbResult, <span class="hljs-number">0</span>);<br><br><span class="hljs-comment">// 5. 解密密文</span><br>BCryptDecrypt(hKey,<br>    ciphertext, cbResult,<br>    <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>,<br>    decrypted, <span class="hljs-keyword">sizeof</span>(decrypted),<br>    &amp;cbResult, <span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure><p>​看上去就是一个AES CBC加密，密钥和初始化向量都可以提取出来，初始化向量是硬编码写死的，密钥和函数<strong>sub_B51090</strong>有关，还不能反编译，有问题，里面还有个花指令，去一下。哎，里面密钥生成也是写死的，和时间没关系了啊…</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/599a91cb030cfebf68ca325e0e5b659b/image-20250709144818638.png" alt="image-20250709144818638"><p>​不太会用赛博厨子了，直接提取出来key和iv的16进制字节没有成功使用啊，同样的输入，加密后输出不一样。算了，看看WP是怎么回事吧。然后发现，我提取的key不对！怎么回事。</p><p>​<code>BCryptGenerateSymmetricKey(phAlgorithm, &amp;phKey, 0, 0, pbSecret, 0x10u, 0);</code>看到这句代码，这是生成对称密钥的调用。原来<strong>pbSecret</strong>才是原始密钥，我粗心了，取的是*<strong>phkey</strong>了。之后就可以快乐的取值，然后一把梭了。</p><p>​密钥是<strong>addddb082dd94dcabad5d75639eac9da</strong>、IV是<strong>633bbdfb3a2cc6ff5c0862a2cda2eab4</strong>、密文是<strong>dde04c75973314b817b61911618a60234616e21a65c35b2668f5ad30b1ee4bc6abb59ebb73954ac278efcba9be71e1a0</strong>。</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//函数原型</span><br>NTSTATUS <span class="hljs-title function_">BCryptGenerateSymmetricKey</span><span class="hljs-params">(</span><br><span class="hljs-params">  BCRYPT_ALG_HANDLE hAlgorithm,      <span class="hljs-comment">// 算法句柄</span></span><br><span class="hljs-params">  BCRYPT_KEY_HANDLE *phKey,          <span class="hljs-comment">// 输出的密钥句柄</span></span><br><span class="hljs-params">  PUCHAR             pbKeyObject,    <span class="hljs-comment">// 密钥对象缓冲区</span></span><br><span class="hljs-params">  ULONG              cbKeyObject,    <span class="hljs-comment">// 缓冲区大小</span></span><br><span class="hljs-params">  PUCHAR             pbSecret,       <span class="hljs-comment">// 密钥原始数据</span></span><br><span class="hljs-params">  ULONG              cbSecret,       <span class="hljs-comment">// 密钥长度</span></span><br><span class="hljs-params">  ULONG              dwFlags         <span class="hljs-comment">// 标志</span></span><br><span class="hljs-params">)</span>;<br></code></pre></td></tr></table></figure><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/599a91cb030cfebf68ca325e0e5b659b/image-20250709145840786.png" alt="image-20250709145840786"><p>​<strong>SYC{W0w_Y0U_fOUNdDD_TLS_AND_AeS}</strong></p><h1 id="ez-ra（暂时没有附件，没做）"><a href="#ez-ra（暂时没有附件，没做）" class="headerlink" title="ez_ra（暂时没有附件，没做）"></a>ez_ra（暂时没有附件，没做）</h1><h1 id="Math"><a href="#Math" class="headerlink" title="Math"></a>Math</h1><p>​无壳，IDA打开一看，很前面的<strong>LinkedListModular</strong>一样，用了很多这种加密函数，我看不懂一点，<strong>Crypto</strong>✌太坏了！</p><p>​放后面单独再出一篇文章吧。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/599a91cb030cfebf68ca325e0e5b659b/image-20250709151114380.png" alt="image-20250709151114380">]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;LinkedListModular&quot;&gt;&lt;a href=&quot;#LinkedListModular&quot; class=&quot;headerlink&quot; title=&quot;LinkedListModular&quot;&gt;&lt;/a&gt;LinkedListModular&lt;/h1&gt;&lt;p&gt;​		这题就应该放在</summary>
      
    
    
    
    <category term="CTF" scheme="http://bumak.github.io/categories/CTF/"/>
    
    
    <category term="Reverse" scheme="http://bumak.github.io/tags/Reverse/"/>
    
  </entry>
  
  <entry>
    <title>BaseCTF2024--Microgame</title>
    <link href="http://bumak.github.io/2025/07/08/BaseCTF/Microgame/"/>
    <id>http://bumak.github.io/2025/07/08/BaseCTF/Microgame/</id>
    <published>2025-07-08T11:27:46.000Z</published>
    <updated>2025-07-08T11:31:41.940Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Microgame"><a href="#Microgame" class="headerlink" title="Microgame"></a>Microgame</h1><p>​还是找不到坐标值。</p><p>​无限子弹找到了，浮点数，初始值16，每打一枪消耗一个子弹。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/417e1e31da1f3ac1d37af0f9d0808fbf/image-20250523201859763.png" alt="image-20250523201859763"><p>​方向表示中，NS中N是正方向，且初始值为-20到-40之间，浮点数。地图中间为0值，地上一个方块是1个单位长度。学习到这个XYZ坐标通常都是放在一起的，互相离的不远，我们先找Z坐标。</p><p>​慢慢的又找到了动态Z坐标，但是有重力模拟，无法稳定保持Z坐标，需要找到稳定的Z坐标，这是一个多重指针。这是初始的Z值，后面就可以通过搜索直接找到。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/417e1e31da1f3ac1d37af0f9d0808fbf/image-20250527175427193.png" alt="image-20250527175427193"><hr><p>太难找了，还好在52pojie上看到大佬教程！慢慢学习再说。</p><p>教程也不将怎么找XYZ坐标，我道心破碎了啊(´;ω;&#96;)。</p><p>​</p><p>找不到，先把题做了，无限子弹慢慢打也行，开无敌也行，通过改动态Z和重力置零能够进入墙体了。<code>BaseCTF&#123;y0u_4r3_7h3_k1n6_0f_fp5_g4m3s&#125;</code></p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/417e1e31da1f3ac1d37af0f9d0808fbf/image-20250528214410500.png" alt="image-20250528214410500">]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Microgame&quot;&gt;&lt;a href=&quot;#Microgame&quot; class=&quot;headerlink&quot; title=&quot;Microgame&quot;&gt;&lt;/a&gt;Microgame&lt;/h1&gt;&lt;p&gt;​	还是找不到坐标值。&lt;/p&gt;
&lt;p&gt;​	无限子弹找到了，浮点数，初始值16，每打一</summary>
      
    
    
    
    <category term="CTF" scheme="http://bumak.github.io/categories/CTF/"/>
    
    
    <category term="CE" scheme="http://bumak.github.io/tags/CE/"/>
    
    <category term="Reverse" scheme="http://bumak.github.io/tags/Reverse/"/>
    
  </entry>
  
  <entry>
    <title>初识SM4</title>
    <link href="http://bumak.github.io/2025/07/08/%E5%88%9D%E8%AF%86SM4/SM4/"/>
    <id>http://bumak.github.io/2025/07/08/%E5%88%9D%E8%AF%86SM4/SM4/</id>
    <published>2025-07-08T07:27:17.000Z</published>
    <updated>2025-07-08T12:47:10.996Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>​简单水一篇文章，别人的文章讲的很清楚了，这个就算是我的笔记吧，加深一下印象，同时记下现在的理解，让以后复习起来更加轻松一点。</p><h2 id="SM4算法"><a href="#SM4算法" class="headerlink" title="SM4算法"></a>SM4算法</h2><p>​结构同AES类似，都是32轮，分块加密，输入明文长度128位，密钥长度128位，输出也是128位字节的密文。</p><h2 id="加密变换"><a href="#加密变换" class="headerlink" title="加密变换"></a>加密变换</h2><h4 id="32轮迭代"><a href="#32轮迭代" class="headerlink" title="32轮迭代"></a>32轮迭代</h4><p>​首先，对4字（每字是32字节长度）明文进行32轮迭代，每轮迭代需要一个1字的轮密钥（由初始4字密钥经过密钥扩展得到）。迭代过程就是不断的通过轮函数F得到下一个字，**X(i+4) &#x3D; F[Xi,X(i+1),X(i+2),X(i+3),RKi]**得到，其中X代表一字明文，RK代表一字轮密钥。</p><p>​最终我们得到32个一字中间密文。</p><h4 id="一次逆序变换"><a href="#一次逆序变换" class="headerlink" title="一次逆序变换"></a>一次逆序变换</h4><p>​我们将最后得到的X32、X33、X34、X35逆序，得到最终密文（X35，X34，X33，X32），这就是整个加密变换的过程。</p><h4 id="轮函数F的构造"><a href="#轮函数F的构造" class="headerlink" title="轮函数F的构造"></a>轮函数F的构造</h4><p>​直观的可以看下面的流程图，取自别人的文章，觉得比较好，下面是文字描述。<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/607d4f05704f2361150349220f864c6a/1.jpg" alt="1"></p><p>​首先，对三个密文和一个密钥进行异或，得到一个输出字A，然后将A分为四个字节**(a,b,c,d)<strong>，再经过</strong>SM4自定义的S盒<strong>进行变换（这是非线性变换），变换方式和AES一致，每个字节转为2位16进制，前一位表示行号，后一位表示列号，得到</strong>(SBOX(a), SBOX(b), SBOX(c), SBOX(d))<strong>，组装成一个字B。然后对B分别做循环左移2位、10位、18位和24位，得到新值C、D、E、F，最后计算出</strong>Xi ^ B ^ C ^ D ^ E ^ F**得到了输出的一个字。</p><h4 id="密钥扩展算法"><a href="#密钥扩展算法" class="headerlink" title="密钥扩展算法"></a>密钥扩展算法</h4><p>​初始化密钥—— 4字原始密钥与系统参数异或，得到(K0, K1, K2, K3)。</p><p>​<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/607d4f05704f2361150349220f864c6a/image-20250708151821329.png" alt="image-20250708151821329"></p><p>​之后，<strong>与加密过程类似</strong>，对这四字进行32轮迭代，得到32个轮密钥。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/607d4f05704f2361150349220f864c6a/image-20250708151940938.png" alt="image-20250708151940938"><p>​**T’**是先进行完全一样的S盒替换，S盒相同，然后循环移位部分不一样。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/607d4f05704f2361150349220f864c6a/image-20250708152123259.png" alt="image-20250708152123259"><p>​<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/607d4f05704f2361150349220f864c6a/image-20250708152211286.png" alt="image-20250708152211286"></p><p>​最终总结的加密过程就是。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/607d4f05704f2361150349220f864c6a/image-20250708152447881.png" alt="image-20250708152447881"><h2 id="解密过程"><a href="#解密过程" class="headerlink" title="解密过程"></a>解密过程</h2><p>​SM4的解密过程与加密过程完全相同，也包括32轮迭代和一次反序变换。只是在轮迭代的时候，需要将轮密钥逆序使用。比如对(RK31,RK30,…..,RK0) ，第一轮使用RK31，第二轮使用RK30，以此类推。</p><p>​</p><h2 id="python实现"><a href="#python实现" class="headerlink" title="python实现"></a>python实现</h2><p>​AI生成的代码，可以用于验证。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span><br><br><span class="hljs-comment"># --- SM4参数 ---</span><br><br>Sbox = [<br>    <span class="hljs-number">0xd6</span>, <span class="hljs-number">0x90</span>, <span class="hljs-number">0xe9</span>, <span class="hljs-number">0xfe</span>, <span class="hljs-number">0xcc</span>, <span class="hljs-number">0xe1</span>, <span class="hljs-number">0x3d</span>, <span class="hljs-number">0xb7</span>,<br>    <span class="hljs-number">0x16</span>, <span class="hljs-number">0xb6</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0xc2</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0xfb</span>, <span class="hljs-number">0x2c</span>, <span class="hljs-number">0x05</span>,<br>    <span class="hljs-number">0x2b</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x9a</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x2a</span>, <span class="hljs-number">0xbe</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0xc3</span>,<br>    <span class="hljs-number">0xaa</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x99</span>,<br>    <span class="hljs-number">0x9c</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0xf4</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0xef</span>, <span class="hljs-number">0x98</span>, <span class="hljs-number">0x7a</span>,<br>    <span class="hljs-number">0x33</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0x0b</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0xed</span>, <span class="hljs-number">0xcf</span>, <span class="hljs-number">0xac</span>, <span class="hljs-number">0x62</span>,<br>    <span class="hljs-number">0xe4</span>, <span class="hljs-number">0xb3</span>, <span class="hljs-number">0x1c</span>, <span class="hljs-number">0xa9</span>, <span class="hljs-number">0xc9</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0xe8</span>, <span class="hljs-number">0x95</span>,<br>    <span class="hljs-number">0x80</span>, <span class="hljs-number">0xdf</span>, <span class="hljs-number">0x94</span>, <span class="hljs-number">0xfa</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0x8f</span>, <span class="hljs-number">0x3f</span>, <span class="hljs-number">0xa6</span>,<br>    <span class="hljs-number">0x47</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0xa7</span>, <span class="hljs-number">0xfc</span>, <span class="hljs-number">0xf3</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0xba</span>,<br>    <span class="hljs-number">0x83</span>, <span class="hljs-number">0x59</span>, <span class="hljs-number">0x3c</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0xe6</span>, <span class="hljs-number">0x85</span>, <span class="hljs-number">0x4f</span>, <span class="hljs-number">0xa8</span>,<br>    <span class="hljs-number">0x68</span>, <span class="hljs-number">0x6b</span>, <span class="hljs-number">0x81</span>, <span class="hljs-number">0xb2</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0xda</span>, <span class="hljs-number">0x8b</span>,<br>    <span class="hljs-number">0xf8</span>, <span class="hljs-number">0xeb</span>, <span class="hljs-number">0x0f</span>, <span class="hljs-number">0x4b</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0x9d</span>, <span class="hljs-number">0x35</span>,<br>    <span class="hljs-number">0x1e</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x0e</span>, <span class="hljs-number">0x5e</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0xd1</span>, <span class="hljs-number">0xa2</span>,<br>    <span class="hljs-number">0x25</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0x7c</span>, <span class="hljs-number">0x3b</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x87</span>,<br>    <span class="hljs-number">0xd4</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0x9f</span>, <span class="hljs-number">0xd3</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0x52</span>,<br>    <span class="hljs-number">0x4c</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0xe7</span>, <span class="hljs-number">0xa0</span>, <span class="hljs-number">0xc4</span>, <span class="hljs-number">0xc8</span>, <span class="hljs-number">0x9e</span>,<br>    <span class="hljs-number">0xea</span>, <span class="hljs-number">0xbf</span>, <span class="hljs-number">0x8a</span>, <span class="hljs-number">0xd2</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">0xc7</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0xb5</span>,<br>    <span class="hljs-number">0xa3</span>, <span class="hljs-number">0xf7</span>, <span class="hljs-number">0xf2</span>, <span class="hljs-number">0xce</span>, <span class="hljs-number">0xf9</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x15</span>, <span class="hljs-number">0xa1</span>,<br>    <span class="hljs-number">0xe0</span>, <span class="hljs-number">0xae</span>, <span class="hljs-number">0x5d</span>, <span class="hljs-number">0xa4</span>, <span class="hljs-number">0x9b</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x1a</span>, <span class="hljs-number">0x55</span>,<br>    <span class="hljs-number">0xad</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0xf5</span>, <span class="hljs-number">0x8c</span>, <span class="hljs-number">0xb1</span>, <span class="hljs-number">0xe3</span>,<br>    <span class="hljs-number">0x1d</span>, <span class="hljs-number">0xf6</span>, <span class="hljs-number">0xe2</span>, <span class="hljs-number">0x2e</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0xca</span>, <span class="hljs-number">0x60</span>,<br>    <span class="hljs-number">0xc0</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0xab</span>, <span class="hljs-number">0x0d</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x4e</span>, <span class="hljs-number">0x6f</span>,<br>    <span class="hljs-number">0xd5</span>, <span class="hljs-number">0xdb</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0xde</span>, <span class="hljs-number">0xfd</span>, <span class="hljs-number">0x8e</span>, <span class="hljs-number">0x2f</span>,<br>    <span class="hljs-number">0x03</span>, <span class="hljs-number">0xff</span>, <span class="hljs-number">0x6a</span>, <span class="hljs-number">0x72</span>, <span class="hljs-number">0x6d</span>, <span class="hljs-number">0x6c</span>, <span class="hljs-number">0x5b</span>, <span class="hljs-number">0x51</span>,<br>    <span class="hljs-number">0x8d</span>, <span class="hljs-number">0x1b</span>, <span class="hljs-number">0xaf</span>, <span class="hljs-number">0x92</span>, <span class="hljs-number">0xbb</span>, <span class="hljs-number">0xdd</span>, <span class="hljs-number">0xbc</span>, <span class="hljs-number">0x7f</span>,<br>    <span class="hljs-number">0x11</span>, <span class="hljs-number">0xd9</span>, <span class="hljs-number">0x5c</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x1f</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0x5a</span>, <span class="hljs-number">0xd8</span>,<br>    <span class="hljs-number">0x0a</span>, <span class="hljs-number">0xc1</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0xa5</span>, <span class="hljs-number">0xcd</span>, <span class="hljs-number">0x7b</span>, <span class="hljs-number">0xbd</span>,<br>    <span class="hljs-number">0x2d</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0xd0</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0xb8</span>, <span class="hljs-number">0xe5</span>, <span class="hljs-number">0xb4</span>, <span class="hljs-number">0xb0</span>,<br>    <span class="hljs-number">0x89</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0x4a</span>, <span class="hljs-number">0x0c</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x7e</span>,<br>    <span class="hljs-number">0x65</span>, <span class="hljs-number">0xb9</span>, <span class="hljs-number">0xf1</span>, <span class="hljs-number">0x09</span>, <span class="hljs-number">0xc5</span>, <span class="hljs-number">0x6e</span>, <span class="hljs-number">0xc6</span>, <span class="hljs-number">0x84</span>,<br>    <span class="hljs-number">0x18</span>, <span class="hljs-number">0xf0</span>, <span class="hljs-number">0x7d</span>, <span class="hljs-number">0xec</span>, <span class="hljs-number">0x3a</span>, <span class="hljs-number">0xdc</span>, <span class="hljs-number">0x4d</span>, <span class="hljs-number">0x20</span>,<br>    <span class="hljs-number">0x79</span>, <span class="hljs-number">0xee</span>, <span class="hljs-number">0x5f</span>, <span class="hljs-number">0x3e</span>, <span class="hljs-number">0xd7</span>, <span class="hljs-number">0xcb</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x48</span>,<br>]<br><br>FK = [<span class="hljs-number">0xa3b1bac6</span>, <span class="hljs-number">0x56aa3350</span>, <span class="hljs-number">0x677d9197</span>, <span class="hljs-number">0xb27022dc</span>]<br><br>CK = [<br>    <span class="hljs-number">0x00070e15</span>, <span class="hljs-number">0x1c232a31</span>, <span class="hljs-number">0x383f464d</span>, <span class="hljs-number">0x545b6269</span>,<br>    <span class="hljs-number">0x70777e85</span>, <span class="hljs-number">0x8c939aa1</span>, <span class="hljs-number">0xa8afb6bd</span>, <span class="hljs-number">0xc4cbd2d9</span>,<br>    <span class="hljs-number">0xe0e7eef5</span>, <span class="hljs-number">0xfc030a11</span>, <span class="hljs-number">0x181f262d</span>, <span class="hljs-number">0x343b4249</span>,<br>    <span class="hljs-number">0x50575e65</span>, <span class="hljs-number">0x6c737a81</span>, <span class="hljs-number">0x888f969d</span>, <span class="hljs-number">0xa4abb2b9</span>,<br>    <span class="hljs-number">0xc0c7ced5</span>, <span class="hljs-number">0xdce3eaf1</span>, <span class="hljs-number">0xf8ff060d</span>, <span class="hljs-number">0x141b2229</span>,<br>    <span class="hljs-number">0x30373e45</span>, <span class="hljs-number">0x4c535a61</span>, <span class="hljs-number">0x686f767d</span>, <span class="hljs-number">0x848b9299</span>,<br>    <span class="hljs-number">0xa0a7aeb5</span>, <span class="hljs-number">0xbcc3cad1</span>, <span class="hljs-number">0xd8dfe6ed</span>, <span class="hljs-number">0xf4fb0209</span>,<br>    <span class="hljs-number">0x10171e25</span>, <span class="hljs-number">0x2c333a41</span>, <span class="hljs-number">0x484f565d</span>, <span class="hljs-number">0x646b7279</span>,<br>]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_rotl</span>(<span class="hljs-params">x: <span class="hljs-built_in">int</span>, n: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    <span class="hljs-keyword">return</span> ((x &lt;&lt; n) &amp; <span class="hljs-number">0xFFFFFFFF</span>) | (x &gt;&gt; (<span class="hljs-number">32</span> - n))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_byte_sub</span>(<span class="hljs-params">a: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;字节替换，用S盒&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> (Sbox[(a &gt;&gt; <span class="hljs-number">24</span>) &amp; <span class="hljs-number">0xFF</span>] &lt;&lt; <span class="hljs-number">24</span>) | (Sbox[(a &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFF</span>] &lt;&lt; <span class="hljs-number">16</span>) | (Sbox[(a &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xFF</span>] &lt;&lt; <span class="hljs-number">8</span>) | Sbox[a &amp; <span class="hljs-number">0xFF</span>]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_tau</span>(<span class="hljs-params">a: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;非线性变换（字节替换）&quot;&quot;&quot;</span><br>    b0 = Sbox[(a &gt;&gt; <span class="hljs-number">24</span>) &amp; <span class="hljs-number">0xFF</span>]<br>    b1 = Sbox[(a &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFF</span>]<br>    b2 = Sbox[(a &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xFF</span>]<br>    b3 = Sbox[a &amp; <span class="hljs-number">0xFF</span>]<br>    <span class="hljs-keyword">return</span> (b0 &lt;&lt; <span class="hljs-number">24</span>) | (b1 &lt;&lt; <span class="hljs-number">16</span>) | (b2 &lt;&lt; <span class="hljs-number">8</span>) | b3<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_L</span>(<span class="hljs-params">B: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;线性变换L&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> B ^ _rotl(B, <span class="hljs-number">2</span>) ^ _rotl(B, <span class="hljs-number">10</span>) ^ _rotl(B, <span class="hljs-number">18</span>) ^ _rotl(B, <span class="hljs-number">24</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_L_key</span>(<span class="hljs-params">B: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;线性变换L&#x27;，用于密钥扩展&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> B ^ _rotl(B, <span class="hljs-number">13</span>) ^ _rotl(B, <span class="hljs-number">23</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_T</span>(<span class="hljs-params">x: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;轮函数T，L(τ(x))&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> _L(_tau(x))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_T_key</span>(<span class="hljs-params">x: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;轮函数T&#x27;，用于密钥扩展&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> _L_key(_tau(x))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_bytes_to_words</span>(<span class="hljs-params">b: <span class="hljs-built_in">bytes</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]:<br>    <span class="hljs-string">&quot;&quot;&quot;把16字节分成4个32位整数&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> [<span class="hljs-built_in">int</span>.from_bytes(b[i * <span class="hljs-number">4</span>:i * <span class="hljs-number">4</span> + <span class="hljs-number">4</span>], <span class="hljs-string">&#x27;big&#x27;</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>)]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_words_to_bytes</span>(<span class="hljs-params">words: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]</span>) -&gt; <span class="hljs-built_in">bytes</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;4个32位整数合成16字节&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">b&#x27;&#x27;</span>.join(w.to_bytes(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;big&#x27;</span>) <span class="hljs-keyword">for</span> w <span class="hljs-keyword">in</span> words)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_xor</span>(<span class="hljs-params">a: <span class="hljs-built_in">bytes</span>, b: <span class="hljs-built_in">bytes</span></span>) -&gt; <span class="hljs-built_in">bytes</span>:<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(x ^ y <span class="hljs-keyword">for</span> x, y <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(a, b))<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SM4</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, key: <span class="hljs-built_in">bytes</span></span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(key) != <span class="hljs-number">16</span>:<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;Key must be 16 bytes&quot;</span>)<br>        <span class="hljs-variable language_">self</span>.key = key<br>        <span class="hljs-variable language_">self</span>.rk = <span class="hljs-variable language_">self</span>._key_expand(key)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_key_expand</span>(<span class="hljs-params">self, key: <span class="hljs-built_in">bytes</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]:<br>        MK = _bytes_to_words(key)<br>        K = [MK[i] ^ FK[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>)]<br>        rk = []<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>):<br>            tmp = K[i] ^ _T_key(K[i + <span class="hljs-number">1</span>] ^ K[i + <span class="hljs-number">2</span>] ^ K[i + <span class="hljs-number">3</span>] ^ CK[i])<br>            rk.append(tmp)<br>            K.append(tmp)<br>        <span class="hljs-keyword">return</span> rk<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_crypt</span>(<span class="hljs-params">self, block: <span class="hljs-built_in">bytes</span>, decrypt: <span class="hljs-built_in">bool</span></span>) -&gt; <span class="hljs-built_in">bytes</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(block) != <span class="hljs-number">16</span>:<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;Block must be 16 bytes&quot;</span>)<br>        X = _bytes_to_words(block)<br>        rk = <span class="hljs-variable language_">self</span>.rk[::-<span class="hljs-number">1</span>] <span class="hljs-keyword">if</span> decrypt <span class="hljs-keyword">else</span> <span class="hljs-variable language_">self</span>.rk<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>):<br>            tmp = X[i] ^ _T(X[i + <span class="hljs-number">1</span>] ^ X[i + <span class="hljs-number">2</span>] ^ X[i + <span class="hljs-number">3</span>] ^ rk[i])<br>            X.append(tmp)<br>        <span class="hljs-comment"># 输出顺序是X[35], X[34], X[33], X[32]</span><br>        out = [X[<span class="hljs-number">35</span>], X[<span class="hljs-number">34</span>], X[<span class="hljs-number">33</span>], X[<span class="hljs-number">32</span>]]<br>        <span class="hljs-keyword">return</span> _words_to_bytes(out)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt_ecb</span>(<span class="hljs-params">self, plaintext: <span class="hljs-built_in">bytes</span></span>) -&gt; <span class="hljs-built_in">bytes</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(plaintext) % <span class="hljs-number">16</span> != <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;Plaintext length must be multiple of 16 bytes for no padding ECB&quot;</span>)<br>        ciphertext = <span class="hljs-string">b&#x27;&#x27;</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(plaintext), <span class="hljs-number">16</span>):<br>            ciphertext += <span class="hljs-variable language_">self</span>._crypt(plaintext[i:i+<span class="hljs-number">16</span>], <span class="hljs-literal">False</span>)<br>        <span class="hljs-keyword">return</span> ciphertext<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt_ecb</span>(<span class="hljs-params">self, ciphertext: <span class="hljs-built_in">bytes</span></span>) -&gt; <span class="hljs-built_in">bytes</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(ciphertext) % <span class="hljs-number">16</span> != <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;Ciphertext length must be multiple of 16 bytes for no padding ECB&quot;</span>)<br>        plaintext = <span class="hljs-string">b&#x27;&#x27;</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(ciphertext), <span class="hljs-number">16</span>):<br>            plaintext += <span class="hljs-variable language_">self</span>._crypt(ciphertext[i:i+<span class="hljs-number">16</span>], <span class="hljs-literal">True</span>)<br>        <span class="hljs-keyword">return</span> plaintext<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt_cbc</span>(<span class="hljs-params">self, plaintext: <span class="hljs-built_in">bytes</span>, iv: <span class="hljs-built_in">bytes</span></span>) -&gt; <span class="hljs-built_in">bytes</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(plaintext) % <span class="hljs-number">16</span> != <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;Plaintext length must be multiple of 16 bytes for no padding CBC&quot;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(iv) != <span class="hljs-number">16</span>:<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;IV must be 16 bytes&quot;</span>)<br>        ciphertext = <span class="hljs-string">b&#x27;&#x27;</span><br>        prev = iv<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(plaintext), <span class="hljs-number">16</span>):<br>            block = _xor(plaintext[i:i+<span class="hljs-number">16</span>], prev)<br>            enc_block = <span class="hljs-variable language_">self</span>._crypt(block, <span class="hljs-literal">False</span>)<br>            ciphertext += enc_block<br>            prev = enc_block<br>        <span class="hljs-keyword">return</span> ciphertext<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt_cbc</span>(<span class="hljs-params">self, ciphertext: <span class="hljs-built_in">bytes</span>, iv: <span class="hljs-built_in">bytes</span></span>) -&gt; <span class="hljs-built_in">bytes</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(ciphertext) % <span class="hljs-number">16</span> != <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;Ciphertext length must be multiple of 16 bytes for no padding CBC&quot;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(iv) != <span class="hljs-number">16</span>:<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;IV must be 16 bytes&quot;</span>)<br>        plaintext = <span class="hljs-string">b&#x27;&#x27;</span><br>        prev = iv<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(ciphertext), <span class="hljs-number">16</span>):<br>            block = ciphertext[i:i+<span class="hljs-number">16</span>]<br>            dec_block = <span class="hljs-variable language_">self</span>._crypt(block, <span class="hljs-literal">True</span>)<br>            plaintext += _xor(dec_block, prev)<br>            prev = block<br>        <span class="hljs-keyword">return</span> plaintext<br><br><br><span class="hljs-comment"># --- 测试 ---</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    key = <span class="hljs-string">b&quot;0123456789abcdeF&quot;</span>      <span class="hljs-comment"># 16字节密钥</span><br>    iv = <span class="hljs-string">b&quot;0000000000000000&quot;</span>       <span class="hljs-comment"># 16字节IV</span><br>    sm4 = SM4(key)<br><br>    plaintext = <span class="hljs-string">b&quot;hello world 1234&quot;</span>  <span class="hljs-comment"># 16字节明文（无填充必须16字节倍数）</span><br><br>    <span class="hljs-comment"># ECB加解密</span><br>    ct_ecb = sm4.encrypt_ecb(plaintext)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ECB密文(hex):&quot;</span>, ct_ecb.<span class="hljs-built_in">hex</span>())<br>    pt_ecb = sm4.decrypt_ecb(ct_ecb)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ECB解密:&quot;</span>, pt_ecb)<br><br>    <span class="hljs-comment"># CBC加解密</span><br>    ct_cbc = sm4.encrypt_cbc(plaintext, iv)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;CBC密文(hex):&quot;</span>, ct_cbc.<span class="hljs-built_in">hex</span>())<br>    pt_cbc = sm4.decrypt_cbc(ct_cbc, iv)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;CBC解密:&quot;</span>, pt_cbc)<br><br></code></pre></td></tr></table></figure><h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><p>​<a href="https://zhuanlan.zhihu.com/p/363900323">知乎</a>、<a href="https://www.cnblogs.com/kentle/p/14135865.html">博客园</a>。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;​	简单水一篇文章，别人的文章讲的很清楚了，这个就算是我的笔记吧，加深一下印象，同时记下现在的理解，让以后复习起来更加轻松一点。&lt;/p&gt;
&lt;</summary>
      
    
    
    
    <category term="CTF" scheme="http://bumak.github.io/categories/CTF/"/>
    
    
    <category term="crypto" scheme="http://bumak.github.io/tags/crypto/"/>
    
  </entry>
  
  <entry>
    <title>极客大挑战2024—Part1</title>
    <link href="http://bumak.github.io/2025/07/07/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982024/WP1/"/>
    <id>http://bumak.github.io/2025/07/07/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982024/WP1/</id>
    <published>2025-07-07T13:05:50.000Z</published>
    <updated>2025-07-08T05:37:13.701Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Hello-re"><a href="#Hello-re" class="headerlink" title="Hello_re"></a>Hello_re</h1><p>​UPX壳，修改了大写标志位，010Editor打开文件修改<code>SYC0</code>为<code>UPX0</code>即可成功使用工具脱壳。然后打开程序，很明显的密钥+下标异或加密，但是正常解密后分析密钥应该是运行时修改过了，所以动调看一下真正的密钥。</p><p>​因为有模8的操作，我们确定新密钥的前8位为所需。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/af78d0f39e337f6562dcfb2001f2d726/image-20250701150024569.png" alt="image-20250701150024569"><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">data = [<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">52</span>,<span class="hljs-number">3</span>,<span class="hljs-number">96</span>,<span class="hljs-number">47</span>,<span class="hljs-number">28</span>,<span class="hljs-number">107</span>,<span class="hljs-number">15</span>,<span class="hljs-number">9</span>,<span class="hljs-number">24</span>,<span class="hljs-number">45</span>,<span class="hljs-number">62</span>,<span class="hljs-number">60</span>,<span class="hljs-number">2</span>,<span class="hljs-number">17</span>,<span class="hljs-number">123</span>,<span class="hljs-number">39</span>,<span class="hljs-number">58</span>,<span class="hljs-number">41</span>,<span class="hljs-number">48</span>,<span class="hljs-number">96</span>,<span class="hljs-number">26</span>,<span class="hljs-number">8</span>,<span class="hljs-number">52</span>,<span class="hljs-number">63</span>,<span class="hljs-number">100</span>,<span class="hljs-number">33</span>,<span class="hljs-number">106</span>,<span class="hljs-number">122</span>,<span class="hljs-number">48</span>]<br>key = [<span class="hljs-number">83</span>, <span class="hljs-number">89</span>, <span class="hljs-number">67</span>, <span class="hljs-number">76</span>, <span class="hljs-number">79</span>, <span class="hljs-number">86</span>, <span class="hljs-number">69</span>, <span class="hljs-number">82</span>]<br>flag = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(data)):<br>    flag += <span class="hljs-built_in">chr</span>(data[i] ^ i ^ key[i%<span class="hljs-number">8</span>])<br><span class="hljs-built_in">print</span>(flag) <br><span class="hljs-comment">#SYC&#123;H3lI0_@_new_R3vers3_Ctf3r!!&#125;</span><br></code></pre></td></tr></table></figure><p>​666，原来是我的IDA识别错误（字符串识别有问题），逆序过来就是正确的KEY。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/af78d0f39e337f6562dcfb2001f2d726/image-20250701151252865.png" alt="image-20250701151252865"><h1 id="先来一道签到题"><a href="#先来一道签到题" class="headerlink" title="先来一道签到题"></a>先来一道签到题</h1><p>​给了一个<code>.s</code>后缀文件，这是用汇编语言编写的源代码文件，这是考察汇编基础了！</p><p>​很显然，奇数位异或7，偶数位减5。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs assembly">.L3:<br>    movl    -84(%rbp), %eax          ;取第i组<br>    movl    %eax, %ecx               <br>    shl     %ecx                     ;乘以2等于真正下标<br>    movzbl  (%rdi,%rcx), %eax        ;取字符，数组操作<br>    xorb    $7, %al                  <br>    movb    %al, (%rdi,%rcx)          ;更新<br>    movzbl  1(%rdi,%rcx), %eax        ;取后一位字符<br>    subb    $5, %al                    <br>    movb    %al, 1(%rdi,%rcx)       <br>    addl    $1, -84(%rbp)<br>.L2:<br>    movl    -84(%rbp), %eax<br>    imull   $2, %eax                  ;每两位一组<br>    cmpl    $36, %eax                 <br>    jl      .L3<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">data = <span class="hljs-string">&quot;TTDv^jrZu`Gg6tXfi+pZojpZSjXmbqbmt.&amp;x&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(data)):<br>    tmp = <span class="hljs-built_in">ord</span>(data[i])<br>    <span class="hljs-keyword">if</span> i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>:<br>        tmp = tmp ^ <span class="hljs-number">7</span>;<br>    <span class="hljs-keyword">else</span>:<br>        tmp = tmp + <span class="hljs-number">5</span>;<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(tmp), end=<span class="hljs-string">&quot;&quot;</span>)<br></code></pre></td></tr></table></figure><h1 id="也许你也听jay"><a href="#也许你也听jay" class="headerlink" title="也许你也听jay"></a>也许你也听jay</h1><p>​源代码的txt文本，变量名混淆过，0、o和O在混淆，不过我们又<strong>sublime</strong>配上神奇的插件<strong>Word Highlight</strong>，能够自动识别，当然也可以自己使用编辑器的<strong>寻找替换</strong>功能，换成易懂的代码。</p><p>​直接写代码。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">ENC_URL = [<span class="hljs-number">0x96</span>, <span class="hljs-number">0xa1</span>, <span class="hljs-number">0xa0</span>, <span class="hljs-number">0x9b</span>, <span class="hljs-number">0x9b</span>, <span class="hljs-number">0x5f</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0x85</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0x7d</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x8d</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0x7a</span>, <span class="hljs-number">0x81</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0x6c</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x2f</span>, <span class="hljs-number">0x6b</span>, <span class="hljs-number">0x6a</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0x3f</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0xf1</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x1f</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0xde</span>, <span class="hljs-number">0x1c</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0xd4</span>]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(ENC_URL)):<br>    ENC_URL[i] -= <span class="hljs-number">0x5D</span> - i<br>    ENC_URL[i] += <span class="hljs-number">47</span> + i + <span class="hljs-number">1</span><br>    ENC_URL[i] ^= i + <span class="hljs-number">1</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(ENC_URL[i]), end=<span class="hljs-string">&#x27;&#x27;</span>)<br><span class="hljs-comment">#https://am1re-sudo.github.io/Coisni ，后面有一些无用的字节</span><br></code></pre></td></tr></table></figure><p>​访问不存在，去找<strong>am1re-sudo</strong>的仓库，看到另一个项目**<a href="https://github.com/Am1re-sudo/Coisni.github.io">Coisni.github.io</a><strong>的</strong>index.html**文件，打开后会有音乐哦。一点点翻，发现密文、KEY和RC4关键字，那就赛博厨子一把梭哈。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/af78d0f39e337f6562dcfb2001f2d726/image-20250701155638301.png" alt="image-20250701155638301"><h1 id="让我康康你的调试"><a href="#让我康康你的调试" class="headerlink" title="让我康康你的调试"></a>让我康康你的调试</h1><p>​IDA打开，先异或0x14，再在<strong>sub_14A6</strong>函数加密，其中开头的<strong>sub_11C9</strong>函数是RC4的KSA（利用Key生成S盒），后面是PRGA（利用S盒生成密钥流）。标准RC4，密钥为字符串<strong>syclover</strong>，唯一需要注意的就是，IDA反编译的容易大小端错误，逆序一下。</p><p>​然后赛博厨子一把梭。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/af78d0f39e337f6562dcfb2001f2d726/image-20250701161018271.png" alt="image-20250701161018271"><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">DATA1 = <span class="hljs-string">&quot;A67A02C9047D5B94&quot;</span><br>DATA2 = <span class="hljs-string">&quot;7EF9680DBC980739&quot;</span><br>DATA3 = <span class="hljs-string">&quot;7104F81698BFBD08&quot;</span><br>DATA4 = <span class="hljs-string">&quot;61DB8498B686155F&quot;</span><br>enc = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(DATA1)-<span class="hljs-number">2</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">2</span>):<br>    enc += DATA1[i:i+<span class="hljs-number">2</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(DATA2)-<span class="hljs-number">2</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">2</span>):<br>    enc += DATA2[i:i+<span class="hljs-number">2</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(DATA3)-<span class="hljs-number">2</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">2</span>):<br>    enc += DATA3[i:i+<span class="hljs-number">2</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(DATA4)-<span class="hljs-number">2</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">2</span>):<br>    enc += DATA4[i:i+<span class="hljs-number">2</span>]<br><span class="hljs-built_in">print</span>(enc+<span class="hljs-string">&quot;6D&quot;</span>)<br></code></pre></td></tr></table></figure><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/af78d0f39e337f6562dcfb2001f2d726/image-20250701161059584.png" alt="image-20250701161059584"><h1 id="我勒个z3啊"><a href="#我勒个z3啊" class="headerlink" title="我勒个z3啊"></a>我勒个z3啊</h1><p>​IDA打开，看到<strong>sub_401B7B</strong>函数，是对第一次输入的约束，代码很清楚，直接写脚本。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">str2 = [<span class="hljs-number">42</span>, <span class="hljs-number">14</span>, <span class="hljs-number">14</span>, <span class="hljs-number">20</span>, <span class="hljs-number">63</span>, <span class="hljs-number">63</span>, <span class="hljs-number">63</span>, <span class="hljs-number">38</span>, <span class="hljs-number">17</span>, <span class="hljs-number">10</span>, <span class="hljs-number">21</span>, <span class="hljs-number">21</span>, <span class="hljs-number">14</span>, <span class="hljs-number">23</span>, <span class="hljs-number">16</span>, <span class="hljs-number">14</span>]<br>a0123456789abcd = <span class="hljs-string">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ?_&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(str2)):<br>    <span class="hljs-built_in">print</span>(a0123456789abcd[str2[i]], end=<span class="hljs-string">&quot;&quot;</span>)<span class="hljs-comment">#Geek___Challenge</span><br></code></pre></td></tr></table></figure><p>​看到<strong>sub_401AAC</strong>函数，里面的<strong>sub_4019EB</strong>函数，每4位一组，从0开始，第i组左移（i+1）位。</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c">__int64 __fastcall <span class="hljs-title function_">sub_4019EB</span><span class="hljs-params">(<span class="hljs-type">char</span> *Myflag2)</span><br>&#123;<br>  __int64 result; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> v2; <span class="hljs-comment">// [rsp+3h] [rbp-Dh]</span><br>  <span class="hljs-type">int</span> k; <span class="hljs-comment">// [rsp+4h] [rbp-Ch]</span><br>  <span class="hljs-type">int</span> j; <span class="hljs-comment">// [rsp+8h] [rbp-8h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+Ch] [rbp-4h]</span><br><br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">7</span>; ++i )<br>  &#123;<br>    <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; ; ++j )<br>    &#123;<br>      result = (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)j;<br>      <span class="hljs-keyword">if</span> ( j &gt;= i )<br>        <span class="hljs-keyword">break</span>;<br>      v2 = Myflag2[<span class="hljs-number">4</span> * i];<br>      <span class="hljs-keyword">for</span> ( k = <span class="hljs-number">0</span>; k &lt;= <span class="hljs-number">2</span>; ++k )<br>        Myflag2[<span class="hljs-number">4</span> * i + k] = Myflag2[<span class="hljs-number">4</span> * i + <span class="hljs-number">1</span> + k];<br>      Myflag2[<span class="hljs-number">4</span> * i + <span class="hljs-number">3</span>] = v2;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><p>​看到函数<strong>sub_40179A</strong>，考察Z3求解。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/af78d0f39e337f6562dcfb2001f2d726/image-20250701162542314.png" alt="image-20250701162542314"><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">dword_4040A0 = [<span class="hljs-number">411</span>, <span class="hljs-number">275</span>, <span class="hljs-number">393</span>, <span class="hljs-number">457</span>, <span class="hljs-number">592</span>, <span class="hljs-number">1334</span>, <span class="hljs-number">1246</span>, <span class="hljs-number">444</span>, <span class="hljs-number">1051</span>, <span class="hljs-number">1828</span>, <span class="hljs-number">1744</span>, <span class="hljs-number">1185</span>, <span class="hljs-number">1605</span>, <span class="hljs-number">1141</span>, <span class="hljs-number">1226</span>, <span class="hljs-number">1676</span>, <span class="hljs-number">997</span>, <span class="hljs-number">455</span>, <span class="hljs-number">829</span>, <span class="hljs-number">1463</span>, <span class="hljs-number">653</span>, <span class="hljs-number">580</span>, <span class="hljs-number">782</span>, <span class="hljs-number">657</span>, <span class="hljs-number">625</span>, <span class="hljs-number">769</span>, <span class="hljs-number">1119</span>, <span class="hljs-number">1135</span>, <span class="hljs-number">1303</span>, <span class="hljs-number">1054</span>, <span class="hljs-number">1062</span>, <span class="hljs-number">1205</span>]<br><br><span class="hljs-keyword">from</span> z3 <span class="hljs-keyword">import</span> *<br><br>En_flag = [Int(<span class="hljs-string">f&quot;En_flag<span class="hljs-subst">&#123;i&#125;</span>&quot;</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>)]<br><br>constraints = [And(En_flag[i] &gt;= <span class="hljs-number">0</span>, En_flag[i] &lt;= <span class="hljs-number">255</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>)]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">32</span>, <span class="hljs-number">4</span>):<br>    constraints.append(<br>        En_flag[i] + <span class="hljs-number">8</span> * En_flag[i + <span class="hljs-number">1</span>] + <span class="hljs-number">6</span> * En_flag[i + <span class="hljs-number">2</span>] + En_flag[i + <span class="hljs-number">3</span>] == dword_4040A0[i]<br>    )<br>    constraints.append(<br>        En_flag[i + <span class="hljs-number">1</span>] + <span class="hljs-number">8</span> * En_flag[i + <span class="hljs-number">2</span>] + <span class="hljs-number">6</span> * En_flag[i + <span class="hljs-number">3</span>] + En_flag[i] == dword_4040A0[i + <span class="hljs-number">1</span>]<br>    )<br>    constraints.append(<br>        En_flag[i + <span class="hljs-number">2</span>] + <span class="hljs-number">8</span> * En_flag[i + <span class="hljs-number">3</span>] + <span class="hljs-number">6</span> * En_flag[i] + En_flag[i + <span class="hljs-number">1</span>] == dword_4040A0[i + <span class="hljs-number">2</span>]<br>    )<br>    constraints.append(<br>        En_flag[i + <span class="hljs-number">3</span>] + <span class="hljs-number">8</span> * En_flag[i] + <span class="hljs-number">6</span> * En_flag[i + <span class="hljs-number">1</span>] + En_flag[i + <span class="hljs-number">2</span>] == dword_4040A0[i + <span class="hljs-number">3</span>]<br>    )<br><br>solver = Solver()<br>solver.add(constraints)<br><br><span class="hljs-comment"># 求解</span><br><span class="hljs-keyword">if</span> solver.check() == sat:<br>    model = solver.model()<br>    result = [model.evaluate(En_flag[i]).as_long() <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>)]<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;解为:&quot;</span>, result)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;无解&quot;</span>)<br>    <br>    <br><span class="hljs-comment">#解为: [23, 40, 7, 26, 29, 3, 69, 125, 111, 9, 125, 118, 99, 126, 74, 54, 112, 89, 28, 5, 25, 63, 9, 70, 111, 26, 43, 48, 58, 102, 60, 69]</span><br></code></pre></td></tr></table></figure><p>最后解<strong>sub_401AAC</strong>函数。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">Myflag2 = [<span class="hljs-number">23</span>, <span class="hljs-number">40</span>, <span class="hljs-number">7</span>, <span class="hljs-number">26</span>, <span class="hljs-number">29</span>, <span class="hljs-number">3</span>, <span class="hljs-number">69</span>, <span class="hljs-number">125</span>, <span class="hljs-number">111</span>, <span class="hljs-number">9</span>, <span class="hljs-number">125</span>, <span class="hljs-number">118</span>, <span class="hljs-number">99</span>, <span class="hljs-number">126</span>, <span class="hljs-number">74</span>, <span class="hljs-number">54</span>, <span class="hljs-number">112</span>, <span class="hljs-number">89</span>, <span class="hljs-number">28</span>, <span class="hljs-number">5</span>, <span class="hljs-number">25</span>, <span class="hljs-number">63</span>, <span class="hljs-number">9</span>, <span class="hljs-number">70</span>, <span class="hljs-number">111</span>, <span class="hljs-number">26</span>, <span class="hljs-number">43</span>, <span class="hljs-number">48</span>, <span class="hljs-number">58</span>, <span class="hljs-number">102</span>, <span class="hljs-number">60</span>, <span class="hljs-number">69</span>]<br>Myflag1 = <span class="hljs-string">&quot;Geek___Challenge&quot;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(Myflag2)-<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>):<br>    Myflag2[i] ^= <span class="hljs-built_in">ord</span>(Myflag1[(<span class="hljs-number">47</span> - i) % <span class="hljs-number">16</span>]) ^ i<br>    Myflag2[i] ^= Myflag2[(i-<span class="hljs-number">1</span>)%<span class="hljs-built_in">len</span>(Myflag2)]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(Myflag2), <span class="hljs-number">4</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(i//<span class="hljs-number">4</span>):<br>        Myflag2[i], Myflag2[i + <span class="hljs-number">1</span>], Myflag2[i + <span class="hljs-number">2</span>], Myflag2[i + <span class="hljs-number">3</span>] = Myflag2[i + <span class="hljs-number">3</span>], Myflag2[i], Myflag2[i + <span class="hljs-number">1</span>], \<br>        Myflag2[i + <span class="hljs-number">2</span>]<br><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(Myflag2)):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(Myflag2[i]), end=<span class="hljs-string">&quot;&quot;</span>)<span class="hljs-comment">#SYC&#123;Wow!!_Y0u_4r3_9o0d_At_r3$!!&#125;</span><br></code></pre></td></tr></table></figure><h1 id="ezzzz"><a href="#ezzzz" class="headerlink" title="ezzzz"></a>ezzzz</h1><p>​附件链接没了，太久远了，2024年底开的复习平台，现在已经无了。就看看别人的WP吧，好像是apk题，很纯的tea加密，java代码如下。</p><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.beans.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">int</span>[] enc=&#123;<span class="hljs-number">0xf1f186b2</span>, <span class="hljs-number">0x5a96c782</span>,<br>                <span class="hljs-number">0xe6c63a0b</span>, <span class="hljs-number">0x70b61b5c</span>,<br>                <span class="hljs-number">0xed6bf848</span>, <span class="hljs-number">0x89700d6b</span>,<br>                <span class="hljs-number">0x9381b5c</span>, <span class="hljs-number">0xcb2f24fa</span>,<br>                <span class="hljs-number">0xb1c79e79</span>, <span class="hljs-number">0x6d822d9c</span>,<br>                <span class="hljs-number">0xdcc55f76</span>, <span class="hljs-number">0xf780e75</span>,<br>                <span class="hljs-number">0xd65c4af</span>, <span class="hljs-number">0xb89084a9</span>,<br>                <span class="hljs-number">0xe978c382</span>, <span class="hljs-number">0x7a8dd810</span>,<br>                <span class="hljs-number">0x91f28df3</span>, <span class="hljs-number">0xa84dbaca</span>,<br>                <span class="hljs-number">0xb4d75f75</span>, <span class="hljs-number">0xf19af8e5</span>,<br>                <span class="hljs-number">0xb90f80fc</span>, <span class="hljs-number">0xfc10a5c3</span>,<br>                <span class="hljs-number">0xd20679fb</span>, <span class="hljs-number">0x2bc734c8</span>,<br>                <span class="hljs-number">0xccb31c92</span>, <span class="hljs-number">0x1ac52ad3</span>,<br>                <span class="hljs-number">0xe7f922b7</span>, <span class="hljs-number">0x2e24d923</span>,<br>                <span class="hljs-number">0xfb4ce9f5</span>, <span class="hljs-number">0x3548a9e5</span>,<br>                <span class="hljs-number">0x71ebc25a</span>, <span class="hljs-number">0xdf38862e</span>,<br>                <span class="hljs-number">0x10059186</span>, <span class="hljs-number">0x32750946</span>,<br>                <span class="hljs-number">0x3dd4d54c</span>, <span class="hljs-number">0x905abc36</span>,<br>                <span class="hljs-number">0xc26d5312</span>, <span class="hljs-number">0xd2cd42c0</span>,<br>                <span class="hljs-number">0x772d99e5</span>, <span class="hljs-number">0xcd4c466</span>,<br>                <span class="hljs-number">0x5c3178d6</span>, <span class="hljs-number">0x3a7ffe71</span>,<br>                <span class="hljs-number">0xada251c0</span>, <span class="hljs-number">0x70568d5a</span>,<br>                <span class="hljs-number">0x5798c292</span>, <span class="hljs-number">0x1ec0f7fc</span>,<br>                <span class="hljs-number">0x3ae9d841</span>, <span class="hljs-number">0x84607629</span>,<br>                <span class="hljs-number">0x30ca6a2d</span>, <span class="hljs-number">0xccef51d2</span>,<br>                <span class="hljs-number">0xa1a80854</span>, <span class="hljs-number">0x91b0f82d</span>,<br>                <span class="hljs-number">0x686ca347</span>, <span class="hljs-number">0x74c52d0f</span>,<br>                <span class="hljs-number">0xf26449f</span>, <span class="hljs-number">0xc28d362c</span>,<br>                <span class="hljs-number">0x86f3311b</span>, <span class="hljs-number">0x8adc4fb1</span>,<br>                <span class="hljs-number">0xa4497e34</span>, <span class="hljs-number">0xe0f0915d</span>&#125;;<br>        <span class="hljs-type">int</span>[] data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">2</span>];<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">0</span>;j&lt;<span class="hljs-number">60</span>;j+=<span class="hljs-number">2</span>)<br>        &#123;<br>            data[<span class="hljs-number">0</span>]=enc[j];<br>            data[<span class="hljs-number">1</span>]=enc[j+<span class="hljs-number">1</span>];<br>            <span class="hljs-type">int</span>[] res=Enc.encrypt(data);<br>            System.out.print((<span class="hljs-type">char</span>)res[<span class="hljs-number">0</span>]);<br>            System.out.print((<span class="hljs-type">char</span>)res[<span class="hljs-number">1</span>]);<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Enc</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">DELTA</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1640531527</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span>[] encrypt(<span class="hljs-type">int</span>[] iArr) &#123;<br><br>        <span class="hljs-type">int</span>[] iArr2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">4</span>];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i2</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i2 &lt; <span class="hljs-number">4</span>; i2++) &#123;<br>            iArr2[i2] = <span class="hljs-string">&quot;GEEK&quot;</span>.charAt(i2);<br>        &#125;<br>        <span class="hljs-type">int</span>[] iArr3=iArr;<br>        decrypt(iArr3, iArr2);<br><br>        <span class="hljs-keyword">return</span> iArr3;<br><br>    &#125;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">decrypt</span><span class="hljs-params">(<span class="hljs-type">int</span>[] iArr, <span class="hljs-type">int</span>[] iArr2)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> iArr[<span class="hljs-number">0</span>];<br>        <span class="hljs-type">int</span> <span class="hljs-variable">i2</span> <span class="hljs-operator">=</span> iArr[<span class="hljs-number">1</span>];<br>        <span class="hljs-type">int</span> <span class="hljs-variable">i3</span> <span class="hljs-operator">=</span> -<span class="hljs-number">957401312</span>; <span class="hljs-comment">// 初始化值，等于 32 * -1640531527</span><br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i4</span> <span class="hljs-operator">=</span> <span class="hljs-number">31</span>; i4 &gt;= <span class="hljs-number">0</span>; i4--) &#123; <span class="hljs-comment">// 反向迭代</span><br>            i2 -= ((((i &lt;&lt; <span class="hljs-number">4</span>) ^ (i &gt;&gt; <span class="hljs-number">5</span>)) + i) ^ (iArr2[(i3 &gt;&gt;&gt; <span class="hljs-number">11</span>) &amp; <span class="hljs-number">3</span>] + i3)) ^ (i3 + i4);<br>            i3 += <span class="hljs-number">1640531527</span>;<br>            i -= ((((i2 &lt;&lt; <span class="hljs-number">4</span>) ^ (i2 &gt;&gt; <span class="hljs-number">5</span>)) + i2) ^ (iArr2[i3 &amp; <span class="hljs-number">3</span>] + i3)) ^ (i3 + i4);<br>        &#125;<br><br>        iArr[<span class="hljs-number">0</span>] = i;<br>        iArr[<span class="hljs-number">1</span>] = i2;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="CPP-flower"><a href="#CPP-flower" class="headerlink" title="CPP_flower"></a>CPP_flower</h1><p>​IDA打开，还看不到主逻辑。通过字符串搜索到指令部分，但是无法反编译，往上面翻一点点就会发现有个<code>jnz+jz</code>的花指令，去了之后还有，慢慢去吧。</p><p>​看到一个新见的花指令形式，分析一下，<strong>A39D9C</strong>处调用函数，将返回地址<strong>A39DA1</strong>压栈，当前ESP指向。<strong>push ebp</strong>是<strong>ESP-4</strong>，并且EBP压栈，也就是在<strong>A39DA7</strong>执行完后，<code>[esp]</code>是指向EBP，而<code>[esp+4]</code>指向的是返回地址。所以返回地址被修改到了<strong>A39DB3</strong>，中间全部可以<strong>nop</strong>掉，或者把<strong>call</strong>改为<strong>jmp</strong>，然后nop掉中间的部分（不如全nop）。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs assembly">.text:00A39D9C                 call    sub_A39DA6<br>.text:00A39DA1                 call    near ptr 4B4BA82h<br>.text:00A39DA1 sub_A39D10      endp ; sp-analysis failed<br>.text:00A39DA1<br>.text:00A39DA6<br>.text:00A39DA6 ; =============== S U B R O U T I N E =======================================<br>.text:00A39DA6<br>.text:00A39DA6 ; Attributes: bp-based frame<br>.text:00A39DA6<br>.text:00A39DA6 sub_A39DA6      proc near               ; CODE XREF: sub_A39D10+8C↑p<br>.text:00A39DA6                 push    ebp<br>.text:00A39DA7                 mov     ebp, esp<br>.text:00A39DA9                 db      36h<br>.text:00A39DA9                 add     dword ptr [esp+4], 12h<br>.text:00A39DAF                 mov     esp, ebp<br>.text:00A39DB1                 pop     ebp<br>.text:00A39DB2                 retn<br>.text:00A39DB2 sub_A39DA6      endp<br>.text:00A39DB2<br>.text:00A39DB3 ; ---------------------------------------------------------------------------<br>.text:00A39DB3                 mov     esi, esp<br></code></pre></td></tr></table></figure><p>​这是一段内存初始化，以前直接忽视过去了，没搞清楚。<code>edi</code>表示内存块起始地址，<code>ecx</code>表示内存块大小，单位是<code>dword</code>，<code>eax</code>表示初始化值。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs assembly">lea     edi, [ebp+var_164]<br>.text:00A39D30                 mov     ecx, 56h<br>.text:00A39D35                 mov     eax, 0CCCCCCCCh<br>.text:00A39D3A                 rep stosd<br></code></pre></td></tr></table></figure><p>​不会了啊，栈一直平不了，反编译也不行，如下代码处。后面我问<strong>ChatGpt</strong>，为什么还没有到函数未，IDA就放弃分析了？</p><blockquote><h2 id="🧠-IDA-函数分析原理概述"><a href="#🧠-IDA-函数分析原理概述" class="headerlink" title="🧠 IDA 函数分析原理概述"></a>🧠 IDA 函数分析原理概述</h2><p>IDA 在分析函数（自动识别、跟踪、反汇编、恢复栈变量等）时，主要依赖三个核心机制：</p><h3 id="1-控制流分析（Control-Flow-Analysis）"><a href="#1-控制流分析（Control-Flow-Analysis）" class="headerlink" title="1. 控制流分析（Control Flow Analysis）"></a>1. <strong>控制流分析（Control Flow Analysis）</strong></h3><ul><li>从入口地址开始，沿着 <code>call/jmp/ret</code> 追踪所有可能执行的指令路径</li><li>构建控制流图（CFG），用于识别函数边界、代码块、调用关系</li></ul><h3 id="2-栈指针追踪（ESP-Tracking-SP-Analysis）"><a href="#2-栈指针追踪（ESP-Tracking-SP-Analysis）" class="headerlink" title="2. 栈指针追踪（ESP Tracking &#x2F; SP Analysis）"></a>2. <strong>栈指针追踪（ESP Tracking &#x2F; SP Analysis）</strong></h3><ul><li>IDA 会模拟 <code>esp</code>（或在 x64 下 <code>rsp</code>）的变化</li><li>它跟踪所有栈相关指令：<code>push/pop</code>, <code>sub/add esp</code>, <code>call</code>, <code>ret</code> 等</li><li>用于判断局部变量偏移、参数传递、返回地址位置</li></ul><h3 id="3-可达性判断（Code-Reachability）"><a href="#3-可达性判断（Code-Reachability）" class="headerlink" title="3. 可达性判断（Code Reachability）"></a>3. <strong>可达性判断（Code Reachability）</strong></h3><ul><li>如果某段指令既没有跳转到它，也不跳转出去，IDA可能判定它是“孤立代码”</li><li>比如大量 <code>nop</code>，或字节无法反汇编成合法指令，IDA就不把它算进函数</li></ul></blockquote><p>​虽然没有完全理解，但是我想到，可能是之前的花指令没改完的时候IDA分析异常后，就不分析了。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs assembly">call    sub_A314B0<br>.text:00A39D98                 mov     byte ptr [ebp+var_4], 1<br>.text:00A39D98 sub_A39D10      endp ; sp-analysis failed;就是这里无法分析下去了。<br>.text:00A39D98<br>.text:00A39D9C                 nop<br>.text:00A39D9D                 nop<br>.text:00A39D9E                 nop<br>.text:00A39D9F                 nop<br>.text:00A39DA0                 nop<br>.text:00A39DA1                 nop<br>.text:00A39DA2                 nop<br>.text:00A39DA3                 nop<br>.text:00A39DA4                 nop<br>.text:00A39DA5                 nop<br>.text:00A39DA6                 nop<br>.text:00A39DA7                 nop<br>.text:00A39DA8                 nop<br>.text:00A39DA9                 nop<br>.text:00A39DAA                 nop<br>.text:00A39DAB                 nop<br>.text:00A39DAC                 nop<br>.text:00A39DAD                 nop<br>.text:00A39DAE                 nop<br>.text:00A39DAF                 nop<br>.text:00A39DB0                 nop<br>.text:00A39DB1                 nop<br>.text:00A39DB2                 nop<br>.text:00A39DB3                 mov     esi, esp<br></code></pre></td></tr></table></figure><p>​最后我检查了一遍没花指令了，重新在<strong>sub_A39D10</strong>函数头按<strong>U</strong>键，再按<strong>C</strong>键，最后按<strong>P</strong>、<strong>F5</strong>就又可以反编译了。</p><p>​函数有点复杂，各种乱七八糟的东西，静态看不太懂。IDA反编译C++还是有点太难了，不太能看，这个时候我都建议去看汇编语句，不见得会比这个困难！</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-type">int</span> v3; <span class="hljs-comment">// eax</span><br>  __int64 Myflag; <span class="hljs-comment">// rax</span><br>  _DWORD *v5; <span class="hljs-comment">// esi</span><br>  <span class="hljs-type">int</span> v6; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// [esp-8h] [ebp-23Ch]</span><br>  _DWORD v9[<span class="hljs-number">41</span>]; <span class="hljs-comment">// [esp+2Ch] [ebp-208h] BYREF</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// [esp+104h] [ebp-130h]</span><br>  _DWORD Buf2[<span class="hljs-number">52</span>]; <span class="hljs-comment">// [esp+110h] [ebp-124h] BYREF</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+1E0h] [ebp-54h]</span><br>  _BYTE v13[<span class="hljs-number">36</span>]; <span class="hljs-comment">// [esp+1ECh] [ebp-48h] BYREF</span><br>  _BYTE v14[<span class="hljs-number">20</span>]; <span class="hljs-comment">// [esp+210h] [ebp-24h] BYREF</span><br>  <span class="hljs-type">int</span> v15; <span class="hljs-comment">// [esp+230h] [ebp-4h]</span><br>  <span class="hljs-type">int</span> savedregs; <span class="hljs-comment">// [esp+234h] [ebp+0h] BYREF</span><br><br>  sub_A31127(<span class="hljs-number">0x10u</span>);<br>  sub_A311C2(v14);<br>  v15 = <span class="hljs-number">0</span>;<br>  srand(<span class="hljs-number">0x7DE9u</span>);<br>  sub_A31519();<br>  sub_A314B0(v13);<br>  LOBYTE(v15) = <span class="hljs-number">1</span>;<br>  v3 = sub_A3138E(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span>, <span class="hljs-string">&quot;give your input:&quot;</span>);<br>  <span class="hljs-built_in">std</span>::ostream::operator&lt;&lt;(v3, sub_A31073);<br>  sub_A31519();<br>  Myflag = sub_A313F7(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cin</span>, (<span class="hljs-type">int</span>)v13);<br>  <span class="hljs-keyword">if</span> ( sub_A3181B(v13, HIDWORD(Myflag)) == dword_A46004 )<br>  &#123;<br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; dword_A46004; ++i )<br>    &#123;<br>      rand();<br>      v9[<span class="hljs-number">0</span>] = sub_A31519() % <span class="hljs-number">255</span>;<br>      sub_A312E4(v9);<br>    &#125;<br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; dword_A46004; ++i )<br>    &#123;<br>      v5 = (_DWORD *)sub_A3128A(i);<br>      v10 = *v5 ^ *(<span class="hljs-type">char</span> *)sub_A31113(i);<br>      Buf2[i] = v10;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( !j_memcmp(&amp;unk_A42C30, Buf2, <span class="hljs-number">4</span> * dword_A46004) )<br>      v6 = sub_A3138E(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span>, <span class="hljs-string">&quot;you get it&quot;</span>);<br>    <span class="hljs-keyword">else</span><br>      v6 = sub_A3138E(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span>, <span class="hljs-string">&quot;Wrong&quot;</span>);<br>    <span class="hljs-built_in">std</span>::ostream::operator&lt;&lt;(v6, sub_A31073);<br>    sub_A31519();<br>    LOBYTE(v15) = <span class="hljs-number">0</span>;<br>    sub_A31438(v13);<br>    v15 = <span class="hljs-number">-1</span>;<br>    sub_A31726(v14);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v9[<span class="hljs-number">3</span>] = <span class="hljs-number">0</span>;<br>    LOBYTE(v15) = <span class="hljs-number">0</span>;<br>    sub_A31438(v13);<br>    v15 = <span class="hljs-number">-1</span>;<br>    sub_A31726(v14);<br>  &#125;<br>  sub_A31456(&amp;savedregs, &amp;dword_A3A008, <span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">return</span> v8;<br>&#125;<br></code></pre></td></tr></table></figure><p>​开始动调，设断点也是很讲究学问的！像这种复杂的东西，而且已知<strong>check</strong>函数的地方，我们就不能从头开始一点点看，得多次调试，先从<strong>check</strong>的前一步开始看，凭借<strong>IDA</strong>动调时看变量的值来确定加密与否。</p><p>​<code>memcmp</code>里面存储我们加密flag的是<strong>Buf2</strong>变量，而前一步中<strong>Buf2</strong>和<strong>v10</strong>有关，<strong>v10</strong>是两个值异或来的，我们就看这两个异或值是多少。一看就知道，这就是一个异或加密，其中一个是我们输入的flag字符串，另一个是一个固定的key（改变输入确认这是固定的）。所以前面一堆都是系统代码，或者是无关紧要的代码。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">key1 = [<span class="hljs-number">109</span>, <span class="hljs-number">193</span>, <span class="hljs-number">168</span>, <span class="hljs-number">93</span>, <span class="hljs-number">124</span>, <span class="hljs-number">190</span>, <span class="hljs-number">80</span>, <span class="hljs-number">186</span>, <span class="hljs-number">229</span>, <span class="hljs-number">136</span>, <span class="hljs-number">81</span>, <span class="hljs-number">199</span>, <span class="hljs-number">251</span>, <span class="hljs-number">176</span>, <span class="hljs-number">24</span>, <span class="hljs-number">43</span>, <span class="hljs-number">217</span>, <span class="hljs-number">148</span>, <span class="hljs-number">82</span>, <span class="hljs-number">66</span>, <span class="hljs-number">89</span>, <span class="hljs-number">245</span>, <span class="hljs-number">248</span>, <span class="hljs-number">167</span>, <span class="hljs-number">231</span>, <span class="hljs-number">34</span>, <span class="hljs-number">173</span>, <span class="hljs-number">31</span>, <span class="hljs-number">134</span>, <span class="hljs-number">245</span>, <span class="hljs-number">249</span>, <span class="hljs-number">101</span>, <span class="hljs-number">38</span>, <span class="hljs-number">88</span>, <span class="hljs-number">52</span>, <span class="hljs-number">155</span>, <span class="hljs-number">69</span>, <span class="hljs-number">123</span>, <span class="hljs-number">134</span>, <span class="hljs-number">180</span>, <span class="hljs-number">101</span>, <span class="hljs-number">253</span>, <span class="hljs-number">104</span>, <span class="hljs-number">39</span>, <span class="hljs-number">82</span>, <span class="hljs-number">50</span>, <span class="hljs-number">129</span>, <span class="hljs-number">80</span>, <span class="hljs-number">196</span>, <span class="hljs-number">184</span>]<br>enc = [<span class="hljs-number">62</span>, <span class="hljs-number">152</span>, <span class="hljs-number">235</span>, <span class="hljs-number">38</span>, <span class="hljs-number">37</span>, <span class="hljs-number">142</span>, <span class="hljs-number">37</span>, <span class="hljs-number">229</span>, <span class="hljs-number">134</span>, <span class="hljs-number">200</span>, <span class="hljs-number">63</span>, <span class="hljs-number">152</span>, <span class="hljs-number">200</span>, <span class="hljs-number">222</span>, <span class="hljs-number">82</span>, <span class="hljs-number">68</span>, <span class="hljs-number">160</span>, <span class="hljs-number">203</span>, <span class="hljs-number">43</span>, <span class="hljs-number">42</span>, <span class="hljs-number">60</span>, <span class="hljs-number">170</span>, <span class="hljs-number">190</span>, <span class="hljs-number">203</span>, <span class="hljs-number">136</span>, <span class="hljs-number">85</span>, <span class="hljs-number">158</span>, <span class="hljs-number">109</span>, <span class="hljs-number">217</span>, <span class="hljs-number">148</span>, <span class="hljs-number">151</span>, <span class="hljs-number">28</span>, <span class="hljs-number">82</span>, <span class="hljs-number">49</span>, <span class="hljs-number">89</span>, <span class="hljs-number">254</span>, <span class="hljs-number">26</span>, <span class="hljs-number">26</span>, <span class="hljs-number">232</span>, <span class="hljs-number">208</span>, <span class="hljs-number">58</span>, <span class="hljs-number">156</span>, <span class="hljs-number">6</span>, <span class="hljs-number">94</span>, <span class="hljs-number">37</span>, <span class="hljs-number">90</span>, <span class="hljs-number">228</span>, <span class="hljs-number">34</span>, <span class="hljs-number">161</span>, <span class="hljs-number">197</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(enc)):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(enc[i] ^ key1[i]), end=<span class="hljs-string">&#x27;&#x27;</span>)<span class="hljs-comment">#SYC&#123;Y0u_c@n_3nJoy_yhe_Flow3r_anytime_and_anywhere&#125;</span><br></code></pre></td></tr></table></figure><p>​另外，<a href="https://bbs.kanxue.com/thread-279604.htm">花指令真得看这个文章</a>。</p><h1 id="DH爱喝茶"><a href="#DH爱喝茶" class="headerlink" title="DH爱喝茶"></a>DH爱喝茶</h1><p>​根据enc函数找到main函数，然后反编译不了，往上看到花指令，无敌了。</p><p>​这个花指令，<code>xor</code>会将<strong>ebx</strong>设置为0，并且设置ZF标志为1；<code>test</code>指令会执行按位与运算，<code>ebx&amp;ebx</code>，但是不影响结果，只改变标志位，由于ebx是0，所以ZF保持1。所以<code>jnz</code>不会跳转，<code>jz</code>会跳转。<code>jnz</code>开始<code>nop</code>掉吧，然后就可以反编译main函数了。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs assembly">.text:00001399                 xor     ebx, ebx<br>.text:0000139B                 test    ebx, ebx<br>.text:0000139D                 jnz     short near ptr LABEL7<br>.text:0000139F                 jz      short LABEL8<br>.text:0000139F ; ---------------------------------------------------------------------------<br>.text:000013A1 LABEL7          db 0C7h                 ; CODE XREF: .text:0000139D↑j<br>.text:000013A2 ; ---------------------------------------------------------------------------<br>.text:000013A2<br>.text:000013A2 LABEL8:                                 ; CODE XREF: .text:0000139F↑j<br>.text:000013A2                 pop     ebx<br></code></pre></td></tr></table></figure><p>​碰到一个新函数，<code>size_t strcspn(const char *str1, const char *str2);</code>，在字符串<strong>str1</strong>中找到第一个包含<strong>str2</strong>中任意字符的位置，然后返回这个位置的索引值；如果没找到，就返回<strong>str1</strong>的长度。</p><p>​enc函数是一个标准tea加密，每次加密前，对key处理， <code>Key[i] = __ROL4__(Key[i], 6);</code>， <strong>ROL4I</strong>DA Pro（反汇编工具）自动生成的伪C代码中使用的一个宏函数，用来表示<strong>对一个32位整数进行循环左移（rotate left）操作</strong>。</p><p>​其中需要注意的是，<code>+0x98765432</code>的指令容易被IDA反编译为<code>-0x6789ABCD</code>，不知道为什么，用减号就不对。</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><br><span class="hljs-type">uint32_t</span> <span class="hljs-title function_">rol32</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> value, <span class="hljs-type">int</span> shift)</span><br>&#123;<br>    <span class="hljs-keyword">return</span> (value &lt;&lt; shift) | (value &gt;&gt; (<span class="hljs-number">32</span> - shift));<br>&#125;<br><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">uint32_t</span> enc[] = &#123;<span class="hljs-number">0x1F85A965</span>,<span class="hljs-number">0xEEC063EC</span>,<span class="hljs-number">0x5BF1D0B6</span>,<span class="hljs-number">0xF2FDE7B0</span>,<span class="hljs-number">0xAA38809A</span>,<span class="hljs-number">0x670772E9</span>,<span class="hljs-number">0x360D24B9</span>,<span class="hljs-number">0xE98C688C</span>&#125;;<br>    <span class="hljs-type">uint32_t</span> key[] = &#123;<span class="hljs-number">0x56789ABC</span>,<span class="hljs-number">0x6789ABCD</span>,<span class="hljs-number">0x789ABCDE</span>,<span class="hljs-number">0x89ABCDEF</span>&#125;;<br>    <span class="hljs-type">uint32_t</span> v0,v1;<br>    <span class="hljs-type">int</span> sum,delta;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">4</span>;i++)<br>    &#123;<br>        key[i] = rol32(key[i],<span class="hljs-number">6</span>);<br>        v0 = enc[i*<span class="hljs-number">2</span>];<br>        v1 = enc[i*<span class="hljs-number">2</span>+<span class="hljs-number">1</span>];<br>        delta = (<span class="hljs-type">uint8_t</span>)(key[<span class="hljs-number">0</span>]^key[<span class="hljs-number">1</span>]) + <span class="hljs-number">0x98765432</span>;<br>        sum = delta * <span class="hljs-number">32</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">0</span>;j&lt;<span class="hljs-number">32</span>;j++)<br>        &#123;<br>            v1 -= (v0 + sum) ^ ((v0 &lt;&lt; <span class="hljs-number">4</span>) + key[<span class="hljs-number">2</span>]) ^ ((v0 &gt;&gt; <span class="hljs-number">5</span>) + key[<span class="hljs-number">3</span>]);<br>            v0 -= (v1 + sum) ^ ((v1 &lt;&lt; <span class="hljs-number">4</span>) + key[<span class="hljs-number">0</span>]) ^ ((v1 &gt;&gt; <span class="hljs-number">5</span>) + key[<span class="hljs-number">1</span>]);<br>            sum -= delta;<br>        &#125;<br>        enc[i*<span class="hljs-number">2</span>] = v0;<br>        enc[i*<span class="hljs-number">2</span>+<span class="hljs-number">1</span>] = v1;<br>    &#125;<br>    <br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">32</span>;i++)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>, *((<span class="hljs-type">char</span>*)enc + i));<span class="hljs-comment">//SYC&#123;DH_likes_flower_and_tea!!!!&#125;</span><br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="好像是python？"><a href="#好像是python？" class="headerlink" title="好像是python？"></a>好像是python？</h1><p>​文本文件，以txt格式打开，看到python字节码的反汇编结果，我刚好没学过，乘此机会好好补一下。</p><p>​推荐文章：[<a href="https://bbs.kanxue.com/thread-246683.htm">原创]死磕python字节码-手工还原python源码-软件逆向-看雪-安全社区|安全招聘|kanxue.com</a>、<a href="https://www.cnblogs.com/blili/p/11804690.html#3.6%E6%95%B0%E5%AD%A6%E8%BF%90%E7%AE%97">Python逆向（五）—— Python字节码解读 - Blili - 博客园</a>。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs assembly">  1           0 LOAD_CONST               0 (&#x27;SYC&#123;MD5(input)&#125;&#x27;)<br>              2 STORE_NAME               0 (flag)                               ;flag = &#x27;SYC&#123;MD5(input)&#125;&#x27;<br><br>  2           4 LOAD_NAME                1 (print)<br>              6 LOAD_CONST               1 (&#x27;Please input0:&#x27;)                   <br>              8 CALL_FUNCTION            1                                      ;print(&#x27;Please input0:&#x27;)<br>             10 POP_TOP<br><br>  3          12 LOAD_CONST               2 (&#x27;&#x27;)<br>             14 STORE_NAME               2 (input0)<br><br>  6          16 LOAD_CONST               3 (&lt;code object test2 at 0x00000245D4F44B30, file &quot;program.py&quot;, line 6&gt;)<br>             18 LOAD_CONST               4 (&#x27;test2&#x27;)<br>             20 MAKE_FUNCTION            0<br>             22 STORE_NAME               3 (test2)<br><br> 14          24 LOAD_CONST               5 (&lt;code object test at 0x00000245D4F44BE0, file &quot;program.py&quot;, line 14&gt;)<br>             26 LOAD_CONST               6 (&#x27;test&#x27;)<br>             28 MAKE_FUNCTION            0<br>             30 STORE_NAME               4 (test)<br><br> 28          32 LOAD_CONST               7 (13)<br>             34 STORE_NAME               5 (a)                              ;a=13<br><br> 29          36 LOAD_CONST               8 (14)<br>             38 STORE_NAME               6 (b)                              ;b=14<br><br> 30          40 LOAD_NAME                5 (a)<br>             42 LOAD_NAME                6 (b)<br>             44 LOAD_NAME                5 (a)<br>             46 BINARY_ADD <br>             48 BINARY_XOR<br>             50 STORE_NAME               7 (c)                              ;c=(a+b)^a<br><br> 31          52 LOAD_NAME                6 (b)<br>             54 LOAD_CONST               9 (100)        <br>             56 BINARY_MULTIPLY<br>             58 STORE_NAME               8 (d)                              ;d=b*100<br><br> 32          60 LOAD_NAME                5 (a)<br>             62 LOAD_NAME                6 (b)<br>             64 BINARY_XOR<br>             66 STORE_NAME               9 (e)                              ;e=a^b<br><br> 33          68 LOAD_NAME                8 (d)<br>             70 LOAD_NAME                7 (c)<br>             72 LOAD_CONST              10 (4)<br>             74 BINARY_MULTIPLY<br>             76 BINARY_SUBTRACT<br>             78 LOAD_NAME                9 (e)              <br>             80 BINARY_ADD<br>             82 LOAD_CONST              11 (1)<br>             84 BINARY_SUBTRACT<br>             86 STORE_NAME              10 (m)                               ;m=(d-(c*4))+e-1<br><br> 35          88 LOAD_NAME               10 (m)<br>             90 LOAD_CONST              12 (26)<br>             92 BINARY_MODULO<br>             94 STORE_NAME              11 (r)<br><br> 37          96 LOAD_NAME                4 (test)<br>             98 LOAD_NAME                2 (input0)<br>            100 LOAD_NAME               11 (r)<br>            102 CALL_FUNCTION            2<br>            104 STORE_NAME              12 (cipher1)<br><br> 38         106 LOAD_NAME                3 (test2)<br>            108 LOAD_NAME               12 (cipher1)<br>            110 CALL_FUNCTION            1<br>            112 STORE_NAME              13 (cipher2)<br><br> 39         114 LOAD_CONST              13 (-1)<br>            116 LOAD_CONST              14 (-36)<br>            118 LOAD_CONST              12 (26)<br>            120 LOAD_CONST              15 (-5)<br>            122 LOAD_CONST               8 (14)<br>            124 LOAD_CONST              16 (41)<br>            126 LOAD_CONST              17 (6)<br>            128 LOAD_CONST              18 (-9)<br>            130 LOAD_CONST              19 (60)<br>            132 LOAD_CONST              20 (29)<br>            134 LOAD_CONST              21 (-28)<br>            136 LOAD_CONST              22 (17)<br>            138 LOAD_CONST              23 (21)<br>            140 LOAD_CONST              24 (7)<br>            142 LOAD_CONST              25 (35)<br>            144 LOAD_CONST              26 (38)<br>            146 LOAD_CONST              12 (26)<br>            148 LOAD_CONST              27 (48)<br>            150 BUILD_LIST              18<br>            152 STORE_NAME              14 (num)<br><br> 40         154 LOAD_NAME               15 (range)<br>            156 LOAD_CONST              28 (18)<br>            158 CALL_FUNCTION            1<br>            160 GET_ITER<br>        &gt;&gt;  162 FOR_ITER                38 (to 202)<br>            164 STORE_NAME              16 (i)<br><br> 41         166 LOAD_NAME               13 (cipher2)<br>            168 LOAD_NAME               16 (i)<br>            170 BINARY_SUBSCR                                   ;索引访问<br>            172 LOAD_NAME               14 (num)<br>            174 LOAD_NAME               16 (i)<br>            176 BINARY_SUBSCR                                   ;索引访问<br>            178 COMPARE_OP               3 (!=)<br>            180 POP_JUMP_IF_FALSE      192<br><br> 42         182 LOAD_NAME                1 (print)<br>            184 LOAD_CONST              29 (&#x27;wrong!&#x27;)<br>            186 CALL_FUNCTION            1<br>            188 POP_TOP<br>            190 JUMP_ABSOLUTE          162<br><br> 44     &gt;&gt;  192 LOAD_NAME                1 (print)<br>            194 LOAD_CONST              30 (&#x27;Rrrright!&#x27;)<br>            196 CALL_FUNCTION            1<br>            198 POP_TOP<br>            200 JUMP_ABSOLUTE          162<br>        &gt;&gt;  202 LOAD_CONST              31 (None)<br>            204 RETURN_VALUE<br><br>Disassembly of &lt;code object test2 at 0x00000245D4F44B30, file &quot;program.py&quot;, line 6&gt;:<br>  7           0 LOAD_CONST               1 (&#x27;SYC&#x27;)<br>              2 STORE_FAST               1 (key)<br><br>  8           4 LOAD_CONST               2 (18)<br>              6 STORE_FAST               2 (length)<br><br>  9           8 BUILD_LIST               0<br>             10 STORE_FAST               3 (cipher)<br><br> 10          12 LOAD_GLOBAL              0 (range)<br>             14 LOAD_FAST                2 (length)<br>             16 CALL_FUNCTION            1                  ;调用后，栈顶就会是 range(length) 返回的迭代器对象<br>             18 GET_ITER                                    ;从栈中弹出迭代器对象，并准备开始迭代<br>        &gt;&gt;   20 FOR_ITER                48 (to 70)          ;从迭代器中取出下一个值，并将值推送到栈顶,如果取到的值是合法的，它会继续执行循环体,否则跳转到70<br>             22 STORE_FAST               4 (i)              ;将栈顶的值（就是 FOR_ITER 获取到的当前值）存储到局部变量 i 中<br><br> 11          24 LOAD_FAST                3 (cipher)<br>             26 LOAD_METHOD              1 (append)<br>             28 LOAD_GLOBAL              2 (ord)<br>             30 LOAD_FAST                0 (s2)<br>             32 LOAD_FAST                4 (i)<br>             34 BINARY_SUBSCR<br>             36 CALL_FUNCTION            1              ;ord(s2[i])<br>             38 LOAD_FAST                4 (i)<br>             40 BINARY_XOR                              ;ord(s2[i]) ^ i<br>             42 LOAD_GLOBAL              2 (ord)<br>             44 LOAD_FAST                1 (key)<br>             46 LOAD_FAST                4 (i)<br>             48 LOAD_CONST               3 (3)          <br>             50 BINARY_MODULO<br>             52 BINARY_SUBSCR<br>             54 CALL_FUNCTION            1              ;ord(key[i%3])<br>             56 UNARY_INVERT                            ;执行一元取反（bitwise NOT）操作，~ord(key[i%3])<br>             58 LOAD_CONST               4 (1)<br>             60 BINARY_ADD                              ;~ord(key[i%3])+1<br>             62 BINARY_ADD                              ;ord(s2[i]) ^ i + (~ord(key[i%3])+1)<br>             64 CALL_METHOD              1<br>             66 POP_TOP<br>             68 JUMP_ABSOLUTE           20<br><br> 12     &gt;&gt;   70 LOAD_FAST                3 (cipher)<br>             72 RETURN_VALUE<br><br>Disassembly of &lt;code object test at 0x00000245D4F44BE0, file &quot;program.py&quot;, line 14&gt;:<br> 15           0 BUILD_LIST               0<br>              2 STORE_FAST               2 (result)                            ;result=[]<br><br> 16           4 LOAD_FAST                0 (s)<br>              6 GET_ITER<br>        &gt;&gt;    8 FOR_ITER               218 (to 228) <br>             10 STORE_FAST               3 (i)                                  ;for i in s:<br><br> 17          12 LOAD_CONST               1 (&#x27;A&#x27;)<br>             14 LOAD_FAST                3 (i)<br>             16 DUP_TOP                                                 ;取栈顶变量复制一份再压入，栈顶元素变两份<br>             18 ROT_THREE                                               ;当前栈顶的三个元素旋转一下，例如当前[&#x27;A&#x27;,i,i]变成[i,&#x27;A&#x27;,i]，这样做是为了适配后面的判断语句<br>             20 COMPARE_OP               1 (&lt;=)                                ;     i &gt;= &#x27;A&#x27;<br>             22 POP_JUMP_IF_FALSE       32<br>             24 LOAD_CONST               2 (&#x27;Z&#x27;) <br>             26 COMPARE_OP               1 (&lt;=)                                    ; i &lt;= &#x27;Z&#x27;<br>             28 POP_JUMP_IF_FALSE       80<br>             30 JUMP_FORWARD             4 (to 36)<br>        &gt;&gt;   32 POP_TOP<br>             34 JUMP_FORWARD            44 (to 80)<br><br> 18     &gt;&gt;   36 LOAD_FAST                2 (result)<br>             38 LOAD_METHOD              0 (append)<br>             40 LOAD_GLOBAL              1 (chr)<br>             42 LOAD_GLOBAL              2 (ord)<br>             44 LOAD_FAST                3 (i)<br>             46 CALL_FUNCTION            1<br>             48 LOAD_GLOBAL              2 (ord)<br>             50 LOAD_CONST               1 (&#x27;A&#x27;)<br>             52 CALL_FUNCTION            1<br>             54 BINARY_SUBTRACT<br>             56 LOAD_FAST                1 (R)<br>             58 BINARY_ADD<br>             60 LOAD_CONST               3 (26)<br>             62 BINARY_MODULO<br>             64 LOAD_GLOBAL              2 (ord)<br>             66 LOAD_CONST               1 (&#x27;A&#x27;)<br>             68 CALL_FUNCTION            1<br>             70 BINARY_ADD<br>             72 CALL_FUNCTION            1<br>             74 CALL_METHOD              1<br>             76 POP_TOP<br>             78 JUMP_ABSOLUTE            8<br><br> 19     &gt;&gt;   80 LOAD_CONST               4 (&#x27;a&#x27;)<br>             82 LOAD_FAST                3 (i)<br>             84 DUP_TOP<br>             86 ROT_THREE<br>             88 COMPARE_OP               1 (&lt;=)<br>             90 POP_JUMP_IF_FALSE      100<br>             92 LOAD_CONST               5 (&#x27;z&#x27;)<br>             94 COMPARE_OP               1 (&lt;=)<br>             96 POP_JUMP_IF_FALSE      148<br>             98 JUMP_FORWARD             4 (to 104)<br>        &gt;&gt;  100 POP_TOP<br>            102 JUMP_FORWARD            44 (to 148)<br><br> 20     &gt;&gt;  104 LOAD_FAST                2 (result)<br>            106 LOAD_METHOD              0 (append)<br>            108 LOAD_GLOBAL              1 (chr)<br>            110 LOAD_GLOBAL              2 (ord)<br>            112 LOAD_FAST                3 (i)<br>            114 CALL_FUNCTION            1<br>            116 LOAD_GLOBAL              2 (ord)<br>            118 LOAD_CONST               4 (&#x27;a&#x27;)<br>            120 CALL_FUNCTION            1<br>            122 BINARY_SUBTRACT<br>            124 LOAD_FAST                1 (R)<br>            126 BINARY_ADD<br>            128 LOAD_CONST               3 (26)<br>            130 BINARY_MODULO<br>            132 LOAD_GLOBAL              2 (ord)<br>            134 LOAD_CONST               4 (&#x27;a&#x27;)<br>            136 CALL_FUNCTION            1<br>            138 BINARY_ADD<br>            140 CALL_FUNCTION            1<br>            142 CALL_METHOD              1<br>            144 POP_TOP<br>            146 JUMP_ABSOLUTE            8<br><br> 21     &gt;&gt;  148 LOAD_CONST               6 (&#x27;0&#x27;)<br>            150 LOAD_FAST                3 (i)<br>            152 DUP_TOP<br>            154 ROT_THREE<br>            156 COMPARE_OP               1 (&lt;=)<br>            158 POP_JUMP_IF_FALSE      168<br>            160 LOAD_CONST               7 (&#x27;9&#x27;)<br>            162 COMPARE_OP               1 (&lt;=)<br>            164 POP_JUMP_IF_FALSE      216<br>            166 JUMP_FORWARD             4 (to 172)<br>        &gt;&gt;  168 POP_TOP<br>            170 JUMP_FORWARD            44 (to 216)<br><br> 22     &gt;&gt;  172 LOAD_FAST                2 (result)<br>            174 LOAD_METHOD              0 (append)<br>            176 LOAD_GLOBAL              1 (chr)<br>            178 LOAD_GLOBAL              2 (ord)<br>            180 LOAD_FAST                3 (i)<br>            182 CALL_FUNCTION            1<br>            184 LOAD_GLOBAL              2 (ord)<br>            186 LOAD_CONST               6 (&#x27;0&#x27;)<br>            188 CALL_FUNCTION            1<br>            190 BINARY_SUBTRACT<br>            192 LOAD_FAST                1 (R)<br>            194 BINARY_ADD<br>            196 LOAD_CONST               8 (10)<br>            198 BINARY_MODULO<br>            200 LOAD_GLOBAL              2 (ord)<br>            202 LOAD_CONST               6 (&#x27;0&#x27;)<br>            204 CALL_FUNCTION            1<br>            206 BINARY_ADD<br>            208 CALL_FUNCTION            1<br>            210 CALL_METHOD              1<br>            212 POP_TOP<br>            214 JUMP_ABSOLUTE            8<br><br> 24     &gt;&gt;  216 LOAD_FAST                2 (result)<br>            218 LOAD_METHOD              0 (append)<br>            220 LOAD_FAST                3 (i)<br>            222 CALL_METHOD              1<br>            224 POP_TOP<br>            226 JUMP_ABSOLUTE            8<br><br> 25     &gt;&gt;  228 LOAD_CONST               9 (&#x27;&#x27;)<br>            230 LOAD_METHOD              3 (join)<br>            232 LOAD_FAST                2 (result)<br>            234 CALL_METHOD              1<br>            236 RETURN_VALUE<br><br></code></pre></td></tr></table></figure><p>​<strong>chatgpt</strong>梭哈还原的代码如下，md它也有错误，垃圾东西！尝试自己对照看汇编指令修改。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">flag = <span class="hljs-string">&#x27;SYC&#123;MD5(input)&#125;&#x27;</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Please input0:&#x27;</span>)<br>input0 = <span class="hljs-string">&#x27;&#x27;</span><br><br><span class="hljs-comment"># 加密函数1：类似 Caesar Cipher 带偏移</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test</span>(<span class="hljs-params">s, R</span>):<br>    result = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> s:<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;A&#x27;</span> &lt;= i &lt;= <span class="hljs-string">&#x27;Z&#x27;</span>:<br>            result.append(<span class="hljs-built_in">chr</span>((<span class="hljs-built_in">ord</span>(i) - <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;A&#x27;</span>) + R) % <span class="hljs-number">26</span> + <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;A&#x27;</span>)))<br>        <span class="hljs-keyword">elif</span> <span class="hljs-string">&#x27;a&#x27;</span> &lt;= i &lt;= <span class="hljs-string">&#x27;z&#x27;</span>:<br>            result.append(<span class="hljs-built_in">chr</span>((<span class="hljs-built_in">ord</span>(i) - <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;a&#x27;</span>) + R) % <span class="hljs-number">26</span> + <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;a&#x27;</span>)))<br>        <span class="hljs-keyword">elif</span> <span class="hljs-string">&#x27;0&#x27;</span> &lt;= i &lt;= <span class="hljs-string">&#x27;9&#x27;</span>:<br>            result.append(<span class="hljs-built_in">chr</span>((<span class="hljs-built_in">ord</span>(i) - <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;0&#x27;</span>) + R) % <span class="hljs-number">10</span> + <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;0&#x27;</span>)))<br>        <span class="hljs-keyword">else</span>:<br>            result.append(i)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join(result)<br><br><span class="hljs-comment"># 加密函数2：字符与 key 异或 + 取反变换</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test2</span>(<span class="hljs-params">s2</span>):<br>    key = <span class="hljs-string">&#x27;SYC&#x27;</span><br>    length = <span class="hljs-number">18</span><br>    cipher = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(length):<br>        c = <span class="hljs-built_in">ord</span>(s2[i]) ^ i + (~<span class="hljs-built_in">ord</span>(key[i % <span class="hljs-number">3</span>]) + <span class="hljs-number">1</span>)<span class="hljs-comment">#这种运算chatgpt未注册版搞不定。</span><br>        cipher.append(c)<br>    <span class="hljs-keyword">return</span> cipher<br><br><span class="hljs-comment"># 主逻辑</span><br>a = <span class="hljs-number">13</span><br>b = <span class="hljs-number">14</span><br>c = (a+b)^a <span class="hljs-comment">#同样修改过。</span><br>d = b * <span class="hljs-number">100</span><br>e = a ^ b<br>m = d - c * <span class="hljs-number">4</span> + e - <span class="hljs-number">1</span><br>r = m % <span class="hljs-number">26</span>    <span class="hljs-comment">#r=14</span><br><br>cipher1 = test(input0, r)<br>cipher2 = test2(cipher1)<br><br>num = [<br>    -<span class="hljs-number">1</span>, -<span class="hljs-number">36</span>, <span class="hljs-number">26</span>, -<span class="hljs-number">5</span>, <span class="hljs-number">14</span>, <span class="hljs-number">41</span>, <span class="hljs-number">6</span>, -<span class="hljs-number">9</span>, <span class="hljs-number">60</span>, <span class="hljs-number">29</span>,<br>    -<span class="hljs-number">28</span>, <span class="hljs-number">17</span>, <span class="hljs-number">21</span>, <span class="hljs-number">7</span>, <span class="hljs-number">35</span>, <span class="hljs-number">38</span>, <span class="hljs-number">26</span>, <span class="hljs-number">48</span><br>]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">18</span>):<br>    <span class="hljs-keyword">if</span> cipher2[i] != num[i]:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;wrong!&#x27;</span>)<br>        <span class="hljs-keyword">continue</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Rrrright!&#x27;</span>)<br><br></code></pre></td></tr></table></figure><p>​解密脚本，md5加密后的flag为<strong>SYC{ed798fdd74e5c382b9c7fcca88500aca}</strong>。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">num = [<br>    -<span class="hljs-number">1</span>, -<span class="hljs-number">36</span>, <span class="hljs-number">26</span>, -<span class="hljs-number">5</span>, <span class="hljs-number">14</span>, <span class="hljs-number">41</span>, <span class="hljs-number">6</span>, -<span class="hljs-number">9</span>, <span class="hljs-number">60</span>, <span class="hljs-number">29</span>,<br>    -<span class="hljs-number">28</span>, <span class="hljs-number">17</span>, <span class="hljs-number">21</span>, <span class="hljs-number">7</span>, <span class="hljs-number">35</span>, <span class="hljs-number">38</span>, <span class="hljs-number">26</span>, <span class="hljs-number">48</span><br>]<br>key = <span class="hljs-string">&#x27;SYC&#x27;</span><br>rol = <span class="hljs-number">14</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(num)):<br>    num[i] = (num[i] - (~<span class="hljs-built_in">ord</span>(key[i%<span class="hljs-number">3</span>]) + <span class="hljs-number">1</span>)) ^ i<br>    A = <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;A&#x27;</span>)<br>    Z = <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;Z&#x27;</span>)<br>    a = <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;a&#x27;</span>)<br>    z = <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;z&#x27;</span>)<br>    <span class="hljs-keyword">if</span> A &lt;= num[i] &lt;= Z:<br>        num[i] = (num[i] - A - rol) % <span class="hljs-number">26</span> + A<br>    <span class="hljs-keyword">elif</span> a &lt;= num[i] &lt;= z:<br>        num[i] = (num[i] - a - rol) % <span class="hljs-number">26</span> + a<br>    <span class="hljs-keyword">elif</span> <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;0&#x27;</span>) &lt;= num[i] &lt;= <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;9&#x27;</span>):<br>        num[i] = (num[i] - <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;0&#x27;</span>) - rol) % <span class="hljs-number">10</span> + <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;0&#x27;</span>)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(num[i]), end=<span class="hljs-string">&#x27;&#x27;</span>)  <span class="hljs-comment">#D0_You_Iik3_python</span><br></code></pre></td></tr></table></figure><p>​</p><h1 id="奇怪的RC4"><a href="#奇怪的RC4" class="headerlink" title="奇怪的RC4"></a>奇怪的RC4</h1><p>​<strong>PyInstaller</strong>打包的exe程序，<strong>pydumpck</strong>解包后得到密文和加密逻辑，直接解包还会反编译不完全，怎么回事，没遇到过啊。</p><p>​手动反汇编，读汇编来补充！这个自动添加的**()注释**真的是漏洞百出，没几个对的。xor1和xor2都没能解析出来。（<strong>原来是3.8的版本，我是一点解不出来</strong>）</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> dis<br><span class="hljs-keyword">import</span> marshal<br><span class="hljs-comment"># 读取 .pyc 文件</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">50</span>):<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">r&quot;easy_xor_and_rc4.pyc&quot;</span>,<br>              <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        <span class="hljs-keyword">try</span>:<br>            f.read(i)<span class="hljs-comment">#因为我不确定魔术头包含多少位，实践证明是0</span><br>            code = marshal.load(f)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ok : &quot;</span>, i)<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Error&quot;</span>)<br><br><span class="hljs-comment"># 使用 dis 模块反汇编字节码</span><br>dis.dis(code)<br></code></pre></td></tr></table></figure><blockquote><p>容易理解错的指令：<strong>STORE_SUBSCR</strong>指令执行时栈顶是**[b[1],a,i]<strong>，那么就是</strong>a[i]&#x3D;b[1]**。</p><p><strong>FOR_ITER</strong>指令不知道。</p><p><strong>JUMP_ABSOLUTE</strong>指令是绝对地址跳转。</p><p><strong>JUMP_FORWARD</strong>指令是相对地址，基址是下一条指令地址。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs assembly">  2           0 LOAD_CONST               0 (0)<br>              2 LOAD_CONST               1 ((&#x27;*&#x27;,))<br>              4 IMPORT_NAME              0 (Rc4)<br>              6 IMPORT_STAR <br><br> 15           8 LOAD_CONST               2 (&lt;code object xor1 at 0x0000023C79386EF0, file &quot;easy_xor_and_rc4.py&quot;, line 2&gt;)<br>             10 LOAD_CONST               3 (&#x27;xor1&#x27;)<br>             12 MAKE_FUNCTION            0<br>             14 STORE_NAME               1 (xor1) ;函数声明，xor1<br><br> 24          16 LOAD_CONST               4 (&lt;code object xor2 at 0x0000023C79387050, file &quot;easy_xor_and_rc4.py&quot;, line 15&gt;)<br>             18 LOAD_CONST               5 (&#x27;xor2&#x27;)<br>             20 MAKE_FUNCTION            0<br>             22 STORE_NAME               2 (xor2)<br><br> 30          24 LOAD_CONST               6 (&lt;code object enc at 0x0000023C79387100, file &quot;easy_xor_and_rc4.py&quot;, line 24&gt;)<br>             26 LOAD_CONST               7 (&#x27;enc&#x27;)<br>             28 MAKE_FUNCTION            0<br>             30 STORE_NAME               3 (enc)<br><br> 31          32 LOAD_NAME                4 (input)<br>             34 LOAD_CONST               8 (&#x27;please give your input:&#x27;)<br>             36 CALL_FUNCTION            1<br>             38 STORE_NAME               5 (plaintext) ;plaintext=input(&quot;...&quot;)<br><br> 32          40 LOAD_CONST               9 (&#x27;SYCFOREVER&#x27;)<br>             42 STORE_NAME               6 (key) ;key=&#x27;...&#x27;<br><br> 33          44 LOAD_NAME                7 (list)<br>             46 LOAD_NAME                8 (range)<br>             48 LOAD_NAME                9 (len)<br>             50 LOAD_NAME                5 (plaintext)<br>             52 CALL_FUNCTION            1<br>             54 CALL_FUNCTION            1<br>             56 CALL_FUNCTION            1<br>             58 STORE_NAME              10 (xor_list) ;xor_list = list[range(len(plaintext))]<br><br> 34          60 LOAD_CONST              10 (158)<br>             62 LOAD_CONST              11 (31)<br>             64 LOAD_CONST              12 (205)<br>             66 LOAD_CONST              13 (434)<br>             68 LOAD_CONST              14 (354)<br>             70 LOAD_CONST              15 (15)<br>             72 LOAD_CONST              16 (383)<br>             74 LOAD_CONST              17 (298)<br>             76 LOAD_CONST              18 (304)<br>             78 LOAD_CONST              19 (351)<br>             80 LOAD_CONST              20 (465)<br>             82 LOAD_CONST              21 (312)<br>             84 LOAD_CONST              22 (261)<br>             86 LOAD_CONST              23 (442)<br>             88 LOAD_CONST              24 (397)<br>             90 LOAD_CONST              25 (474)<br>             92 LOAD_CONST              26 (310)<br>             94 LOAD_CONST              24 (397)<br>             96 LOAD_CONST              11 (31)<br>             98 LOAD_CONST              27 (21)<br>            100 LOAD_CONST              28 (78)<br>            102 LOAD_CONST              29 (67)<br>            104 LOAD_CONST              30 (47)<br>            106 LOAD_CONST              31 (133)<br>            108 LOAD_CONST              32 (168)<br>            110 LOAD_CONST              33 (48)<br>            112 LOAD_CONST              34 (153)<br>            114 LOAD_CONST              35 (99)<br>            116 LOAD_CONST              36 (103)<br>            118 LOAD_CONST              37 (204)<br>            120 LOAD_CONST              38 (137)<br>            122 LOAD_CONST              39 (29)<br>            124 LOAD_CONST              40 (22)<br>            126 LOAD_CONST              41 (13)<br>            128 LOAD_CONST              42 (228)<br>            130 LOAD_CONST              43 (3)<br>            132 LOAD_CONST              44 (136)<br>            134 LOAD_CONST              45 (141)<br>            136 LOAD_CONST              46 (248)<br>            138 LOAD_CONST              47 (124)<br>            140 LOAD_CONST              48 (26)<br>            142 LOAD_CONST              48 (26)<br>            144 LOAD_CONST              49 (65)<br>            146 LOAD_CONST              50 (200)<br>            148 LOAD_CONST              51 (7)<br>            150 BUILD_LIST              45<br>            152 STORE_NAME              11 (cipher) ;cipher=[...]<br><br> 35         154 LOAD_NAME                3 (enc)<br>            156 LOAD_NAME                5 (plaintext)<br>            158 LOAD_NAME                6 (key)<br>            160 LOAD_NAME               10 (xor_list)<br>            162 CALL_FUNCTION            3 ;enc(plaintext,key,xor_list)<br>            164 STORE_NAME               5 (plaintext)<br><br> 36         166 LOAD_NAME                8 (range)<br>            168 LOAD_NAME                9 (len)<br>            170 LOAD_NAME               11 (cipher)<br>            172 CALL_FUNCTION            1<br>            174 CALL_FUNCTION            1 <br>            176 GET_ITER<br>            178 FOR_ITER                36 (to 252)<br>            180 STORE_NAME              12 (i);for i in range(len(cipher))<br><br> 37         182 LOAD_NAME               11 (cipher)<br>            184 LOAD_NAME               12 (i)<br>            186 BINARY_SUBSCR<br>            188 LOAD_NAME                5 (plaintext)<br>            190 LOAD_NAME               12 (i)<br>            192 BINARY_SUBSCR<br>            194 COMPARE_OP               3 (!=) ;cipher[i]!=plaintext[i]<br>            196 POP_JUMP_IF_FALSE      178 (to 356)<br><br> 38         198 LOAD_NAME               13 (print)<br>            200 LOAD_CONST              52 (&#x27;Wrong&#x27;)<br>            202 CALL_FUNCTION            1<br>            204 POP_TOP<br><br> 39         206 LOAD_NAME               14 (exit)<br>            208 LOAD_CONST              53 (1)<br>            210 CALL_FUNCTION            1<br>            212 POP_TOP<br>            214 JUMP_ABSOLUTE          178 (to 356)<br>            216 LOAD_NAME               13 (print)<br>            218 LOAD_CONST              54 (&#x27;You know the flag!!&#x27;)<br>            220 CALL_FUNCTION            1<br>            222 POP_TOP<br>            224 LOAD_CONST              55 (None)<br>            226 RETURN_VALUE<br><br>Disassembly of &lt;code object xor1 at 0x0000023C79386EF0, file &quot;easy_xor_and_rc4.py&quot;, line 2&gt;:<br>  4           0 SETUP_FINALLY           18 (to 38)<br><br>  5           2 LOAD_CONST               1 (&lt;code object &lt;listcomp&gt; at 0x0000023C79386550, file &quot;easy_xor_and_rc4.py&quot;, line 4&gt;)<br>              4 LOAD_CONST               2 (&#x27;xor1.&lt;locals&gt;.&lt;listcomp&gt;&#x27;)<br>              6 MAKE_FUNCTION            0<br>              8 LOAD_FAST                1 (xor_list)<br>             10 GET_ITER<br>             12 CALL_FUNCTION            1<br>             14 STORE_FAST               1 (xor_list)<br>             16 POP_BLOCK<br>             18 JUMP_FORWARD            12 (to 44)<br><br>  6          20 POP_TOP<br>             22 POP_TOP<br>             24 POP_TOP<br><br>  7          26 POP_EXCEPT<br>             28 JUMP_FORWARD             2 (to 34)<br>             30 &lt;88&gt;<br><br>  8          32 SETUP_FINALLY           18 (to 70)<br><br>  9     &gt;&gt;   34 LOAD_CONST               3 (&lt;code object &lt;listcomp&gt; at 0x0000023C79386E40, file &quot;easy_xor_and_rc4.py&quot;, line 8&gt;)<br>             36 LOAD_CONST               2 (&#x27;xor1.&lt;locals&gt;.&lt;listcomp&gt;&#x27;)<br>        &gt;&gt;   38 MAKE_FUNCTION            0<br>             40 LOAD_FAST                0 (plaintext)<br>             42 GET_ITER<br>        &gt;&gt;   44 CALL_FUNCTION            1<br>             46 STORE_FAST               0 (plaintext)<br>             48 POP_BLOCK<br>             50 JUMP_FORWARD            12 (to 76)<br><br> 10          52 POP_TOP<br>             54 POP_TOP<br>             56 POP_TOP<br><br> 11          58 POP_EXCEPT<br>             60 JUMP_FORWARD             2 (to 66)<br>             62 &lt;88&gt;<br><br> 12          64 LOAD_GLOBAL              0 (range)<br>        &gt;&gt;   66 LOAD_GLOBAL              1 (len)<br>             68 LOAD_FAST                0 (plaintext)<br>        &gt;&gt;   70 CALL_FUNCTION            1<br>             72 CALL_FUNCTION            1<br>             74 GET_ITER<br>        &gt;&gt;   76 FOR_ITER                24 (to 126)<br>             78 STORE_FAST               2 (i)<br><br> 13          80 LOAD_FAST                0 (plaintext)<br>             82 LOAD_FAST                2 (i)<br>             84 DUP_TOP_TWO;将栈顶两个元素复制一份放到栈顶<br>             86 BINARY_SUBSCR<br>             88 LOAD_FAST                1 (xor_list)<br>             90 LOAD_FAST                2 (i)<br>             92 BINARY_SUBSCR<br>             94 INPLACE_XOR ;就地（栈）异或，减少内存占用<br>             96 ROT_THREE<br>             98 STORE_SUBSCR ;plaintext[i]^=xor_list[i]<br>            100 JUMP_ABSOLUTE           76 (to 152)<br>            102 LOAD_FAST                0 (plaintext)<br>            104 RETURN_VALUE<br><br>Disassembly of &lt;code object &lt;listcomp&gt; at 0x0000023C79386550, file &quot;easy_xor_and_rc4.py&quot;, line 4&gt;:<br>  4           0 BUILD_LIST               0<br>              2 LOAD_FAST                0 (.0)<br>              4 FOR_ITER                12 (to 30)<br>              6 STORE_FAST               1 (i)<br>        &gt;&gt;    8 LOAD_GLOBAL              0 (ord)<br>             10 LOAD_FAST                1 (i)<br>             12 CALL_FUNCTION            1<br>             14 LIST_APPEND              2<br>             16 JUMP_ABSOLUTE            4 (to 8)<br>             18 RETURN_VALUE<br><br>Disassembly of &lt;code object &lt;listcomp&gt; at 0x0000023C79386E40, file &quot;easy_xor_and_rc4.py&quot;, line 8&gt;:<br>  8           0 BUILD_LIST               0<br>              2 LOAD_FAST                0 (.0)<br>              4 FOR_ITER                12 (to 30)<br>              6 STORE_FAST               1 (i)<br>        &gt;&gt;    8 LOAD_GLOBAL              0 (ord)<br>             10 LOAD_FAST                1 (i)<br>             12 CALL_FUNCTION            1<br>             14 LIST_APPEND              2<br>             16 JUMP_ABSOLUTE            4 (to 8)<br>             18 RETURN_VALUE<br><br>Disassembly of &lt;code object xor2 at 0x0000023C79387050, file &quot;easy_xor_and_rc4.py&quot;, line 15&gt;:<br> 17           0 SETUP_FINALLY           18 (to 38)    ;异常发生时跳转到38<br><br> 18           2 LOAD_CONST               1 (&lt;code object &lt;listcomp&gt; at 0x0000023C79386FA0, file &quot;easy_xor_and_rc4.py&quot;, line 17&gt;) ;加载常量 1，这个常量指向一个内联的列表推导式<br>              4 LOAD_CONST               2 (&#x27;xor2.&lt;locals&gt;.&lt;listcomp&gt;&#x27;)<br>              6 MAKE_FUNCTION            0 ;创建一个函数对象，准备将其应用<br>              8 LOAD_FAST                0 (plaintext)<br>             10 GET_ITER<br>             12 CALL_FUNCTION            1 ;由于这个函数是列表推导式，所以它将对 plaintext 进行迭代，并返回一个列表。<br>             14 STORE_FAST               0 (plaintext)<br>             16 POP_BLOCK ;结束当前代码块（通常用于 try、with 语句块）<br>             18 JUMP_FORWARD            12 (to 44)<br><br> 19          20 POP_TOP<br>             22 POP_TOP<br>             24 POP_TOP<br><br> 20          26 POP_EXCEPT<br>             28 JUMP_FORWARD             2 (to 34)<br>             30 &lt;88&gt;<br><br> 21          32 LOAD_GLOBAL              0 (range)<br>        &gt;&gt;   34 LOAD_GLOBAL              1 (len)<br>             36 LOAD_FAST                0 (plaintext)<br>        &gt;&gt;   38 CALL_FUNCTION            1<br>             40 LOAD_CONST               3 (1)<br>             42 BINARY_SUBTRACT<br>        &gt;&gt;   44 CALL_FUNCTION            1 ;range(len(plaintext)-1)<br>             46 GET_ITER<br>             48 FOR_ITER                32 (to 114) ;32啥也不是！<br>             50 STORE_FAST               1 (i) ;for i in range(...)<br><br> 22          52 LOAD_FAST                0 (plaintext)<br>             54 LOAD_FAST                1 (i)<br>             56 BINARY_SUBSCR<br>             58 LOAD_FAST                0 (plaintext)<br>             60 LOAD_FAST                1 (i)<br>             62 LOAD_CONST               3 (1)<br>             64 BINARY_ADD<br>             66 BINARY_SUBSCR<br>             68 BINARY_XOR ;plaintext[i]^plaintext[i+1]<br>             70 LOAD_FAST                0 (plaintext)<br>             72 LOAD_FAST                1 (i)<br>             74 LOAD_CONST               3 (1)<br>             76 BINARY_ADD<br>             78 STORE_SUBSCR ;plaintext[i+1]=...<br>             80 JUMP_ABSOLUTE           48 (to 96) ;跳转到绝对位置48<br>             82 LOAD_FAST                0 (plaintext)<br>             84 RETURN_VALUE<br><br>Disassembly of &lt;code object &lt;listcomp&gt; at 0x0000023C79386FA0, file &quot;easy_xor_and_rc4.py&quot;, line 17&gt;:<br> 17           0 BUILD_LIST               0<br>              2 LOAD_FAST                0 (.0)<br>              4 FOR_ITER                12 (to 30)<br>              6 STORE_FAST               1 (i)<br>        &gt;&gt;    8 LOAD_GLOBAL              0 (ord)<br>             10 LOAD_FAST                1 (i)<br>             12 CALL_FUNCTION            1<br>             14 LIST_APPEND              2<br>             16 JUMP_ABSOLUTE            4 (to 8)<br>             18 RETURN_VALUE<br><br>Disassembly of &lt;code object enc at 0x0000023C79387100, file &quot;easy_xor_and_rc4.py&quot;, line 24&gt;:<br> 26           0 LOAD_GLOBAL              0 (rc4)<br>              2 LOAD_FAST                0 (plaintext)<br>              4 LOAD_FAST                1 (key)<br>              6 CALL_FUNCTION            2<br>              8 STORE_FAST               0 (plaintext) ;plaintext=rc4(plaintext,key)<br><br> 27          10 LOAD_GLOBAL              1 (xor1)<br>             12 LOAD_FAST                0 (plaintext)<br>             14 LOAD_FAST                2 (xor_list)<br>             16 CALL_FUNCTION            2<br>             18 STORE_FAST               0 (plaintext) ;plaintext=xor1(plaintext,xor_list)<br><br> 28          20 LOAD_GLOBAL              2 (xor2)<br>             22 LOAD_FAST                0 (plaintext)<br>             24 CALL_FUNCTION            1<br>             26 STORE_FAST               0 (plaintext)      ;plaintext=xor2(plaintext)<br>             28 LOAD_FAST                0 (plaintext)<br>             30 RETURN_VALUE<br><br>Process finished with exit code 0<br><br></code></pre></td></tr></table></figure><p>​可以大概看出来，<code>xor1</code>函数是<code>plaintext[i]^xor_list[i]</code>，<code>xor2</code>是前后异或，其中数据自取。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">xor2</span>(<span class="hljs-params">plain</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(plain)-<span class="hljs-number">1</span>):<br>        plain[i+<span class="hljs-number">1</span>]^=plain[i]<br>    <span class="hljs-keyword">return</span> plain<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">xor1</span>(<span class="hljs-params">plain,xor_list</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(plain)):<br>        plain[i] ^= i<span class="hljs-comment">#xor_list[i]=i</span><br>  <span class="hljs-keyword">return</span> plain<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">enc</span>(<span class="hljs-params">plain,key,xor_list</span>):<br>    enc(plain,key)<br>    xor1(plain,xor_list)<br>    xor2(plain)<br>    <span class="hljs-keyword">return</span> plain<br></code></pre></td></tr></table></figure><p>​再看看RC4的代码，解包时，RC4函数没能成功解析出来，KSA和PRGA还是半对，烦！</p><p>​分析一下。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs assembly">  9           0 LOAD_CONST               0 (&lt;code object KSA at 0x000001C022376550, file &quot;Rc4.py&quot;, line 1&gt;)<br>              2 LOAD_CONST               1 (&#x27;KSA&#x27;)<br>              4 MAKE_FUNCTION            0<br>              6 STORE_NAME               0 (KSA)<br><br> 19           8 LOAD_CONST               2 (&lt;code object PRGA at 0x000001C022376E40, file &quot;Rc4.py&quot;, line 9&gt;)<br>             10 LOAD_CONST               3 (&#x27;PRGA&#x27;)<br>             12 MAKE_FUNCTION            0<br>             14 STORE_NAME               1 (PRGA)<br>             16 LOAD_CONST               4 (&lt;code object rc4 at 0x000001C022377100, file &quot;Rc4.py&quot;, line 19&gt;)<br>             18 LOAD_CONST               5 (&#x27;rc4&#x27;)<br>             20 MAKE_FUNCTION            0<br>             22 STORE_NAME               2 (rc4)<br>             24 LOAD_CONST               6 (None)<br>             26 RETURN_VALUE<br><br>Disassembly of &lt;code object KSA at 0x000001C022376550, file &quot;Rc4.py&quot;, line 1&gt;:<br>  3           0 LOAD_CONST               1 (0)<br>              2 STORE_FAST               1 (j)<br><br>  4           4 LOAD_GLOBAL              0 (list)<br>              6 LOAD_GLOBAL              1 (range)<br>              8 LOAD_CONST               2 (256)<br>             10 CALL_FUNCTION            1<br>             12 CALL_FUNCTION            1<br>             14 STORE_FAST               2 (S)<br><br>  5          16 LOAD_GLOBAL              2 (len)<br>             18 LOAD_FAST                0 (key)<br>             20 CALL_FUNCTION            1<br>             22 STORE_FAST               3 (key_length)<br><br>  6          24 LOAD_GLOBAL              1 (range)<br>             26 LOAD_CONST               2 (256)<br>             28 CALL_FUNCTION            1<br>             30 GET_ITER<br>             32 FOR_ITER                58 (to 150)<br>             34 STORE_FAST               4 (i)<br><br>  7          36 LOAD_FAST                1 (j)<br>             38 LOAD_FAST                2 (S)<br>             40 LOAD_FAST                4 (i)<br>             42 BINARY_SUBSCR<br>             44 BINARY_ADD<br>             46 LOAD_FAST                0 (key)<br>             48 LOAD_FAST                4 (i)<br>             50 LOAD_FAST                3 (key_length)<br>             52 BINARY_MODULO<br>             54 BINARY_SUBSCR<br>             56 BINARY_ADD<br>             58 LOAD_CONST               2 (256)<br>             60 BINARY_MODULO<br>             62 STORE_FAST               1 (j)<br><br>  8     &gt;&gt;   64 LOAD_FAST                2 (S)<br>             66 LOAD_FAST                1 (j)<br>             68 BINARY_SUBSCR<br>             70 LOAD_FAST                2 (S)<br>             72 LOAD_FAST                4 (i)<br>             74 BINARY_SUBSCR<br>             76 ROT_TWO<br>             78 LOAD_FAST                2 (S)<br>             80 LOAD_FAST                4 (i)<br>             82 STORE_SUBSCR<br>             84 LOAD_FAST                2 (S)<br>             86 LOAD_FAST                1 (j)<br>             88 STORE_SUBSCR<br>             90 JUMP_ABSOLUTE           32 (to 64)<br>             92 LOAD_FAST                2 (S)<br>             94 RETURN_VALUE<br><br>Disassembly of &lt;code object PRGA at 0x000001C022376E40, file &quot;Rc4.py&quot;, line 9&gt;:<br> 11           0 LOAD_CONST               1 (0)<br>              2 STORE_FAST               1 (i)<br><br> 13           4 LOAD_CONST               1 (0)<br>              6 STORE_FAST               2 (j)<br><br> 14           8 LOAD_FAST                1 (i)<br>             10 LOAD_CONST               2 (1)<br>             12 BINARY_ADD<br>             14 LOAD_CONST               3 (256)<br>        &gt;&gt;   16 BINARY_MODULO<br>             18 STORE_FAST               1 (i)<br><br> 15          20 LOAD_FAST                2 (j)<br>             22 LOAD_FAST                0 (S)<br>             24 LOAD_FAST                1 (i)<br>             26 BINARY_SUBSCR<br>             28 BINARY_ADD<br>             30 LOAD_CONST               3 (256)<br>             32 BINARY_MODULO<br>             34 STORE_FAST               2 (j)<br><br> 16          36 LOAD_FAST                0 (S)<br>             38 LOAD_FAST                2 (j)<br>             40 BINARY_SUBSCR<br>             42 LOAD_FAST                0 (S)<br>             44 LOAD_FAST                1 (i)<br>             46 BINARY_SUBSCR<br>             48 ROT_TWO ;[s[i],s[j]]<br>             50 LOAD_FAST                0 (S)<br>             52 LOAD_FAST                1 (i)<br>             54 STORE_SUBSCR ;s[i]=s[j]<br>             56 LOAD_FAST                0 (S)<br>             58 LOAD_FAST                2 (j)<br>             60 STORE_SUBSCR ;s[j]=t=s[i](原先的s[i])，swap了一下<br><br> 17          62 LOAD_FAST                0 (S)<br>             64 LOAD_FAST                1 (i)<br>             66 BINARY_SUBSCR<br>             68 LOAD_FAST                0 (S)<br>             70 LOAD_FAST                2 (j)<br>             72 BINARY_SUBSCR ;[s[i],s[j]]<br>             74 BINARY_ADD<br>             76 LOAD_CONST               3 (256)<br>             78 BINARY_MODULO<br>             80 STORE_FAST               3 (k) ;k=s[i]+s[j]<br>             82 LOAD_FAST                3 (k)<br>             84 YIELD_VALUE<br>             86 POP_TOP<br>             88 JUMP_ABSOLUTE            8 (to 16)<br>             90 LOAD_CONST               0 (None)<br>             92 RETURN_VALUE<br><br>Disassembly of &lt;code object rc4 at 0x000001C022377100, file &quot;Rc4.py&quot;, line 19&gt;:<br> 21           0 SETUP_FINALLY           18 (to 38)<br><br> 22           2 LOAD_CONST               1 (&lt;code object &lt;listcomp&gt; at 0x000001C022376FA0, file &quot;Rc4.py&quot;, line 21&gt;)<br>              4 LOAD_CONST               2 (&#x27;rc4.&lt;locals&gt;.&lt;listcomp&gt;&#x27;)<br>              6 MAKE_FUNCTION            0<br>              8 LOAD_FAST                1 (key)<br>             10 GET_ITER<br>             12 CALL_FUNCTION            1<br>             14 STORE_FAST               1 (key)<br>             16 POP_BLOCK<br>             18 JUMP_FORWARD            12 (to 44)<br><br> 23          20 POP_TOP<br>             22 POP_TOP<br>             24 POP_TOP<br><br> 24          26 POP_EXCEPT<br>             28 JUMP_FORWARD             2 (to 34)<br>             30 &lt;88&gt;<br><br> 25          32 SETUP_FINALLY           18 (to 70)<br><br> 26     &gt;&gt;   34 LOAD_CONST               3 (&lt;code object &lt;listcomp&gt; at 0x000001C022377050, file &quot;Rc4.py&quot;, line 25&gt;)<br>             36 LOAD_CONST               2 (&#x27;rc4.&lt;locals&gt;.&lt;listcomp&gt;&#x27;)<br>        &gt;&gt;   38 MAKE_FUNCTION            0<br>             40 LOAD_FAST                0 (plaintext)<br>             42 GET_ITER<br>        &gt;&gt;   44 CALL_FUNCTION            1<br>             46 STORE_FAST               0 (plaintext)<br>             48 POP_BLOCK<br>             50 JUMP_FORWARD            12 (to 76)<br><br> 27          52 POP_TOP<br>             54 POP_TOP<br>             56 POP_TOP<br><br> 28          58 POP_EXCEPT<br>             60 JUMP_FORWARD             2 (to 66)<br>             62 &lt;88&gt;<br><br> 29          64 LOAD_GLOBAL              0 (range)<br>        &gt;&gt;   66 LOAD_GLOBAL              1 (len)<br>             68 LOAD_FAST                0 (plaintext)<br>        &gt;&gt;   70 CALL_FUNCTION            1<br>             72 CALL_FUNCTION            1<br>             74 GET_ITER<br>        &gt;&gt;   76 FOR_ITER                20 (to 118)<br>             78 STORE_FAST               2 (i)<br><br> 30          80 LOAD_FAST                0 (plaintext)<br>             82 LOAD_FAST                2 (i)<br>             84 DUP_TOP_TWO<br>             86 BINARY_SUBSCR<br>             88 LOAD_FAST                2 (i)<br>             90 INPLACE_ADD ;plaintext[i]+i<br>             92 ROT_THREE<br>             94 STORE_SUBSCR ;plaintext[i] = plaintext[i]+i<br>             96 JUMP_ABSOLUTE           76 (to 152)<br><br> 31          98 LOAD_GLOBAL              2 (KSA)<br>            100 LOAD_FAST                1 (key)<br>            102 CALL_FUNCTION            1<br>            104 STORE_FAST               3 (S) ;S=KSA(key)<br><br> 32         106 LOAD_GLOBAL              3 (PRGA)<br>            108 LOAD_FAST                3 (S)<br>            110 CALL_FUNCTION            1<br>            112 STORE_FAST               4 (xor_value) ;xor_vlaue=PRGA(S)<br><br> 33         114 LOAD_GLOBAL              0 (range)<br>            116 LOAD_GLOBAL              1 (len)<br>        &gt;&gt;  118 LOAD_FAST                0 (plaintext)<br>            120 CALL_FUNCTION            1<br>            122 CALL_FUNCTION            1<br>            124 GET_ITER<br>            126 FOR_ITER                32 (to 192)<br>            128 STORE_FAST               2 (i) ;for i in range(len(plaintext)):<br><br> 34         130 LOAD_FAST                0 (plaintext)<br>            132 LOAD_FAST                2 (i)<br>            134 DUP_TOP_TWO<br>            136 BINARY_SUBSCR<br>            138 LOAD_GLOBAL              4 (int)<br>            140 LOAD_GLOBAL              5 (next)<br>            142 LOAD_FAST                4 (xor_value)<br>            144 CALL_FUNCTION            1<br>            146 CALL_FUNCTION            1 ;int(next(xor_value))<br>            148 LOAD_CONST               4 (6)<br>            150 BINARY_ADD ;...+6<br>        &gt;&gt;  152 INPLACE_XOR ;plaintext[i]^...<br>            154 ROT_THREE<br>            156 STORE_SUBSCR ;plaintext[i]=...<br>            158 JUMP_ABSOLUTE          126 (to 252)<br>            160 LOAD_FAST                0 (plaintext)<br>            162 RETURN_VALUE<br><br>Disassembly of &lt;code object &lt;listcomp&gt; at 0x000001C022376FA0, file &quot;Rc4.py&quot;, line 21&gt;:<br> 21           0 BUILD_LIST               0<br>              2 LOAD_FAST                0 (.0)<br>              4 FOR_ITER                12 (to 30)<br>              6 STORE_FAST               1 (i)<br>        &gt;&gt;    8 LOAD_GLOBAL              0 (ord)<br>             10 LOAD_FAST                1 (i)<br>             12 CALL_FUNCTION            1<br>             14 LIST_APPEND              2<br>             16 JUMP_ABSOLUTE            4 (to 8)<br>             18 RETURN_VALUE<br><br>Disassembly of &lt;code object &lt;listcomp&gt; at 0x000001C022377050, file &quot;Rc4.py&quot;, line 25&gt;:<br> 25           0 BUILD_LIST               0<br>              2 LOAD_FAST                0 (.0)<br>              4 FOR_ITER                12 (to 30)<br>              6 STORE_FAST               1 (i)<br>        &gt;&gt;    8 LOAD_GLOBAL              0 (ord)<br>             10 LOAD_FAST                1 (i)<br>             12 CALL_FUNCTION            1<br>             14 LIST_APPEND              2<br>             16 JUMP_ABSOLUTE            4 (to 8)<br>             18 RETURN_VALUE<br><br>Process finished with exit code 0<br></code></pre></td></tr></table></figure><p>​综合分析得到的rc4.py如下，简化了一些异常处理以及格式转换。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">KSA</span>(<span class="hljs-params">key</span>):<br>    j = <span class="hljs-number">0</span><br>    S = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>))<br>    key_length = <span class="hljs-built_in">len</span>(key)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>        j = (j + S[i] + key[i % key_length]) % <span class="hljs-number">256</span><br>        S[i],S[j] = S[j],S[i]<br>        <span class="hljs-keyword">return</span> S<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">PRGA</span>(<span class="hljs-params">S</span>):<br>    i = <span class="hljs-number">0</span><br>    j = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        i = (i + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span><br>    j = (j + S[i]) % <span class="hljs-number">256</span><br>    S[i],S[j] = S[j],S[i]<br>    k = (S[i] + S[j]) % <span class="hljs-number">256</span><br>    <span class="hljs-keyword">yield</span> k<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">RC4</span>(<span class="hljs-params">plain, key</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(plain)):<br>        plain_text[i] += i<br>    S = KSA(key)<br>    cipher_text = []<br>    prga = PRGA(S)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(plain_text)):<br>        cipher_text.append(plain_text[i] ^ (<span class="hljs-built_in">int</span>(<span class="hljs-built_in">next</span>(prga))+<span class="hljs-number">6</span>))<br>    <span class="hljs-keyword">return</span> cipher_text<br></code></pre></td></tr></table></figure><p>​最后的解密代码如下，开始还把xor2的前后异或给解错了，应该从后往前解，还是没有理解的清清楚楚啊！</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">cipher = [<span class="hljs-number">158</span>, <span class="hljs-number">31</span>, <span class="hljs-number">205</span>, <span class="hljs-number">434</span>, <span class="hljs-number">354</span>, <span class="hljs-number">15</span>, <span class="hljs-number">383</span>, <span class="hljs-number">298</span>, <span class="hljs-number">304</span>, <span class="hljs-number">351</span>, <span class="hljs-number">465</span>, <span class="hljs-number">312</span>, <span class="hljs-number">261</span>, <span class="hljs-number">442</span>,<span class="hljs-number">397</span>, <span class="hljs-number">474</span>, <span class="hljs-number">310</span>, <span class="hljs-number">397</span>, <span class="hljs-number">31</span>, <span class="hljs-number">21</span>, <span class="hljs-number">78</span>, <span class="hljs-number">67</span>, <span class="hljs-number">47</span>, <span class="hljs-number">133</span>, <span class="hljs-number">168</span>, <span class="hljs-number">48</span>, <span class="hljs-number">153</span>, <span class="hljs-number">99</span>, <span class="hljs-number">103</span>, <span class="hljs-number">204</span>, <span class="hljs-number">137</span>, <span class="hljs-number">29</span>, <span class="hljs-number">22</span>, <span class="hljs-number">13</span>, <span class="hljs-number">228</span>, <span class="hljs-number">3</span>, <span class="hljs-number">136</span>, <span class="hljs-number">141</span>, <span class="hljs-number">248</span>, <span class="hljs-number">124</span>, <span class="hljs-number">26</span>, <span class="hljs-number">26</span>, <span class="hljs-number">65</span>, <span class="hljs-number">200</span>, <span class="hljs-number">7</span>]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(cipher)-<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,-<span class="hljs-number">1</span>):<br>    cipher[i] ^= cipher[i-<span class="hljs-number">1</span>]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(cipher)):<br>    cipher[i] ^= i<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">KSA</span>(<span class="hljs-params">key</span>):<br>    j = <span class="hljs-number">0</span><br>    S = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>))<br>    key_length = <span class="hljs-built_in">len</span>(key)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>        j = (j + S[i] + key[i % key_length]) % <span class="hljs-number">256</span><br>        S[i], S[j] = S[j], S[i]<br>    <span class="hljs-keyword">return</span> S<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">PRGA</span>(<span class="hljs-params">S</span>):<br>    i = <span class="hljs-number">0</span><br>    j = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        i = (i + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span><br>        j = (j + S[i]) % <span class="hljs-number">256</span><br>        S[i], S[j] = S[j], S[i]<br>        K = (S[i] + S[j]) % <span class="hljs-number">256</span><br>        <span class="hljs-keyword">yield</span> K<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">deRC4</span>(<span class="hljs-params">plain, key</span>):<br>    S = KSA(key)<br>    prga = PRGA(S)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(plain)):<br>        plain[i] ^= (<span class="hljs-built_in">int</span>(<span class="hljs-built_in">next</span>(prga))+<span class="hljs-number">6</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(plain)):<br>        plain[i] -= i<br>    <span class="hljs-keyword">return</span> plain<br><br>key = <span class="hljs-string">&quot;SYCFOREVER&quot;</span><br>key = [<span class="hljs-built_in">ord</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> key]<br>plain_text = deRC4(cipher, key)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&quot;</span>.join([<span class="hljs-built_in">chr</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> plain_text]))<span class="hljs-comment">#SYC&#123;Bel1eve_thAt_you_a3e_Unique_@nd_tHe_beSt&#125;</span><br></code></pre></td></tr></table></figure><h1 id="玩就行了"><a href="#玩就行了" class="headerlink" title="玩就行了"></a>玩就行了</h1><p>​Unity逆向，玩黄金矿工小游戏，全屏还缩小不了。CE修改得分，通关后就提示“有什么东西遗漏了！”。我怎么知道。</p><p>​然后打开<strong>Data.txt</strong>文件，我以敏锐的直觉看到开头的<strong>4D5A</strong>，这是exe程序的文件头，根本不是unity逆向！</p><p>​无壳程序，直接拖入IDA。</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __fastcall <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-type">char</span> Key[<span class="hljs-number">117</span>]; <span class="hljs-comment">// [rsp+2Bh] [rbp-55h] BYREF</span><br>  <span class="hljs-type">char</span> Myflag[<span class="hljs-number">108</span>]; <span class="hljs-comment">// [rsp+A0h] [rbp+20h] BYREF</span><br>  <span class="hljs-type">int</span> flag_len; <span class="hljs-comment">// [rsp+10Ch] [rbp+8Ch]</span><br><br>  sub_14000181E(argc, argv, envp);<br>  <span class="hljs-built_in">strcpy</span>(Key, <span class="hljs-string">&quot;GEEK&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;WOW~~Niceeeee to see you here!!!\n&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Welcome to GEEK Challenge!!!!!\n&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Please input your answer~\n&quot;</span>);<br>  <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>, Myflag);<br>  flag_len = <span class="hljs-built_in">strlen</span>(Myflag);<br>  sub_14000144B(Myflag, <span class="hljs-number">20LL</span>);<br>  sub_140001596(Myflag, Key);<br>  sub_14000161C(Myflag, &amp;Key[<span class="hljs-number">5</span>]);<br>  <span class="hljs-keyword">if</span> ( !<span class="hljs-built_in">strcmp</span>(&amp;Key[<span class="hljs-number">5</span>], <span class="hljs-string">&quot;0A161230300C2D0A2B303D2428233005242C2D26182206233E097F133A&quot;</span>) )<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;G00D!!!&quot;</span>);<br>  <span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Try again.&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\nPress any key to continue...&quot;</span>);<br>  getchar();<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>​<strong>sub_14000144B</strong>函数是类凯撒密码，数字也移位了，偏移量20。</p><p>​<strong>sub_140001596</strong>函数使用key异或加密。</p><p>​<strong>sub_14000161C</strong>里面调用了<strong>sub_140001408</strong>函数，这个函数IDA反编译不太好看，其参数为buffer指针、格式化字符、字符数据。先猜测一下，别想着都搞清楚，其中有不少底层代码，该清楚很麻烦的啊，慢慢积累就好了。猜测就是进行一下格式转换，直接写脚本试试。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">data = <span class="hljs-string">&quot;0A161230300C2D0A2B303D2428233005242C2D26182206233E097F133A&quot;</span><br>key = <span class="hljs-string">&quot;GEEK&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(data), <span class="hljs-number">2</span>):<br>    tmp = <span class="hljs-built_in">int</span>(data[i:i+<span class="hljs-number">2</span>], <span class="hljs-number">16</span>)<br>    tmp ^= <span class="hljs-built_in">ord</span>(key[(i // <span class="hljs-number">2</span>) % <span class="hljs-number">4</span>])<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;0&#x27;</span>) &lt;= tmp &lt;= <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;9&#x27;</span>):<br>        tmp = (tmp - <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;0&#x27;</span>) - <span class="hljs-number">20</span>) % <span class="hljs-number">10</span> + <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;0&#x27;</span>)<br>    <span class="hljs-keyword">elif</span> <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;A&#x27;</span>) &lt;= tmp &lt;= <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;Z&#x27;</span>):<br>        tmp = (tmp - <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;A&#x27;</span>) - <span class="hljs-number">20</span>) % <span class="hljs-number">26</span> + <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;A&#x27;</span>)<br>    <span class="hljs-keyword">elif</span> <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;a&#x27;</span>) &lt;= tmp &lt;= <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;z&#x27;</span>):<br>        tmp = (tmp - <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;a&#x27;</span>) - <span class="hljs-number">20</span>) % <span class="hljs-number">26</span> + <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;a&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(tmp),end=<span class="hljs-string">&#x27;&#x27;</span>) <span class="hljs-comment">#SYC&#123;cOnGraduulaTions_mIneR:D&#125;</span><br></code></pre></td></tr></table></figure><h1 id="长颈鹿喜欢吃彩虹"><a href="#长颈鹿喜欢吃彩虹" class="headerlink" title="长颈鹿喜欢吃彩虹"></a>长颈鹿喜欢吃彩虹</h1><p>​运行一下，还挺好看。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/af78d0f39e337f6562dcfb2001f2d726/image-20250703124214319.png" alt="image-20250703124214319"><p>​IDA打开，看到main函数，使用变量<strong>v6</strong>进行跳转，还没碰到过，这是什么混淆方式吧。其实一点点看，也可以分析出程序运行流程，但是先学习一下WP的方法，有一个说是<strong>平坦化</strong>，使用<strong>b810插件</strong>去除。（原来我之前安过啊）</p><p>​这个插件下载教程可以去看<a href="https://lkliki.github.io/2023/09/28/ida%E6%8F%92%E4%BB%B6-d810%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/">这个文章</a>，我的IDA切换到了3.11.0版本的python（系统中的，自行下载的），然后通过<code>py -3.11.0 -m pip install xxx</code>命令安装好依赖，使用起来就是先打开插件，选择<strong>unflattening ollvm</strong>去平坦化的，点击start就算启动了。之后回到main函数，在汇编界面，按<strong>U</strong>、<strong>C</strong>、<strong>P</strong>、<strong>F5</strong>重新反编译一次，这时候插件就会起作用。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/af78d0f39e337f6562dcfb2001f2d726/image-20250703134023131.png" alt="image-20250703134023131"><p>​可以看到，情况大不一样，效果很成功。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/af78d0f39e337f6562dcfb2001f2d726/image-20250703134312775.png" alt="image-20250703134312775"><p>​这个encrypt函数平坦化之后还是挺难看的，一个变量挪动了好多位置，主要就看到一个异或操作，其中一个确定应该是输入的flag字符串，另一个贼难跟踪。当然，在异或处下断点动调（汇编指令处）应该是能看出来这两个值是什么的，但是我已经看过别人的WP了，人家直接猜的。</p><p>​看看动调的方法吧，首先看到加密函数处，可以直接拿到Key是<strong>BOb0m0oN</strong>，可以确定Buffer的地址，可以选择下内存断点。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/af78d0f39e337f6562dcfb2001f2d726/image-20250703152243098.png" alt="image-20250703152243098"><p>​看到异或处，一个是我的输入，另一个数<strong>ecx</strong>多看两轮就知道是逆序的Key了，规律也简单，大胆猜测，小心取值。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/af78d0f39e337f6562dcfb2001f2d726/image-20250703152641983.png" alt="image-20250703152641983"><p>​最后看到比较处，取出加密输入和密文，我们其实可以通过输入特定的flag来确定每位的异或值是多少，这样也能解密。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/af78d0f39e337f6562dcfb2001f2d726/image-20250703152840984.png" alt="image-20250703152840984"><p>​有点累人，真的是做题做久了，一点兴趣都没了。现在边做边记录，做了两整天了，早上起来开做，晚上结束回去睡觉，开始很有激情，不觉得累，做到这种攻坚的地方，就没精力了，缓几天再做吧。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">enc = [<span class="hljs-number">29</span>, <span class="hljs-number">54</span>, <span class="hljs-number">115</span>, <span class="hljs-number">22</span>, <span class="hljs-number">73</span>, <span class="hljs-number">45</span>, <span class="hljs-number">26</span>, <span class="hljs-number">29</span>, <span class="hljs-number">41</span>, <span class="hljs-number">6</span>, <span class="hljs-number">66</span>, <span class="hljs-number">44</span>, <span class="hljs-number">118</span>, <span class="hljs-number">7</span>, <span class="hljs-number">16</span>, <span class="hljs-number">14</span>, <span class="hljs-number">126</span>, <span class="hljs-number">57</span>, <span class="hljs-number">85</span>, <span class="hljs-number">50</span>, <span class="hljs-number">117</span>, <span class="hljs-number">3</span>, <span class="hljs-number">27</span>, <span class="hljs-number">29</span>, <span class="hljs-number">25</span>, <span class="hljs-number">95</span>, <span class="hljs-number">82</span>, <span class="hljs-number">35</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">29</span>, <span class="hljs-number">63</span>]<br>key = [<span class="hljs-number">0x42</span>, <span class="hljs-number">0x4f</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x6d</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x6f</span>, <span class="hljs-number">0x4e</span>]<br>result = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(enc)):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>((enc[i] ^ key[::-<span class="hljs-number">1</span>][i % <span class="hljs-built_in">len</span>(key)]) &amp; <span class="hljs-number">0xff</span>), end=<span class="hljs-string">&#x27;&#x27;</span>)<br><span class="hljs-comment">#SYC&#123;yOU_girAFe_L0Ve_EaT_W0bN1aR&#125;</span><br></code></pre></td></tr></table></figure><h1 id="AES"><a href="#AES" class="headerlink" title="AES!"></a>AES!</h1><p>​无他，考察AES算法的理解。对我来说都无所谓，反正是新知识，没学过！不会可以看另一篇文章AES。</p><p>​专门学了半天的AES，边理解边敲代码，最后还debug，搞定一些小的细节错误，终于大功告成！但是，那是密码学的知识，我们做题还得识别验证是不是标准的AES，具体看看代码的实现。</p><p>​进入函数，输入flag后，验证长度是否是32位字节，然后使用<strong>1C99</strong>函数加密，<del>下面的那个不知道干嘛</del>，v7应该是flag的后一段，应该是反编译有问题，看汇编就很清楚了。传入参数，第一个是密钥，第二个是密钥长度，第五个是输入长度，会检查是否是16的倍数的。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/af78d0f39e337f6562dcfb2001f2d726/image-20250705164812604.png" alt="image-20250705164812604"><p>​可以清楚的看到，是将flag分成了两次加密，第二次传入的地址都加上了偏移0x10。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/af78d0f39e337f6562dcfb2001f2d726/image-20250705165554915.png" alt="image-20250705165554915"><p>​然后看到<strong>sub_7FF60A701408</strong>函数，里面是在做扩展轮密钥，先将初始16字节密钥换成4个32位字。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/af78d0f39e337f6562dcfb2001f2d726/image-20250705172649254.png" alt="image-20250705172649254"><p>​后面的就很清晰了，就不一点点解析了，是在是有点懒了。<strong>sub_7FF60A7016DC</strong>是在取input的16字节复制到v7中，看汇编也能看出来<strong>v12</strong>是指向<strong>v9</strong>的。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/af78d0f39e337f6562dcfb2001f2d726/image-20250705173038449.png" alt="image-20250705173038449"><p>​最后的解密代码如下。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AES</span>:<br>    MIX_C = [[<span class="hljs-number">0x2</span>, <span class="hljs-number">0x3</span>, <span class="hljs-number">0x1</span>, <span class="hljs-number">0x1</span>], [<span class="hljs-number">0x1</span>, <span class="hljs-number">0x2</span>, <span class="hljs-number">0x3</span>, <span class="hljs-number">0x1</span>], [<span class="hljs-number">0x1</span>, <span class="hljs-number">0x1</span>, <span class="hljs-number">0x2</span>, <span class="hljs-number">0x3</span>], [<span class="hljs-number">0x3</span>, <span class="hljs-number">0x1</span>, <span class="hljs-number">0x1</span>, <span class="hljs-number">0x2</span>]]<br>    MIX_C_INV = [[<span class="hljs-number">0xe</span>, <span class="hljs-number">0xb</span>, <span class="hljs-number">0xd</span>, <span class="hljs-number">0x9</span>], [<span class="hljs-number">0x9</span>, <span class="hljs-number">0xe</span>, <span class="hljs-number">0xb</span>, <span class="hljs-number">0xd</span>], [<span class="hljs-number">0xd</span>, <span class="hljs-number">0x9</span>, <span class="hljs-number">0xe</span>, <span class="hljs-number">0xb</span>], [<span class="hljs-number">0xb</span>, <span class="hljs-number">0xd</span>, <span class="hljs-number">0x9</span>, <span class="hljs-number">0xe</span>]]<br>    RCON= [<span class="hljs-number">0x01</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0x1b</span>, <span class="hljs-number">0x36</span> ,<span class="hljs-number">0x6c</span>, <span class="hljs-number">0xd8</span>, <span class="hljs-number">0xab</span>, <span class="hljs-number">0x4d</span>]  <span class="hljs-comment"># 实际只用到前10个</span><br>    S_BOX = [[<span class="hljs-number">124</span>, <span class="hljs-number">202</span>, <span class="hljs-number">123</span>, <span class="hljs-number">119</span>, <span class="hljs-number">242</span>, <span class="hljs-number">107</span>, <span class="hljs-number">111</span>, <span class="hljs-number">197</span>, <span class="hljs-number">48</span>, <span class="hljs-number">1</span>, <span class="hljs-number">103</span>, <span class="hljs-number">43</span>, <span class="hljs-number">254</span>, <span class="hljs-number">215</span>, <span class="hljs-number">71</span>, <span class="hljs-number">171</span>],<br>             [<span class="hljs-number">118</span>, <span class="hljs-number">99</span>, <span class="hljs-number">130</span>, <span class="hljs-number">201</span>, <span class="hljs-number">125</span>, <span class="hljs-number">250</span>, <span class="hljs-number">89</span>, <span class="hljs-number">240</span>, <span class="hljs-number">173</span>, <span class="hljs-number">212</span>, <span class="hljs-number">162</span>, <span class="hljs-number">175</span>, <span class="hljs-number">156</span>, <span class="hljs-number">164</span>, <span class="hljs-number">114</span>, <span class="hljs-number">192</span>],<br>             [<span class="hljs-number">183</span>, <span class="hljs-number">253</span>, <span class="hljs-number">147</span>, <span class="hljs-number">38</span>, <span class="hljs-number">54</span>, <span class="hljs-number">63</span>, <span class="hljs-number">247</span>, <span class="hljs-number">204</span>, <span class="hljs-number">52</span>, <span class="hljs-number">165</span>, <span class="hljs-number">229</span>, <span class="hljs-number">241</span>, <span class="hljs-number">113</span>, <span class="hljs-number">216</span>, <span class="hljs-number">49</span>, <span class="hljs-number">21</span>],<br>             [<span class="hljs-number">4</span>, <span class="hljs-number">199</span>, <span class="hljs-number">35</span>, <span class="hljs-number">195</span>, <span class="hljs-number">24</span>, <span class="hljs-number">150</span>, <span class="hljs-number">5</span>, <span class="hljs-number">154</span>, <span class="hljs-number">7</span>, <span class="hljs-number">18</span>, <span class="hljs-number">128</span>, <span class="hljs-number">226</span>, <span class="hljs-number">235</span>, <span class="hljs-number">39</span>, <span class="hljs-number">178</span>, <span class="hljs-number">117</span>],<br>             [<span class="hljs-number">9</span>, <span class="hljs-number">131</span>, <span class="hljs-number">44</span>, <span class="hljs-number">26</span>, <span class="hljs-number">27</span>, <span class="hljs-number">110</span>, <span class="hljs-number">90</span>, <span class="hljs-number">160</span>, <span class="hljs-number">82</span>, <span class="hljs-number">59</span>, <span class="hljs-number">214</span>, <span class="hljs-number">179</span>, <span class="hljs-number">41</span>, <span class="hljs-number">227</span>, <span class="hljs-number">47</span>, <span class="hljs-number">132</span>],<br>             [<span class="hljs-number">83</span>, <span class="hljs-number">209</span>, <span class="hljs-number">0</span>, <span class="hljs-number">237</span>, <span class="hljs-number">32</span>, <span class="hljs-number">252</span>, <span class="hljs-number">177</span>, <span class="hljs-number">91</span>, <span class="hljs-number">106</span>, <span class="hljs-number">203</span>, <span class="hljs-number">190</span>, <span class="hljs-number">57</span>, <span class="hljs-number">74</span>, <span class="hljs-number">76</span>, <span class="hljs-number">88</span>, <span class="hljs-number">207</span>],<br>             [<span class="hljs-number">208</span>, <span class="hljs-number">239</span>, <span class="hljs-number">170</span>, <span class="hljs-number">251</span>, <span class="hljs-number">67</span>, <span class="hljs-number">77</span>, <span class="hljs-number">51</span>, <span class="hljs-number">133</span>, <span class="hljs-number">69</span>, <span class="hljs-number">249</span>, <span class="hljs-number">2</span>, <span class="hljs-number">127</span>, <span class="hljs-number">80</span>, <span class="hljs-number">60</span>, <span class="hljs-number">159</span>, <span class="hljs-number">168</span>],<br>             [<span class="hljs-number">81</span>, <span class="hljs-number">163</span>, <span class="hljs-number">64</span>, <span class="hljs-number">143</span>, <span class="hljs-number">146</span>, <span class="hljs-number">157</span>, <span class="hljs-number">56</span>, <span class="hljs-number">245</span>, <span class="hljs-number">188</span>, <span class="hljs-number">182</span>, <span class="hljs-number">218</span>, <span class="hljs-number">33</span>, <span class="hljs-number">16</span>, <span class="hljs-number">255</span>, <span class="hljs-number">243</span>, <span class="hljs-number">210</span>],<br>             [<span class="hljs-number">151</span>, <span class="hljs-number">205</span>, <span class="hljs-number">12</span>, <span class="hljs-number">19</span>, <span class="hljs-number">236</span>, <span class="hljs-number">95</span>, <span class="hljs-number">68</span>, <span class="hljs-number">23</span>, <span class="hljs-number">196</span>, <span class="hljs-number">167</span>, <span class="hljs-number">126</span>, <span class="hljs-number">61</span>, <span class="hljs-number">100</span>, <span class="hljs-number">93</span>, <span class="hljs-number">25</span>, <span class="hljs-number">115</span>],<br>             [<span class="hljs-number">96</span>, <span class="hljs-number">129</span>, <span class="hljs-number">79</span>, <span class="hljs-number">220</span>, <span class="hljs-number">34</span>, <span class="hljs-number">42</span>, <span class="hljs-number">144</span>, <span class="hljs-number">136</span>, <span class="hljs-number">70</span>, <span class="hljs-number">238</span>, <span class="hljs-number">184</span>, <span class="hljs-number">20</span>, <span class="hljs-number">222</span>, <span class="hljs-number">94</span>, <span class="hljs-number">11</span>, <span class="hljs-number">219</span>],<br>             [<span class="hljs-number">224</span>, <span class="hljs-number">50</span>, <span class="hljs-number">58</span>, <span class="hljs-number">10</span>, <span class="hljs-number">73</span>, <span class="hljs-number">6</span>, <span class="hljs-number">36</span>, <span class="hljs-number">92</span>, <span class="hljs-number">194</span>, <span class="hljs-number">211</span>, <span class="hljs-number">172</span>, <span class="hljs-number">98</span>, <span class="hljs-number">145</span>, <span class="hljs-number">149</span>, <span class="hljs-number">228</span>, <span class="hljs-number">121</span>],<br>             [<span class="hljs-number">231</span>, <span class="hljs-number">200</span>, <span class="hljs-number">55</span>, <span class="hljs-number">109</span>, <span class="hljs-number">141</span>, <span class="hljs-number">213</span>, <span class="hljs-number">78</span>, <span class="hljs-number">169</span>, <span class="hljs-number">108</span>, <span class="hljs-number">86</span>, <span class="hljs-number">244</span>, <span class="hljs-number">234</span>, <span class="hljs-number">101</span>, <span class="hljs-number">122</span>, <span class="hljs-number">174</span>, <span class="hljs-number">8</span>],<br>             [<span class="hljs-number">186</span>, <span class="hljs-number">120</span>, <span class="hljs-number">37</span>, <span class="hljs-number">46</span>, <span class="hljs-number">28</span>, <span class="hljs-number">166</span>, <span class="hljs-number">180</span>, <span class="hljs-number">198</span>, <span class="hljs-number">232</span>, <span class="hljs-number">221</span>, <span class="hljs-number">116</span>, <span class="hljs-number">31</span>, <span class="hljs-number">75</span>, <span class="hljs-number">189</span>, <span class="hljs-number">139</span>, <span class="hljs-number">138</span>],<br>             [<span class="hljs-number">112</span>, <span class="hljs-number">62</span>, <span class="hljs-number">181</span>, <span class="hljs-number">102</span>, <span class="hljs-number">72</span>, <span class="hljs-number">3</span>, <span class="hljs-number">246</span>, <span class="hljs-number">14</span>, <span class="hljs-number">97</span>, <span class="hljs-number">53</span>, <span class="hljs-number">87</span>, <span class="hljs-number">185</span>, <span class="hljs-number">134</span>, <span class="hljs-number">193</span>, <span class="hljs-number">29</span>, <span class="hljs-number">158</span>],<br>             [<span class="hljs-number">225</span>, <span class="hljs-number">248</span>, <span class="hljs-number">152</span>, <span class="hljs-number">17</span>, <span class="hljs-number">105</span>, <span class="hljs-number">217</span>, <span class="hljs-number">142</span>, <span class="hljs-number">148</span>, <span class="hljs-number">155</span>, <span class="hljs-number">30</span>, <span class="hljs-number">233</span>, <span class="hljs-number">206</span>, <span class="hljs-number">85</span>, <span class="hljs-number">40</span>, <span class="hljs-number">223</span>, <span class="hljs-number">140</span>],<br>             [<span class="hljs-number">161</span>, <span class="hljs-number">137</span>, <span class="hljs-number">13</span>, <span class="hljs-number">191</span>, <span class="hljs-number">230</span>, <span class="hljs-number">66</span>, <span class="hljs-number">104</span>, <span class="hljs-number">65</span>, <span class="hljs-number">153</span>, <span class="hljs-number">45</span>, <span class="hljs-number">15</span>, <span class="hljs-number">176</span>, <span class="hljs-number">84</span>, <span class="hljs-number">187</span>, <span class="hljs-number">22</span>, <span class="hljs-number">135</span>]]<br><br>    S_BOX_INV = [[<span class="hljs-number">82</span>, <span class="hljs-number">9</span>, <span class="hljs-number">106</span>, <span class="hljs-number">213</span>, <span class="hljs-number">48</span>, <span class="hljs-number">54</span>, <span class="hljs-number">165</span>, <span class="hljs-number">56</span>, <span class="hljs-number">191</span>, <span class="hljs-number">64</span>, <span class="hljs-number">163</span>, <span class="hljs-number">158</span>, <span class="hljs-number">130</span>, <span class="hljs-number">242</span>, <span class="hljs-number">215</span>, <span class="hljs-number">250</span>],<br>              [<span class="hljs-number">124</span>, <span class="hljs-number">227</span>, <span class="hljs-number">57</span>, <span class="hljs-number">131</span>, <span class="hljs-number">155</span>, <span class="hljs-number">47</span>, <span class="hljs-number">254</span>, <span class="hljs-number">135</span>, <span class="hljs-number">52</span>, <span class="hljs-number">142</span>, <span class="hljs-number">67</span>, <span class="hljs-number">68</span>, <span class="hljs-number">196</span>, <span class="hljs-number">222</span>, <span class="hljs-number">233</span>, <span class="hljs-number">203</span>],<br>              [<span class="hljs-number">84</span>, <span class="hljs-number">123</span>, <span class="hljs-number">148</span>, <span class="hljs-number">50</span>, <span class="hljs-number">166</span>, <span class="hljs-number">194</span>, <span class="hljs-number">35</span>, <span class="hljs-number">61</span>, <span class="hljs-number">237</span>, <span class="hljs-number">76</span>, <span class="hljs-number">149</span>, <span class="hljs-number">11</span>, <span class="hljs-number">66</span>, <span class="hljs-number">249</span>, <span class="hljs-number">195</span>, <span class="hljs-number">78</span>],<br>              [<span class="hljs-number">8</span>, <span class="hljs-number">46</span>, <span class="hljs-number">161</span>, <span class="hljs-number">102</span>, <span class="hljs-number">40</span>, <span class="hljs-number">217</span>, <span class="hljs-number">36</span>, <span class="hljs-number">178</span>, <span class="hljs-number">118</span>, <span class="hljs-number">91</span>, <span class="hljs-number">162</span>, <span class="hljs-number">73</span>, <span class="hljs-number">109</span>, <span class="hljs-number">139</span>, <span class="hljs-number">209</span>, <span class="hljs-number">37</span>],<br>              [<span class="hljs-number">114</span>, <span class="hljs-number">247</span>, <span class="hljs-number">245</span>, <span class="hljs-number">100</span>, <span class="hljs-number">134</span>, <span class="hljs-number">104</span>, <span class="hljs-number">152</span>, <span class="hljs-number">14</span>, <span class="hljs-number">212</span>, <span class="hljs-number">164</span>, <span class="hljs-number">92</span>, <span class="hljs-number">204</span>, <span class="hljs-number">93</span>, <span class="hljs-number">101</span>, <span class="hljs-number">182</span>, <span class="hljs-number">146</span>],<br>              [<span class="hljs-number">108</span>, <span class="hljs-number">112</span>, <span class="hljs-number">72</span>, <span class="hljs-number">80</span>, <span class="hljs-number">252</span>, <span class="hljs-number">236</span>, <span class="hljs-number">185</span>, <span class="hljs-number">218</span>, <span class="hljs-number">94</span>, <span class="hljs-number">22</span>, <span class="hljs-number">70</span>, <span class="hljs-number">87</span>, <span class="hljs-number">167</span>, <span class="hljs-number">141</span>, <span class="hljs-number">157</span>, <span class="hljs-number">133</span>],<br>              [<span class="hljs-number">144</span>, <span class="hljs-number">216</span>, <span class="hljs-number">171</span>, <span class="hljs-number">17</span>, <span class="hljs-number">140</span>, <span class="hljs-number">188</span>, <span class="hljs-number">211</span>, <span class="hljs-number">10</span>, <span class="hljs-number">246</span>, <span class="hljs-number">228</span>, <span class="hljs-number">88</span>, <span class="hljs-number">5</span>, <span class="hljs-number">184</span>, <span class="hljs-number">179</span>, <span class="hljs-number">69</span>, <span class="hljs-number">6</span>],<br>              [<span class="hljs-number">208</span>, <span class="hljs-number">44</span>, <span class="hljs-number">30</span>, <span class="hljs-number">143</span>, <span class="hljs-number">202</span>, <span class="hljs-number">63</span>, <span class="hljs-number">16</span>, <span class="hljs-number">3</span>, <span class="hljs-number">193</span>, <span class="hljs-number">175</span>, <span class="hljs-number">189</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">20</span>, <span class="hljs-number">138</span>, <span class="hljs-number">107</span>],<br>              [<span class="hljs-number">58</span>, <span class="hljs-number">145</span>, <span class="hljs-number">18</span>, <span class="hljs-number">65</span>, <span class="hljs-number">79</span>, <span class="hljs-number">103</span>, <span class="hljs-number">220</span>, <span class="hljs-number">255</span>, <span class="hljs-number">151</span>, <span class="hljs-number">241</span>, <span class="hljs-number">207</span>, <span class="hljs-number">206</span>, <span class="hljs-number">239</span>, <span class="hljs-number">180</span>, <span class="hljs-number">230</span>, <span class="hljs-number">115</span>],<br>              [<span class="hljs-number">150</span>, <span class="hljs-number">172</span>, <span class="hljs-number">116</span>, <span class="hljs-number">34</span>, <span class="hljs-number">231</span>, <span class="hljs-number">173</span>, <span class="hljs-number">53</span>, <span class="hljs-number">128</span>, <span class="hljs-number">226</span>, <span class="hljs-number">248</span>, <span class="hljs-number">55</span>, <span class="hljs-number">232</span>, <span class="hljs-number">28</span>, <span class="hljs-number">117</span>, <span class="hljs-number">223</span>, <span class="hljs-number">110</span>],<br>              [<span class="hljs-number">71</span>, <span class="hljs-number">240</span>, <span class="hljs-number">26</span>, <span class="hljs-number">113</span>, <span class="hljs-number">29</span>, <span class="hljs-number">41</span>, <span class="hljs-number">197</span>, <span class="hljs-number">137</span>, <span class="hljs-number">111</span>, <span class="hljs-number">183</span>, <span class="hljs-number">98</span>, <span class="hljs-number">15</span>, <span class="hljs-number">170</span>, <span class="hljs-number">24</span>, <span class="hljs-number">190</span>, <span class="hljs-number">27</span>],<br>              [<span class="hljs-number">251</span>, <span class="hljs-number">86</span>, <span class="hljs-number">62</span>, <span class="hljs-number">75</span>, <span class="hljs-number">198</span>, <span class="hljs-number">210</span>, <span class="hljs-number">121</span>, <span class="hljs-number">32</span>, <span class="hljs-number">154</span>, <span class="hljs-number">219</span>, <span class="hljs-number">192</span>, <span class="hljs-number">253</span>, <span class="hljs-number">120</span>, <span class="hljs-number">205</span>, <span class="hljs-number">90</span>, <span class="hljs-number">243</span>],<br>              [<span class="hljs-number">31</span>, <span class="hljs-number">221</span>, <span class="hljs-number">168</span>, <span class="hljs-number">51</span>, <span class="hljs-number">136</span>, <span class="hljs-number">7</span>, <span class="hljs-number">199</span>, <span class="hljs-number">49</span>, <span class="hljs-number">177</span>, <span class="hljs-number">19</span>, <span class="hljs-number">1</span>, <span class="hljs-number">89</span>, <span class="hljs-number">39</span>, <span class="hljs-number">129</span>, <span class="hljs-number">235</span>, <span class="hljs-number">95</span>],<br>              [<span class="hljs-number">96</span>, <span class="hljs-number">81</span>, <span class="hljs-number">127</span>, <span class="hljs-number">169</span>, <span class="hljs-number">25</span>, <span class="hljs-number">181</span>, <span class="hljs-number">74</span>, <span class="hljs-number">13</span>, <span class="hljs-number">45</span>, <span class="hljs-number">229</span>, <span class="hljs-number">122</span>, <span class="hljs-number">159</span>, <span class="hljs-number">147</span>, <span class="hljs-number">201</span>, <span class="hljs-number">156</span>, <span class="hljs-number">238</span>],<br>              [<span class="hljs-number">160</span>, <span class="hljs-number">224</span>, <span class="hljs-number">59</span>, <span class="hljs-number">77</span>, <span class="hljs-number">174</span>, <span class="hljs-number">42</span>, <span class="hljs-number">244</span>, <span class="hljs-number">176</span>, <span class="hljs-number">200</span>, <span class="hljs-number">234</span>, <span class="hljs-number">187</span>, <span class="hljs-number">60</span>, <span class="hljs-number">132</span>, <span class="hljs-number">83</span>, <span class="hljs-number">153</span>, <span class="hljs-number">97</span>],<br>              [<span class="hljs-number">23</span>, <span class="hljs-number">43</span>, <span class="hljs-number">4</span>, <span class="hljs-number">126</span>, <span class="hljs-number">186</span>, <span class="hljs-number">119</span>, <span class="hljs-number">214</span>, <span class="hljs-number">38</span>, <span class="hljs-number">225</span>, <span class="hljs-number">105</span>, <span class="hljs-number">21</span>, <span class="hljs-number">99</span>, <span class="hljs-number">85</span>, <span class="hljs-number">33</span>, <span class="hljs-number">12</span>, <span class="hljs-number">125</span>]]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">SubBytes</span>(<span class="hljs-params">self, state, inv=<span class="hljs-literal">False</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        对输入的state进行S盒置换。</span><br><span class="hljs-string">        state是一个16个字节元素的列表，以一维形式访问</span><br><span class="hljs-string">        返回值是变换后的二维列表</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">for</span> i,v <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(state):<br>            <span class="hljs-keyword">if</span> inv == <span class="hljs-literal">False</span>:<br>                state[i] = <span class="hljs-variable language_">self</span>.S_BOX[v&gt;&gt;<span class="hljs-number">4</span>][v&amp;<span class="hljs-number">0xf</span>]<br>            <span class="hljs-keyword">else</span>:<br>                state[i] = <span class="hljs-variable language_">self</span>.S_BOX_INV[v&gt;&gt;<span class="hljs-number">4</span>][v&amp;<span class="hljs-number">0xf</span>]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">ShiftRows</span>(<span class="hljs-params">self, state, inv=<span class="hljs-literal">False</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        state是一个16个字节元素的列表，以一维形式访问</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>            <span class="hljs-keyword">if</span> inv == <span class="hljs-literal">False</span>:<br>                state[i::<span class="hljs-number">4</span>] = state[i::<span class="hljs-number">4</span>][i:] + state[i::<span class="hljs-number">4</span>][:i] <span class="hljs-comment"># 左移</span><br>            <span class="hljs-keyword">else</span>:<br>                state[i::<span class="hljs-number">4</span>] = state[i::<span class="hljs-number">4</span>][-i:] + state[i::<span class="hljs-number">4</span>][:-i]   <span class="hljs-comment"># 右移</span><br><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">MixColumns</span>(<span class="hljs-params">self, state, inv=<span class="hljs-literal">False</span></span>):<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">GFmul_by_2</span>(<span class="hljs-params">n</span>):<br>            <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">            这个计算是有数学意义的，不是简单的乘法运算，原理可自行了解GF域的定义。</span><br><span class="hljs-string">            :param n:</span><br><span class="hljs-string">            :return:</span><br><span class="hljs-string">            &quot;&quot;&quot;</span><br>            s = (n &lt;&lt; <span class="hljs-number">1</span>) &amp; <span class="hljs-number">0xff</span><br>            <span class="hljs-keyword">if</span> n &amp; <span class="hljs-number">128</span>:<br>                s ^= <span class="hljs-number">0x1b</span><br>            <span class="hljs-keyword">return</span> s<br><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">GFmul_by_3</span>(<span class="hljs-params">n</span>):<br>            <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">            :param n:</span><br><span class="hljs-string">            :return:</span><br><span class="hljs-string">            &quot;&quot;&quot;</span><br>            <span class="hljs-keyword">return</span> n ^ GFmul_by_2(n)<br><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">mix_column</span>(<span class="hljs-params">c</span>):<br>            <span class="hljs-keyword">return</span> [<br>                GFmul_by_2(c[<span class="hljs-number">0</span>]) ^ GFmul_by_3(c[<span class="hljs-number">1</span>]) ^ c[<span class="hljs-number">2</span>] ^ c[<span class="hljs-number">3</span>],<br>                GFmul_by_2(c[<span class="hljs-number">1</span>]) ^ GFmul_by_3(c[<span class="hljs-number">2</span>]) ^ c[<span class="hljs-number">3</span>] ^ c[<span class="hljs-number">0</span>],<br>                GFmul_by_2(c[<span class="hljs-number">2</span>]) ^ GFmul_by_3(c[<span class="hljs-number">3</span>]) ^ c[<span class="hljs-number">0</span>] ^ c[<span class="hljs-number">1</span>],<br>                GFmul_by_2(c[<span class="hljs-number">3</span>]) ^ GFmul_by_3(c[<span class="hljs-number">0</span>]) ^ c[<span class="hljs-number">1</span>] ^ c[<span class="hljs-number">2</span>]<br>            ]<br><br>        <span class="hljs-keyword">if</span> inv == <span class="hljs-literal">False</span>:<br>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">16</span>, <span class="hljs-number">4</span>):<br>                state[i:i + <span class="hljs-number">4</span>] = mix_column(state[i:i + <span class="hljs-number">4</span>])<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">16</span>, <span class="hljs-number">4</span>):<br>                <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>                    state[i:i + <span class="hljs-number">4</span>] = mix_column(state[i:i + <span class="hljs-number">4</span>])<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">AddRoundKey</span>(<span class="hljs-params">self, state, key</span>):<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>):<br>            state[i] ^= key[i]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">key_expansion</span>(<span class="hljs-params">self, key</span>):<br>        key = <span class="hljs-built_in">bytearray</span>(key)<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span> * <span class="hljs-number">4</span>):<br>            r = key[-<span class="hljs-number">4</span>:]<br>            r = <span class="hljs-built_in">bytearray</span>(r)<br>            <span class="hljs-keyword">if</span> i % <span class="hljs-number">4</span> == <span class="hljs-number">0</span>:  <span class="hljs-comment"># 对上一轮最后4字节，先循环左移一位，再S-box置换、轮常数异或，从而计算出当前新一轮最前4字节</span><br>                <span class="hljs-keyword">for</span> j, v <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(r[<span class="hljs-number">1</span>:] + r[:<span class="hljs-number">1</span>]):<br>                    r[j] = <span class="hljs-variable language_">self</span>.S_BOX[v &gt;&gt; <span class="hljs-number">4</span>][v &amp; <span class="hljs-number">0xf</span>] ^ (<span class="hljs-variable language_">self</span>.RCON[i // <span class="hljs-number">4</span>] <span class="hljs-keyword">if</span> j == <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>)<br><br>            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>                key.append(key[-<span class="hljs-number">16</span>] ^ r[j])<br><br>        <span class="hljs-keyword">return</span> key<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt</span>(<span class="hljs-params">self, b, expanded_key</span>):<br>        <span class="hljs-variable language_">self</span>.AddRoundKey(b, expanded_key)<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>):<br>            <span class="hljs-variable language_">self</span>.SubBytes(b)<br>            <span class="hljs-variable language_">self</span>.ShiftRows(b)<br>            <span class="hljs-variable language_">self</span>.MixColumns(b)<br>            <span class="hljs-variable language_">self</span>.AddRoundKey(b, expanded_key[i*<span class="hljs-number">16</span>:])<br><br>        <span class="hljs-variable language_">self</span>.SubBytes(b)<br>        <span class="hljs-variable language_">self</span>.ShiftRows(b)<br>        <span class="hljs-variable language_">self</span>.AddRoundKey(b, expanded_key[-<span class="hljs-number">16</span>:])<br>        <span class="hljs-keyword">return</span> b<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">self, b, expanded_key</span>):<br>        <span class="hljs-variable language_">self</span>.AddRoundKey(b, expanded_key[-<span class="hljs-number">16</span>:])<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">9</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>):<br>            <span class="hljs-variable language_">self</span>.ShiftRows(b, inv=<span class="hljs-literal">True</span>)<br>            <span class="hljs-variable language_">self</span>.SubBytes(b, inv=<span class="hljs-literal">True</span>)<br>            <span class="hljs-variable language_">self</span>.AddRoundKey(b, expanded_key[i*<span class="hljs-number">16</span>:])<br>            <span class="hljs-variable language_">self</span>.MixColumns(b, inv=<span class="hljs-literal">True</span>)<br><br>        <span class="hljs-variable language_">self</span>.ShiftRows(b, inv=<span class="hljs-literal">True</span>)<br>        <span class="hljs-variable language_">self</span>.SubBytes(b, inv=<span class="hljs-literal">True</span>)<br>        <span class="hljs-variable language_">self</span>.AddRoundKey(b, expanded_key)<br>        <span class="hljs-keyword">return</span> b<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">aes_ecb</span>(<span class="hljs-params">self,<span class="hljs-built_in">type</span>, key, msg</span>):<br>        expanded_key = <span class="hljs-variable language_">self</span>.key_expansion(key)<br>        b = <span class="hljs-built_in">bytearray</span>(msg)<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span> == <span class="hljs-number">0</span>:<br>            b = <span class="hljs-built_in">bytearray</span>(msg+<span class="hljs-string">b&#x27;\x00&#x27;</span>*(<span class="hljs-number">16</span> - <span class="hljs-built_in">len</span>(msg)%<span class="hljs-number">16</span>))<br><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(b), <span class="hljs-number">16</span>):<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span> == <span class="hljs-number">0</span>:<br>                b[i:i+<span class="hljs-number">16</span>] = <span class="hljs-variable language_">self</span>.encrypt(b[i:i+<span class="hljs-number">16</span>], expanded_key)<br>            <span class="hljs-keyword">else</span>:<br>                b[i:i+<span class="hljs-number">16</span>] = <span class="hljs-variable language_">self</span>.decrypt(b[i:i+<span class="hljs-number">16</span>], expanded_key)<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(b)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    key = <span class="hljs-string">b&#x27;SYCLOVERSYCLOVER&#x27;</span><br>    aes = AES()<br>    dec = aes.aes_ecb(<span class="hljs-number">1</span>, <span class="hljs-built_in">bytearray</span>(key), <span class="hljs-string">b&#x27;\x99\xe8\xb8\x01\xc8\x82\x51\x93\x12\xee\x89\x64\xe7\xef\x63\x8d\x51\xdf\x5d\x78\x39\xaa\x39\x62\xa0\xb4\x50\x30\x47\x30\x21\x06&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Decrypted:&#x27;</span>, dec)<span class="hljs-comment">#SYC&#123;B3l1eue_Th@t_y0u__l3aRn_Aes&#125;</span><br></code></pre></td></tr></table></figure><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/af78d0f39e337f6562dcfb2001f2d726/image-20250705173544896.png" alt="image-20250705173544896"><h1 id="blasting-master"><a href="#blasting-master" class="headerlink" title="blasting_master"></a>blasting_master</h1><p>​无壳64位程序，IDA打开看到main函数，先是等待输入，然后循环，最后比较。我是调试了一遍，变量名变成了这个样子。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/af78d0f39e337f6562dcfb2001f2d726/image-20250706172043004.png" alt="image-20250706172043004"><p>​先看循环的逻辑，进入<strong>sub_555555555464</strong>函数，其中有个全局变量<strong>dword_555555558040</strong>，初始值为0，函数每运行一次加1，<strong>v4</strong>存储输入字符串中的4个连续字符，其起始地址由<strong>8040</strong>变量决定。很明显看出来，每运行一次这个函数，就会往后1个字符。比如输入是<strong>SYC{AAA}</strong>，那么第一次就是取<strong>SYC{</strong>，第二次就是<strong>YC{A</strong>。</p><p>​<strong>sub_5555555553E2</strong>函数里面的代码比较陌生，还是问AI才知道这是使用OpenSSL库计算MD5值的函数。</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c">__int64 __fastcall <span class="hljs-title function_">sub_5555555553E2</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *a1, __int64 a2)</span><br>&#123;<br>  __int64 v2; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">size_t</span> v3; <span class="hljs-comment">// rax</span><br>  __int64 v5; <span class="hljs-comment">// [rsp+18h] [rbp-8h]</span><br><br>  v5 = EVP_MD_CTX_new();<br>  v2 = EVP_md5();<br>  EVP_DigestInit_ex(v5, v2, <span class="hljs-number">0LL</span>);<br>  v3 = <span class="hljs-built_in">strlen</span>(a1);<br>  EVP_DigestUpdate(v5, a1, v3);<br>  EVP_DigestFinal_ex(v5, a2, <span class="hljs-number">0LL</span>);<br>  <span class="hljs-keyword">return</span> EVP_MD_CTX_free(v5);<br>&#125;<br></code></pre></td></tr></table></figure><p>​再下面就是16次循环处理得到的MD5值了，逻辑很清楚，只需要注意<strong>s2</strong>是字节数组。那这个函数就很清楚了，每次截取4个字符，计算MD5值，进行加密，然后存储到内存空间s2中去，<strong>dword_555555558040</strong>存储的就是MD5值个数。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/af78d0f39e337f6562dcfb2001f2d726/image-20250706172211561.png" alt="image-20250706172211561"><p>​退回到main函数，循环结束条件是和<strong>byte_5555555582DE</strong>的值有关的，其非0即可停止循环。查看内存空间看到，该变量在s2尾部，因为每次写入的MD5是16个字节长度，即0x10，所以只有当写入<code>(0x82E0-0x8060)/0x10=28</code>个MD5值后，s2才会溢出到这个地方，使得循环退出。那我们也能得知到flag的长度就是3+28&#x3D;31个字符长度。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/af78d0f39e337f6562dcfb2001f2d726/image-20250706173208026.png" alt="image-20250706173208026"><p>​接下来的比较就没什么好说的了。取出MD5密文，解密后进行爆破即可。根据题目名称和提示也能猜到这题就是考爆破的，代码如下。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> hashlib<br><br>en_md5 = <span class="hljs-string">&quot;b250a0bc3a7f546d96070f719a72eba5a0b571a46ab8bafae431c3715429a759202b1321bd675f8d653a0227084f929cb57cdf6934b8822df6ca7a659863dc512a34974ff8bc231f38a8a62fa90d644cac2ff9f52db191a8d576d92dc6ac2e6932d5641dc13cecf52c90edf4178b554ce46c3bb3da29c07b39df9273fcc9c2a86811222b643f129b95732a05d33f2e33f185ed077b868f622d7903ac80cef5b2a00cf7e1c50e6327d16523ea5a1c020b32ba1fe5c722a56677ea5be464ab8b60b6df00dcf76d93ec2f2f680750e0d11a3fc64e2ec6bbae0840d85b11b5dc15357f63493e5b9c0dfc0db680b72b00ef3c0c2feb864457749e5f1f8ba1c901f1d8f49282956f85d215221ff09fd1ab51399ab6c4dafb388de68c57195e94da57ccf0b90a4a1782fcc54f4b5aa5f4e53efa3a0af4b48e7f25847590cd3587ebc3ce812b86c9167e85682df1db8e7415cf955107885e1be937c95bba61eb9f7be48910f06ecd7571ad09745849a3f533837522951be33c48055cada86bfd41ebafc60228c65ecf36ae50ce93f270889d3f4a9f86e76764b002960cab9feb4b034492de6cf4ce324f4f38e25259ca954a11d830a27bd53ae611da3a4a3361396526d278bcedbda58b2b874c95472502ba833ddce46aad67dd22b1bd2b7c53113cd923063d20ba28c82d8951576382a0c8a8de2961c15351b0bc3704eec9358aa8a266ba6f24b63f62416d1046cb061239d90ef9dc19a765b8c040bef6999aaf0216374da5754c424b1af052da38f36ba91adcfa80b060b1fd737b78d9628326bf163371796f112fe9a7bb4646d68ff6217efc6812866bfc51c9707a74bc8f6e0b86426f5cfdf74e2771fe37e6c86247fcd56cba5cd9295a73aec38ff0469532422dd0&quot;</span><br>flag = <span class="hljs-string">&quot;SYC&#123;&quot;</span><br>de_md5 = []<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(en_md5)//<span class="hljs-number">32</span>):<br>    tp_str = en_md5[i*<span class="hljs-number">32</span>:i*<span class="hljs-number">32</span>+<span class="hljs-number">32</span>]<br>    t = [<span class="hljs-built_in">int</span>(tp_str[j:j+<span class="hljs-number">2</span>], <span class="hljs-number">16</span>) <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(tp_str), <span class="hljs-number">2</span>)]<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>):<br>        t[j] = t[j] - (j % <span class="hljs-number">15</span>) * <span class="hljs-number">82</span><br>        t[j] = t[j] % <span class="hljs-number">256</span><br>        <span class="hljs-keyword">while</span> (t[j] % <span class="hljs-number">7</span> != <span class="hljs-number">0</span>):<br>            t[j] += <span class="hljs-number">256</span><br>        t[j] //= <span class="hljs-number">7</span><br>        t[j] ^= (j + <span class="hljs-number">42</span>)<br>    md5_str = <span class="hljs-string">&quot;&quot;</span>.join(<span class="hljs-built_in">hex</span>(t[j])[<span class="hljs-number">2</span>:].zfill(<span class="hljs-number">2</span>) <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>))<br>    de_md5.append(md5_str)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-built_in">len</span>(de_md5)):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>,<span class="hljs-number">127</span>):<br>        test_str = flag[-<span class="hljs-number">3</span>:] + <span class="hljs-built_in">chr</span>(j)<br>        test_md5 = hashlib.md5(test_str.encode()).hexdigest()<br>        <span class="hljs-keyword">if</span> test_md5 == de_md5[i]:<br>            flag += <span class="hljs-built_in">chr</span>(j)<br>            <span class="hljs-keyword">break</span><br><br><span class="hljs-built_in">print</span>(flag)<span class="hljs-comment">#SYC&#123;W0w!y0u_@re_th3_BeSt_blasting_Exp3rt!!&#125;</span><br></code></pre></td></tr></table></figure><h1 id="ez-hook"><a href="#ez-hook" class="headerlink" title="ez_hook"></a>ez_hook</h1><p>​无壳64位，打开看到一个简单的反调试，直接把<strong>jz</strong>（74）改为<strong>jmp</strong>（EB）。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/af78d0f39e337f6562dcfb2001f2d726/image-20250706185725865.png" alt="image-20250706185725865"><p>​然后看到<strong>sub_4016E4</strong>函数，调试分析其输出的<strong>v6</strong>变量，应该是对flag进行顺序打乱的，这个简单，通过测试输入，得到输出就可以固定“映射方式”。</p><p>​然后准备调试<strong>sub_4017E0</strong>函数的时候，发现根本没进去，怎么回事！原来在4016E4函数的结尾对内存中的函数进行了修改，在<strong>sub_4017E0</strong>函数头加了个jmp跳转，相对跳转（E9），跳到了<strong>sub_4018B4</strong>函数头。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/af78d0f39e337f6562dcfb2001f2d726/image-20250706190048229.png" alt="image-20250706190048229"><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c">BOOL __fastcall <span class="hljs-title function_">sub_401911</span><span class="hljs-params">(_BYTE *a1, <span class="hljs-type">int</span> a2)</span><br>&#123;<br>  __int64 v3; <span class="hljs-comment">// [rsp+2Bh] [rbp-15h]</span><br>  DWORD flOldProtect; <span class="hljs-comment">// [rsp+34h] [rbp-Ch] BYREF</span><br>  SIZE_T dwSize; <span class="hljs-comment">// [rsp+38h] [rbp-8h]</span><br><br>  dwSize = <span class="hljs-number">5LL</span>;<span class="hljs-comment">//表示将要操作的内存区域大小</span><br>    <br>    <span class="hljs-comment">//修改内存保护，改变内存区域 a1 所指向的 5 字节的保护属性，0x40u表示将内存区域设为可写（PAGE_EXECUTE_READWRITE），这样就可以修改内存。</span><br>  VirtualProtect(a1, <span class="hljs-number">5uLL</span>, <span class="hljs-number">0x40u</span>, &amp;flOldProtect);<br>    <br>    <span class="hljs-comment">//构造指令，E9是jmp的操作码，后一行是在算地址偏移，-5是因为程序写入跳转指令已经占据了5字节。</span><br>  LOBYTE(v3) = <span class="hljs-number">0xE9</span>;<br>  *(_DWORD *)((<span class="hljs-type">char</span> *)&amp;v3 + <span class="hljs-number">1</span>) = a2 - (_DWORD)a1 - <span class="hljs-number">5</span>;<br>    <br>    <span class="hljs-comment">//修改内存内容，先写4字节，再写1字节。</span><br>  *(_DWORD *)a1 = v3;<br>  a1[<span class="hljs-number">4</span>] = BYTE4(v3);<br>    <br>    <span class="hljs-comment">//恢复内存保护。</span><br>  <span class="hljs-keyword">return</span> VirtualProtect(a1, dwSize, flOldProtect, &amp;flOldProtect);<br>&#125;<br></code></pre></td></tr></table></figure><p>​而<strong>sub_4018B4</strong>函数很明显看出来是异或7，所以解密脚本如下。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">enc = <span class="hljs-string">&quot;zoXpih^lhX6soX7lr~DTHtGpX|&quot;</span><br><span class="hljs-built_in">input</span> = <span class="hljs-string">&quot;SYC&#123;abcdefghijklmnopqrstu&#125;&quot;</span><br>encst = <span class="hljs-string">&quot;&#125;rnjfbYusqomkigecaCStplhd&#123;&quot;</span><span class="hljs-comment">#调试提取v6的值得到</span><br>enflag = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(enc)):<br>    enflag += <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(enc[i]) ^ <span class="hljs-number">7</span>)<br>flag = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(enflag)):<br>    flag += enflag[encst.index(<span class="hljs-built_in">input</span>[i])]<br><span class="hljs-built_in">print</span>(flag)<span class="hljs-comment">#SYC&#123;you_kn0w_wh@t_1s_hoOk&#125;</span><br></code></pre></td></tr></table></figure><p>​其实也可以看看<strong>sub_4016E4</strong>函数的置换逻辑，首先外循环是3轮，<strong>v7</strong>是步长，先后是4、2、0。<strong>Enflag</strong>（简称e）是从下标0开始，到结束依次赋值的，<strong>v12</strong>就是其下标。</p><p>​算了，细究起来发现前面的<strong>sub_40167D</strong>函数对flag也进行了打乱，4016E4是进行第二次打乱了。有点复杂，不想看啊，不想调了，就这样吧！</p><p>​找了一个别人的脚本，包括顺序还原的，随便看看吧。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">c=<span class="hljs-string">&#x27;zoXpih^lhX6soX7lr~DTHtGpX|&#x27;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">reverse_flag</span>(<span class="hljs-params">a3, a2</span>):<br>    v8 = <span class="hljs-built_in">len</span>(a3)  <span class="hljs-comment"># a3 的长度</span><br>    a1 = [<span class="hljs-string">&#x27;&#x27;</span>] * v8  <span class="hljs-comment"># 初始化 a1 为长度为 v8 的空字符串列表</span><br>    v12 = <span class="hljs-number">0</span>  <span class="hljs-comment"># 计数器，用于跟踪读取 a3 的位置</span><br> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(a2):<br>        v9 = i<br>        v7 = <span class="hljs-number">2</span> * (a2 - i - <span class="hljs-number">1</span>)<br>        j = <span class="hljs-number">2</span> * i<br>        <span class="hljs-keyword">while</span> v9 &lt; v8:<br>            <span class="hljs-keyword">if</span> v7:<br>                a1[v9] = a3[v12]<br>                v12 += <span class="hljs-number">1</span><br>            v10 = v7 + v9<br>            <span class="hljs-keyword">if</span> v10 &gt;= v8:<br>                <span class="hljs-keyword">break</span><br>            <span class="hljs-keyword">if</span> j:<br>                a1[v10] = a3[v12]<br>                v12 += <span class="hljs-number">1</span><br>            v9 = j + v10<br>    <span class="hljs-keyword">return</span> a1<br>a2 = <span class="hljs-number">3</span>  <span class="hljs-comment"># 已知的 a2 值</span><br>a3=[<span class="hljs-number">0</span>]*<span class="hljs-built_in">len</span>(c)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(c)):<br>    a3[i]=<span class="hljs-built_in">ord</span>(c[i]) ^ <span class="hljs-number">7</span><br>reversed_flag = reverse_flag(a3, a2)<br>flag=<span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> reversed_flag:<br>    flag+=<span class="hljs-built_in">chr</span>(a)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Reversed flag:&quot;</span>, flag[::-<span class="hljs-number">1</span>])<br></code></pre></td></tr></table></figure><h1 id="致我的星星"><a href="#致我的星星" class="headerlink" title="致我的星星"></a>致我的星星</h1><p>​<strong>好玩好玩！！！不玩包后悔的！！！强烈建议多做一会，这样就能少后悔一点。最好自己做出来</strong></p><p>​<strong>js</strong>逆向，第一次做，看到<strong>index.js</strong>，没有使用很难的东西，基础语法会点就能看懂了。还是解析一下。</p><p>​<strong>funclick</strong>函数是点击后更新界面的函数，然后<strong>fl</strong>被设置为处理键盘输入的响应函数，我们可以看到其比较MD5值后会调用<strong>typewrite</strong>函数，这是输出成功后提示信息的函数。所以我们的目标就是搞定这个MD5的字符串是什么。但是MD5爆破是不成功的（直接爆的也是狠人），只有继续看剩下的代码也没有什么提示了。</p><p>​从197行开始，其实就是“多余”的代码，当然，没有必要肯定是不会放这段代码的（<strong>反正我是没自己做出了，中间有脑洞没风暴成功！最后我是这样告诉自己的。</strong>）很明显，221行到274行是在做迷宫的初始化，<del>这我都明白</del>，为什么告诉了行列是10*20，结果data只有180个字符，还得自己补？这是我的第一个犹豫点，我也做过补了的尝试，继续往后看。</p><p>​第259到274行是纯提示选手自己计算出S和Y的坐标，但是有两个S和Y，我脑残了，这没能和后面联系起来，我的问题，短时间刷题刷多了是这样的。</p><p>​md，使用z3-solver还出了个错，之前脑残下了个z3包（不知道干嘛的），删也没删干净，污染了python环境，处理又浪费我的时间。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> z3 <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment">#声明整数变量</span><br>a1, a2, a3, a4, a5, a6, a7, a8 = Ints(<span class="hljs-string">&#x27;a1 a2 a3 a4 a5 a6 a7 a8&#x27;</span>)<br><br><span class="hljs-comment"># 创建求解器</span><br>s = Solver()<br><br><span class="hljs-comment"># 添加方程组</span><br>s.add(<span class="hljs-number">43654</span>*a1 - <span class="hljs-number">57003</span>*a2 -<span class="hljs-number">3158</span>*a3 + <span class="hljs-number">30120</span>*a4 -<span class="hljs-number">58621</span>*a5 -<span class="hljs-number">41947</span>*a6 +<span class="hljs-number">122237</span>*a7 +<span class="hljs-number">129534</span>*a8 == <span class="hljs-number">2594143</span>)<br>s.add(-<span class="hljs-number">48022</span>*a1 + <span class="hljs-number">18308</span>*a2 + <span class="hljs-number">52478</span>*a3 + <span class="hljs-number">69397</span>*a4  +<span class="hljs-number">49696</span>*a5 + <span class="hljs-number">12288</span>*a6 -<span class="hljs-number">40437</span>*a7 -<span class="hljs-number">23154</span>*a8 == <span class="hljs-number">651137</span>)<br>s.add(<span class="hljs-number">124109</span>*a1  +<span class="hljs-number">58952</span>*a2 + <span class="hljs-number">16645</span>*a3 -<span class="hljs-number">17531</span>*a4 + <span class="hljs-number">53139</span>*a5  +<span class="hljs-number">49937</span>*a6  + <span class="hljs-number">3282</span>*a7   +<span class="hljs-number">7656</span>*a8 == <span class="hljs-number">2071815</span>)<br>s.add(<span class="hljs-number">108286</span>*a1 + <span class="hljs-number">118886</span>*a2 +<span class="hljs-number">116876</span>*a3   +<span class="hljs-number">2281</span>*a4 -<span class="hljs-number">64590</span>*a5  -<span class="hljs-number">3021</span>*a6 + <span class="hljs-number">13386</span>*a7 -<span class="hljs-number">56070</span>*a8 == <span class="hljs-number">703</span>)<br>s.add(<span class="hljs-number">105983</span>*a1 + <span class="hljs-number">8794</span>*a2 + <span class="hljs-number">31851</span>*a3 -<span class="hljs-number">35052</span>*a4  -<span class="hljs-number">7880</span>*a5  + <span class="hljs-number">2183</span>*a6 + <span class="hljs-number">47575</span>*a7 +<span class="hljs-number">107236</span>*a8 == <span class="hljs-number">2511919</span>)<br>s.add(-<span class="hljs-number">38005</span>*a1 -<span class="hljs-number">6833</span>*a2 +<span class="hljs-number">107897</span>*a3 +<span class="hljs-number">119771</span>*a4 +<span class="hljs-number">124322</span>*a5 + <span class="hljs-number">13335</span>*a6+ <span class="hljs-number">121590</span>*a7 -<span class="hljs-number">17434</span>*a8 == <span class="hljs-number">4816084</span>)<br>s.add(<span class="hljs-number">60696</span>*a1 +<span class="hljs-number">95253</span>*a2 +<span class="hljs-number">101581</span>*a3 + <span class="hljs-number">93822</span>*a4 +<span class="hljs-number">112989</span>*a5  +<span class="hljs-number">65643</span>*a6  +<span class="hljs-number">45639</span>*a7 + <span class="hljs-number">26705</span>*a8 == <span class="hljs-number">5330538</span>)<br>s.add(<span class="hljs-number">49019</span>*a1 +<span class="hljs-number">72343</span>*a2 -<span class="hljs-number">21814</span>*a3  +<span class="hljs-number">85020</span>*a4 -<span class="hljs-number">62332</span>*a5  +<span class="hljs-number">99828</span>*a6  +  <span class="hljs-number">587</span>*a7 -<span class="hljs-number">65119</span>*a8 ==  <span class="hljs-number">505173</span>)<br><br><span class="hljs-comment"># 检查可解性</span><br><span class="hljs-keyword">if</span> s.check() == sat:<br>    model = s.model()<br>    <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> [a1, a2, a3, a4, a5, a6, a7, a8]:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;v&#125;</span> = <span class="hljs-subst">&#123;model[v]&#125;</span>&quot;</span>)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;无解&quot;</span>)<br>    <br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">a1 = 3</span><br><span class="hljs-string">a2 = 4</span><br><span class="hljs-string">a3 = 6</span><br><span class="hljs-string">a4 = 8</span><br><span class="hljs-string">a5 = 13</span><br><span class="hljs-string">a6 = 13</span><br><span class="hljs-string">a7 = 15</span><br><span class="hljs-string">a8 = 15</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure><p>​考脑洞吗？？？😅😅😅<del>我咋感觉这个index.js文件里面的逻辑都有问题啊，执行起来根本通关不了。</del></p><p>​从277行到结尾都是在做走迷宫的部分了，但是代码逻辑就是有问题，你会发现xy坐标根本没有更新。选手要从错误的代码中，猜出出题人正确的思路！</p><p>​在<strong>findtheway</strong>函数中会直接进入死循环，输入正确的答案，<strong>findtheway</strong>控制台调用也会进入死循环，这就不是让我玩的，是让我看的！</p><p>​这也就算了，从明显的错误中猜到正确的思路，像我这种小白都能看出错误，难道出题人看不出来吗？<del>这里不算什么，我也能看出来要跑两次。</del>实际上，第一次做这种题，被他这个错误代码逻辑给吓住了，我都想举报题错了，很难有继续思考的想法了，很想找WP验证我的“举报”是正确的！</p><p>​无所谓，我其实还在尝试，两个迷宫就两个迷宫，输两次就输两次。但是<strong>最完蛋的是</strong>迷宫的提示信息我没转过弯来，忘记了<strong>第i行对应的是数组中第(i-1)行，第i列对应的是数组中的第(i-1)列</strong>，导致我迷宫复现错误，这种东西一时半会真反应不过来，也可能是前面也就脑子过载了，我就不想浪费时间了，就直接看WP了。</p><p>​挺遗憾的，没自己独立做出了，少了一份感动……</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/af78d0f39e337f6562dcfb2001f2d726/image-20250706215042186.png" alt="image-20250706215042186"><p>​以上是我的思维过程和一些吐槽，下面是完美做法。</p><p>​先补充完data到200字节，补“#”。然后求解出S和Y的坐标，编写<strong>js</strong>脚本得到迷宫字符串，我喜欢通过python输出迷宫。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> data = [<br>    <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>,<br>    <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>,<br>    <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>,<br>    <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>,<br>    <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>,<br>    <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>,<br>    <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>,<br>    <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>,<br>    <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>,<br>    <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span><br>];<br><br><span class="hljs-keyword">let</span> coordinates = [<br>    [<span class="hljs-number">1</span>, <span class="hljs-number">11</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">12</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">13</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">14</span>],<br>    [<span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">2</span>, <span class="hljs-number">4</span>], [<span class="hljs-number">2</span>, <span class="hljs-number">11</span>], [<span class="hljs-number">2</span>, <span class="hljs-number">12</span>], [<span class="hljs-number">2</span>, <span class="hljs-number">14</span>],<br>    [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">14</span>],<br>    [<span class="hljs-number">5</span>, <span class="hljs-number">7</span>], [<span class="hljs-number">5</span>, <span class="hljs-number">8</span>], [<span class="hljs-number">5</span>, <span class="hljs-number">12</span>], [<span class="hljs-number">5</span>, <span class="hljs-number">14</span>], [<span class="hljs-number">5</span>, <span class="hljs-number">15</span>], [<span class="hljs-number">5</span>, <span class="hljs-number">18</span>],<br>    [<span class="hljs-number">6</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">6</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">6</span>, <span class="hljs-number">4</span>], [<span class="hljs-number">6</span>, <span class="hljs-number">5</span>], [<span class="hljs-number">6</span>, <span class="hljs-number">7</span>], [<span class="hljs-number">6</span>, <span class="hljs-number">8</span>], [<span class="hljs-number">6</span>, <span class="hljs-number">11</span>], [<span class="hljs-number">6</span>, <span class="hljs-number">15</span>],<br>    [<span class="hljs-number">7</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">5</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">11</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">12</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">13</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">14</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">15</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">16</span>],<br>    [<span class="hljs-number">8</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">8</span>, <span class="hljs-number">12</span>], [<span class="hljs-number">8</span>, <span class="hljs-number">13</span>], [<span class="hljs-number">8</span>, <span class="hljs-number">15</span>], [<span class="hljs-number">8</span>, <span class="hljs-number">18</span>],<br>    [<span class="hljs-number">9</span>, <span class="hljs-number">3</span>], [<span class="hljs-number">9</span>, <span class="hljs-number">4</span>], [<span class="hljs-number">9</span>, <span class="hljs-number">6</span>], [<span class="hljs-number">9</span>, <span class="hljs-number">7</span>], [<span class="hljs-number">9</span>, <span class="hljs-number">8</span>]<br>];<br><br><span class="hljs-keyword">let</span> cols = <span class="hljs-number">20</span>;<br><span class="hljs-keyword">let</span> rows = <span class="hljs-number">10</span>;<br><br>coordinates.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">[row, col]</span>) =&gt;</span> &#123;<br>   <br>    <span class="hljs-keyword">const</span> index = row * cols + col;<br>    <br>    <span class="hljs-keyword">if</span> (index &gt;= <span class="hljs-number">0</span> &amp;&amp; index &lt; data.<span class="hljs-property">length</span>) &#123;<br>        data[index] = <span class="hljs-string">&#x27;*&#x27;</span>;<br>    &#125;<br>&#125;);<br><br>data[<span class="hljs-number">2</span>*cols + <span class="hljs-number">12</span>] = <span class="hljs-string">&#x27;S&#x27;</span>;<br>data[<span class="hljs-number">7</span>*cols + <span class="hljs-number">12</span>] = <span class="hljs-string">&#x27;S&#x27;</span>;<br>data[<span class="hljs-number">3</span>*cols + <span class="hljs-number">14</span>] = <span class="hljs-string">&#x27;Y&#x27;</span>;<br>data[<span class="hljs-number">5</span>*cols + <span class="hljs-number">14</span>] = <span class="hljs-string">&#x27;Y&#x27;</span>;<br><br><span class="hljs-keyword">let</span> map = data.<span class="hljs-title function_">slice</span>();<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(map.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;&#x27;</span>));<br></code></pre></td></tr></table></figure><p>​得到迷宫后自己能够手写出来路径，第一个是STTAAARRRR，第二个迷宫是AAATTTTS，合在一起就得到了应该输入的input字符串<strong>STTAAARRRRAAATTTTS</strong>，flag为<strong>SYC{STTAAARRRRAAATTTTS}</strong>。</p><p>​可以通过计算一下MD5值验证一下，实际上是要在网页中按下这些字符，然后才能跳转到正确提示页面。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/af78d0f39e337f6562dcfb2001f2d726/image-20250706215937333.png" alt="image-20250706215937333">]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Hello-re&quot;&gt;&lt;a href=&quot;#Hello-re&quot; class=&quot;headerlink&quot; title=&quot;Hello_re&quot;&gt;&lt;/a&gt;Hello_re&lt;/h1&gt;&lt;p&gt;​	UPX壳，修改了大写标志位，010Editor打开文件修改&lt;code&gt;SYC0&lt;/cod</summary>
      
    
    
    
    <category term="CTF" scheme="http://bumak.github.io/categories/CTF/"/>
    
    
    <category term="Reverse" scheme="http://bumak.github.io/tags/Reverse/"/>
    
  </entry>
  
  <entry>
    <title>初识SEH</title>
    <link href="http://bumak.github.io/2025/07/07/%E5%88%9D%E8%AF%86SEH/SEH/"/>
    <id>http://bumak.github.io/2025/07/07/%E5%88%9D%E8%AF%86SEH/SEH/</id>
    <published>2025-07-07T09:34:30.000Z</published>
    <updated>2025-07-10T07:30:43.823Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>​本文的初衷是因为一个逆向题目中的疑难问题，同时也解决对SEH机制的理解。</p><p>​大佬博客文章都讲的非常详细了，那么我建议直接去看参考文章，下面正文算是我的一些疑问和特别知识点的记录吧，会比较零碎。</p><h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><p>​<strong>SetThreadContext</strong>函数是一个<strong>Windows API</strong>函数，可以修改一个<strong>现有线程</strong>的执行上下文，其<strong>lpContext</strong>指向一个结构体，里面存储着线程环境，包括各种寄存器值、EIP和堆栈信息等等。我们可以修改EIP的值，实现远程代码注入，而不需要创建新的线程。</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c">BOOL <span class="hljs-title function_">SetThreadContext</span><span class="hljs-params">(</span><br><span class="hljs-params">  HANDLE hThread,            <span class="hljs-comment">// 线程的句柄</span></span><br><span class="hljs-params">  CONST CONTEXT* lpContext   <span class="hljs-comment">// 要设置的上下文结构体（CULTEXT）</span></span><br><span class="hljs-params">)</span>;<br></code></pre></td></tr></table></figure><p>​一般代码注入的思路就是：获取目标进程的句柄，然后分配内存（用VirtualAllocEx）写入DLL路径（我们的代码），压入栈顶，然后获取<strong>LoadLibraryA</strong>函数地址，获取线程上下文，设置EIP为LoadLibraryA，恢复线程，让它执行。DLL文件被加载后，系统会自动调用它的入口函数<strong>DllMain</strong>（其在多种情况下会被调用，比如被进程加载、被进程卸载、被线程加载、被线程卸载等等），我们就可以在其中写入“主动执行”的代码。</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-number">1.</span>OpenThread     打开一个线程<br><span class="hljs-number">2.</span>SuspendThread 暂定这个线程<br><span class="hljs-number">3.</span>VirtualAllocEX    申请空间<br><span class="hljs-number">4.</span>WriteProcessMemory  写入DLL路径<br><span class="hljs-number">5.</span>修改Eip<br><span class="hljs-number">6.</span>ResumeThread  启动线程<br></code></pre></td></tr></table></figure><p>​</p><hr><p>​<strong>段寄存器（Segment Register）</strong> 是 x86 架构中的一种特殊寄存器，用来表示不同类型的内存区域（段）。这些寄存器是用来帮助 CPU 访问内存中的不同部分的。比如说段式管理下，程序分为代码段（CS）、数据段（DS）、栈段（SS）、附加段（ES）、附加段1（FS）、附加段2（GS），其段寄存器起到存储基址的作用，具体访问时是<strong>内存地址 &#x3D; 段寄存器 * 16 + 偏移量</strong>。</p><p>​<strong>节</strong>这个概念也很常见，是程序在编译时分割的内存区域，通常用于表示程序中不同的内容。</p><p>​<strong>节与段的不同</strong>：段主要用于运行时内存的组织（CPU通过段寄存器来定位），而节是程序在编译、链接时的内存划分，用来表示不同类型的代码和数据。在编译和链接阶段，编译器和链接器会把程序分成不同的节，并指定它们在最终可执行文件中的位置。</p><p>​</p><hr><p>​内联汇编反调试例子，这个反调试思路是检测到调试就让程序崩溃，不能使用<strong>ExitProcess</strong>退出，因为容易被别人据此API函数跟踪找到反调试的地方。崩溃的思路可以是，开一个新线程，然后给NULL指针赋值。</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;stdafx.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;STDLIB.H&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span>* argv[])</span><br>&#123;<br>    <span class="hljs-type">char</span> isDbg;<br>    __asm<br>    &#123;<br>        mov eax,fs:[<span class="hljs-number">0x18</span>]            <span class="hljs-comment">//找到teb的位置</span><br>        mov eax,[eax + <span class="hljs-number">0x30</span>]        <span class="hljs-comment">//teb + 30找到PEB的位置,对其取内容得到第一个首地址</span><br>        mov eax,[eax+<span class="hljs-number">0x2</span>]            <span class="hljs-comment">//首地址 + 偏移找到debug的位置对其取内容</span><br>        mov isDbg,al                <span class="hljs-comment">//求出是否在调试 ,因为BeingDebugged是UChar类型，所以使用al                         </span><br>         <span class="hljs-comment">//或者直接找peb查看</span><br>         <span class="hljs-comment">//mov eax,fs:[0x30]</span><br><span class="hljs-comment">//mov eax,[eax +0x2]</span><br><span class="hljs-comment">//mov isdbg,al</span><br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\r\n&quot;</span>,isDbg);<br>    system(<span class="hljs-string">&quot;pause&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>​另外，PEB中还存储着Windows 系统中的模块链表，通常是由其Ldr（Loader）字段表示的，我们可以遍历模板链表，找到目标板块后，可以通过修改链表指针将该节点删除，从而让操作系统和其他工具看不到整个板块。按道理，程序还能正常运行的，但是调试器可能会依赖这个链表信息，所以调试可能会失败。</p><hr><p>​<strong>C05</strong>或<strong>C0005</strong>是Windows系统的一个错误代码，表示 <strong>“Access Violation”</strong>，即访问违规。这通常发生在程序尝试访问它不应该访问的内存位置时。例如，程序可能试图读取一个空指针或写入只读内存。</p><p>​常见情况：空指针引用、堆栈溢出或堆内存破坏、数组越界、访问权限问题。</p><hr><p>​前置知识：FS段的信息如下。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/d728253053486fc8f09f9fab7374373e/image-20250707153320830.png" alt="image-20250707153320830"><p>​通过windbg查看FS段的信息如下。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/d728253053486fc8f09f9fab7374373e/image-20250707153413085.png" alt="image-20250707153413085"><p>​继续看**_NT_TIB**的指向的内容，偏移0处是异常链表，偏移4就是回调函数了（函数指针）。系统为每一个函数都注册了异常处理回调函数，是依次通过链表来查找使用的。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/d728253053486fc8f09f9fab7374373e/image-20250707153514506.png" alt="image-20250707153514506"><p>​下面是一个异常处理的代码注册的代码，重点讲解一下其中注册的地方——第一个内联汇编处，先将函数地址压栈，然后将<strong>FS:[0]<strong>压栈，再将esp的值传给</strong>FS:[0]</strong>，那么在调用异常处理函数时，通过**[FS:[0]+0x4]<strong>得到的函数地址就是我们之前push进去的函数地址了，而继续找回调函数就是通过</strong>[FS:[0]]**来得到下一个节点的地址，刚好esp指向的是原来的FS:[0]，那么程序还能继续正常运行，我们相当于往链表最开头插入了一个节点。</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;stdafx.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;WINDOWS.H&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;STDLIB.H&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;WINNT.H&gt;</span></span><br> <br>EXCEPTION_DISPOSITION __cdecl <span class="hljs-title function_">HANDLER1</span><span class="hljs-params">(</span><br><span class="hljs-params">                                       <span class="hljs-keyword">struct</span> _EXCEPTION_RECORD *ExceptionRecord,</span><br><span class="hljs-params">                                       <span class="hljs-type">void</span> * EstablisherFrame,</span><br><span class="hljs-params">                                       <span class="hljs-keyword">struct</span> _CONTEXT *ContextRecord,</span><br><span class="hljs-params">                                       <span class="hljs-type">void</span> * DispatcherContext)</span><br>&#123;<br> <br>    MessageBox(<span class="hljs-literal">NULL</span>,<span class="hljs-string">&quot;我处理了异常\r\n&quot;</span>,<span class="hljs-literal">NULL</span>,<span class="hljs-literal">NULL</span>);<br>    <span class="hljs-keyword">return</span> ExceptionContinueSearch;<br>&#125;<br><span class="hljs-type">void</span> <span class="hljs-title function_">fun1</span><span class="hljs-params">()</span><br>&#123;<br>    __asm<br>    &#123;<br>        push offset HANDLER1<br>        push fs:[<span class="hljs-number">0</span>]<br>        mov fs:[<span class="hljs-number">0</span>],esp<br>    &#125;<br>     <span class="hljs-type">char</span> *p = <span class="hljs-literal">NULL</span>;<br>     *p = <span class="hljs-number">1</span>;<br>    __asm<br>    &#123;<br>        pop fs:[<span class="hljs-number">0</span>]<span class="hljs-comment">//还原原来的结构</span><br>        add esp,<span class="hljs-number">4</span><br>        ret<br>    &#125;<br>&#125;<br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span>* argv[])</span><br>&#123;    <br>    fun1();    <br>    system(<span class="hljs-string">&quot;pause&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><hr><p>​C++中的函数<strong>func1</strong>调用了<strong>func2</strong>，<strong>func1</strong>有回调函数，<strong>func2</strong>没有注册异常处理，现在<strong>func2</strong>运行时出现异常后，会往上一层寻找找到<strong>func1</strong>的回调函数。</p><p>​如下面的代码。</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// SEHecpt.cpp : Defines the entry point for the console application.</span><br><span class="hljs-comment">//</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;stdafx.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;WINDOWS.H&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;STDLIB.H&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;WINNT.H&gt;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">fun2</span><span class="hljs-params">()</span>;<br><br>EXCEPTION_DISPOSITION __cdecl <span class="hljs-title function_">HANDLER1</span><span class="hljs-params">(</span><br><span class="hljs-params">                                       <span class="hljs-keyword">struct</span> _EXCEPTION_RECORD *ExceptionRecord,</span><br><span class="hljs-params">                                       <span class="hljs-type">void</span> * EstablisherFrame,</span><br><span class="hljs-params">                                       <span class="hljs-keyword">struct</span> _CONTEXT *ContextRecord,</span><br><span class="hljs-params">                                       <span class="hljs-type">void</span> * DispatcherContext)</span><br>&#123;<br><br>    MessageBox(<span class="hljs-literal">NULL</span>,<span class="hljs-string">&quot;我处理了异常\r\n&quot;</span>,<span class="hljs-literal">NULL</span>,<span class="hljs-literal">NULL</span>);<br>    <span class="hljs-keyword">return</span> ExceptionContinueSearch;<span class="hljs-comment">//返回继续搜索，表示当前回调函数处理不了，需要往上一层再找回调函数处理。</span><br>&#125;                   <br><span class="hljs-type">void</span> <span class="hljs-title function_">fun1</span><span class="hljs-params">()</span><br>&#123;<br>    __asm<br>    &#123;<br>       <br>        push offset HANDLER1<br>        push fs:[<span class="hljs-number">0</span>]<br>        mov fs:[<span class="hljs-number">0</span>],esp<br>    &#125;<br><br>    fun2();<br>     <span class="hljs-type">char</span> *p = <span class="hljs-literal">NULL</span>;<br>     *p = <span class="hljs-number">1</span>;<br>    __asm<br>    &#123;<br>        pop fs:[<span class="hljs-number">0</span>]<br>        add esp,<span class="hljs-number">4</span><br>        ret<br>    &#125;<br>&#125;<br><span class="hljs-type">void</span> <span class="hljs-title function_">fun2</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">char</span> *p =<span class="hljs-literal">NULL</span>;<br>    *p = <span class="hljs-number">1</span>;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span>* argv[])</span><br>&#123;<br>    fun1();    <br>    system(<span class="hljs-string">&quot;pause&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>​</p><hr><p>​什么是<strong>异常展开</strong>？AI的解释是：“<strong>异常展开</strong>”是指在程序发生异常时，操作系统或运行时环境<strong>从当前异常点逐层向上查找处理该异常的地方</strong>，并在这个过程中清理资源、撤销函数调用栈的过程。</p><blockquote><p>​简单来说就是 fun1 调用fun2 fun2出现了异常,自己的异常链表来不及卸载（func2和func1写一样的注册和卸载）,此时只能交给fun1去处理,那么现在我们应该把链表的位置重置为fun1的异常链表,fun2的不在需要了.否则操作系统调用的时候则是调用了一个错误的地址。</p><p>​说到释放的时候我们上面说了,操作系统会根据错误标志2,来接着调用一次我们的异常回调函数,这就是因为在操作系统帮我们卸载这个异常链表,但是会依次的调用一次我们的回调函数,通知我们,该释放资源的释放资源,该处理的处理,给我们一次释放资源的机会。</p></blockquote><hr><blockquote><p>异常处理处理发生的时候,会有顺序的</p><p>​1.系统首先发送给调试器 调试器优先级最高</p><p>​2.如果没有调试器,系统会继续查找线程相关的异常处理,</p><p>​3.每个线程相关的异常处理例程,可以处理或者不处理这个异常,如果不处理,并且安装了多个线程相关的处理例程,可交给连起来的其它例程处理</p><p>​4.不处理这个异常,在判断程序是否在调试状态,如果在就接着给调试器</p><p>​5.如果没有的话,或者不处理,那么操作系统就会调用筛选器异常</p><p>​6.如果没有,那么系统会调用默认的异常处理,也就是崩溃的的界面</p><p>​7.在终结之前,对其展开操作,然后依次调用设置的SEH链表中的回调函数,给予一次最后清理的机会.</p></blockquote><p>​throw语句抛出异常也是使用API，前两个参数分别是错误代码、错误标志，后两个是用户自定义的。</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">RaiseException</span><span class="hljs-params">(DWORD dwExeptionCode,</span><br><span class="hljs-params">　　　　　　　　　DWORD   dwExceptionFlages</span><br><span class="hljs-params">　　　　　　 　　 DWORD nNumberOfArguments,</span><br><span class="hljs-params">　　　　　　  　　Const DWORD * lpArguments)</span><br></code></pre></td></tr></table></figure><h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><p>​<a href="https://www.cnblogs.com/iBinary/p/7566380.html">异常处理第一讲</a>、<a href="https://www.cnblogs.com/iBinary/p/7596199.html">异常处理第二讲</a>、<a href="https://www.cnblogs.com/iBinary/p/7599713.html">异常处理第三讲</a>。还有一个IDA的<a href="https://leeyuxun.github.io/IDA%E5%9F%BA%E7%A1%80%E5%8A%9F%E8%83%BD%E6%80%BB%E7%BB%93.html">功能详解</a>，感觉挺好的，忘了可以再查。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;​	本文的初衷是因为一个逆向题目中的疑难问题，同时也解决对SEH机制的理解。&lt;/p&gt;
&lt;p&gt;​	大佬博客文章都讲的非常详细了，那么我建议直接</summary>
      
    
    
    
    <category term="CTF" scheme="http://bumak.github.io/categories/CTF/"/>
    
    
    <category term="Reverse" scheme="http://bumak.github.io/tags/Reverse/"/>
    
    <category term="Windows" scheme="http://bumak.github.io/tags/Windows/"/>
    
  </entry>
  
  <entry>
    <title>初识AES</title>
    <link href="http://bumak.github.io/2025/07/06/%E5%88%9D%E8%AF%86AES/AES/"/>
    <id>http://bumak.github.io/2025/07/06/%E5%88%9D%E8%AF%86AES/AES/</id>
    <published>2025-07-06T02:53:21.000Z</published>
    <updated>2025-07-08T05:35:44.625Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>​使用python实现，主要是熟悉加密流程，并且加强python编程能力。<a href="https://sxyz.blog/aes-from-scratch/">参考文章1</a>，<a href="https://blog.csdn.net/qq_28205153/article/details/55798628">参考文章2</a>，小白就是喜欢记录学习过程，为省时就边学边写，很多想法都是第一反应，如有错误望指出。</p><h2 id="python知识点"><a href="#python知识点" class="headerlink" title="python知识点"></a>python知识点</h2><p>​python中的参数传递，分为可变对象传递和不可变对象传递，本质上是引用传递。</p><p>​可变对象传参，如list、dict、set等类型对象，参数传递的是对象的引用，因此函数内能够修改传入的变量。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">a</span>):<br>    a.append(<span class="hljs-number">10</span>)<br><br>lst = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]<br>foo(lst)<br><span class="hljs-built_in">print</span>(lst)  <span class="hljs-comment"># 输出: [1, 2, 3, 10]</span><br></code></pre></td></tr></table></figure><p>​不可变对象传参，如int、str、tuple等类型对象，函数内部修改参数，是不会影响外部的变量的。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">a</span>):<br>    a = a + <span class="hljs-number">1</span><br><br>x = <span class="hljs-number">5</span><br>foo(x)<br><span class="hljs-built_in">print</span>(x)  <span class="hljs-comment"># 输出: 5</span><br><span class="hljs-comment">#a = a + 1 实际是重新绑定了局部变量 a，外面的 x 不受影响。</span><br></code></pre></td></tr></table></figure><p>​如果重新绑定参数名，是不会影响外部变量的。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">a</span>):<br>    a = [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>]  <span class="hljs-comment"># 给a重新赋值</span><br><br>lst = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]<br>foo(lst)<br><span class="hljs-built_in">print</span>(lst)  <span class="hljs-comment"># 输出: [1, 2, 3]</span><br></code></pre></td></tr></table></figure><h2 id="AES-128位密钥-ECB模式加密"><a href="#AES-128位密钥-ECB模式加密" class="headerlink" title="AES 128位密钥  ECB模式加密"></a>AES 128位密钥  ECB模式加密</h2><p>​AES是分组加密算法，每次加密的输入是128位，也就是分块大小。输出也是128位，8*16，可表示为16个字节。</p><h3 id="1-加密流程"><a href="#1-加密流程" class="headerlink" title="1. 加密流程"></a>1. 加密流程</h3><p>​共十轮加密，除却<strong>开头的一次轮密钥加</strong>（不算在十轮中）和最后一轮，剩余9轮操作是一样的。</p><p>​中间的9轮都是进行<strong>字节替换、行移位、列混淆、轮密钥</strong>加四个操作，最后一轮没有<strong>列混淆</strong>这一步骤。</p><p>​在代码中，输入state是以一维列表形式存储的，key也是以一维列表形式存储的，但是其表示的矩阵是如下的，我们之后讨论的操作都是在这种排列的矩阵基础上进行的。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/初识AES/image-20250705115307045.png" alt="image-20250705115307045"><p>​其中S盒是一个16*16的二维列表，其正常表示即<code>S[0][1]</code>表示第0行第1列的元素。</p><h4 id="字节替换"><a href="#字节替换" class="headerlink" title="字节替换"></a>字节替换</h4><p>​我们知道<code>state[i]</code>都是一个字节元素，取前4位作为行号，后4位作为列号，然后按照行列号取S盒中的元素来替代state[i]。</p><p>​这是可逆操作，其逆操作就是根据S盒算出逆S盒（S盒生成和逆盒原理可以自行学习），然后进行同样的替换。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">SubBytes</span>(<span class="hljs-params">self, state, inv=<span class="hljs-literal">False</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    对输入的state进行S盒置换。</span><br><span class="hljs-string">    state是一个16个字节元素的列表，以一维形式访问</span><br><span class="hljs-string">    返回值是变换后的二维列表</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> i,v <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(state):<br>        <span class="hljs-keyword">if</span> inv == <span class="hljs-literal">False</span>:<br>            state[i] = <span class="hljs-variable language_">self</span>.S_BOX[v&gt;&gt;<span class="hljs-number">4</span>][v&amp;<span class="hljs-number">0xf</span>]<br>        <span class="hljs-keyword">else</span>:<br>            state[i] = <span class="hljs-variable language_">self</span>.S_BOX_INV[v&gt;&gt;<span class="hljs-number">4</span>][v&amp;<span class="hljs-number">0xf</span>]<br></code></pre></td></tr></table></figure><h4 id="行移位"><a href="#行移位" class="headerlink" title="行移位"></a>行移位</h4><p>​针对前图中的state矩阵，运行规则是：第i行的元素左循环移位(i-1)位，行数从1开始，例如第二行1、5、9、13就会变成5、9、13、1。</p><p>​其逆操作就是循环右移同样的位数。</p><p>​我们通过切片操作实现，<code>state[i::4]</code>就是从下标i开始，按步长4取值，正好得到第i行元素。<code>state[i::4][-i:]</code>表示取第i行的后面（i-1）个元素，例如当i&#x3D;1时，其为state[13]，当i&#x3D;2时，其为<code>state[10],state[14]</code>。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">ShiftRows</span>(<span class="hljs-params">self, state, inv=<span class="hljs-literal">False</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    state是一个16个字节元素的列表，以一维形式访问</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>        <span class="hljs-keyword">if</span> inv == <span class="hljs-literal">False</span>:<br>            state[i::<span class="hljs-number">4</span>] = state[i::<span class="hljs-number">4</span>][i:] + state[i::<span class="hljs-number">4</span>][:i] <span class="hljs-comment"># 左移</span><br>        <span class="hljs-keyword">else</span>:<br>            state[i::<span class="hljs-number">4</span>] = state[i::<span class="hljs-number">4</span>][-i:] + state[i::<span class="hljs-number">4</span>][:-i]   <span class="hljs-comment"># 右移</span><br></code></pre></td></tr></table></figure><p>​</p><h4 id="列混淆"><a href="#列混淆" class="headerlink" title="列混淆"></a>列混淆</h4><p>​列混淆是对上面矩阵的每一列与一个<strong>特定的矩阵M</strong>（一般是固定的，如下图）做乘法运算，得到新的值，针对的还是上面的那个矩阵。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/初识AES/image-20250705124744021.png" alt="image-20250705124744021"><p>​因为特定的矩阵存在下面的性质，所以解密就是重复三次加密。<br>$$<br><br>M^4 &#x3D; M \cdot M^{-1} &#x3D; E<br>$$<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/初识AES/image-20250705122301118.png" alt="image-20250705122301118"></p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">MixColumns</span>(<span class="hljs-params">self, state, inv=<span class="hljs-literal">False</span></span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">GFmul_by_2</span>(<span class="hljs-params">n</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        这个计算是有数学意义的，不是简单的乘法运算，原理可自行了解GF域的定义。</span><br><span class="hljs-string">        :param n:</span><br><span class="hljs-string">        :return:</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        s = (n &lt;&lt; <span class="hljs-number">1</span>) &amp; <span class="hljs-number">0xff</span><br>        <span class="hljs-keyword">if</span> n &amp; <span class="hljs-number">128</span>:<span class="hljs-comment">#注意，这里不要抄错了！！！</span><br>            s ^= <span class="hljs-number">0x1b</span><br>        <span class="hljs-keyword">return</span> s<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">GFmul_by_3</span>(<span class="hljs-params">n</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        :param n:</span><br><span class="hljs-string">        :return:</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">return</span> n ^ GFmul_by_2(n)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">mix_column</span>(<span class="hljs-params">c</span>):<br>        <span class="hljs-keyword">return</span> [<br>            GFmul_by_2(c[<span class="hljs-number">0</span>]) ^ GFmul_by_3(c[<span class="hljs-number">1</span>]) ^ c[<span class="hljs-number">2</span>] ^ c[<span class="hljs-number">3</span>],<br>            GFmul_by_2(c[<span class="hljs-number">1</span>]) ^ GFmul_by_3(c[<span class="hljs-number">2</span>]) ^ c[<span class="hljs-number">3</span>] ^ c[<span class="hljs-number">0</span>],<br>            GFmul_by_2(c[<span class="hljs-number">2</span>]) ^ GFmul_by_3(c[<span class="hljs-number">3</span>]) ^ c[<span class="hljs-number">0</span>] ^ c[<span class="hljs-number">1</span>],<br>            GFmul_by_2(c[<span class="hljs-number">3</span>]) ^ GFmul_by_3(c[<span class="hljs-number">0</span>]) ^ c[<span class="hljs-number">1</span>] ^ c[<span class="hljs-number">2</span>]<br>        ]<br><br>    <span class="hljs-keyword">if</span> inv == <span class="hljs-literal">False</span>:<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">16</span>, <span class="hljs-number">4</span>):<br>            state[i:i + <span class="hljs-number">4</span>] = mix_column(state[i:i + <span class="hljs-number">4</span>])<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">16</span>, <span class="hljs-number">4</span>):<br>                state[i:i + <span class="hljs-number">4</span>] = mix_column(state[i:i + <span class="hljs-number">4</span>])<br></code></pre></td></tr></table></figure><h4 id="轮密钥加"><a href="#轮密钥加" class="headerlink" title="轮密钥加"></a>轮密钥加</h4><p>​将对应的密钥<strong>列表</strong>与状态<strong>列表</strong>的元素进行异或即可。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/初识AES/image-20250705130308252.png" alt="image-20250705130308252"><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">AddRoundKey</span>(<span class="hljs-params">self, state, key</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>):<br>        state[i] ^= key[i]<br></code></pre></td></tr></table></figure><h3 id="2-密钥扩展算法"><a href="#2-密钥扩展算法" class="headerlink" title="2. 密钥扩展算法"></a>2. 密钥扩展算法</h3><p>​AES系列算法的密钥可能位数为128、192、256，以128为例，<code>W[i]</code>是由<code>K[i:i+4]</code>组成的32位，我们会由初始的<code>W[0:4]</code>这四个字通过密钥扩展得到后面的40个字<code>W[4:44]</code>，其中每一轮会用到<code>W[i:i+4]</code>四个字进行轮密钥加操作。初始的4个字是用在第一轮前的轮密钥加的。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/初识AES/image-20250705125157750.png" alt="image-20250705125157750"><p>​具体计算过程就是，从i&#x3D;4开始，👍如果i不是4的倍数，那么W[i]就是W[i-1]^W[i-4]。等价成字节操作就是，每4个key一组，若对应的W[i]的i不是4的倍数，那么<code>key[-16]^r[j]</code>就是<code>W[i-1]^W[i-4]</code>的逐字节操作，其中key[-16]对应W[i-4]中的字节，r[i]对应W[i-1]中的字节。✌️如果是4的倍数，则要对最后的4字节进行一系列加密，<code>r[1:] + r[:1]</code>就是将r切片左移一位，其他也很显然。需要注意的是，轮密钥常数也有写成<strong>0x01000000</strong>这种形式的，这种是在字的级别进行操作的，我们是在逐字节处理，所以要通过<code>if j == 0 else 0</code>来补充00。</p><p>​注意，其中<code>r = key[-4:]</code>得到的是一个新的切片对象，修改r不会影响key中的值。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">key_expansion</span>(<span class="hljs-params">self, key</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span> * <span class="hljs-number">4</span>):<br>        r = key[-<span class="hljs-number">4</span>:]<br>        <span class="hljs-keyword">if</span> i % <span class="hljs-number">4</span> == <span class="hljs-number">0</span>:  <span class="hljs-comment"># 对上一轮最后4字节自循环、S-box置换、轮常数异或，从而计算出当前新一轮最前4字节</span><br>            <span class="hljs-keyword">for</span> j, v <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(r[<span class="hljs-number">1</span>:] + r[:<span class="hljs-number">1</span>]):<br>                r[j] = <span class="hljs-variable language_">self</span>.S_BOX[v &gt;&gt; <span class="hljs-number">4</span>][v &amp; <span class="hljs-number">0xf</span>] ^ (<span class="hljs-variable language_">self</span>.RCON[i // <span class="hljs-number">4</span>] <span class="hljs-keyword">if</span> j == <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>)<br><br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>            key.append(key[-<span class="hljs-number">16</span>] ^ r[j])<br><br>    <span class="hljs-keyword">return</span> key<br></code></pre></td></tr></table></figure><h3 id="3-整体加解密代码"><a href="#3-整体加解密代码" class="headerlink" title="3. 整体加解密代码"></a>3. 整体加解密代码</h3><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AES</span>:<br>    MIX_C = [[<span class="hljs-number">0x2</span>, <span class="hljs-number">0x3</span>, <span class="hljs-number">0x1</span>, <span class="hljs-number">0x1</span>], [<span class="hljs-number">0x1</span>, <span class="hljs-number">0x2</span>, <span class="hljs-number">0x3</span>, <span class="hljs-number">0x1</span>], [<span class="hljs-number">0x1</span>, <span class="hljs-number">0x1</span>, <span class="hljs-number">0x2</span>, <span class="hljs-number">0x3</span>], [<span class="hljs-number">0x3</span>, <span class="hljs-number">0x1</span>, <span class="hljs-number">0x1</span>, <span class="hljs-number">0x2</span>]]<br>    MIX_C_INV = [[<span class="hljs-number">0xe</span>, <span class="hljs-number">0xb</span>, <span class="hljs-number">0xd</span>, <span class="hljs-number">0x9</span>], [<span class="hljs-number">0x9</span>, <span class="hljs-number">0xe</span>, <span class="hljs-number">0xb</span>, <span class="hljs-number">0xd</span>], [<span class="hljs-number">0xd</span>, <span class="hljs-number">0x9</span>, <span class="hljs-number">0xe</span>, <span class="hljs-number">0xb</span>], [<span class="hljs-number">0xb</span>, <span class="hljs-number">0xd</span>, <span class="hljs-number">0x9</span>, <span class="hljs-number">0xe</span>]]<br>    RCON= [<span class="hljs-number">0x01</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0x1b</span>, <span class="hljs-number">0x36</span> ,<span class="hljs-number">0x6c</span>, <span class="hljs-number">0xd8</span>, <span class="hljs-number">0xab</span>, <span class="hljs-number">0x4d</span>]  <span class="hljs-comment"># 实际只用到前10个</span><br>    S_BOX = [[<span class="hljs-number">124</span>, <span class="hljs-number">202</span>, <span class="hljs-number">123</span>, <span class="hljs-number">119</span>, <span class="hljs-number">242</span>, <span class="hljs-number">107</span>, <span class="hljs-number">111</span>, <span class="hljs-number">197</span>, <span class="hljs-number">48</span>, <span class="hljs-number">1</span>, <span class="hljs-number">103</span>, <span class="hljs-number">43</span>, <span class="hljs-number">254</span>, <span class="hljs-number">215</span>, <span class="hljs-number">71</span>, <span class="hljs-number">171</span>],<br>             [<span class="hljs-number">118</span>, <span class="hljs-number">99</span>, <span class="hljs-number">130</span>, <span class="hljs-number">201</span>, <span class="hljs-number">125</span>, <span class="hljs-number">250</span>, <span class="hljs-number">89</span>, <span class="hljs-number">240</span>, <span class="hljs-number">173</span>, <span class="hljs-number">212</span>, <span class="hljs-number">162</span>, <span class="hljs-number">175</span>, <span class="hljs-number">156</span>, <span class="hljs-number">164</span>, <span class="hljs-number">114</span>, <span class="hljs-number">192</span>],<br>             [<span class="hljs-number">183</span>, <span class="hljs-number">253</span>, <span class="hljs-number">147</span>, <span class="hljs-number">38</span>, <span class="hljs-number">54</span>, <span class="hljs-number">63</span>, <span class="hljs-number">247</span>, <span class="hljs-number">204</span>, <span class="hljs-number">52</span>, <span class="hljs-number">165</span>, <span class="hljs-number">229</span>, <span class="hljs-number">241</span>, <span class="hljs-number">113</span>, <span class="hljs-number">216</span>, <span class="hljs-number">49</span>, <span class="hljs-number">21</span>],<br>             [<span class="hljs-number">4</span>, <span class="hljs-number">199</span>, <span class="hljs-number">35</span>, <span class="hljs-number">195</span>, <span class="hljs-number">24</span>, <span class="hljs-number">150</span>, <span class="hljs-number">5</span>, <span class="hljs-number">154</span>, <span class="hljs-number">7</span>, <span class="hljs-number">18</span>, <span class="hljs-number">128</span>, <span class="hljs-number">226</span>, <span class="hljs-number">235</span>, <span class="hljs-number">39</span>, <span class="hljs-number">178</span>, <span class="hljs-number">117</span>],<br>             [<span class="hljs-number">9</span>, <span class="hljs-number">131</span>, <span class="hljs-number">44</span>, <span class="hljs-number">26</span>, <span class="hljs-number">27</span>, <span class="hljs-number">110</span>, <span class="hljs-number">90</span>, <span class="hljs-number">160</span>, <span class="hljs-number">82</span>, <span class="hljs-number">59</span>, <span class="hljs-number">214</span>, <span class="hljs-number">179</span>, <span class="hljs-number">41</span>, <span class="hljs-number">227</span>, <span class="hljs-number">47</span>, <span class="hljs-number">132</span>],<br>             [<span class="hljs-number">83</span>, <span class="hljs-number">209</span>, <span class="hljs-number">0</span>, <span class="hljs-number">237</span>, <span class="hljs-number">32</span>, <span class="hljs-number">252</span>, <span class="hljs-number">177</span>, <span class="hljs-number">91</span>, <span class="hljs-number">106</span>, <span class="hljs-number">203</span>, <span class="hljs-number">190</span>, <span class="hljs-number">57</span>, <span class="hljs-number">74</span>, <span class="hljs-number">76</span>, <span class="hljs-number">88</span>, <span class="hljs-number">207</span>],<br>             [<span class="hljs-number">208</span>, <span class="hljs-number">239</span>, <span class="hljs-number">170</span>, <span class="hljs-number">251</span>, <span class="hljs-number">67</span>, <span class="hljs-number">77</span>, <span class="hljs-number">51</span>, <span class="hljs-number">133</span>, <span class="hljs-number">69</span>, <span class="hljs-number">249</span>, <span class="hljs-number">2</span>, <span class="hljs-number">127</span>, <span class="hljs-number">80</span>, <span class="hljs-number">60</span>, <span class="hljs-number">159</span>, <span class="hljs-number">168</span>],<br>             [<span class="hljs-number">81</span>, <span class="hljs-number">163</span>, <span class="hljs-number">64</span>, <span class="hljs-number">143</span>, <span class="hljs-number">146</span>, <span class="hljs-number">157</span>, <span class="hljs-number">56</span>, <span class="hljs-number">245</span>, <span class="hljs-number">188</span>, <span class="hljs-number">182</span>, <span class="hljs-number">218</span>, <span class="hljs-number">33</span>, <span class="hljs-number">16</span>, <span class="hljs-number">255</span>, <span class="hljs-number">243</span>, <span class="hljs-number">210</span>],<br>             [<span class="hljs-number">151</span>, <span class="hljs-number">205</span>, <span class="hljs-number">12</span>, <span class="hljs-number">19</span>, <span class="hljs-number">236</span>, <span class="hljs-number">95</span>, <span class="hljs-number">68</span>, <span class="hljs-number">23</span>, <span class="hljs-number">196</span>, <span class="hljs-number">167</span>, <span class="hljs-number">126</span>, <span class="hljs-number">61</span>, <span class="hljs-number">100</span>, <span class="hljs-number">93</span>, <span class="hljs-number">25</span>, <span class="hljs-number">115</span>],<br>             [<span class="hljs-number">96</span>, <span class="hljs-number">129</span>, <span class="hljs-number">79</span>, <span class="hljs-number">220</span>, <span class="hljs-number">34</span>, <span class="hljs-number">42</span>, <span class="hljs-number">144</span>, <span class="hljs-number">136</span>, <span class="hljs-number">70</span>, <span class="hljs-number">238</span>, <span class="hljs-number">184</span>, <span class="hljs-number">20</span>, <span class="hljs-number">222</span>, <span class="hljs-number">94</span>, <span class="hljs-number">11</span>, <span class="hljs-number">219</span>],<br>             [<span class="hljs-number">224</span>, <span class="hljs-number">50</span>, <span class="hljs-number">58</span>, <span class="hljs-number">10</span>, <span class="hljs-number">73</span>, <span class="hljs-number">6</span>, <span class="hljs-number">36</span>, <span class="hljs-number">92</span>, <span class="hljs-number">194</span>, <span class="hljs-number">211</span>, <span class="hljs-number">172</span>, <span class="hljs-number">98</span>, <span class="hljs-number">145</span>, <span class="hljs-number">149</span>, <span class="hljs-number">228</span>, <span class="hljs-number">121</span>],<br>             [<span class="hljs-number">231</span>, <span class="hljs-number">200</span>, <span class="hljs-number">55</span>, <span class="hljs-number">109</span>, <span class="hljs-number">141</span>, <span class="hljs-number">213</span>, <span class="hljs-number">78</span>, <span class="hljs-number">169</span>, <span class="hljs-number">108</span>, <span class="hljs-number">86</span>, <span class="hljs-number">244</span>, <span class="hljs-number">234</span>, <span class="hljs-number">101</span>, <span class="hljs-number">122</span>, <span class="hljs-number">174</span>, <span class="hljs-number">8</span>],<br>             [<span class="hljs-number">186</span>, <span class="hljs-number">120</span>, <span class="hljs-number">37</span>, <span class="hljs-number">46</span>, <span class="hljs-number">28</span>, <span class="hljs-number">166</span>, <span class="hljs-number">180</span>, <span class="hljs-number">198</span>, <span class="hljs-number">232</span>, <span class="hljs-number">221</span>, <span class="hljs-number">116</span>, <span class="hljs-number">31</span>, <span class="hljs-number">75</span>, <span class="hljs-number">189</span>, <span class="hljs-number">139</span>, <span class="hljs-number">138</span>],<br>             [<span class="hljs-number">112</span>, <span class="hljs-number">62</span>, <span class="hljs-number">181</span>, <span class="hljs-number">102</span>, <span class="hljs-number">72</span>, <span class="hljs-number">3</span>, <span class="hljs-number">246</span>, <span class="hljs-number">14</span>, <span class="hljs-number">97</span>, <span class="hljs-number">53</span>, <span class="hljs-number">87</span>, <span class="hljs-number">185</span>, <span class="hljs-number">134</span>, <span class="hljs-number">193</span>, <span class="hljs-number">29</span>, <span class="hljs-number">158</span>],<br>             [<span class="hljs-number">225</span>, <span class="hljs-number">248</span>, <span class="hljs-number">152</span>, <span class="hljs-number">17</span>, <span class="hljs-number">105</span>, <span class="hljs-number">217</span>, <span class="hljs-number">142</span>, <span class="hljs-number">148</span>, <span class="hljs-number">155</span>, <span class="hljs-number">30</span>, <span class="hljs-number">233</span>, <span class="hljs-number">206</span>, <span class="hljs-number">85</span>, <span class="hljs-number">40</span>, <span class="hljs-number">223</span>, <span class="hljs-number">140</span>],<br>             [<span class="hljs-number">161</span>, <span class="hljs-number">137</span>, <span class="hljs-number">13</span>, <span class="hljs-number">191</span>, <span class="hljs-number">230</span>, <span class="hljs-number">66</span>, <span class="hljs-number">104</span>, <span class="hljs-number">65</span>, <span class="hljs-number">153</span>, <span class="hljs-number">45</span>, <span class="hljs-number">15</span>, <span class="hljs-number">176</span>, <span class="hljs-number">84</span>, <span class="hljs-number">187</span>, <span class="hljs-number">22</span>, <span class="hljs-number">135</span>]]<br><br>    S_BOX_INV = [[<span class="hljs-number">82</span>, <span class="hljs-number">9</span>, <span class="hljs-number">106</span>, <span class="hljs-number">213</span>, <span class="hljs-number">48</span>, <span class="hljs-number">54</span>, <span class="hljs-number">165</span>, <span class="hljs-number">56</span>, <span class="hljs-number">191</span>, <span class="hljs-number">64</span>, <span class="hljs-number">163</span>, <span class="hljs-number">158</span>, <span class="hljs-number">130</span>, <span class="hljs-number">242</span>, <span class="hljs-number">215</span>, <span class="hljs-number">250</span>],<br>              [<span class="hljs-number">124</span>, <span class="hljs-number">227</span>, <span class="hljs-number">57</span>, <span class="hljs-number">131</span>, <span class="hljs-number">155</span>, <span class="hljs-number">47</span>, <span class="hljs-number">254</span>, <span class="hljs-number">135</span>, <span class="hljs-number">52</span>, <span class="hljs-number">142</span>, <span class="hljs-number">67</span>, <span class="hljs-number">68</span>, <span class="hljs-number">196</span>, <span class="hljs-number">222</span>, <span class="hljs-number">233</span>, <span class="hljs-number">203</span>],<br>              [<span class="hljs-number">84</span>, <span class="hljs-number">123</span>, <span class="hljs-number">148</span>, <span class="hljs-number">50</span>, <span class="hljs-number">166</span>, <span class="hljs-number">194</span>, <span class="hljs-number">35</span>, <span class="hljs-number">61</span>, <span class="hljs-number">237</span>, <span class="hljs-number">76</span>, <span class="hljs-number">149</span>, <span class="hljs-number">11</span>, <span class="hljs-number">66</span>, <span class="hljs-number">249</span>, <span class="hljs-number">195</span>, <span class="hljs-number">78</span>],<br>              [<span class="hljs-number">8</span>, <span class="hljs-number">46</span>, <span class="hljs-number">161</span>, <span class="hljs-number">102</span>, <span class="hljs-number">40</span>, <span class="hljs-number">217</span>, <span class="hljs-number">36</span>, <span class="hljs-number">178</span>, <span class="hljs-number">118</span>, <span class="hljs-number">91</span>, <span class="hljs-number">162</span>, <span class="hljs-number">73</span>, <span class="hljs-number">109</span>, <span class="hljs-number">139</span>, <span class="hljs-number">209</span>, <span class="hljs-number">37</span>],<br>              [<span class="hljs-number">114</span>, <span class="hljs-number">247</span>, <span class="hljs-number">245</span>, <span class="hljs-number">100</span>, <span class="hljs-number">134</span>, <span class="hljs-number">104</span>, <span class="hljs-number">152</span>, <span class="hljs-number">14</span>, <span class="hljs-number">212</span>, <span class="hljs-number">164</span>, <span class="hljs-number">92</span>, <span class="hljs-number">204</span>, <span class="hljs-number">93</span>, <span class="hljs-number">101</span>, <span class="hljs-number">182</span>, <span class="hljs-number">146</span>],<br>              [<span class="hljs-number">108</span>, <span class="hljs-number">112</span>, <span class="hljs-number">72</span>, <span class="hljs-number">80</span>, <span class="hljs-number">252</span>, <span class="hljs-number">236</span>, <span class="hljs-number">185</span>, <span class="hljs-number">218</span>, <span class="hljs-number">94</span>, <span class="hljs-number">22</span>, <span class="hljs-number">70</span>, <span class="hljs-number">87</span>, <span class="hljs-number">167</span>, <span class="hljs-number">141</span>, <span class="hljs-number">157</span>, <span class="hljs-number">133</span>],<br>              [<span class="hljs-number">144</span>, <span class="hljs-number">216</span>, <span class="hljs-number">171</span>, <span class="hljs-number">17</span>, <span class="hljs-number">140</span>, <span class="hljs-number">188</span>, <span class="hljs-number">211</span>, <span class="hljs-number">10</span>, <span class="hljs-number">246</span>, <span class="hljs-number">228</span>, <span class="hljs-number">88</span>, <span class="hljs-number">5</span>, <span class="hljs-number">184</span>, <span class="hljs-number">179</span>, <span class="hljs-number">69</span>, <span class="hljs-number">6</span>],<br>              [<span class="hljs-number">208</span>, <span class="hljs-number">44</span>, <span class="hljs-number">30</span>, <span class="hljs-number">143</span>, <span class="hljs-number">202</span>, <span class="hljs-number">63</span>, <span class="hljs-number">16</span>, <span class="hljs-number">3</span>, <span class="hljs-number">193</span>, <span class="hljs-number">175</span>, <span class="hljs-number">189</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">20</span>, <span class="hljs-number">138</span>, <span class="hljs-number">107</span>],<br>              [<span class="hljs-number">58</span>, <span class="hljs-number">145</span>, <span class="hljs-number">18</span>, <span class="hljs-number">65</span>, <span class="hljs-number">79</span>, <span class="hljs-number">103</span>, <span class="hljs-number">220</span>, <span class="hljs-number">255</span>, <span class="hljs-number">151</span>, <span class="hljs-number">241</span>, <span class="hljs-number">207</span>, <span class="hljs-number">206</span>, <span class="hljs-number">239</span>, <span class="hljs-number">180</span>, <span class="hljs-number">230</span>, <span class="hljs-number">115</span>],<br>              [<span class="hljs-number">150</span>, <span class="hljs-number">172</span>, <span class="hljs-number">116</span>, <span class="hljs-number">34</span>, <span class="hljs-number">231</span>, <span class="hljs-number">173</span>, <span class="hljs-number">53</span>, <span class="hljs-number">128</span>, <span class="hljs-number">226</span>, <span class="hljs-number">248</span>, <span class="hljs-number">55</span>, <span class="hljs-number">232</span>, <span class="hljs-number">28</span>, <span class="hljs-number">117</span>, <span class="hljs-number">223</span>, <span class="hljs-number">110</span>],<br>              [<span class="hljs-number">71</span>, <span class="hljs-number">240</span>, <span class="hljs-number">26</span>, <span class="hljs-number">113</span>, <span class="hljs-number">29</span>, <span class="hljs-number">41</span>, <span class="hljs-number">197</span>, <span class="hljs-number">137</span>, <span class="hljs-number">111</span>, <span class="hljs-number">183</span>, <span class="hljs-number">98</span>, <span class="hljs-number">15</span>, <span class="hljs-number">170</span>, <span class="hljs-number">24</span>, <span class="hljs-number">190</span>, <span class="hljs-number">27</span>],<br>              [<span class="hljs-number">251</span>, <span class="hljs-number">86</span>, <span class="hljs-number">62</span>, <span class="hljs-number">75</span>, <span class="hljs-number">198</span>, <span class="hljs-number">210</span>, <span class="hljs-number">121</span>, <span class="hljs-number">32</span>, <span class="hljs-number">154</span>, <span class="hljs-number">219</span>, <span class="hljs-number">192</span>, <span class="hljs-number">253</span>, <span class="hljs-number">120</span>, <span class="hljs-number">205</span>, <span class="hljs-number">90</span>, <span class="hljs-number">243</span>],<br>              [<span class="hljs-number">31</span>, <span class="hljs-number">221</span>, <span class="hljs-number">168</span>, <span class="hljs-number">51</span>, <span class="hljs-number">136</span>, <span class="hljs-number">7</span>, <span class="hljs-number">199</span>, <span class="hljs-number">49</span>, <span class="hljs-number">177</span>, <span class="hljs-number">19</span>, <span class="hljs-number">1</span>, <span class="hljs-number">89</span>, <span class="hljs-number">39</span>, <span class="hljs-number">129</span>, <span class="hljs-number">235</span>, <span class="hljs-number">95</span>],<br>              [<span class="hljs-number">96</span>, <span class="hljs-number">81</span>, <span class="hljs-number">127</span>, <span class="hljs-number">169</span>, <span class="hljs-number">25</span>, <span class="hljs-number">181</span>, <span class="hljs-number">74</span>, <span class="hljs-number">13</span>, <span class="hljs-number">45</span>, <span class="hljs-number">229</span>, <span class="hljs-number">122</span>, <span class="hljs-number">159</span>, <span class="hljs-number">147</span>, <span class="hljs-number">201</span>, <span class="hljs-number">156</span>, <span class="hljs-number">238</span>],<br>              [<span class="hljs-number">160</span>, <span class="hljs-number">224</span>, <span class="hljs-number">59</span>, <span class="hljs-number">77</span>, <span class="hljs-number">174</span>, <span class="hljs-number">42</span>, <span class="hljs-number">244</span>, <span class="hljs-number">176</span>, <span class="hljs-number">200</span>, <span class="hljs-number">234</span>, <span class="hljs-number">187</span>, <span class="hljs-number">60</span>, <span class="hljs-number">132</span>, <span class="hljs-number">83</span>, <span class="hljs-number">153</span>, <span class="hljs-number">97</span>],<br>              [<span class="hljs-number">23</span>, <span class="hljs-number">43</span>, <span class="hljs-number">4</span>, <span class="hljs-number">126</span>, <span class="hljs-number">186</span>, <span class="hljs-number">119</span>, <span class="hljs-number">214</span>, <span class="hljs-number">38</span>, <span class="hljs-number">225</span>, <span class="hljs-number">105</span>, <span class="hljs-number">21</span>, <span class="hljs-number">99</span>, <span class="hljs-number">85</span>, <span class="hljs-number">33</span>, <span class="hljs-number">12</span>, <span class="hljs-number">125</span>]]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">SubBytes</span>(<span class="hljs-params">self, state, inv=<span class="hljs-literal">False</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        对输入的state进行S盒置换。</span><br><span class="hljs-string">        state是一个16个字节元素的列表，以一维形式访问</span><br><span class="hljs-string">        返回值是变换后的二维列表</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">for</span> i,v <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(state):<br>            <span class="hljs-keyword">if</span> inv == <span class="hljs-literal">False</span>:<br>                state[i] = <span class="hljs-variable language_">self</span>.S_BOX[v&gt;&gt;<span class="hljs-number">4</span>][v&amp;<span class="hljs-number">0xf</span>]<br>            <span class="hljs-keyword">else</span>:<br>                state[i] = <span class="hljs-variable language_">self</span>.S_BOX_INV[v&gt;&gt;<span class="hljs-number">4</span>][v&amp;<span class="hljs-number">0xf</span>]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">ShiftRows</span>(<span class="hljs-params">self, state, inv=<span class="hljs-literal">False</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        state是一个16个字节元素的列表，以一维形式访问</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>            <span class="hljs-keyword">if</span> inv == <span class="hljs-literal">False</span>:<br>                state[i::<span class="hljs-number">4</span>] = state[i::<span class="hljs-number">4</span>][i:] + state[i::<span class="hljs-number">4</span>][:i] <span class="hljs-comment"># 左移</span><br>            <span class="hljs-keyword">else</span>:<br>                state[i::<span class="hljs-number">4</span>] = state[i::<span class="hljs-number">4</span>][-i:] + state[i::<span class="hljs-number">4</span>][:-i]   <span class="hljs-comment"># 右移</span><br><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">MixColumns</span>(<span class="hljs-params">self, state, inv=<span class="hljs-literal">False</span></span>):<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">GFmul_by_2</span>(<span class="hljs-params">n</span>):<br>            <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">            这个计算是有数学意义的，不是简单的乘法运算，原理可自行了解GF域的定义。</span><br><span class="hljs-string">            :param n:</span><br><span class="hljs-string">            :return:</span><br><span class="hljs-string">            &quot;&quot;&quot;</span><br>            s = (n &lt;&lt; <span class="hljs-number">1</span>) &amp; <span class="hljs-number">0xff</span><br>            <span class="hljs-keyword">if</span> n &amp; <span class="hljs-number">128</span>:<br>                s ^= <span class="hljs-number">0x1b</span><br>            <span class="hljs-keyword">return</span> s<br><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">GFmul_by_3</span>(<span class="hljs-params">n</span>):<br>            <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">            :param n:</span><br><span class="hljs-string">            :return:</span><br><span class="hljs-string">            &quot;&quot;&quot;</span><br>            <span class="hljs-keyword">return</span> n ^ GFmul_by_2(n)<br><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">mix_column</span>(<span class="hljs-params">c</span>):<br>            <span class="hljs-keyword">return</span> [<br>                GFmul_by_2(c[<span class="hljs-number">0</span>]) ^ GFmul_by_3(c[<span class="hljs-number">1</span>]) ^ c[<span class="hljs-number">2</span>] ^ c[<span class="hljs-number">3</span>],<br>                GFmul_by_2(c[<span class="hljs-number">1</span>]) ^ GFmul_by_3(c[<span class="hljs-number">2</span>]) ^ c[<span class="hljs-number">3</span>] ^ c[<span class="hljs-number">0</span>],<br>                GFmul_by_2(c[<span class="hljs-number">2</span>]) ^ GFmul_by_3(c[<span class="hljs-number">3</span>]) ^ c[<span class="hljs-number">0</span>] ^ c[<span class="hljs-number">1</span>],<br>                GFmul_by_2(c[<span class="hljs-number">3</span>]) ^ GFmul_by_3(c[<span class="hljs-number">0</span>]) ^ c[<span class="hljs-number">1</span>] ^ c[<span class="hljs-number">2</span>]<br>            ]<br><br>        <span class="hljs-keyword">if</span> inv == <span class="hljs-literal">False</span>:<br>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">16</span>, <span class="hljs-number">4</span>):<br>                state[i:i + <span class="hljs-number">4</span>] = mix_column(state[i:i + <span class="hljs-number">4</span>])<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>                <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">16</span>, <span class="hljs-number">4</span>):<br>                    state[i:i + <span class="hljs-number">4</span>] = mix_column(state[i:i + <span class="hljs-number">4</span>])<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">AddRoundKey</span>(<span class="hljs-params">self, state, key</span>):<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>):<br>            state[i] ^= key[i]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">key_expansion</span>(<span class="hljs-params">self, key</span>):<br>        key = <span class="hljs-built_in">bytearray</span>(key)<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span> * <span class="hljs-number">4</span>):<br>            r = key[-<span class="hljs-number">4</span>:]<br>            r = <span class="hljs-built_in">bytearray</span>(r)<br>            <span class="hljs-keyword">if</span> i % <span class="hljs-number">4</span> == <span class="hljs-number">0</span>:  <span class="hljs-comment"># 对上一轮最后4字节，先循环左移一位，再S-box置换、轮常数异或，从而计算出当前新一轮最前4字节</span><br>                <span class="hljs-keyword">for</span> j, v <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(r[<span class="hljs-number">1</span>:] + r[:<span class="hljs-number">1</span>]):<br>                    r[j] = <span class="hljs-variable language_">self</span>.S_BOX[v &gt;&gt; <span class="hljs-number">4</span>][v &amp; <span class="hljs-number">0xf</span>] ^ (<span class="hljs-variable language_">self</span>.RCON[i // <span class="hljs-number">4</span>] <span class="hljs-keyword">if</span> j == <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>)<br><br>            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>                key.append(key[-<span class="hljs-number">16</span>] ^ r[j])<br><br>        <span class="hljs-keyword">return</span> key<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt</span>(<span class="hljs-params">self, b, expanded_key</span>):<br>        <span class="hljs-variable language_">self</span>.AddRoundKey(b, expanded_key)<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>):<br>            <span class="hljs-variable language_">self</span>.SubBytes(b)<br>            <span class="hljs-variable language_">self</span>.ShiftRows(b)<br>            <span class="hljs-variable language_">self</span>.MixColumns(b)<br>            <span class="hljs-variable language_">self</span>.AddRoundKey(b, expanded_key[i*<span class="hljs-number">16</span>:])<br><br>        <span class="hljs-variable language_">self</span>.SubBytes(b)<br>        <span class="hljs-variable language_">self</span>.ShiftRows(b)<br>        <span class="hljs-variable language_">self</span>.AddRoundKey(b, expanded_key[-<span class="hljs-number">16</span>:])<br>        <span class="hljs-keyword">return</span> b<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">self, b, expanded_key</span>):<br>        <span class="hljs-variable language_">self</span>.AddRoundKey(b, expanded_key[-<span class="hljs-number">16</span>:])<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">9</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>):<br>            <span class="hljs-variable language_">self</span>.ShiftRows(b, inv=<span class="hljs-literal">True</span>)<br>            <span class="hljs-variable language_">self</span>.SubBytes(b, inv=<span class="hljs-literal">True</span>)<br>            <span class="hljs-variable language_">self</span>.AddRoundKey(b, expanded_key[i*<span class="hljs-number">16</span>:])<br>            <span class="hljs-variable language_">self</span>.MixColumns(b, inv=<span class="hljs-literal">True</span>)<br><br>        <span class="hljs-variable language_">self</span>.ShiftRows(b, inv=<span class="hljs-literal">True</span>)<br>        <span class="hljs-variable language_">self</span>.SubBytes(b, inv=<span class="hljs-literal">True</span>)<br>        <span class="hljs-variable language_">self</span>.AddRoundKey(b, expanded_key)<br>        <span class="hljs-keyword">return</span> b<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">aes_ecb</span>(<span class="hljs-params">self,<span class="hljs-built_in">type</span>, key, msg</span>):<br>        expanded_key = <span class="hljs-variable language_">self</span>.key_expansion(key)<br>        b = <span class="hljs-built_in">bytearray</span>(msg)<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span> == <span class="hljs-number">0</span>:<br>            b = <span class="hljs-built_in">bytearray</span>(msg+<span class="hljs-string">b&#x27;\x00&#x27;</span>*(<span class="hljs-number">16</span> - <span class="hljs-built_in">len</span>(msg)%<span class="hljs-number">16</span>))<br><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(b), <span class="hljs-number">16</span>):<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span> == <span class="hljs-number">0</span>:<br>                b[i:i+<span class="hljs-number">16</span>] = <span class="hljs-variable language_">self</span>.encrypt(b[i:i+<span class="hljs-number">16</span>], expanded_key)<br>            <span class="hljs-keyword">else</span>:<br>                b[i:i+<span class="hljs-number">16</span>] = <span class="hljs-variable language_">self</span>.decrypt(b[i:i+<span class="hljs-number">16</span>], expanded_key)<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(b)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    key = <span class="hljs-string">b&#x27;sxyz.blog foobar&#x27;</span><br>    aes = AES()<br>    enc = aes.aes_ecb(<span class="hljs-number">0</span>, <span class="hljs-built_in">bytearray</span>(key), <span class="hljs-string">b&#x27;Gonna find the answer, how to clear this up&#x27;</span>)<br>    dec = aes.aes_ecb(<span class="hljs-number">1</span>, <span class="hljs-built_in">bytearray</span>(key), enc)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Encrypted:&#x27;</span>, enc)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Decrypted:&#x27;</span>, dec)<br></code></pre></td></tr></table></figure><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/初识AES/image-20250705164453636.png" alt="image-20250705164453636"><p>​验证成功！</p>]]></content>
    
    
    <summary type="html">大概了解AES标准算法，使用python代码实现</summary>
    
    
    
    <category term="CTF" scheme="http://bumak.github.io/categories/CTF/"/>
    
    
    <category term="crypto" scheme="http://bumak.github.io/tags/crypto/"/>
    
  </entry>
  
  <entry>
    <title>XYCTF2025</title>
    <link href="http://bumak.github.io/2025/07/04/XYCTF2025/XYCTF2025RE/"/>
    <id>http://bumak.github.io/2025/07/04/XYCTF2025/XYCTF2025RE/</id>
    <published>2025-07-04T12:25:01.428Z</published>
    <updated>2025-07-04T12:25:39.023Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>​复现了4、5个题后，就感觉难度有点太大了，好几个题都涉及到没学过的技术，由于我的Windows基础很差，我的知识一直很琐碎，做题的时候感觉也只是能跑个脚本，思路根本没有领悟，而且没有深入的学习知识，没有收获，只是在动手能力方面强了一点点，性价比太低了。</p><p>​学习路线还未确定，每天就只有复现题目，很难受，看不到前进的方向。我考量着，本来要考研复习了，有很多事情等着我去忙，我都是推了其他事情，拿出考试周后的几天来全神贯注的学习做题，但是自己自学逆向越往后越难了，基础太重要了，开发经验也很重要。我是不是需要合理的计划一下我的学习了，减少无谓刷题的时间，以考研复习为中心，有空余就做一做题，这样也许心态会好很多。成为逆向大佬也不是一蹴而就的事情，一年、两年甚至数十年，这是一个爱好，我要尝试没有逆向的时期了。</p><p>​——2025 06 14</p><hr><h1 id="WARMUP-附件VBS"><a href="#WARMUP-附件VBS" class="headerlink" title="WARMUP(附件VBS)"></a>WARMUP(附件VBS)</h1><p>​这是一个vbs程序，通过<code>wscript.echo</code>函数输出代码，但是设置的窗口太大，又不知道怎么修改。于是使用python脚本提取出chr字段，在python中运行输出代码。</p><blockquote><p>学习一下<code>vbs</code>语言的基础知识：Dim是声明变量的关键字，数组标识为<code>s(255)</code>形式，字符串下标是从1开始的。字符串拼接是使用&amp;符号，Right(str,n)函数表示对字符串从右向左取n位。</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decode_vbs_chr_obfuscation_and_output</span>(<span class="hljs-params">input_vbs_file, output_txt_file</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    读取 VBScript 文件，提取 chr() 形式的混淆字符，</span><br><span class="hljs-string">    计算出其对应的 ASCII 码值和实际字符，</span><br><span class="hljs-string">    并将解码后的结果输出到指定的文本文件。</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Args:</span><br><span class="hljs-string">        input_vbs_file (str): 包含混淆 VBScript 代码的输入文件路径（例如 &#x27;chal.vbs&#x27;）。</span><br><span class="hljs-string">        output_txt_file (str): 存储解码结果的输出文件路径（例如 &#x27;code.txt&#x27;）。</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    decoded_string_parts = []<br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(input_vbs_file, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>, errors=<span class="hljs-string">&#x27;ignore&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            vbs_code = f.read()<br>    <span class="hljs-keyword">except</span> FileNotFoundError:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;错误: 输入文件 &#x27;<span class="hljs-subst">&#123;input_vbs_file&#125;</span>&#x27; 未找到。请确保文件路径正确。&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;读取文件 &#x27;<span class="hljs-subst">&#123;input_vbs_file&#125;</span>&#x27; 时发生错误: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span><br><br>    <span class="hljs-comment"># 正则表达式来匹配 chr() 中的数学表达式</span><br>    <span class="hljs-comment"># 捕获组 ([0-9\s\+\-\*\/\.]+) 会提取 chr() 括号内的内容</span><br>    chr_pattern = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&quot;chr\(\s*([0-9\s\+\-\*\/\.]+)\s*\)&quot;</span>, re.IGNORECASE)<br><br>    <span class="hljs-comment"># 查找所有匹配项</span><br>    matches = chr_pattern.findall(vbs_code)<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> matches:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;在 &#x27;<span class="hljs-subst">&#123;input_vbs_file&#125;</span>&#x27; 中未找到 &#x27;chr()&#x27; 形式的混淆表达式。&quot;</span>)<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(output_txt_file, <span class="hljs-string">&#x27;w&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> outfile:<br>            outfile.write(<span class="hljs-string">&quot;未在 VBScript 文件中找到可解码的 &#x27;chr()&#x27; 表达式。\n&quot;</span>)<br>        <span class="hljs-keyword">return</span><br><br>    <span class="hljs-keyword">for</span> expression_str <span class="hljs-keyword">in</span> matches:<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-comment"># 使用 eval() 计算数学表达式</span><br>            <span class="hljs-comment"># 注意：eval() 存在安全风险，仅在信任输入来源时使用</span><br>            ascii_value = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">eval</span>(expression_str))<br><br>            <span class="hljs-comment"># 将 ASCII 码值转换为字符</span><br>            character = <span class="hljs-built_in">chr</span>(ascii_value)<br><br>            decoded_string_parts.append(character)<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;警告: 计算表达式 &#x27;<span class="hljs-subst">&#123;expression_str&#125;</span>&#x27; 时出错: <span class="hljs-subst">&#123;e&#125;</span>。该部分将被跳过或显示为错误。&quot;</span>)<br><br>    <span class="hljs-comment"># 将所有解码出的字符连接起来形成最终的字符串</span><br>    decoded_full_string = <span class="hljs-string">&quot;&quot;</span>.join(decoded_string_parts)<br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(output_txt_file, <span class="hljs-string">&#x27;w&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> outfile:<br>            outfile.write(decoded_full_string)<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;成功解码并输出结果到 &#x27;<span class="hljs-subst">&#123;output_txt_file&#125;</span>&#x27;。&quot;</span>)<br><br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;写入文件 &#x27;<span class="hljs-subst">&#123;output_txt_file&#125;</span>&#x27; 时发生错误: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-comment"># 定义输入和输出文件名</span><br>    input_file_name = <span class="hljs-string">r&quot;F:\StudyFiles\CTF\Review_CTF\XYCTF2025\RE\VBS\chal.vbs&quot;</span><br>    output_file_name = <span class="hljs-string">r&quot;F:\StudyFiles\CTF\Review_CTF\XYCTF2025\RE\VBS\code.txt&quot;</span><br>    <span class="hljs-comment"># 调用函数执行解码和输出</span><br>    decode_vbs_chr_obfuscation_and_output(input_file_name, output_file_name)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">40</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;处理完成。&quot;</span>)<br></code></pre></td></tr></table></figure><figure class="highlight vbscript"><table><tr><td class="code"><pre><code class="hljs vbscript">MsgBox <span class="hljs-string">&quot;Dear CTFER. Have fun in XYCTF 2025!&quot;</span><br>flag = <span class="hljs-built_in">InputBox</span>(<span class="hljs-string">&quot;Enter the FLAG:&quot;</span>, <span class="hljs-string">&quot;XYCTF&quot;</span>)<br>wefbuwiue = <span class="hljs-string">&quot;90df4407ee093d309098d85a42be57a2979f1e51463a31e8d15e2fac4e84ea0df622a55c4ddfb535ef3e51e8b2528b826d5347e165912e99118333151273cc3fa8b2b3b413cf2bdb1e8c9c52865efc095a8dd89b3b3cfbb200bbadbf4a6cd4&quot;</span><br>qwfe = <span class="hljs-string">&quot;rc4key&quot;</span><br><br><br><span class="hljs-keyword">Function</span> RunRC(sMessage, strKey)<br>    <span class="hljs-keyword">Dim</span> kLen, i, j, temp, pos, outHex<br>    <span class="hljs-keyword">Dim</span> s(<span class="hljs-number">255</span>), k(<span class="hljs-number">255</span>)<br>    <br>    kLen = <span class="hljs-built_in">Len</span>(strKey)<br>    <span class="hljs-keyword">For</span> i = <span class="hljs-number">0</span> <span class="hljs-keyword">To</span> <span class="hljs-number">255</span><br>        s(i) = i<br>        k(i) = <span class="hljs-built_in">Asc</span>(<span class="hljs-built_in">Mid</span>(strKey, (i Mod kLen) + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)) <br>    <span class="hljs-keyword">Next</span><br>    <br><br>    j = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">For</span> i = <span class="hljs-number">0</span> <span class="hljs-keyword">To</span> <span class="hljs-number">255</span><br>        j = (j + s(i) + k(i)) Mod <span class="hljs-number">256</span><br>        temp = s(i)<br>        s(i) = s(j)<br>        s(j) = temp<br>    <span class="hljs-keyword">Next</span><br>    <br>   <br>    i = <span class="hljs-number">0</span> : j = <span class="hljs-number">0</span> : outHex = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">For</span> pos = <span class="hljs-number">1</span> <span class="hljs-keyword">To</span> <span class="hljs-built_in">Len</span>(sMessage)<br>        i = (i + <span class="hljs-number">1</span>) Mod <span class="hljs-number">256</span><br>        j = (j + s(i)) Mod <span class="hljs-number">256</span><br>        temp = s(i)<br>        s(i) = s(j)<br>        s(j) = temp<br>        <br>        <br>        <span class="hljs-keyword">Dim</span> plainChar, cipherByte<br>        plainChar = <span class="hljs-built_in">Asc</span>(<span class="hljs-built_in">Mid</span>(sMessage, pos, <span class="hljs-number">1</span>)) <br>        cipherByte = s((s(i) + s(j)) Mod <span class="hljs-number">256</span>) <span class="hljs-keyword">Xor</span> plainChar<br>        outHex = outHex &amp; <span class="hljs-built_in">Right</span>(<span class="hljs-string">&quot;0&quot;</span> &amp; <span class="hljs-built_in">Hex</span>(cipherByte), <span class="hljs-number">2</span>)<br>    <span class="hljs-keyword">Next</span><br>    <br>    RunRC = outHex<br><span class="hljs-keyword">End</span> <span class="hljs-keyword">Function</span><br><br><br><span class="hljs-keyword">If</span> <span class="hljs-built_in">LCase</span>(RunRC(flag, qwfe)) = <span class="hljs-built_in">LCase</span>(wefbuwiue) <span class="hljs-keyword">Then</span><br>    MsgBox <span class="hljs-string">&quot;Congratulations! Correct FLAG!&quot;</span><br><span class="hljs-keyword">Else</span><br>    MsgBox <span class="hljs-string">&quot;Wrong flag.&quot;</span><br><span class="hljs-keyword">End</span> <span class="hljs-keyword">If</span><br></code></pre></td></tr></table></figure><p>​赛博厨子一把梭哈RC4，就行了。得到<code>flag&#123;We1c0me_t0_XYCTF_2025_reverse_ch@lleng3_by_th3_w@y_p3cd0wn&#39;s_chall_is_r3@lly_gr3@t_&amp;_fuN!&#125;</code></p><p>按要求得到md5值。</p><h1 id="Moon"><a href="#Moon" class="headerlink" title="Moon"></a>Moon</h1><p>​这是一个pyd文件的逆向，对我来说相当难。.pyd文件是Python动态模块的一种，它本质上是一个Windows下的动态链接库（DLL）文件，但是扩展名为.pyd，以便Python能够识别和导入。</p><p>​.pyd文件运行你使用c或c++等编译型语言编写Python模块，然后作为一个模块供python导入和调用，就像是普通的Python文件一样。</p><p>​python版本大多数情况下可以在IDA的字符串中看到。</p><p>​不知道该怎么解，直接看源码也只能瞎猜，而且源码审计还得熟悉对应的函数才好跟踪，我都没经验。</p><h3 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h3><p>​直接学习WP，看到了，多半也是猜的，没有很逻辑性的分析。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2025/image-20250609102034211.png" alt="image-20250609102034211"></p><p>​猜测就是随机数生成流密钥，然后异或加密。所以去找密文就行。</p><p>​但是开始我使用C写的脚本生成的随机数不对劲，然后看了一眼WP，是python的随机数生成。</p><p>​现在我的脚本基本上都是AI写的了，虽然正确率高、速度快，但是我自身的代码能力下降了很多。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> random<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solve_xor_cipher</span>():<br>    seed = <span class="hljs-number">1131796</span><br>    random.seed(seed)<br><br>    enflag = <span class="hljs-string">&quot;426b87abd0ceaa3c58761bbb0172606dd8ab064491a2a76af9a93e1ae56fa84206a2f7&quot;</span><br><br>    decoded_bytes = <span class="hljs-built_in">bytearray</span>()<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(enflag), <span class="hljs-number">2</span>):<br>        hex_byte_str = enflag[i:i + <span class="hljs-number">2</span>]<br><br>        en_byte = <span class="hljs-built_in">int</span>(hex_byte_str, <span class="hljs-number">16</span>)<br><br>        random_num = random.randint(<span class="hljs-number">0</span>, <span class="hljs-number">255</span>)<br><br>        decoded_byte = en_byte ^ random_num<br><br>        decoded_bytes.append(decoded_byte)<br><br>    <span class="hljs-keyword">try</span>:<br>        flag = decoded_bytes.decode(<span class="hljs-string">&#x27;ascii&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Decoded Flag: <span class="hljs-subst">&#123;flag&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">except</span> UnicodeDecodeError:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Decoded Flag (might contain non-ASCII characters):&quot;</span>)<br>        <span class="hljs-built_in">print</span>(decoded_bytes.<span class="hljs-built_in">hex</span>())<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    solve_xor_cipher()<br></code></pre></td></tr></table></figure><p>​下面是我写的，AI还是太格式化了。</p><figure class="highlight py"><table><tr><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> random<br>enflag = <span class="hljs-string">&quot;426b87abd0ceaa3c58761bbb0172606dd8ab064491a2a76af9a93e1ae56fa84206a2f7&quot;</span><br>seed = <span class="hljs-number">1131796</span><br>random.seed(seed)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(enflag),<span class="hljs-number">2</span>):<br>    data = <span class="hljs-built_in">int</span>(enflag[i:i+<span class="hljs-number">2</span>], <span class="hljs-number">16</span>)<br>    data = data ^ random.randint(<span class="hljs-number">0</span>, <span class="hljs-number">255</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(data), end=<span class="hljs-string">&#x27;&#x27;</span>)<br></code></pre></td></tr></table></figure><h1 id="Dragon"><a href="#Dragon" class="headerlink" title="Dragon"></a>Dragon</h1><p>​拿到一个<code>bc</code>后缀文件，先使用虚拟机中的LLVM环境将文件反汇编为.ll文件，所使用命令为<code>llvm -dis filename</code>。<strong>.ll</strong>文件是LLVM的中间表示语言，是一种使用文本方式写的LLVM中间代码，可视作“<strong>高级汇编</strong>”。</p><p>​然后使用<code>sublime</code>打开反汇编文件，看到main函数，</p><p>​这是<code>for</code>循环的初始化过程，循环字符串长度除以2次。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2025/image-20250609204824158.png" alt="image-20250609204824158"></p><p>​看到for循环的主体，先调用calculate_crc64_direct函数，然后将返回值和密文比对，按照enc名称即可找到密文。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2025/image-20250609204928826.png" alt="image-20250609204928826"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2025/image-20250609205043827.png" alt="image-20250609205043827"></p><p>​下一步看一下CRC64函数，看看具体的计算过程，其实就是这个算法。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2025/image-20250609205917935.png" alt="image-20250609205917935"></p><p>​得到经验，<code>for.cond</code>表示循环的初始化，<code>for.body</code>代表循环的主要逻辑，<code>for.inc</code>表示程序循环参数的自加，<code>for.end</code>表示循环的解释，很好理解。</p><p>​整体的思路就是使用同样的计算CRC64的方法，去爆破结果。这个crc64计算函数的汇编代码非常简单，看汇编代码完全能一点点写出来，也不长。</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdint.h&gt;</span></span><br><br><span class="hljs-type">uint64_t</span> <span class="hljs-title function_">calculate_crc64</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">uint8_t</span> *data, <span class="hljs-type">int</span> len)</span><br>&#123;<br>    <span class="hljs-type">uint64_t</span> crc = <span class="hljs-number">0xFFFFFFFFFFFFFFFF</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; len; i++)<br>    &#123;<br>        crc ^= (<span class="hljs-type">uint64_t</span>)(data[i]) &lt;&lt; <span class="hljs-number">56</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">0</span>; j&lt;<span class="hljs-number">8</span>; j++)<br>        &#123;<br>            <span class="hljs-keyword">if</span>(crc &amp; <span class="hljs-number">0x8000000000000000</span>)<br>            &#123;<br>                crc = (crc &lt;&lt; <span class="hljs-number">1</span>) ^ <span class="hljs-number">0x42F0E1EBA9EA3693</span>;<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                crc &lt;&lt;= <span class="hljs-number">1</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> crc ^ <span class="hljs-number">0xFFFFFFFFFFFFFFFF</span>;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">uint64_t</span> enc[] = &#123;<span class="hljs-number">0xDC63E34E419F7B47</span>,<span class="hljs-number">0x31EF8D4E7B2BFC6</span>,<span class="hljs-number">0x12D62FBC625FD89E</span>,<span class="hljs-number">0x83E8B6E1CC5755E8</span>,<span class="hljs-number">0xfc7bb1eb2ab665cc</span>,<span class="hljs-number">0x9382ca1b2a62d96b</span>,<span class="hljs-number">0xb1fff8a07673c387</span>,<span class="hljs-number">0xda81627388e05e1</span>,<span class="hljs-number">0x9ef1e61ae8d0aab7</span>,<span class="hljs-number">0x92783fd2e7f26145</span>,<span class="hljs-number">0x63c97ca1f56fe60b</span>,<span class="hljs-number">0x9bd3a8b043b73aab</span>&#125;;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i =<span class="hljs-number">0</span>; i&lt;<span class="hljs-keyword">sizeof</span>(enc)/<span class="hljs-keyword">sizeof</span>(enc[<span class="hljs-number">0</span>]); i++)<br>    &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">uint16_t</span> j=<span class="hljs-number">0x2020</span>; j&lt;<span class="hljs-number">0xffff</span>; j++)<br>        &#123;<br>            <span class="hljs-type">uint64_t</span> crc = calculate_crc64((<span class="hljs-type">uint8_t</span>*)&amp;j, <span class="hljs-number">2</span>);<br>            <span class="hljs-keyword">if</span>(crc == enc[i])<br>            &#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c%c&quot;</span>, j&amp;<span class="hljs-number">0xff</span>, j&gt;&gt;<span class="hljs-number">8</span>);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="Lake"><a href="#Lake" class="headerlink" title="Lake"></a>Lake</h1><p>​无壳，Pascal语言编写，IDA反编译出来都是无符号解析的，只能动态分析了。</p><p>​根据程序运行时的特定，可以跟踪sleep函数到主逻辑函数<code>sub_100001B70</code>。调试时很容易发现<code>sub_10000C760</code>是输出语句的地方，<code>sub_10000CB90</code>是输入flag的地方。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2025/image-20250610123522648.png" alt="image-20250610123522648"></p><p>​第一次加密，是利用一个类似虚拟机一样的东西进行处理，取出操作码发现，只有128三种操作，其他都没使用。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2025/image-20250610123623209.png" alt="image-20250610123623209"></p><p>​第二次加密函数<code>sub_1000019B0</code>，里面很清晰的移位加密，等价于<code>v5[i] = (v3[i+1] &lt;&lt; 3) | (v3[i+2] &gt;&gt; 5)</code></p><p><code>v5[i+1] =  (v3[i+2]&lt;&lt;3) | (v3[i+3] &gt;&gt; 5)</code> <code>v5[i+2] =  (v3[i+3]&lt;&lt;3) | (v3[i] &gt;&gt; 5)</code> <code>v5[i+3] =  (v3[i]&lt;&lt;3) | (v3[i+1] &gt;&gt; 5)</code>。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2025/image-20250610123756995.png" alt="image-20250610123756995"></p><p>​最后进行密文比对，逻辑很清晰了，写解密脚本就行了。这题唯一的难点就在于无符号解析，函数名和变量巨丑陋，需要自己动调+静态分析，体力活。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2025/image-20250610124019036.png" alt="image-20250610124019036"></p><p>​我又复习到了C语言的长度计算函数——<code>sizeof</code>函数。</p><blockquote><p>​<code>sizeof</code>返回操作数所占用的内存空间大小，以字节为单位，一个字节通常是8位，但是具体位数由CHAR_BIT宏定义（在limits.h中）。返回的结果是一个无符号整型，通常是size_t类型，定义在<code>&lt;stddef.h&gt;</code>（以及其他标准头文件）中。因此，在使用<code>sizeof</code>的结果时，推荐使用<code>size_t</code>类型变量来存储。</p><p>​当<code>sizeof</code>应用于一个表达式时，它只会分析表达式的类型，而不会真正执行该表达式。例如，<code>sizeof(x++)</code>会返回<code>x</code>的类型大小，但<code>x</code>的值不会因此而增加。唯一的例外是当操作数是一个可变长度数组（VLA）时，它会在运行时求值。</p><p>​<code>sizeof(myArray)</code>: 返回整个数组的总字节数，即<code>元素数量 * 单个元素大小</code>。计算数组元素个数: <code>sizeof(myArray) / sizeof(myArray[0])</code> 是计算数组元素个数的常用方法。</p><p>​<code>sizeof(myPointer)</code>: 返回指针本身在内存中占用的字节数，而不是它所指向的数据的大小。这通常是4或8字节，取决于系统架构（32位或64位）。</p></blockquote><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><br><br><span class="hljs-comment">//这个函数需要主动传入opr数组的大小，因为在该函数里面sizeof(opr)只能得到8，也就是指针的内存空间大小。</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">decrypt1</span><span class="hljs-params">(<span class="hljs-type">uint8_t</span> *enc, <span class="hljs-type">uint8_t</span> *opr, <span class="hljs-type">int</span> opr_len)</span><br>&#123;<br>    <span class="hljs-type">uint8_t</span> a,b,c;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=opr_len<span class="hljs-number">-3</span>; i&gt;=<span class="hljs-number">0</span> ;i-=<span class="hljs-number">3</span>)<br>    &#123;<br>        a = opr[i];<br>        b = opr[i+<span class="hljs-number">1</span>];<br>        c = opr[i+<span class="hljs-number">2</span>];<br>        <span class="hljs-comment">//这里是因为已经分析出了操作码只有1、2、8三种类型。</span><br>        <span class="hljs-keyword">switch</span>(a)<br>        &#123;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>                enc[b] -= c;<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>                enc[b] += c;<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">8</span>:<br>                enc[b] ^= c;<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">default</span>:<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Error\n&quot;</span>);<br>                <span class="hljs-keyword">break</span>;     <br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">decrypt2</span><span class="hljs-params">(<span class="hljs-type">uint8_t</span> *enc, <span class="hljs-type">uint8_t</span> *flag)</span><br>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">40</span>;i+=<span class="hljs-number">4</span>)<br>    &#123;<br>        flag[i] = (enc[i+<span class="hljs-number">3</span>]&gt;&gt;<span class="hljs-number">3</span>) | (enc[i+<span class="hljs-number">2</span>]&lt;&lt;<span class="hljs-number">5</span>);<br>        flag[i+<span class="hljs-number">1</span>] = (enc[i]&gt;&gt;<span class="hljs-number">3</span>) | (enc[i+<span class="hljs-number">3</span>]&lt;&lt;<span class="hljs-number">5</span>);<br>        flag[i+<span class="hljs-number">2</span>] = (enc[i+<span class="hljs-number">1</span>]&gt;&gt;<span class="hljs-number">3</span>) | (enc[i]&lt;&lt;<span class="hljs-number">5</span>);<br>        flag[i+<span class="hljs-number">3</span>] = (enc[i+<span class="hljs-number">2</span>]&gt;&gt;<span class="hljs-number">3</span>) | (enc[i+<span class="hljs-number">1</span>]&lt;&lt;<span class="hljs-number">5</span>);<br>    &#125;<br>&#125;<br><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">uint8_t</span> enc[] = &#123;<span class="hljs-number">74</span>, <span class="hljs-number">171</span>, <span class="hljs-number">155</span>, <span class="hljs-number">27</span>, <span class="hljs-number">97</span>, <span class="hljs-number">177</span>, <span class="hljs-number">243</span>, <span class="hljs-number">50</span>, <span class="hljs-number">209</span>, <span class="hljs-number">139</span>, <span class="hljs-number">115</span>, <span class="hljs-number">235</span>, <span class="hljs-number">233</span>, <span class="hljs-number">115</span>, <span class="hljs-number">107</span>, <span class="hljs-number">34</span>, <span class="hljs-number">129</span>, <span class="hljs-number">131</span>, <span class="hljs-number">35</span>, <span class="hljs-number">49</span>, <span class="hljs-number">203</span>, <span class="hljs-number">27</span>, <span class="hljs-number">34</span>, <span class="hljs-number">251</span>, <span class="hljs-number">37</span>, <span class="hljs-number">194</span>, <span class="hljs-number">129</span>, <span class="hljs-number">129</span>, <span class="hljs-number">115</span>, <span class="hljs-number">34</span>, <span class="hljs-number">250</span>, <span class="hljs-number">3</span>, <span class="hljs-number">156</span>, <span class="hljs-number">75</span>, <span class="hljs-number">91</span>, <span class="hljs-number">73</span>, <span class="hljs-number">151</span>, <span class="hljs-number">135</span>, <span class="hljs-number">219</span>, <span class="hljs-number">81</span>&#125;;<br>    <span class="hljs-type">uint8_t</span> opr_sequ[] = &#123;<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">12</span>, <span class="hljs-number">1</span>, <span class="hljs-number">26</span>, <span class="hljs-number">85</span>, <span class="hljs-number">1</span>, <span class="hljs-number">35</span>, <span class="hljs-number">12</span>, <span class="hljs-number">2</span>, <span class="hljs-number">14</span>, <span class="hljs-number">9</span>, <span class="hljs-number">1</span>, <span class="hljs-number">27</span>, <span class="hljs-number">6</span>, <span class="hljs-number">8</span>, <span class="hljs-number">6</span>, <span class="hljs-number">5</span>, <span class="hljs-number">8</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">2</span>, <span class="hljs-number">27</span>, <span class="hljs-number">14</span>, <span class="hljs-number">2</span>, <span class="hljs-number">25</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">26</span>, <span class="hljs-number">4</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">8</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">12</span>, <span class="hljs-number">2</span>, <span class="hljs-number">12</span>, <span class="hljs-number">10</span>, <span class="hljs-number">1</span>, <span class="hljs-number">37</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">32</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">9</span>, <span class="hljs-number">12</span>, <span class="hljs-number">8</span>, <span class="hljs-number">26</span>, <span class="hljs-number">5</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">13</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">15</span>, <span class="hljs-number">2</span>, <span class="hljs-number">10</span>, <span class="hljs-number">14</span>, <span class="hljs-number">1</span>, <span class="hljs-number">16</span>, <span class="hljs-number">7</span>, <span class="hljs-number">1</span>, <span class="hljs-number">12</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">34</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">21</span>, <span class="hljs-number">10</span>, <span class="hljs-number">1</span>, <span class="hljs-number">39</span>, <span class="hljs-number">126</span>, <span class="hljs-number">2</span>, <span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">8</span>, <span class="hljs-number">15</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">1</span>, <span class="hljs-number">34</span>, <span class="hljs-number">11</span>, <span class="hljs-number">2</span>, <span class="hljs-number">18</span>, <span class="hljs-number">8</span>, <span class="hljs-number">2</span>, <span class="hljs-number">25</span>, <span class="hljs-number">9</span>, <span class="hljs-number">8</span>, <span class="hljs-number">14</span>, <span class="hljs-number">6</span>, <span class="hljs-number">8</span>, <span class="hljs-number">0</span>, <span class="hljs-number">5</span>, <span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">27</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">13</span>, <span class="hljs-number">6</span>, <span class="hljs-number">8</span>, <span class="hljs-number">13</span>, <span class="hljs-number">4</span>, <span class="hljs-number">8</span>, <span class="hljs-number">23</span>, <span class="hljs-number">12</span>, <span class="hljs-number">8</span>, <span class="hljs-number">34</span>, <span class="hljs-number">14</span>, <span class="hljs-number">2</span>, <span class="hljs-number">18</span>, <span class="hljs-number">52</span>, <span class="hljs-number">1</span>, <span class="hljs-number">38</span>, <span class="hljs-number">119</span>&#125;;<br>    <span class="hljs-type">uint8_t</span> flag[<span class="hljs-number">40</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br>    decrypt2(enc,flag);<br>    decrypt1(flag,opr_sequ,<span class="hljs-keyword">sizeof</span>(opr_sequ));<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">40</span>;i++)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>,flag[i]);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="CrackMe"><a href="#CrackMe" class="headerlink" title="CrackMe"></a>CrackMe</h1><p>​IDA查看，非MFC程序，xspy找不到按键对应的函数。调试的时候，提交按键被禁止了，需要找到对应的逻辑patch掉。</p><p>​看WP，考察的方向是win32窗口程序逆向、反调试对抗、多线程和异步。</p><p>​cs东西，x64dbg一点调试不明白。自己重新学win32窗口程序。做了，也逆不了，代码混淆的太恶心了，ida的插件还装不上，x64dbg一直到不了check点，一点点我崩溃了，花几天都解决不了的题，说明这根本不是我这个阶段能掌握的题。还是中等!</p><hr><p>​既然无法自己完整复现，更别提自己思考，那么我就跟着学一下算法逆向吧，锻炼一下代码能力好了。总不能一直卡住吧，后面的路还很远，我不能在这里停下。</p><hr><h3 id="复现-1"><a href="#复现-1" class="headerlink" title="复现"></a>复现</h3><p>​里面有个特别有特征的函数，我看不懂，直接全部问AI。</p><blockquote><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul><li><strong>这段代码是一个基于导出函数名哈希的动态API调用器。</strong></li><li>它通过参数决定加载哪个系统DLL，从该DLL导出表里用哈希匹配函数名，找到函数指针后调用，并返回结果。</li><li>结合前面代码，感觉整体代码是个复杂的“保护壳”或“自定义API调用层”，有防调试+动态调用机制。</li></ul></blockquote><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2025/image-20250612220942036.png" alt="image-20250612220942036"></p><p>​因为这个防护，所以我们无法通过导入函数的交叉引用来切入程序，但是我理解了这个是调用函数的地方（而且启同样功能，相同的代码的这个函数有很多名称，IDA在不同地方都取了不同的名称，但是点进去看是极为相似的），知道了这一点很重要，我以前不了解，只会感到太复杂，太可怕。现在我明白了，它调用函数的功能后，我就清楚类似下面这种代码就是函数调用，调用的就是<code>sub_7FF6D7FF1320</code>。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2025/image-20250612222609678.png" alt="image-20250612222609678"></p><p>​而像这种，就不是什么主要操作，多半是赋值啊等等无关的底层操作。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2025/image-20250612222847321.png" alt="image-20250612222847321"></p><p>​像<code>_CheckForDebuggerJustMyCode</code>这种函数，我开始以为是出题人写的反调试部分，检索才知道是系统代码，应该是VS程序自带的一个和调试有关的东西，我还没有深入了解，但是确认了这个函数对做题无影响。</p><p>​我也找到了PEB的反调试代码，是在<code>TlsCallback_0</code>——<code>sub_7FF6D7FF2370</code>——<code>sub_7FF6D7FF1320</code>——<code>sub_7FF6D7FEE7E0</code>——<code>sub_7FF6D7FEF280</code>处，是真难找啊，我还是跟着大佬翻源码找到的。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2025/image-20250612222252435.png" alt="image-20250612222252435"></p><p>​本以为简单的下个断点，改一次标志位就能绕过，但是情况并非如此，IDA直接卡死了，连退出命令都没有效果了，调试器直接不起作用了。看WP学习到，这是题目使⽤<code>NtSetInformationThread</code> 设置线程属性 <code>ThreadHideFromDebugger</code> 来不让调试器调试，有关的特征就是这个<code>0x11</code>数。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2025/image-20250613194110999.png" alt="image-20250613194110999"></p><p>​这次的反调试对抗，绕过技巧是修改标志0x11为其他值，同时修改对<code>BeingDebugded</code>的判断逻辑，可以将等于1改为0，如下图即可。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2025/image-20250613195146488.png" alt="image-20250613195146488"></p><p>​<code>sub_7FF65DFA1320</code>函数还有调用<code>NtSetInformationThread</code>函数的地方，修改为其他值，如下图即可。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2025/image-20250613195106815.png" alt="image-20250613195106815"></p><p>​修改如上三个位置后，就能成功正常调试了，按键不会“灰”了。<strong>(≧∀≦)ゞ</strong>，接下来就可以愉快的调试程序了，查看加密验证逻辑了。</p><hr><p>​<code>sub_7FF65DF9E7E0</code>函数相当于<code>WndProc</code>函数，断点下在这个函数头几行即可，输入后首先进入case0，这里是初始化窗口，然后再进入case4，再进入case5，后面还得回case0验证最后一步，总共分三个部分验证。</p><p>​在case4里面，异或加密验证嘛，检查前5位的<code>flag&#123;</code>。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2025/image-20250613203657885.png" alt="image-20250613203657885"></p><p>​看到case5里面调用的函数，先生成一个固定的数组，也就是替换box，然后通过异或、替换等操作进行加密，最后进行比较。我们可以直接拿到这个替换盒，然后爆破这七位。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2025/image-20250613204251325.png" alt="image-20250613204251325"></p><p>​提取数据IDA脚本。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">data = []<br>base = <span class="hljs-number">0xF33A8FF0C0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>    addr = base + i * <span class="hljs-number">4</span><br>    data.append(get_wide_dword(addr))<br><br><span class="hljs-built_in">print</span>(data)<br></code></pre></td></tr></table></figure><p>​爆破脚本，得到第二段是<code>moshui_</code>。还让我又复习了一遍python运算符的基础知识，好好好！</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">box = [<span class="hljs-number">0</span>, <span class="hljs-number">3233442988</span>, <span class="hljs-number">1510334235</span>, <span class="hljs-number">2596254647</span>, <span class="hljs-number">3020668470</span>, <span class="hljs-number">1957810842</span>, <span class="hljs-number">3993919789</span>, <span class="hljs-number">783551873</span>, <span class="hljs-number">3009837615</span>, <span class="hljs-number">1943803523</span>, <span class="hljs-number">3915621684</span>, <span class="hljs-number">702138776</span>, <span class="hljs-number">124634137</span>, <span class="hljs-number">3352799413</span>, <span class="hljs-number">1567103746</span>, <span class="hljs-number">2647816110</span>, <span class="hljs-number">3183342109</span>, <span class="hljs-number">2097651377</span>, <span class="hljs-number">3887607046</span>, <span class="hljs-number">654459306</span>, <span class="hljs-number">162941995</span>, <span class="hljs-number">3373015175</span>, <span class="hljs-number">1404277552</span>, <span class="hljs-number">2466906012</span>, <span class="hljs-number">249268274</span>, <span class="hljs-number">3462522014</span>, <span class="hljs-number">1423857449</span>, <span class="hljs-number">2489596805</span>, <span class="hljs-number">3134207492</span>, <span class="hljs-number">2053790376</span>, <span class="hljs-number">3772115231</span>, <span class="hljs-number">544179635</span>, <span class="hljs-number">2685067897</span>, <span class="hljs-number">1622183637</span>, <span class="hljs-number">4195302754</span>, <span class="hljs-number">984961486</span>, <span class="hljs-number">335633487</span>, <span class="hljs-number">3569037539</span>, <span class="hljs-number">1308918612</span>, <span class="hljs-number">2394877944</span>, <span class="hljs-number">325883990</span>, <span class="hljs-number">3554079994</span>, <span class="hljs-number">1231636301</span>, <span class="hljs-number">2312317921</span>, <span class="hljs-number">2808555104</span>, <span class="hljs-number">1742555852</span>, <span class="hljs-number">4251122043</span>, <span class="hljs-number">1037604311</span>, <span class="hljs-number">498536548</span>, <span class="hljs-number">3708648648</span>, <span class="hljs-number">1202900863</span>, <span class="hljs-number">2265490387</span>, <span class="hljs-number">2847714898</span>, <span class="hljs-number">1762050814</span>, <span class="hljs-number">4089016649</span>, <span class="hljs-number">855842277</span>, <span class="hljs-number">2932959819</span>, <span class="hljs-number">1852507879</span>, <span class="hljs-number">4107580752</span>, <span class="hljs-number">879679996</span>, <span class="hljs-number">450548861</span>, <span class="hljs-number">3663771857</span>, <span class="hljs-number">1088359270</span>, <span class="hljs-number">2154129354</span>, <span class="hljs-number">2607071921</span>, <span class="hljs-number">1541320221</span>, <span class="hljs-number">3244367274</span>, <span class="hljs-number">31158534</span>, <span class="hljs-number">795835527</span>, <span class="hljs-number">4023717931</span>, <span class="hljs-number">1969922972</span>, <span class="hljs-number">3050360624</span>, <span class="hljs-number">671266974</span>, <span class="hljs-number">3904427058</span>, <span class="hljs-number">1913087877</span>, <span class="hljs-number">2998733609</span>, <span class="hljs-number">2617837224</span>, <span class="hljs-number">1555261956</span>, <span class="hljs-number">3322730931</span>, <span class="hljs-number">112637215</span>, <span class="hljs-number">651767980</span>, <span class="hljs-number">3865271296</span>, <span class="hljs-number">2094854071</span>, <span class="hljs-number">3160834843</span>, <span class="hljs-number">2463272602</span>, <span class="hljs-number">1382605366</span>, <span class="hljs-number">3369554305</span>, <span class="hljs-number">141376813</span>, <span class="hljs-number">2512341635</span>, <span class="hljs-number">1426400815</span>, <span class="hljs-number">3485111704</span>, <span class="hljs-number">251722036</span>, <span class="hljs-number">565507253</span>, <span class="hljs-number">3775830041</span>, <span class="hljs-number">2075208622</span>, <span class="hljs-number">3138078466</span>, <span class="hljs-number">997073096</span>, <span class="hljs-number">4224994404</span>, <span class="hljs-number">1634467795</span>, <span class="hljs-number">2714866559</span>, <span class="hljs-number">2405801726</span>, <span class="hljs-number">1340076626</span>, <span class="hljs-number">3579855333</span>, <span class="hljs-number">366619977</span>, <span class="hljs-number">2282248935</span>, <span class="hljs-number">1219638859</span>, <span class="hljs-number">3524101628</span>, <span class="hljs-number">314042704</span>, <span class="hljs-number">1006888145</span>, <span class="hljs-number">4240017533</span>, <span class="hljs-number">1711684554</span>, <span class="hljs-number">2797360998</span>, <span class="hljs-number">2262029013</span>, <span class="hljs-number">1181335161</span>, <span class="hljs-number">3705015758</span>, <span class="hljs-number">476864866</span>, <span class="hljs-number">853044451</span>, <span class="hljs-number">4066508879</span>, <span class="hljs-number">1759359992</span>, <span class="hljs-number">2825379668</span>, <span class="hljs-number">901097722</span>, <span class="hljs-number">4111451222</span>, <span class="hljs-number">1873836001</span>, <span class="hljs-number">2936675149</span>, <span class="hljs-number">2176718540</span>, <span class="hljs-number">1090812512</span>, <span class="hljs-number">3686517207</span>, <span class="hljs-number">453092731</span>, <span class="hljs-number">3988292385</span>, <span class="hljs-number">755167117</span>, <span class="hljs-number">3082640442</span>, <span class="hljs-number">1996959894</span>, <span class="hljs-number">1504918807</span>, <span class="hljs-number">2567524795</span>, <span class="hljs-number">62317068</span>, <span class="hljs-number">3272380064</span>, <span class="hljs-number">1591671054</span>, <span class="hljs-number">2657392034</span>, <span class="hljs-number">81470997</span>, <span class="hljs-number">3294710457</span>, <span class="hljs-number">3939845944</span>, <span class="hljs-number">711928724</span>, <span class="hljs-number">2966460451</span>, <span class="hljs-number">1886057615</span>, <span class="hljs-number">1342533948</span>, <span class="hljs-number">2428444048</span>, <span class="hljs-number">167816743</span>, <span class="hljs-number">3401237131</span>, <span class="hljs-number">3826175754</span>, <span class="hljs-number">615818150</span>, <span class="hljs-number">3188396049</span>, <span class="hljs-number">2125561021</span>, <span class="hljs-number">3814918931</span>, <span class="hljs-number">601450431</span>, <span class="hljs-number">3110523912</span>, <span class="hljs-number">2044508324</span>, <span class="hljs-number">1466479909</span>, <span class="hljs-number">2547177865</span>, <span class="hljs-number">225274430</span>, <span class="hljs-number">3453421202</span>, <span class="hljs-number">1303535960</span>, <span class="hljs-number">2366115316</span>, <span class="hljs-number">397917763</span>, <span class="hljs-number">3608007407</span>, <span class="hljs-number">4189708142</span>, <span class="hljs-number">956543938</span>, <span class="hljs-number">2747007093</span>, <span class="hljs-number">1661365465</span>, <span class="hljs-number">4275313527</span>, <span class="hljs-number">1047427035</span>, <span class="hljs-number">2765210732</span>, <span class="hljs-number">1684777152</span>, <span class="hljs-number">1256170817</span>, <span class="hljs-number">2321926637</span>, <span class="hljs-number">282753626</span>, <span class="hljs-number">3495958262</span>, <span class="hljs-number">4027552581</span>, <span class="hljs-number">817233897</span>, <span class="hljs-number">2852801630</span>, <span class="hljs-number">1789927666</span>, <span class="hljs-number">1141124467</span>, <span class="hljs-number">2227061215</span>, <span class="hljs-number">503444072</span>, <span class="hljs-number">3736837828</span>, <span class="hljs-number">1131014506</span>, <span class="hljs-number">2211677638</span>, <span class="hljs-number">426522225</span>, <span class="hljs-number">3654703837</span>, <span class="hljs-number">4150417244</span>, <span class="hljs-number">936918000</span>, <span class="hljs-number">2909243463</span>, <span class="hljs-number">1843258603</span>, <span class="hljs-number">1994146192</span>, <span class="hljs-number">3060149564</span>, <span class="hljs-number">752459403</span>, <span class="hljs-number">3965973031</span>, <span class="hljs-number">3268935590</span>, <span class="hljs-number">40735498</span>, <span class="hljs-number">2563907773</span>, <span class="hljs-number">1483230225</span>, <span class="hljs-number">3317316543</span>, <span class="hljs-number">83908371</span>, <span class="hljs-number">2680153252</span>, <span class="hljs-number">1594198024</span>, <span class="hljs-number">1907459465</span>, <span class="hljs-number">2970347813</span>, <span class="hljs-number">733239954</span>, <span class="hljs-number">3943577150</span>, <span class="hljs-number">3412177805</span>, <span class="hljs-number">198958881</span>, <span class="hljs-number">2439277718</span>, <span class="hljs-number">1373503546</span>, <span class="hljs-number">2137656763</span>, <span class="hljs-number">3218104599</span>, <span class="hljs-number">628085408</span>, <span class="hljs-number">3855990284</span>, <span class="hljs-number">2013776290</span>, <span class="hljs-number">3099436302</span>, <span class="hljs-number">570562233</span>, <span class="hljs-number">3803740693</span>, <span class="hljs-number">3423369108</span>, <span class="hljs-number">213261112</span>, <span class="hljs-number">2517215375</span>, <span class="hljs-number">1454621731</span>, <span class="hljs-number">3604390889</span>, <span class="hljs-number">376229701</span>, <span class="hljs-number">2362670322</span>, <span class="hljs-number">1281953886</span>, <span class="hljs-number">1658658271</span>, <span class="hljs-number">2724688243</span>, <span class="hljs-number">953729732</span>, <span class="hljs-number">4167216744</span>, <span class="hljs-number">1706088902</span>, <span class="hljs-number">2768942442</span>, <span class="hljs-number">1068828381</span>, <span class="hljs-number">4279200369</span>, <span class="hljs-number">3518719984</span>, <span class="hljs-number">285281116</span>, <span class="hljs-number">2344532203</span>, <span class="hljs-number">1258607687</span>, <span class="hljs-number">1802195444</span>, <span class="hljs-number">2882616664</span>, <span class="hljs-number">829329135</span>, <span class="hljs-number">4057260611</span>, <span class="hljs-number">3747672002</span>, <span class="hljs-number">534414190</span>, <span class="hljs-number">2238001369</span>, <span class="hljs-number">1172266101</span>, <span class="hljs-number">3624741851</span>, <span class="hljs-number">414664567</span>, <span class="hljs-number">2181625024</span>, <span class="hljs-number">1119000684</span>, <span class="hljs-number">1812370925</span>, <span class="hljs-number">2898065729</span>, <span class="hljs-number">906185462</span>, <span class="hljs-number">4139329114</span>]<br><br>enc = [<span class="hljs-number">0x46A95BAD</span>,<span class="hljs-number">0x1CAC84B6</span>,<span class="hljs-number">0xA67CB2B2</span>,<span class="hljs-number">0x32188937</span>,<span class="hljs-number">0x4872D39F</span>,<span class="hljs-number">0xF2A2E59B</span>,<span class="hljs-number">0x11B94D2</span>]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(enc)):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>, <span class="hljs-number">127</span>):<br>        tmp = j ^ <span class="hljs-number">0x79</span> &amp; <span class="hljs-number">0xff</span><br>        <br>        <span class="hljs-comment">#更好的选择是 ((~box[tmp] ^ 0xB0E0E879) &amp; 0xffffffff)，下面这个是个有冗余的代码。</span><br>        <span class="hljs-comment">#因为python中优先级：取反&gt;与&gt;异或，使用下面的代码是先算括号，然后算后面的与，然后才算异或的。</span><br>        <span class="hljs-comment">#也就是说最后的与根本没起作用，限制不了前面括号的数，它直接和0xB0E0E879爆了。</span><br>        <span class="hljs-keyword">if</span> ((~box[tmp] &amp; <span class="hljs-number">0xffffffff</span>) ^ <span class="hljs-number">0xB0E0E879</span> &amp; <span class="hljs-number">0xffffffff</span>) == enc[i]:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(j), end=<span class="hljs-string">&#x27;&#x27;</span>)<br>            <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><p>​</p><p>​最后一段，通过断点，也可以发现，是在TLS回调函数这里的一个线程里面，它一直在while(1)循环，等待前两部分验证通过才会进入进入第三部分的验证的，这里应该是通过共享全局变量标志位和if语句来实现这个效果的。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2025/image-20250613215606861.png" alt="image-20250613215606861"></p><p>​下面生成了一个128位的密钥，一个循环5一个循环7，可以猜到是使用前两段flag来生成密钥啊。直接提取就可以了。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2025/image-20250613220005888.png" alt="image-20250613220005888"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2025/image-20250613220123411.png" alt="image-20250613220123411"></p><p>​后面又在验证末尾是不是}符号，不是就进入if，处理错误逻辑。同时根据+28这个偏移，我们能够猜到flag总长度为29个字节，前面12个已经验证，后面再验证17个字符（包括结尾的}）。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2025/image-20250613220329827.png" alt="image-20250613220329827"></p><p>​看到后面的加密函数和验证代码，v7就是密文。<code>sub_7FF65DFA1500</code>参数有密钥、输入的flag、长度、输出缓冲区。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2025/image-20250613220636641.png" alt="image-20250613220636641"></p><p>​里面又有一些密钥操作，然后加密0x10000次，但是因为加密的明文和密文保存在两个不同的数组，所以其实和加密一次一样，每次都是同样的结果写入密文的缓冲区。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2025/image-20250613220840974.png" alt="image-20250613220840974"></p><p>​学习大佬的WP，里面是一个IDEA加密算法，我是菜鸡，都没有碰到过这个算法，好好学学。烦的一批，怎么现在这个AI还是这么煞笔啊，给出的代码全是错的，越改越差，垃圾狗屎AI。</p><p>​学习下大佬的代码吧，我现在还是不会写代码，算法都不太能理解，数学能力很差了，代码能力也很差了。我感觉我要去练算法题了，哈哈，有时间一定去练好吧。</p><figure class="highlight c++"><table><tr><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;bitset&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cmath&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;windows.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-keyword">typedef</span> bitset&lt;16&gt; code;<br><span class="hljs-keyword">typedef</span> bitset&lt;128&gt; key;<br><br>bitset&lt;16&gt; sub_key[<span class="hljs-number">52</span>];<br>bitset&lt;16&gt; inv_sub_key[<span class="hljs-number">52</span>];<br><br><span class="hljs-function">code <span class="hljs-title">XOR</span><span class="hljs-params">(code code_1, code code_2)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> code_1 ^ code_2;<br>&#125;<br><br><span class="hljs-function">code <span class="hljs-title">Plus</span><span class="hljs-params">(code code_1, code code_2)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> tmp = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++)<br>    &#123;<br>        tmp += code_1[i] * <span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>, i) + code_2[i] * <span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>, i);<br>    &#125;<br>    tmp %= <span class="hljs-number">65536</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bitset</span>&lt;<span class="hljs-number">16</span>&gt;(tmp);<br>&#125;<br><br><span class="hljs-function">code <span class="hljs-title">invPlus</span><span class="hljs-params">(code code_in)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> tmp = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++)<br>        tmp += code_in[i] * <span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>, i);<br>    tmp = <span class="hljs-number">65536</span> - tmp;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bitset</span>&lt;<span class="hljs-number">16</span>&gt;(tmp);<br>&#125;<br><br><span class="hljs-function">code <span class="hljs-title">Times</span><span class="hljs-params">(code code_1, code code_2)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> tmp_1 = <span class="hljs-number">0</span>, tmp_2 = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++)<br>    &#123;<br>        tmp_1 += code_1[i] * <span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>, i);<br>        tmp_2 += code_2[i] * <span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>, i);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (tmp_1 == <span class="hljs-number">0</span>)<br>        tmp_1 = <span class="hljs-number">65536</span>;<br>    <span class="hljs-keyword">if</span> (tmp_2 == <span class="hljs-number">0</span>)<br>        tmp_2 = <span class="hljs-number">65536</span>;<br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> tmp = (tmp_1 * tmp_2) % <span class="hljs-number">65537</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bitset</span>&lt;<span class="hljs-number">16</span>&gt;(tmp == <span class="hljs-number">65536</span> ? <span class="hljs-number">0</span> : tmp);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Exgcd</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b, <span class="hljs-type">int</span> &amp;x, <span class="hljs-type">int</span> &amp;y)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span> (!b)<br>        x = <span class="hljs-number">1</span>, y = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-built_in">Exgcd</span>(b, a % b, y, x), y -= a / b * x;<br>&#125;<br><br><span class="hljs-function">code <span class="hljs-title">invTimes</span><span class="hljs-params">(code code_in)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> tmp = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++)<br>        tmp += code_in[i] * <span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>, i);<br>    <span class="hljs-type">int</span> x, y;<br>    <span class="hljs-type">int</span> p = <span class="hljs-number">65537</span>;<br>    <span class="hljs-built_in">Exgcd</span>(tmp, p, x, y);<br>    x = (x % p + p) % p;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bitset</span>&lt;<span class="hljs-number">16</span>&gt;(x);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">subkeys_get</span><span class="hljs-params">(code keys_input[<span class="hljs-number">8</span>])</span></span><br><span class="hljs-function"></span>&#123;<br>    key keys;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++)<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">16</span>; j++)<br>            keys[j + <span class="hljs-number">16</span> * i] = keys_input[<span class="hljs-number">7</span> - i][j];<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++)<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">16</span>; j++)<br>            sub_key[i][<span class="hljs-number">15</span> - j] = keys[<span class="hljs-number">127</span> - (j + <span class="hljs-number">16</span> * i)];<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++)<br>    &#123;<br>        key tmp_keys = keys &gt;&gt; <span class="hljs-number">103</span>;<br>        keys = (keys &lt;&lt; <span class="hljs-number">25</span>) | tmp_keys;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = (<span class="hljs-number">8</span> + <span class="hljs-number">8</span> * i); j &lt; (<span class="hljs-number">8</span> * (i + <span class="hljs-number">2</span>)); j++)<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> k = <span class="hljs-number">0</span>; k &lt; <span class="hljs-number">16</span>; k++)<br>                sub_key[j][<span class="hljs-number">15</span> - k] = keys[<span class="hljs-number">127</span> - (k + <span class="hljs-number">16</span> * (j - <span class="hljs-number">8</span> - <span class="hljs-number">8</span> * i))];<br>    &#125;<br><br>    key tmp_keys = keys &gt;&gt; <span class="hljs-number">103</span>;<br>    keys = (keys &lt;&lt; <span class="hljs-number">25</span>) | tmp_keys;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">48</span>; i &lt; <span class="hljs-number">52</span>; i++)<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">16</span>; j++)<br>            sub_key[i][<span class="hljs-number">15</span> - j] = keys[<span class="hljs-number">127</span> - (j + <span class="hljs-number">16</span> * (i - <span class="hljs-number">48</span>))];<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">inv_subkeys_get</span><span class="hljs-params">(code sub_key[<span class="hljs-number">52</span>])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">6</span>; i &lt; <span class="hljs-number">48</span>; i += <span class="hljs-number">6</span>)<br>    &#123;<br>        inv_sub_key[i] = <span class="hljs-built_in">invTimes</span>(sub_key[<span class="hljs-number">48</span> - i]);<br>        inv_sub_key[i + <span class="hljs-number">1</span>] = <span class="hljs-built_in">invPlus</span>(sub_key[<span class="hljs-number">50</span> - i]);<br>        inv_sub_key[i + <span class="hljs-number">2</span>] = <span class="hljs-built_in">invPlus</span>(sub_key[<span class="hljs-number">49</span> - i]);<br>        inv_sub_key[i + <span class="hljs-number">3</span>] = <span class="hljs-built_in">invTimes</span>(sub_key[<span class="hljs-number">51</span> - i]);<br>    &#125;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">48</span>; i += <span class="hljs-number">6</span>)<br>    &#123;<br>        inv_sub_key[i + <span class="hljs-number">4</span>] = sub_key[<span class="hljs-number">46</span> - i];<br>        inv_sub_key[i + <span class="hljs-number">5</span>] = sub_key[<span class="hljs-number">47</span> - i];<br>    &#125;<br><br>    inv_sub_key[<span class="hljs-number">0</span>] = <span class="hljs-built_in">invTimes</span>(sub_key[<span class="hljs-number">48</span>]);<br>    inv_sub_key[<span class="hljs-number">1</span>] = <span class="hljs-built_in">invPlus</span>(sub_key[<span class="hljs-number">49</span>]);<br>    inv_sub_key[<span class="hljs-number">2</span>] = <span class="hljs-built_in">invPlus</span>(sub_key[<span class="hljs-number">50</span>]);<br>    inv_sub_key[<span class="hljs-number">3</span>] = <span class="hljs-built_in">invTimes</span>(sub_key[<span class="hljs-number">51</span>]);<br><br>    inv_sub_key[<span class="hljs-number">48</span>] = <span class="hljs-built_in">invTimes</span>(sub_key[<span class="hljs-number">0</span>]);<br>    inv_sub_key[<span class="hljs-number">49</span>] = <span class="hljs-built_in">invPlus</span>(sub_key[<span class="hljs-number">1</span>]);<br>    inv_sub_key[<span class="hljs-number">50</span>] = <span class="hljs-built_in">invPlus</span>(sub_key[<span class="hljs-number">2</span>]);<br>    inv_sub_key[<span class="hljs-number">51</span>] = <span class="hljs-built_in">invTimes</span>(sub_key[<span class="hljs-number">3</span>]);<br>&#125;<br><br><span class="hljs-function">bitset&lt;64&gt; <span class="hljs-title">dencrypt</span><span class="hljs-params">(bitset&lt;<span class="hljs-number">64</span>&gt; cipher)</span></span><br><span class="hljs-function"></span>&#123;<br>    bitset&lt;16&gt; I_1, I_2, I_3, I_4;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++)<br>    &#123;<br>        I_1[<span class="hljs-number">15</span> - i] = cipher[<span class="hljs-number">63</span> - i];<br>        I_2[<span class="hljs-number">15</span> - i] = cipher[<span class="hljs-number">47</span> - i];<br>        I_3[<span class="hljs-number">15</span> - i] = cipher[<span class="hljs-number">31</span> - i];<br>        I_4[i] = cipher[i];<br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">48</span>; i += <span class="hljs-number">6</span>)<br>    &#123;<br>        bitset&lt;16&gt; tmp_1 = <span class="hljs-built_in">Times</span>(inv_sub_key[i], I_1);<br>        bitset&lt;16&gt; tmp_2 = <span class="hljs-built_in">Plus</span>(inv_sub_key[i + <span class="hljs-number">1</span>], I_2);<br>        bitset&lt;16&gt; tmp_3 = <span class="hljs-built_in">Plus</span>(inv_sub_key[i + <span class="hljs-number">2</span>], I_3);<br>        bitset&lt;16&gt; tmp_4 = <span class="hljs-built_in">Times</span>(inv_sub_key[i + <span class="hljs-number">3</span>], I_4);<br>        bitset&lt;16&gt; tmp_5 = <span class="hljs-built_in">XOR</span>(tmp_1, tmp_3);<br>        bitset&lt;16&gt; tmp_6 = <span class="hljs-built_in">XOR</span>(tmp_2, tmp_4);<br>        bitset&lt;16&gt; tmp_7 = <span class="hljs-built_in">Times</span>(inv_sub_key[i + <span class="hljs-number">4</span>], tmp_5);<br>        bitset&lt;16&gt; tmp_8 = <span class="hljs-built_in">Plus</span>(tmp_6, tmp_7);<br>        bitset&lt;16&gt; tmp_9 = <span class="hljs-built_in">Times</span>(tmp_8, inv_sub_key[i + <span class="hljs-number">5</span>]);<br>        bitset&lt;16&gt; tmp_10 = <span class="hljs-built_in">Plus</span>(tmp_7, tmp_9);<br>        I_1 = <span class="hljs-built_in">XOR</span>(tmp_1, tmp_9);<br>        I_2 = <span class="hljs-built_in">XOR</span>(tmp_3, tmp_9);<br>        I_3 = <span class="hljs-built_in">XOR</span>(tmp_2, tmp_10);<br>        I_4 = <span class="hljs-built_in">XOR</span>(tmp_4, tmp_10);<br>    &#125;<br>    bitset&lt;16&gt; Y_1 = <span class="hljs-built_in">Times</span>(I_1, inv_sub_key[<span class="hljs-number">48</span>]);<br>    bitset&lt;16&gt; Y_2 = <span class="hljs-built_in">Plus</span>(I_3, inv_sub_key[<span class="hljs-number">49</span>]);<br>    bitset&lt;16&gt; Y_3 = <span class="hljs-built_in">Plus</span>(I_2, inv_sub_key[<span class="hljs-number">50</span>]);<br>    bitset&lt;16&gt; Y_4 = <span class="hljs-built_in">Times</span>(I_4, inv_sub_key[<span class="hljs-number">51</span>]);<br><br>    bitset&lt;64&gt; plaint;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++)<br>    &#123;<br>        plaint[i] = Y_4[i];<br>        plaint[i + <span class="hljs-number">16</span>] = Y_3[i];<br>        plaint[i + <span class="hljs-number">32</span>] = Y_2[i];<br>        plaint[i + <span class="hljs-number">48</span>] = Y_1[i];<br>    &#125;<br>    <span class="hljs-keyword">return</span> plaint;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> box1[] = &#123;<br>        <span class="hljs-number">0x00000000</span>, <span class="hljs-number">0xC0BA6CAC</span>, <span class="hljs-number">0x5A05DF1B</span>, <span class="hljs-number">0x9ABFB3B7</span>, <span class="hljs-number">0xB40BBE36</span>, <span class="hljs-number">0x74B1D29A</span>,<br>        <span class="hljs-number">0xEE0E612D</span>, <span class="hljs-number">0x2EB40D81</span>, <span class="hljs-number">0xB3667A2F</span>, <span class="hljs-number">0x73DC1683</span>, <span class="hljs-number">0xE963A534</span>, <span class="hljs-number">0x29D9C998</span>, <span class="hljs-number">0x076DC419</span>, <span class="hljs-number">0xC7D7A8B5</span>,<br>        <span class="hljs-number">0x5D681B02</span>, <span class="hljs-number">0x9DD277AE</span>, <span class="hljs-number">0xBDBDF21D</span>, <span class="hljs-number">0x7D079EB1</span>, <span class="hljs-number">0xE7B82D06</span>, <span class="hljs-number">0x270241AA</span>, <span class="hljs-number">0x09B64C2B</span>, <span class="hljs-number">0xC90C2087</span>,<br>        <span class="hljs-number">0x53B39330</span>, <span class="hljs-number">0x9309FF9C</span>, <span class="hljs-number">0x0EDB8832</span>, <span class="hljs-number">0xCE61E49E</span>, <span class="hljs-number">0x54DE5729</span>, <span class="hljs-number">0x94643B85</span>, <span class="hljs-number">0xBAD03604</span>, <span class="hljs-number">0x7A6A5AA8</span>,<br>        <span class="hljs-number">0xE0D5E91F</span>, <span class="hljs-number">0x206F85B3</span>, <span class="hljs-number">0xA00AE279</span>, <span class="hljs-number">0x60B08ED5</span>, <span class="hljs-number">0xFA0F3D62</span>, <span class="hljs-number">0x3AB551CE</span>, <span class="hljs-number">0x14015C4F</span>, <span class="hljs-number">0xD4BB30E3</span>,<br>        <span class="hljs-number">0x4E048354</span>, <span class="hljs-number">0x8EBEEFF8</span>, <span class="hljs-number">0x136C9856</span>, <span class="hljs-number">0xD3D6F4FA</span>, <span class="hljs-number">0x4969474D</span>, <span class="hljs-number">0x89D32BE1</span>, <span class="hljs-number">0xA7672660</span>, <span class="hljs-number">0x67DD4ACC</span>,<br>        <span class="hljs-number">0xFD62F97B</span>, <span class="hljs-number">0x3DD895D7</span>, <span class="hljs-number">0x1DB71064</span>, <span class="hljs-number">0xDD0D7CC8</span>, <span class="hljs-number">0x47B2CF7F</span>, <span class="hljs-number">0x8708A3D3</span>, <span class="hljs-number">0xA9BCAE52</span>, <span class="hljs-number">0x6906C2FE</span>,<br>        <span class="hljs-number">0xF3B97149</span>, <span class="hljs-number">0x33031DE5</span>, <span class="hljs-number">0xAED16A4B</span>, <span class="hljs-number">0x6E6B06E7</span>, <span class="hljs-number">0xF4D4B550</span>, <span class="hljs-number">0x346ED9FC</span>, <span class="hljs-number">0x1ADAD47D</span>, <span class="hljs-number">0xDA60B8D1</span>,<br>        <span class="hljs-number">0x40DF0B66</span>, <span class="hljs-number">0x806567CA</span>, <span class="hljs-number">0x9B64C2B1</span>, <span class="hljs-number">0x5BDEAE1D</span>, <span class="hljs-number">0xC1611DAA</span>, <span class="hljs-number">0x01DB7106</span>, <span class="hljs-number">0x2F6F7C87</span>, <span class="hljs-number">0xEFD5102B</span>,<br>        <span class="hljs-number">0x756AA39C</span>, <span class="hljs-number">0xB5D0CF30</span>, <span class="hljs-number">0x2802B89E</span>, <span class="hljs-number">0xE8B8D432</span>, <span class="hljs-number">0x72076785</span>, <span class="hljs-number">0xB2BD0B29</span>, <span class="hljs-number">0x9C0906A8</span>, <span class="hljs-number">0x5CB36A04</span>,<br>        <span class="hljs-number">0xC60CD9B3</span>, <span class="hljs-number">0x06B6B51F</span>, <span class="hljs-number">0x26D930AC</span>, <span class="hljs-number">0xE6635C00</span>, <span class="hljs-number">0x7CDCEFB7</span>, <span class="hljs-number">0xBC66831B</span>, <span class="hljs-number">0x92D28E9A</span>, <span class="hljs-number">0x5268E236</span>,<br>        <span class="hljs-number">0xC8D75181</span>, <span class="hljs-number">0x086D3D2D</span>, <span class="hljs-number">0x95BF4A83</span>, <span class="hljs-number">0x5505262F</span>, <span class="hljs-number">0xCFBA9598</span>, <span class="hljs-number">0x0F00F934</span>, <span class="hljs-number">0x21B4F4B5</span>, <span class="hljs-number">0xE10E9819</span>,<br>        <span class="hljs-number">0x7BB12BAE</span>, <span class="hljs-number">0xBB0B4702</span>, <span class="hljs-number">0x3B6E20C8</span>, <span class="hljs-number">0xFBD44C64</span>, <span class="hljs-number">0x616BFFD3</span>, <span class="hljs-number">0xA1D1937F</span>, <span class="hljs-number">0x8F659EFE</span>, <span class="hljs-number">0x4FDFF252</span>,<br>        <span class="hljs-number">0xD56041E5</span>, <span class="hljs-number">0x15DA2D49</span>, <span class="hljs-number">0x88085AE7</span>, <span class="hljs-number">0x48B2364B</span>, <span class="hljs-number">0xD20D85FC</span>, <span class="hljs-number">0x12B7E950</span>, <span class="hljs-number">0x3C03E4D1</span>, <span class="hljs-number">0xFCB9887D</span>,<br>        <span class="hljs-number">0x66063BCA</span>, <span class="hljs-number">0xA6BC5766</span>, <span class="hljs-number">0x86D3D2D5</span>, <span class="hljs-number">0x4669BE79</span>, <span class="hljs-number">0xDCD60DCE</span>, <span class="hljs-number">0x1C6C6162</span>, <span class="hljs-number">0x32D86CE3</span>, <span class="hljs-number">0xF262004F</span>,<br>        <span class="hljs-number">0x68DDB3F8</span>, <span class="hljs-number">0xA867DF54</span>, <span class="hljs-number">0x35B5A8FA</span>, <span class="hljs-number">0xF50FC456</span>, <span class="hljs-number">0x6FB077E1</span>, <span class="hljs-number">0xAF0A1B4D</span>, <span class="hljs-number">0x81BE16CC</span>, <span class="hljs-number">0x41047A60</span>,<br>        <span class="hljs-number">0xDBBBC9D7</span>, <span class="hljs-number">0x1B01A57B</span>, <span class="hljs-number">0xEDB88321</span>, <span class="hljs-number">0x2D02EF8D</span>, <span class="hljs-number">0xB7BD5C3A</span>, <span class="hljs-number">0x77073096</span>, <span class="hljs-number">0x59B33D17</span>, <span class="hljs-number">0x990951BB</span>,<br>        <span class="hljs-number">0x03B6E20C</span>, <span class="hljs-number">0xC30C8EA0</span>, <span class="hljs-number">0x5EDEF90E</span>, <span class="hljs-number">0x9E6495A2</span>, <span class="hljs-number">0x04DB2615</span>, <span class="hljs-number">0xC4614AB9</span>, <span class="hljs-number">0xEAD54738</span>, <span class="hljs-number">0x2A6F2B94</span>,<br>        <span class="hljs-number">0xB0D09823</span>, <span class="hljs-number">0x706AF48F</span>, <span class="hljs-number">0x5005713C</span>, <span class="hljs-number">0x90BF1D90</span>, <span class="hljs-number">0x0A00AE27</span>, <span class="hljs-number">0xCABAC28B</span>, <span class="hljs-number">0xE40ECF0A</span>, <span class="hljs-number">0x24B4A3A6</span>,<br>        <span class="hljs-number">0xBE0B1011</span>, <span class="hljs-number">0x7EB17CBD</span>, <span class="hljs-number">0xE3630B13</span>, <span class="hljs-number">0x23D967BF</span>, <span class="hljs-number">0xB966D408</span>, <span class="hljs-number">0x79DCB8A4</span>, <span class="hljs-number">0x5768B525</span>, <span class="hljs-number">0x97D2D989</span>,<br>        <span class="hljs-number">0x0D6D6A3E</span>, <span class="hljs-number">0xCDD70692</span>, <span class="hljs-number">0x4DB26158</span>, <span class="hljs-number">0x8D080DF4</span>, <span class="hljs-number">0x17B7BE43</span>, <span class="hljs-number">0xD70DD2EF</span>, <span class="hljs-number">0xF9B9DF6E</span>, <span class="hljs-number">0x3903B3C2</span>,<br>        <span class="hljs-number">0xA3BC0075</span>, <span class="hljs-number">0x63066CD9</span>, <span class="hljs-number">0xFED41B77</span>, <span class="hljs-number">0x3E6E77DB</span>, <span class="hljs-number">0xA4D1C46C</span>, <span class="hljs-number">0x646BA8C0</span>, <span class="hljs-number">0x4ADFA541</span>, <span class="hljs-number">0x8A65C9ED</span>,<br>        <span class="hljs-number">0x10DA7A5A</span>, <span class="hljs-number">0xD06016F6</span>, <span class="hljs-number">0xF00F9345</span>, <span class="hljs-number">0x30B5FFE9</span>, <span class="hljs-number">0xAA0A4C5E</span>, <span class="hljs-number">0x6AB020F2</span>, <span class="hljs-number">0x44042D73</span>, <span class="hljs-number">0x84BE41DF</span>,<br>        <span class="hljs-number">0x1E01F268</span>, <span class="hljs-number">0xDEBB9EC4</span>, <span class="hljs-number">0x4369E96A</span>, <span class="hljs-number">0x83D385C6</span>, <span class="hljs-number">0x196C3671</span>, <span class="hljs-number">0xD9D65ADD</span>, <span class="hljs-number">0xF762575C</span>, <span class="hljs-number">0x37D83BF0</span>,<br>        <span class="hljs-number">0xAD678847</span>, <span class="hljs-number">0x6DDDE4EB</span>, <span class="hljs-number">0x76DC4190</span>, <span class="hljs-number">0xB6662D3C</span>, <span class="hljs-number">0x2CD99E8B</span>, <span class="hljs-number">0xEC63F227</span>, <span class="hljs-number">0xC2D7FFA6</span>, <span class="hljs-number">0x026D930A</span>,<br>        <span class="hljs-number">0x98D220BD</span>, <span class="hljs-number">0x58684C11</span>, <span class="hljs-number">0xC5BA3BBF</span>, <span class="hljs-number">0x05005713</span>, <span class="hljs-number">0x9FBFE4A4</span>, <span class="hljs-number">0x5F058808</span>, <span class="hljs-number">0x71B18589</span>, <span class="hljs-number">0xB10BE925</span>,<br>        <span class="hljs-number">0x2BB45A92</span>, <span class="hljs-number">0xEB0E363E</span>, <span class="hljs-number">0xCB61B38D</span>, <span class="hljs-number">0x0BDBDF21</span>, <span class="hljs-number">0x91646C96</span>, <span class="hljs-number">0x51DE003A</span>, <span class="hljs-number">0x7F6A0DBB</span>, <span class="hljs-number">0xBFD06117</span>,<br>        <span class="hljs-number">0x256FD2A0</span>, <span class="hljs-number">0xE5D5BE0C</span>, <span class="hljs-number">0x7807C9A2</span>, <span class="hljs-number">0xB8BDA50E</span>, <span class="hljs-number">0x220216B9</span>, <span class="hljs-number">0xE2B87A15</span>, <span class="hljs-number">0xCC0C7794</span>, <span class="hljs-number">0x0CB61B38</span>,<br>        <span class="hljs-number">0x9609A88F</span>, <span class="hljs-number">0x56B3C423</span>, <span class="hljs-number">0xD6D6A3E9</span>, <span class="hljs-number">0x166CCF45</span>, <span class="hljs-number">0x8CD37CF2</span>, <span class="hljs-number">0x4C69105E</span>, <span class="hljs-number">0x62DD1DDF</span>, <span class="hljs-number">0xA2677173</span>,<br>        <span class="hljs-number">0x38D8C2C4</span>, <span class="hljs-number">0xF862AE68</span>, <span class="hljs-number">0x65B0D9C6</span>, <span class="hljs-number">0xA50AB56A</span>, <span class="hljs-number">0x3FB506DD</span>, <span class="hljs-number">0xFF0F6A71</span>, <span class="hljs-number">0xD1BB67F0</span>, <span class="hljs-number">0x11010B5C</span>,<br>        <span class="hljs-number">0x8BBEB8EB</span>, <span class="hljs-number">0x4B04D447</span>, <span class="hljs-number">0x6B6B51F4</span>, <span class="hljs-number">0xABD13D58</span>, <span class="hljs-number">0x316E8EEF</span>, <span class="hljs-number">0xF1D4E243</span>, <span class="hljs-number">0xDF60EFC2</span>, <span class="hljs-number">0x1FDA836E</span>,<br>        <span class="hljs-number">0x856530D9</span>, <span class="hljs-number">0x45DF5C75</span>, <span class="hljs-number">0xD80D2BDB</span>, <span class="hljs-number">0x18B74777</span>, <span class="hljs-number">0x8208F4C0</span>, <span class="hljs-number">0x42B2986C</span>, <span class="hljs-number">0x6C0695ED</span>, <span class="hljs-number">0xACBCF941</span>,<br>        <span class="hljs-number">0x36034AF6</span>, <span class="hljs-number">0xF6B9265A</span>, <span class="hljs-number">0xCCCCCCCC</span>, <span class="hljs-number">0xCCCCCC00</span>, <span class="hljs-number">0x00000100</span>, <span class="hljs-number">0x00000000</span>, <span class="hljs-number">0xF6B9265A</span>, <span class="hljs-number">0xCCCCCCCC</span>,<br>        <span class="hljs-number">0x00000008</span>, <span class="hljs-number">0x00000000</span>&#125;;<br><br>    <span class="hljs-type">uint32_t</span> enc1[]&#123;<br>        <span class="hljs-number">0x46A95BAD</span>,<br>        <span class="hljs-number">0x1CAC84B6</span>,<br>        <span class="hljs-number">0xA67CB2B2</span>,<br>        <span class="hljs-number">0x32188937</span>,<br>        <span class="hljs-number">0x4872D39F</span>,<br>        <span class="hljs-number">0xF2A2E59B</span>,<br>        <span class="hljs-number">0x011B94D2</span>,<br>    &#125;;<br><br>    <span class="hljs-comment">// 爆破前7字节</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">7</span>; i++)<br>    &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> c = <span class="hljs-number">28</span>; c &lt; <span class="hljs-number">132</span>; c++)<br>        &#123;<br>            <span class="hljs-keyword">if</span> ((~box1[(<span class="hljs-type">uint8_t</span>)c ^ <span class="hljs-number">0x79</span>] ^ <span class="hljs-number">0xB0E0E879</span>) == enc1[i])<br>            &#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>, c);<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// 后16字节进行IDEA解密</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> enc2[<span class="hljs-number">16</span>] = &#123;<br>        <span class="hljs-number">0x5C</span>, <span class="hljs-number">0x2F</span>, <span class="hljs-number">0xD0</span>, <span class="hljs-number">0xEC</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0x0E</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x57</span>,<br>        <span class="hljs-number">0x6A</span>, <span class="hljs-number">0x9F</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0xF6</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0xA4</span>, <span class="hljs-number">0xAC</span>, <span class="hljs-number">0x90</span>&#125;;<br>    <span class="hljs-comment">// unsigned int key[4] = &#123;</span><br>    <span class="hljs-comment">//     0x42B2986C, 0x12345678, 0x0D6D6A3E, 0x89ABCDEF&#125;;</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> key[<span class="hljs-number">4</span>] = &#123;<br>        <span class="hljs-number">0x6C98B242</span>, <span class="hljs-number">0x78563412</span>, <span class="hljs-number">0x3E6A6D0D</span>, <span class="hljs-number">0xEFCDAB89</span>&#125;;<br><br>    code keys_input[<span class="hljs-number">8</span>];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++)<br>    &#123;<br>        keys_input[<span class="hljs-number">2</span> * i + <span class="hljs-number">1</span>] = key[i] &amp; <span class="hljs-number">0xFFFF</span>;<br>        keys_input[<span class="hljs-number">2</span> * i] = (key[i] &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFFFF</span>;<br>    &#125;<br><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> result[<span class="hljs-number">16</span>];<br>    bitset&lt;64&gt; cipher1, cipher2;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++)<br>    &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">8</span>; j++)<br>        &#123;<br>            cipher1[<span class="hljs-number">63</span> - (i * <span class="hljs-number">8</span> + j)] = (enc2[i] &gt;&gt; (<span class="hljs-number">7</span> - j)) &amp; <span class="hljs-number">1</span>;<br>            cipher2[<span class="hljs-number">63</span> - (i * <span class="hljs-number">8</span> + j)] = (enc2[i + <span class="hljs-number">8</span>] &gt;&gt; (<span class="hljs-number">7</span> - j)) &amp; <span class="hljs-number">1</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-built_in">subkeys_get</span>(keys_input);<br>    <span class="hljs-built_in">inv_subkeys_get</span>(sub_key);<br><br>    bitset&lt;64&gt; plain1 = <span class="hljs-built_in">dencrypt</span>(cipher1);<br>    bitset&lt;64&gt; plain2 = <span class="hljs-built_in">dencrypt</span>(cipher2);<br><br>    <span class="hljs-type">uint64_t</span> plain1_val = plain<span class="hljs-number">1.</span><span class="hljs-built_in">to_ullong</span>();<br>    <span class="hljs-type">uint64_t</span> plain2_val = plain<span class="hljs-number">2.</span><span class="hljs-built_in">to_ullong</span>();<br><br>    <span class="hljs-type">uint8_t</span> dec2[<span class="hljs-number">16</span>]&#123;&#125;;<br>    <span class="hljs-built_in">memcpy</span>(dec2, &amp;plain2_val, <span class="hljs-number">8</span>);<br>    <span class="hljs-built_in">memcpy</span>(dec2 + <span class="hljs-number">8</span>, &amp;plain1_val, <span class="hljs-number">8</span>);<br>    <span class="hljs-built_in">reverse</span>(dec2, dec2 + <span class="hljs-number">16</span>);<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%.16s\n&quot;</span>, dec2);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="ezVM（附件chal）"><a href="#ezVM（附件chal）" class="headerlink" title="ezVM（附件chal）"></a>ezVM（附件chal）</h1><p>​无壳64位ELF程序，程序有异常，IDA分析蛮久才结束。</p><p>​根据字符串引用找到主逻辑，先进行长度比对，然后加密，最后check，密文在<code>unk_1639E40</code>处。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2025/image-20250614130136465.png" alt="image-20250614130136465"></p><p>​里面的函数呢，就算了，又是太无语的代码，一堆垃圾，看不清楚一点。学习WP，反正是学新东西。</p><h3 id="复现liv大佬的WP"><a href="#复现liv大佬的WP" class="headerlink" title="复现liv大佬的WP"></a>复现liv大佬的WP</h3><p>​学习知道这是一个使用<strong>unicorn</strong>框架执行虚拟代码的程序，我们要使用<strong>bindiff</strong>来恢复一些被丢弃的函数符号信息。具体操作就是，先搞到对应架构的动态库文件（Windows就是dll文件），然后通过<strong>bindiff</strong>可以进行函数级别的比较，这会帮助你<strong>识别目标程序中哪些函数是 Unicorn 的实现</strong>，并可以<strong>导入函数名</strong>。</p><p>​但是动态库文件需要自己编译啊，很难找到现成的。又打消了我的积极性啊。</p><hr><p>​在Ubuntu24虚拟机中安装Unicorn框架，建议方式：</p><ul><li>使用<strong>python3-venv</strong>虚拟环境，在其中使用<code>pip install unicorn</code>直接下载。之后可以通过<code>from unicorn import *</code>、 <code>from unicorn.x86_const import *</code>的方式导入模块，不熟悉的同学可以通过<code>help(unicorn)</code>查看其模块信息。</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># unicorn_example.py</span><br><span class="hljs-keyword">from</span> unicorn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> unicorn.x86_const <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># 创建一个 Unicorn 引擎</span><br>uc = Uc(UC_ARCH_X86, UC_MODE_64)<br><br><span class="hljs-comment"># 为程序分配内存（这里选择了0x1000地址起始的内存区）</span><br>uc.mem_map(<span class="hljs-number">0x1000</span>, <span class="hljs-number">2</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>)<br><br><span class="hljs-comment"># 向内存写入代码（简单的汇编代码）</span><br>code = <span class="hljs-string">b&quot;\x48\x31\xc0&quot;</span>  <span class="hljs-comment"># x86_64 汇编：xor rax, rax</span><br>uc.mem_write(<span class="hljs-number">0x1000</span>, code)<br><br><span class="hljs-comment"># 设置程序的起始地址</span><br>uc.reg_write(UC_X86_REG_RIP, <span class="hljs-number">0x1000</span>)<br><br><span class="hljs-comment"># 执行模拟（最多执行 1 步）</span><br>uc.emu_start(<span class="hljs-number">0x1000</span>, <span class="hljs-number">0x1000</span> + <span class="hljs-built_in">len</span>(code))<br><br><span class="hljs-comment"># 获取并输出结果（此处我们查询 RAX 寄存器的值）</span><br>result = uc.reg_read(UC_X86_REG_RAX)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;RAX = <span class="hljs-subst">&#123;result&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure><ul><li>如果有网联通github，可以通过<code>git clone https://github.com/unicorn-engine/unicorn.git</code>命令拉取预编译文件，然后<code>cd unicorn</code>、<code>mkdir build</code>、<code>cd build</code>、<code>cmake ..</code>、<code>make</code>，编译好了之后， 可以编写cpp文件了，编写完后，通过g++编译链接出可执行程序。命令示例如下：<code>g++ -o unicorn_test /home/ubuntu/桌面/unicorn_test.cpp     -I/home/ubuntu/桌面/unicorn/include     -L/home/ubuntu/桌面/unicorn/build     -lunicorn</code>。有可能会报错找不到共享库文件，可以使用命令<code>export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/home/ubuntu/桌面/unicorn/build</code>，其中的路径自行修改。</li></ul><figure class="highlight c++"><table><tr><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unicorn/unicorn.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ADDRESS 0x1000000  <span class="hljs-comment">// 起始地址</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    uc_engine *uc;<br>    uc_err err;<br><br>    <span class="hljs-comment">// 初始化 Unicorn 模拟器</span><br>    err = <span class="hljs-built_in">uc_open</span>(UC_ARCH_X86, UC_MODE_64, &amp;uc);<br>    <span class="hljs-keyword">if</span> (err != UC_ERR_OK) &#123;<br>        std::cerr &lt;&lt; <span class="hljs-string">&quot;Failed to initialize Unicorn engine!&quot;</span> &lt;&lt; std::endl;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 映射 2MB 的内存区域，设置可读、可写、可执行权限</span><br>    err = <span class="hljs-built_in">uc_mem_map</span>(uc, ADDRESS, <span class="hljs-number">2</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>, UC_PROT_READ | UC_PROT_WRITE | UC_PROT_EXEC);<br>    <span class="hljs-keyword">if</span> (err != UC_ERR_OK) &#123;<br>        std::cerr &lt;&lt; <span class="hljs-string">&quot;Failed to map memory!&quot;</span> &lt;&lt; std::endl;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 将一段简单的机器码写入内存（如 `int 0x80` 中断指令）</span><br>    <span class="hljs-type">uint8_t</span> code[] = &#123; <span class="hljs-number">0xCD</span>, <span class="hljs-number">0x80</span> &#125;; <span class="hljs-comment">// x86 中断指令</span><br>    err = <span class="hljs-built_in">uc_mem_write</span>(uc, ADDRESS, code, <span class="hljs-built_in">sizeof</span>(code));<br>    <span class="hljs-keyword">if</span> (err != UC_ERR_OK) &#123;<br>        std::cerr &lt;&lt; <span class="hljs-string">&quot;Failed to write code to memory!&quot;</span> &lt;&lt; std::endl;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 执行该段代码</span><br>    err = <span class="hljs-built_in">uc_emu_start</span>(uc, ADDRESS, ADDRESS + <span class="hljs-built_in">sizeof</span>(code), <span class="hljs-number">0</span>, <span class="hljs-number">0</span>); <span class="hljs-comment">// 添加timeout和count</span><br>    <span class="hljs-keyword">if</span> (err != UC_ERR_OK) &#123;<br>        std::cerr &lt;&lt; <span class="hljs-string">&quot;Failed to start emulation!&quot;</span> &lt;&lt; std::endl;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 释放 Unicorn 引擎</span><br>    <span class="hljs-built_in">uc_close</span>(uc);<br><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Emulation completed successfully!&quot;</span> &lt;&lt; std::endl;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><hr><p>​其实，在unicorn编译后，在build目录下面有很多架构的示例文件，如sample_x86、sample_arm64等等，如果只是恢复符号的话，可以使用这些例子，不需要自己码了。但是，在我的环境下编译出来的ELF程序进行bindiff，完全比对不上，恢复不了对应的函数名。就先这样吧，直接抄大佬恢复的符号吧。</p><p>​</p><p>​然后将以上调用write写入的数据提取（5个全部提取），随便找一个ARM64框架（<strong>因为根据反编译代码看出来是使用unicorn模拟执行ARM64的指令</strong>）的.so（<strong>安卓app程序都有这种ARM64的so程序</strong>）复制到对应地址，以便反编译看代码。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2025/image-20250627220457369.png" alt="image-20250627220457369"></p><p>​ok，写入这个四个数据后，就可以反编译出来了。注意，data_2是会重新覆盖Code_Arm中的，必须覆盖掉那一部分。我也是终于看到这个函数了！（<strong>还是有个问题，我的MEMORY[]地址和大佬的还不一样，是哪里错了吗？</strong>）</p><p>​大佬说这是虚拟机执行函数，最后还是通过hook模拟执行，看汇编分析逻辑。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2025/image-20250627220713636.png" alt="image-20250627220713636"></p><p>​在Hook模拟时，由于在ubuntu系统下， 我小改了一下程序，修改了一下windows.h的替代，结果编译出来就死循环了😥。真难受。改Windows的python-unicorn，还是死循环，开在启动模拟的输出就没了，希望哪个师傅能够指点一下。</p><p>​经过重新尝试，我将code的字节保存到了一个二进制文件中，然后在程序中读取，这样就能够正常跑了。好玄学，是不是这种文本太长了，<strong>Typora</strong>保存出错啊，还是风水问题，这个取数据的操作，我重复了至少五次！</p><p>​也有可能是<strong>010Editor</strong>的问题，大量字节数据复制粘贴时就给我强行换成文本模式，非得先保存二进制数据到另一个文件中，然后再通过“文件插入”功能，把字节数据放进去。</p><p>​下面的终于能跑了！</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#demo_2</span><br>Data1 = [<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x01</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x06</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x01</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x05</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x05</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x50</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x08</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xe4</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xe4</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x01</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xd8</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xe4</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x06</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x05</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xe4</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x01</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x09</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x0a</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x29</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xe4</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xd8</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xd4</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x09</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xd4</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x20</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x0f</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x5b</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x11</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x08</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xe0</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xb0</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x53</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xb1</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xb2</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x6f</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xb3</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x77</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xb4</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x6d</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xb5</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x61</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xb6</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x6b</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xb7</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x65</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xb8</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x72</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xb9</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x5f</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xba</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x6d</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xbb</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x61</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xbc</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x64</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xbd</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x65</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xbe</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x69</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xbf</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x74</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x06</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xb0</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xf4</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x07</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xd0</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x19</span>,<span class="hljs-number">0x19</span>,<span class="hljs-number">0xa0</span>,<span class="hljs-number">0xa0</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x12</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xf4</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x08</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xcc</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x08</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xf4</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x08</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xc8</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x08</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x01</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xf4</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x08</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xc4</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x12</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xf4</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x08</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xc0</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x07</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xf8</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x0c</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x37</span>,<span class="hljs-number">0x01</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xf8</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xf8</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x09</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xf8</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x08</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x13</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xf8</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xe0</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x09</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xec</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xf8</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xe0</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x0a</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xe8</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x07</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xf0</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x07</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xdc</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x0c</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x83</span>,<span class="hljs-number">0x01</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xdc</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x01</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xdc</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x09</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xdc</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x48</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x14</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x3b</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xe8</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x07</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x05</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xe8</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x08</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x06</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x05</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x01</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xe8</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x05</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x44</span>,<span class="hljs-number">0x33</span>,<span class="hljs-number">0x22</span>,<span class="hljs-number">0x11</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x01</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xf0</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x0d</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xf4</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x09</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xf0</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x05</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x12</span>,<span class="hljs-number">0x12</span>,<span class="hljs-number">0xab</span>,<span class="hljs-number">0xab</span>,<span class="hljs-number">0x05</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x01</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xec</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xec</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xf0</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xd0</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xf0</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xec</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x07</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xec</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x08</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x07</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x05</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x01</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xec</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x05</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x88</span>,<span class="hljs-number">0x77</span>,<span class="hljs-number">0x66</span>,<span class="hljs-number">0x55</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x01</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xf0</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x07</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x0b</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x0d</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xf4</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x09</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xf0</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x05</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x66</span>,<span class="hljs-number">0x55</span>,<span class="hljs-number">0x23</span>,<span class="hljs-number">0x23</span>,<span class="hljs-number">0x05</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x01</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xe8</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xe8</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x0c</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x75</span>,<span class="hljs-number">0x01</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xf8</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xe0</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xec</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x0b</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xf8</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xe0</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xe8</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x0c</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x0c</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x29</span>,<span class="hljs-number">0x01</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x01</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x05</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x01</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>]<br>Data2 = [<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x81</span>,<span class="hljs-number">0x08</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x4d</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x07</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x14</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x7c</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x29</span>,<span class="hljs-number">0x07</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x97</span>,<span class="hljs-number">0x07</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x0b</span>,<span class="hljs-number">0x08</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xdd</span>,<span class="hljs-number">0x05</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xa5</span>,<span class="hljs-number">0x06</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x7f</span>,<span class="hljs-number">0x08</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xe5</span>,<span class="hljs-number">0x06</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x05</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x7f</span>,<span class="hljs-number">0x08</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xc5</span>,<span class="hljs-number">0x06</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x11</span>,<span class="hljs-number">0x07</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x24</span>,<span class="hljs-number">0x07</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x60</span>,<span class="hljs-number">0x07</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0xf3</span>,<span class="hljs-number">0x06</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x8a</span>,<span class="hljs-number">0x06</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x00</span>]<br>Data3 = [<span class="hljs-number">0x28</span>,<span class="hljs-number">0x4a</span>,<span class="hljs-number">0x1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>]<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> unicorn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> unicorn.arm64_const <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> demo_2<br><br>Base = <span class="hljs-number">0x1000000</span><br>Stack = <span class="hljs-number">0x7F0000</span><br>InputAddr = <span class="hljs-number">0x14C28</span><br>Input = <span class="hljs-string">b&#x27;XYCTF&#123;fun_un1c0rn_with_4rm64_VM&#125;&#x27;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hook_code</span>(<span class="hljs-params">uc, address, size, user_data</span>):<br>    <span class="hljs-keyword">if</span> address == <span class="hljs-number">0x1FAC</span>:<br>        w1 = uc.reg_read(UC_ARM64_REG_W1)<br>        w0 = uc.reg_read(UC_ARM64_REG_W0)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;W3 = W1 ^ W0 --- <span class="hljs-subst">&#123;w1:#x&#125;</span> ^ <span class="hljs-subst">&#123;w0:#x&#125;</span> = <span class="hljs-subst">&#123;w1 ^ w0:#x&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">elif</span> address == <span class="hljs-number">0x2054</span>:<br>        w3 = uc.reg_read(UC_ARM64_REG_W3)<br>        w0 = uc.reg_read(UC_ARM64_REG_W0)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;W2 = W0 ^ W3 --- <span class="hljs-subst">&#123;w0:#x&#125;</span> ^ <span class="hljs-subst">&#123;w3:#x&#125;</span> = <span class="hljs-subst">&#123;w3 ^ w0:#x&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">elif</span> address == <span class="hljs-number">0x2180</span>:<br>        w1 = uc.reg_read(UC_ARM64_REG_W1)<br>        w4 = uc.reg_read(UC_ARM64_REG_W4)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;W1 = W1 ^ W4 --- <span class="hljs-subst">&#123;w1:#x&#125;</span> ^ <span class="hljs-subst">&#123;w4:#x&#125;</span> = <span class="hljs-subst">&#123;w1 ^ w4:#x&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">elif</span> address == <span class="hljs-number">0x2238</span>:<br>        w3 = uc.reg_read(UC_ARM64_REG_W3)<br>        w0 = uc.reg_read(UC_ARM64_REG_W0)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;W2 = W0 ^ W3 --- <span class="hljs-subst">&#123;w0:#x&#125;</span> ^ <span class="hljs-subst">&#123;w3:#x&#125;</span> = <span class="hljs-subst">&#123;w3 ^ w0:#x&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">elif</span> address == <span class="hljs-number">0x2BE4</span>:<br>        w1 = uc.reg_read(UC_ARM64_REG_W1)<br>        w0 = uc.reg_read(UC_ARM64_REG_W0)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;W3 = W1 &gt;&gt; W0 --- <span class="hljs-subst">&#123;w1:#x&#125;</span> &gt;&gt; <span class="hljs-subst">&#123;w0:#x&#125;</span> = <span class="hljs-subst">&#123;(w1 &gt;&gt; w0):#x&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">elif</span> address == <span class="hljs-number">0x2CD4</span>:<br>        w1 = uc.reg_read(UC_ARM64_REG_W1)<br>        w0 = uc.reg_read(UC_ARM64_REG_W0)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;W2 = W1 &gt;&gt; W0 --- <span class="hljs-subst">&#123;w1:#x&#125;</span> &gt;&gt; <span class="hljs-subst">&#123;w0:#x&#125;</span> = <span class="hljs-subst">&#123;(w1 &gt;&gt; w0):#x&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">elif</span> address == <span class="hljs-number">0x2EA4</span>:<br>        w1 = uc.reg_read(UC_ARM64_REG_W1)<br>        w0 = uc.reg_read(UC_ARM64_REG_W0)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;W2 = W1 &lt;&lt; W0 --- <span class="hljs-subst">&#123;w1:#x&#125;</span> &lt;&lt; <span class="hljs-subst">&#123;w0:#x&#125;</span> = <span class="hljs-subst">&#123;(w1 &lt;&lt; w0):#x&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">elif</span> address == <span class="hljs-number">0x2DB4</span>:<br>        w1 = uc.reg_read(UC_ARM64_REG_W1)<br>        w0 = uc.reg_read(UC_ARM64_REG_W0)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;W2 = W1 &lt;&lt; W0 --- <span class="hljs-subst">&#123;w1:#x&#125;</span> &lt;&lt; <span class="hljs-subst">&#123;w0:#x&#125;</span> = <span class="hljs-subst">&#123;(w1 &lt;&lt; w0):#x&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">elif</span> address == <span class="hljs-number">0x232C</span>:<br>        w3 = uc.reg_read(UC_ARM64_REG_W3)<br>        w0 = uc.reg_read(UC_ARM64_REG_W0)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;W2 = W0 &amp; W3 --- <span class="hljs-subst">&#123;w0:#x&#125;</span> &amp; <span class="hljs-subst">&#123;w3:#x&#125;</span> = <span class="hljs-subst">&#123;w0 &amp; w3:#x&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">elif</span> address ==<span class="hljs-number">0x241C</span>:<br>        w1 = uc.reg_read(UC_ARM64_REG_W1)<br>        w0 = uc.reg_read(UC_ARM64_REG_W0)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;W2 = W0 &amp; W1 --- <span class="hljs-subst">&#123;w0:#x&#125;</span> &amp; <span class="hljs-subst">&#123;w1:#x&#125;</span> = <span class="hljs-subst">&#123;w0 &amp; w1:#x&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">elif</span> address == <span class="hljs-number">0x1CC4</span>:<br>        w0 = uc.reg_read(UC_ARM64_REG_W0)<br>        w1 = uc.reg_read(UC_ARM64_REG_W1)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;W2 = W1 + W0 --- <span class="hljs-subst">&#123;w1:#x&#125;</span> + <span class="hljs-subst">&#123;w0:#x&#125;</span> = <span class="hljs-subst">&#123;w1 + w0:#x&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">elif</span> address == <span class="hljs-number">0x1A0C</span>:<br>        w0 = uc.reg_read(UC_ARM64_REG_W0)<br>        w1 = uc.reg_read(UC_ARM64_REG_W1)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;W2 = W1 + W0 --- <span class="hljs-subst">&#123;w1:#x&#125;</span> + <span class="hljs-subst">&#123;w0:#x&#125;</span> = <span class="hljs-subst">&#123;w1 + w0:#x&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">elif</span> address == <span class="hljs-number">0x1AB4</span>:<br>        w0 = uc.reg_read(UC_ARM64_REG_W0)<br>        w3 = uc.reg_read(UC_ARM64_REG_W3)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;W2 = W0 + W3 --- <span class="hljs-subst">&#123;w0:#x&#125;</span> + <span class="hljs-subst">&#123;w3:#x&#125;</span> = <span class="hljs-subst">&#123;w0 + w3:#x&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">elif</span> address == <span class="hljs-number">0x1BE0</span>:<br>        w1 = uc.reg_read(UC_ARM64_REG_W1)<br>        w4 = uc.reg_read(UC_ARM64_REG_W4)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;W1 = W1 + W4 --- <span class="hljs-subst">&#123;w1:#x&#125;</span> + <span class="hljs-subst">&#123;w4:#x&#125;</span> = <span class="hljs-subst">&#123;w1 + w4:#x&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">elif</span> address == <span class="hljs-number">0x1E98</span>:<br>        w0 = uc.reg_read(UC_ARM64_REG_W0)<br>        w1 = uc.reg_read(UC_ARM64_REG_W1)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;W2 = W1 - W0 --- <span class="hljs-subst">&#123;w1:#x&#125;</span> - <span class="hljs-subst">&#123;w0:#x&#125;</span> = <span class="hljs-subst">&#123;w1 - w0:#x&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">elif</span> address == <span class="hljs-number">0x1DA8</span>:<br>        w0 = uc.reg_read(UC_ARM64_REG_W0)<br>        w3 = uc.reg_read(UC_ARM64_REG_W3)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;W2 = W0 - W3 --- <span class="hljs-subst">&#123;w0:#x&#125;</span> - <span class="hljs-subst">&#123;w3:#x&#125;</span> = <span class="hljs-subst">&#123;w0 - w3:#x&#125;</span>&quot;</span>)<br><br>        <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;code&#x27;</span>, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            Code = f.read()<br>        Data1 = <span class="hljs-built_in">bytes</span>(demo_2.Data1)<br>        Data2 = <span class="hljs-built_in">bytes</span>(demo_2.Data2)<br>        Data3 = <span class="hljs-built_in">bytes</span>(demo_2.Data3)<br>        mu = Uc(UC_ARCH_ARM64, UC_MODE_ARM)  <span class="hljs-comment"># 架构+模式</span><br><br>        <span class="hljs-comment">#映射内存</span><br>        mu.mem_map(<span class="hljs-number">0</span>,Base,UC_PROT_ALL)<br>        <span class="hljs-comment">#mu.mem_map(Stack-4096,0x4000,UC_PROT_ALL)</span><br><br>        mu.hook_add(UC_HOOK_CODE, hook_code)<br><br>        mu.mem_write(InputAddr,Input)<br>        mu.mem_write(<span class="hljs-number">0xC70</span>,Code)<br>        mu.mem_write(<span class="hljs-number">0x14010</span>,Data1)<br>        mu.mem_write(<span class="hljs-number">0x30F0</span>,Data2)<br>        mu.mem_write(<span class="hljs-number">0x149E8</span>,Data3)<br><br>        mu.reg_write(UC_ARM64_REG_X0, InputAddr)<br>        mu.reg_write(UC_ARM64_REG_SP, Stack)<br><br>        mu.emu_start(<span class="hljs-number">0x0C70</span>,<span class="hljs-number">0x2EF4</span>)<br><br>        result = mu.mem_read(InputAddr,<span class="hljs-number">48</span>)<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;result[i]:02x&#125;</span> &quot;</span>, end=<span class="hljs-string">&#x27;&#x27;</span>)<br>        <span class="hljs-built_in">print</span>()<br>    <span class="hljs-keyword">except</span> UcError <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Unicorn error: %s&quot;</span> % e)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br></code></pre></td></tr></table></figure><p>​现在的问题还有两个：一就是这个<strong>关键计算地址究竟是怎么筛选出来的</strong>，还有其他的计算处没有添加进去啊？其二就是看输出的<strong>计算过程分析加密算法</strong>了。</p><p>​也没有人能回答，我猜就是随便挑了一些计算出来，懒得全写。上面我已经补全了所有的计算指令地址，更美味的享受吧。</p><p>​随便看看这个计算过程，很明显是有规律的，很像是个循环，循环多少轮呢，老实数吧。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2025/image-20250704183341268.png" alt="image-20250704183341268"></p><p>​先从最基础的一轮开始看起，可以先看两轮，确定其中的常数项，然后由参数开始逐渐定义变量来还原计算过程，并且多次验证。唯一的缺点就是，轮数太🐔儿多，让人望而生畏，不是有flag的诱惑，谁干这么苦逼的活，当然我们RE✌是不会这么吃亏的，每一轮的长度是22行，加上计数的一行，我们可以复制到另一个强大的文本编辑器去快速计算轮数。</p><p>​看规律的东西还是太鸡儿不爽了，太折磨没有耐心的我啊。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">W3 = W1 &gt;&gt; W0 --- <span class="hljs-number">0x75667b46</span> &gt;&gt; <span class="hljs-number">0x5</span> = <span class="hljs-number">0x3ab33da</span><span class="hljs-comment">#v1 &gt;&gt; 5</span><br>W2 = W1 &lt;&lt; W0 --- <span class="hljs-number">0x75667b46</span> &lt;&lt; <span class="hljs-number">0x6</span> = <span class="hljs-number">0x1d599ed180</span><span class="hljs-comment">#v1 &lt;&lt; 6</span><br>W3 = W1 ^ W0 --- <span class="hljs-number">0x3ab33da</span> ^ <span class="hljs-number">0x599ed180</span> = <span class="hljs-number">0x5a35e25a</span> <span class="hljs-comment">#(v1&gt;&gt;5) ^ (v1 &lt;&lt; 6 &amp; 0xfffffffff)</span><br>W2 = W0 ^ W3 --- <span class="hljs-number">0x75667b46</span> ^ <span class="hljs-number">0x11223344</span> = <span class="hljs-number">0x64444802</span><span class="hljs-comment">#v1 ^ key0</span><br>W2 = W1 + W0 --- <span class="hljs-number">0x5a35e25a</span> + <span class="hljs-number">0x64444802</span> = <span class="hljs-number">0xbe7a2a5c</span><span class="hljs-comment">#t1 = ((v1&gt;&gt;5) ^ ...) + (v1 ^ key0)</span><br>W2 = W0 &amp; W3 --- <span class="hljs-number">0x0</span> &amp; <span class="hljs-number">0x3</span> = <span class="hljs-number">0x0</span><br>W2 = W1 + W0 --- <span class="hljs-number">0x776f6853</span> + <span class="hljs-number">0x0</span> = <span class="hljs-number">0x776f6853</span><br>W2 = W0 ^ W3 --- <span class="hljs-number">0x776f6853</span> ^ <span class="hljs-number">0xabab1212</span> = <span class="hljs-number">0xdcc47a41</span><span class="hljs-comment">#t2</span><br>W3 = W1 ^ W0 --- <span class="hljs-number">0xbe7a2a5c</span> ^ <span class="hljs-number">0xdcc47a41</span> = <span class="hljs-number">0x62be501d</span><span class="hljs-comment">#t1 ^ t2</span><br>W2 = W1 + W0 --- <span class="hljs-number">0x62be501d</span> + <span class="hljs-number">0x54435958</span> = <span class="hljs-number">0xb701a975</span><span class="hljs-comment">#v0 = t2 + ?</span><br>W2 = W1 - W0 --- <span class="hljs-number">0x0</span> - <span class="hljs-number">0xa0a01919</span> = -<span class="hljs-number">0xa0a01919</span><span class="hljs-comment">#sum-=delta ,  =0x5f5fe6e7</span><br>W3 = W1 &gt;&gt; W0 --- <span class="hljs-number">0xb701a975</span> &gt;&gt; <span class="hljs-number">0x4</span> = <span class="hljs-number">0xb701a97</span><br>W2 = W1 &lt;&lt; W0 --- <span class="hljs-number">0xb701a975</span> &lt;&lt; <span class="hljs-number">0x7</span> = <span class="hljs-number">0x5b80d4ba80</span><br>W3 = W1 ^ W0 --- <span class="hljs-number">0xb701a97</span> ^ <span class="hljs-number">0x80d4ba80</span> = <span class="hljs-number">0x8ba4a017</span><span class="hljs-comment">#t3 = (v0&gt;&gt;4)+(v0&lt;&lt;7)</span><br>W2 = W0 ^ W3 --- <span class="hljs-number">0xb701a975</span> ^ <span class="hljs-number">0x55667788</span> = <span class="hljs-number">0xe267defd</span><span class="hljs-comment">#t4 = v0^key1</span><br>W2 = W1 + W0 --- <span class="hljs-number">0x8ba4a017</span> + <span class="hljs-number">0xe267defd</span> = <span class="hljs-number">0x16e0c7f14</span><span class="hljs-comment">#t3 + (v0^key1)</span><br>W3 = W1 &gt;&gt; W0 --- <span class="hljs-number">0x5f5fe6e7</span> &gt;&gt; <span class="hljs-number">0xb</span> = <span class="hljs-number">0xbebfc</span><span class="hljs-comment">#sum&gt;&gt;11</span><br>W2 = W0 &amp; W3 --- <span class="hljs-number">0xbebfc</span> &amp; <span class="hljs-number">0x3</span> = <span class="hljs-number">0x0</span><span class="hljs-comment">#(sum&gt;&gt;11)&amp;3</span><br>W2 = W1 + W0 --- <span class="hljs-number">0x776f6853</span> + <span class="hljs-number">0x5f5fe6e7</span> = <span class="hljs-number">0xd6cf4f3a</span><br>W2 = W0 ^ W3 --- <span class="hljs-number">0xd6cf4f3a</span> ^ <span class="hljs-number">0x23235566</span> = <span class="hljs-number">0xf5ec1a5c</span><span class="hljs-comment">#t2</span><br>W3 = W1 ^ W0 --- <span class="hljs-number">0xf5ec1a5c</span> ^ <span class="hljs-number">0x6e0c7f14</span> = <span class="hljs-number">0x9be06548</span> <span class="hljs-comment">#t5 = t2^(t3 + (v0^key1))</span><br>W2 = W1 + W0 --- <span class="hljs-number">0x9be06548</span> + <span class="hljs-number">0x75667b46</span> = <span class="hljs-number">0x11146e08e</span><span class="hljs-comment">#v1= t5 + v1</span><br>W2 = W0 + W3 --- <span class="hljs-number">0x0</span> + <span class="hljs-number">0x1</span> = <span class="hljs-number">0x1</span><span class="hljs-comment">#-------------------------------------计数，分解线</span><br>W3 = W1 &gt;&gt; W0 --- <span class="hljs-number">0x1146e08e</span> &gt;&gt; <span class="hljs-number">0x5</span> = <span class="hljs-number">0x8a3704</span> <span class="hljs-comment">#v1&gt;&gt;5</span><br>W2 = W1 &lt;&lt; W0 --- <span class="hljs-number">0x1146e08e</span> &lt;&lt; <span class="hljs-number">0x6</span> = <span class="hljs-number">0x451b82380</span><br>W3 = W1 ^ W0 --- <span class="hljs-number">0x8a3704</span> ^ <span class="hljs-number">0x51b82380</span> = <span class="hljs-number">0x51321484</span><br>W2 = W0 ^ W3 --- <span class="hljs-number">0x1146e08e</span> ^ <span class="hljs-number">0x11223344</span> = <span class="hljs-number">0x64d3ca</span><br>W2 = W1 + W0 --- <span class="hljs-number">0x51321484</span> + <span class="hljs-number">0x64d3ca</span> = <span class="hljs-number">0x5196e84e</span><br>W2 = W0 &amp; W3 --- <span class="hljs-number">0x5f5fe6e7</span> &amp; <span class="hljs-number">0x3</span> = <span class="hljs-number">0x3</span><br>W2 = W1 + W0 --- <span class="hljs-number">0x74696564</span> + <span class="hljs-number">0x5f5fe6e7</span> = <span class="hljs-number">0xd3c94c4b</span><br>W2 = W0 ^ W3 --- <span class="hljs-number">0xd3c94c4b</span> ^ <span class="hljs-number">0xabab1212</span> = <span class="hljs-number">0x78625e59</span><br>W3 = W1 ^ W0 --- <span class="hljs-number">0x5196e84e</span> ^ <span class="hljs-number">0x78625e59</span> = <span class="hljs-number">0x29f4b617</span><br>W2 = W1 + W0 --- <span class="hljs-number">0x29f4b617</span> + <span class="hljs-number">0xb701a975</span> = <span class="hljs-number">0xe0f65f8c</span><br>W2 = W1 - W0 --- <span class="hljs-number">0x5f5fe6e7</span> - <span class="hljs-number">0xa0a01919</span> = -<span class="hljs-number">0x41403232</span><br>W3 = W1 &gt;&gt; W0 --- <span class="hljs-number">0xe0f65f8c</span> &gt;&gt; <span class="hljs-number">0x4</span> = <span class="hljs-number">0xe0f65f8</span><br>W2 = W1 &lt;&lt; W0 --- <span class="hljs-number">0xe0f65f8c</span> &lt;&lt; <span class="hljs-number">0x7</span> = <span class="hljs-number">0x707b2fc600</span><br>W3 = W1 ^ W0 --- <span class="hljs-number">0xe0f65f8</span> ^ <span class="hljs-number">0x7b2fc600</span> = <span class="hljs-number">0x7520a3f8</span><br>W2 = W0 ^ W3 --- <span class="hljs-number">0xe0f65f8c</span> ^ <span class="hljs-number">0x55667788</span> = <span class="hljs-number">0xb5902804</span><br>W2 = W1 + W0 --- <span class="hljs-number">0x7520a3f8</span> + <span class="hljs-number">0xb5902804</span> = <span class="hljs-number">0x12ab0cbfc</span><br>W3 = W1 &gt;&gt; W0 --- <span class="hljs-number">0xbebfcdce</span> &gt;&gt; <span class="hljs-number">0xb</span> = <span class="hljs-number">0x17d7f9</span><br>W2 = W0 &amp; W3 --- <span class="hljs-number">0x17d7f9</span> &amp; <span class="hljs-number">0x3</span> = <span class="hljs-number">0x1</span><br>W2 = W1 + W0 --- <span class="hljs-number">0x656b616d</span> + <span class="hljs-number">0xbebfcdce</span> = <span class="hljs-number">0x1242b2f3b</span><br>W2 = W0 ^ W3 --- <span class="hljs-number">0x242b2f3b</span> ^ <span class="hljs-number">0x23235566</span> = <span class="hljs-number">0x7087a5d</span><br>W3 = W1 ^ W0 --- <span class="hljs-number">0x7087a5d</span> ^ <span class="hljs-number">0x2ab0cbfc</span> = <span class="hljs-number">0x2db8b1a1</span><br>W2 = W1 + W0 --- <span class="hljs-number">0x2db8b1a1</span> + <span class="hljs-number">0x1146e08e</span> = <span class="hljs-number">0x3eff922f</span><br>W2 = W0 + W3 --- <span class="hljs-number">0x1</span> + <span class="hljs-number">0x1</span> = <span class="hljs-number">0x2</span> <span class="hljs-comment">#-------------------------------------计数，分解线</span><br>W3 = W1 &gt;&gt; W0 --- <span class="hljs-number">0x3eff922f</span> &gt;&gt; <span class="hljs-number">0x5</span> = <span class="hljs-number">0x1f7fc91</span><br>W2 = W1 &lt;&lt; W0 --- <span class="hljs-number">0x3eff922f</span> &lt;&lt; <span class="hljs-number">0x6</span> = <span class="hljs-number">0xfbfe48bc0</span><br></code></pre></td></tr></table></figure><p>​大佬总结出来了加密代码。</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">encipher</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> v[<span class="hljs-number">2</span>], <span class="hljs-type">const</span> <span class="hljs-type">uint32_t</span> key[<span class="hljs-number">4</span>])</span><br>&#123;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> i;<br>    <span class="hljs-type">uint32_t</span> v0 = v[<span class="hljs-number">0</span>], v1 = v[<span class="hljs-number">1</span>], sum = <span class="hljs-number">0</span>, delta = <span class="hljs-number">0x5f5fe6e7</span>;<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">72</span>; i++)<br>    &#123;<br>        <span class="hljs-keyword">auto</span> tmp = (((v1 &lt;&lt; <span class="hljs-number">6</span>) ^ (v1 &gt;&gt; <span class="hljs-number">5</span>)) + (v1 ^ <span class="hljs-number">0x11223344</span>));<br>        <span class="hljs-keyword">auto</span> tmp2 = (((key[sum &amp; <span class="hljs-number">3</span>] + sum) ^ <span class="hljs-number">0xabab1212</span>) ^ tmp);<br>        v0 += tmp2;<br>        sum += delta;<br>        <span class="hljs-keyword">auto</span> tmp3 = (((v0 &lt;&lt; <span class="hljs-number">7</span>) ^ (v0 &gt;&gt; <span class="hljs-number">4</span>)) + (v0 ^ <span class="hljs-number">0x55667788</span>));<br>        <span class="hljs-keyword">auto</span> tmp4 = ((key[(sum &gt;&gt; <span class="hljs-number">11</span>) &amp; <span class="hljs-number">3</span>] + sum) ^ <span class="hljs-number">0x23235566</span> ^ tmp3);<br>        v1 += tmp4;<br>    &#125;<br>    v[<span class="hljs-number">0</span>] = v0;<br>    v[<span class="hljs-number">1</span>] = v1;<br>&#125;<br></code></pre></td></tr></table></figure><p>​然后写解密脚本即可。</p><h1 id="EzObf"><a href="#EzObf" class="headerlink" title="EzObf"></a>EzObf</h1><p>​这种逆向题就是第一次没头绪，就完全不想做了。。</p><h3 id="复现WP"><a href="#复现WP" class="headerlink" title="复现WP"></a>复现WP</h3><p>​首先熟悉一下不熟悉的汇编指令。</p><blockquote><p><strong>pushfq</strong></p><p><strong>作用</strong>：将 <strong>RFLAGS（64位）&#x2F;EFLAGS（32位）寄存器的值压入栈中</strong>。</p><p><strong>用途</strong>：保存当前的标志寄存器状态，常用于函数调用前保存状态，或者处理中断、上下文切换时保护标志寄存器。</p><p><strong>popfq</strong>就是对应恢复的指令。</p><p><strong>call    $+5</strong> 其中$代表当前指令的地址，作用就是：跳转到当前指令地址往后5字节处执行代码，同时把返回地址压入栈。</p><p><strong>rol</strong>指令是循环左移。</p></blockquote><p>​可以看到pushfq和popfq是对称的，等价于都不起作用。push和pop也是对称的，也可以nop掉，真实有效执行指令只有一条。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2025/image-20250628142121006.png" alt="image-20250628142121006"></p><p>​原理比较清晰了，看到大手子师傅给的IDC脚本，直接自动化nop掉并且计算出新的跳转指令，tql！<strong>ψ(｀∇´)ψ</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2025/image-20250628144934914.png" alt="image-20250628144934914"></p><p>​自己再手动nop掉上面的几行push，然后<strong>apply patches to input files</strong>，不保存<strong>i64</strong>文件，重新导入IDA分析，F5就能反编译出来了。师傅太强了，膜拜！</p><p>​好好学习欣赏一下师傅的IDC脚本，其实后面真实汇编混淆的格式都一样，只有第一个特殊一点，需要手动patch掉一部分。下次碰到就可以边研究边模仿写了。</p><figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">//从addr开始nop掉长度为length个字节</span><br><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-title">NopCode</span><span class="hljs-params">(Addr, Length)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">auto</span> i;<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; Length; i++)<br>    &#123;<br>        <span class="hljs-built_in">PatchByte</span>(Addr + i, <span class="hljs-number">0x90</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//计算循环移位</span><br><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-title">rol</span><span class="hljs-params">(value, count, bits = <span class="hljs-number">32</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>    count = count % bits;<br>    <span class="hljs-keyword">return</span> ((value &lt;&lt; count) | (value &gt;&gt; (bits - count))) &amp; ((<span class="hljs-number">1</span> &lt;&lt; bits) - <span class="hljs-number">1</span>);<br>&#125;<br><br><span class="hljs-comment">// 搜索真实汇编代码的下一条指令地址</span><br><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-title">FindEnd</span><span class="hljs-params">(Addr)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">auto</span> i;<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">0x90</span>; i++)<br>    &#123;<br>        <span class="hljs-keyword">auto</span> v = <span class="hljs-built_in">Dword</span>(Addr + i);<br>        <span class="hljs-keyword">if</span> (v == <span class="hljs-number">0x5153509C</span>)<br>        &#123;<br>            <span class="hljs-keyword">return</span> Addr + i;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">// 搜索最后的jmp rax指令</span><br><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-title">FindJmpRax</span><span class="hljs-params">(Addr)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">auto</span> i;<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">0x90</span>; i++)<br>    &#123;<br>        <span class="hljs-keyword">auto</span> v = <span class="hljs-built_in">Word</span>(Addr + i);<br>        <span class="hljs-keyword">if</span> (v == <span class="hljs-number">0xE0FF</span>)<br>        &#123;<br>            <span class="hljs-keyword">return</span> Addr + i;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">// 搜索call $+5</span><br><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-title">FindCall</span><span class="hljs-params">(Addr)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">auto</span> i;<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">0x90</span>; i++)<br>    &#123;<br>        <span class="hljs-keyword">auto</span> v = <span class="hljs-built_in">Dword</span>(Addr + i);<br>        <span class="hljs-keyword">if</span> (v == <span class="hljs-number">0xE8</span>)<br>        &#123;<br>            <span class="hljs-keyword">return</span> Addr + i;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">auto</span> StartAddr = <span class="hljs-number">0x1401F400D</span>;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        <span class="hljs-comment">// 搜索真实汇编代码的下一个指令地址</span><br>        <span class="hljs-keyword">auto</span> EndAddr = <span class="hljs-built_in">FindEnd</span>(StartAddr);<br>        <span class="hljs-keyword">if</span> (EndAddr == <span class="hljs-number">0</span>)<br>        &#123;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-comment">// 真实汇编代码的字节长度</span><br>        <span class="hljs-keyword">auto</span> CodeLength = EndAddr - StartAddr - <span class="hljs-number">13</span>;<br>        <span class="hljs-comment">// 搜索Call $+5</span><br>        <span class="hljs-keyword">auto</span> CallAddr = <span class="hljs-built_in">FindCall</span>(StartAddr + <span class="hljs-number">13</span> + CodeLength);<br>        <span class="hljs-keyword">if</span> (CallAddr == <span class="hljs-number">0</span>)<br>        &#123;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-comment">// call $+5的下一条指令地址，即call时push到栈的返回地址</span><br>        <span class="hljs-keyword">auto</span> CalcAddr = CallAddr + <span class="hljs-number">5</span>;<br>        <span class="hljs-keyword">auto</span> ebx = <span class="hljs-built_in">Dword</span>(CalcAddr + <span class="hljs-number">2</span>);<br>        <span class="hljs-keyword">auto</span> rol_Value = <span class="hljs-built_in">Byte</span>(CalcAddr + <span class="hljs-number">8</span>);<br>        <span class="hljs-keyword">auto</span> Mode = <span class="hljs-built_in">Dword</span>(CalcAddr + <span class="hljs-number">9</span>);<br>        ebx = <span class="hljs-built_in">rol</span>(ebx, rol_Value);<br><br>        <span class="hljs-comment">// 搜索最尾部的jmp rax指令地址</span><br>        <span class="hljs-keyword">auto</span> JmpRaxAddr = <span class="hljs-built_in">FindJmpRax</span>(StartAddr);<br>        <span class="hljs-keyword">if</span> (JmpRaxAddr == <span class="hljs-number">0</span>)<br>        &#123;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-comment">// 第一部分垃圾指令长度</span><br>        <span class="hljs-keyword">auto</span> TrushCodeLength_1 = CallAddr - (StartAddr + <span class="hljs-number">13</span> + CodeLength);<br>        <span class="hljs-comment">// 第二部分垃圾指令长度</span><br>        <span class="hljs-keyword">auto</span> TrushCodeLength_2 = JmpRaxAddr - CallAddr + <span class="hljs-number">2</span>;<br>        <span class="hljs-comment">// Nop掉无用的所有代码</span><br>        <br>        <span class="hljs-built_in">NopCode</span>(StartAddr, <span class="hljs-number">13</span>);<br>       <br>        <span class="hljs-built_in">NopCode</span>(StartAddr + <span class="hljs-number">13</span> + CodeLength, TrushCodeLength_1);<br>        <br>        <span class="hljs-built_in">NopCode</span>(CallAddr, TrushCodeLength_2);<br>        <span class="hljs-comment">// 一共两种地址计算，加和减</span><br>        <span class="hljs-keyword">if</span> (Mode == <span class="hljs-number">0xffC32B48</span>)<br>        &#123;<br>            CalcAddr = CalcAddr - ebx;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (Mode == <span class="hljs-number">0xffC30348</span>)<br>        &#123;<br>            CalcAddr = CalcAddr + ebx;<br>        &#125;<br>        <span class="hljs-keyword">auto</span> JmpCodeAddr = EndAddr;<br>        <span class="hljs-comment">// 计算相对跳转地址</span><br>        <span class="hljs-keyword">auto</span> JmpOffset = CalcAddr - JmpCodeAddr + <span class="hljs-number">5</span>;<br>        <span class="hljs-comment">// 写入jmp指令</span><br>        <span class="hljs-built_in">PatchByte</span>(JmpCodeAddr, <span class="hljs-number">0xE9</span>);<br>        <span class="hljs-built_in">PatchDword</span>(JmpCodeAddr + <span class="hljs-number">1</span>, JmpOffset);<br>        <span class="hljs-comment">// jmp的地址为下一次deobf起始地址</span><br>        StartAddr = CalcAddr;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>​下面第n次重新学习xxtea算法，🐽，迟早我要出一篇算法的专栏，收集到较丰富的python脚本，以后直接梭哈！</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//标准加解密代码</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> DELTA 0x9e3779b9</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MX (((z&gt;&gt;5^y<span class="hljs-string">&lt;&lt;2) + (y&gt;</span>&gt;3^z&lt;&lt;4)) ^ ((sum^y) + (key[(p&amp;3)^e] ^ z)))</span><br> <br><span class="hljs-type">void</span> <span class="hljs-title function_">btea</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> *v, <span class="hljs-type">int</span> n, <span class="hljs-type">uint32_t</span> <span class="hljs-type">const</span> key[<span class="hljs-number">4</span>])</span><br>&#123;<br>    <span class="hljs-type">uint32_t</span> y, z, sum;<br>    <span class="hljs-type">unsigned</span> p, rounds, e;<br>    <span class="hljs-keyword">if</span> (n &gt; <span class="hljs-number">1</span>)            <span class="hljs-comment">/* Coding Part */</span><br>    &#123;<br>        rounds = <span class="hljs-number">6</span> + <span class="hljs-number">52</span>/n;<br>        sum = <span class="hljs-number">0</span>;<br>        z = v[n<span class="hljs-number">-1</span>];<br>        <span class="hljs-keyword">do</span><br>        &#123;<br>            sum += DELTA;<br>            e = (sum &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span>;<br>            <span class="hljs-keyword">for</span> (p=<span class="hljs-number">0</span>; p&lt;n<span class="hljs-number">-1</span>; p++)<br>            &#123;<br>                y = v[p+<span class="hljs-number">1</span>];<br>                z = v[p] += MX;<br>            &#125;<br>            y = v[<span class="hljs-number">0</span>];<br>            z = v[n<span class="hljs-number">-1</span>] += MX;<br>        &#125;<br>        <span class="hljs-keyword">while</span> (--rounds);<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (n &lt; <span class="hljs-number">-1</span>)      <span class="hljs-comment">/* Decoding Part */</span><br>    &#123;<br>        n = -n;<br>        rounds = <span class="hljs-number">6</span> + <span class="hljs-number">52</span>/n;<br>        sum = rounds*DELTA;<br>        y = v[<span class="hljs-number">0</span>];<br>        <span class="hljs-keyword">do</span><br>        &#123;<br>            e = (sum &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span>;<br>            <span class="hljs-keyword">for</span> (p=n<span class="hljs-number">-1</span>; p&gt;<span class="hljs-number">0</span>; p--)<br>            &#123;<br>                z = v[p<span class="hljs-number">-1</span>];<br>                y = v[p] -= MX;<br>            &#125;<br>            z = v[n<span class="hljs-number">-1</span>];<br>            y = v[<span class="hljs-number">0</span>] -= MX;<br>            sum -= DELTA;<br>        &#125;<br>        <span class="hljs-keyword">while</span> (--rounds);<br>    &#125;<br>&#125;<br> <br> <br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">uint32_t</span> v[<span class="hljs-number">2</span>]= &#123;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>&#125;;<br>    <span class="hljs-type">uint32_t</span> <span class="hljs-type">const</span> k[<span class="hljs-number">4</span>]= &#123;<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>&#125;;<br>    <span class="hljs-type">int</span> n= <span class="hljs-number">2</span>; <span class="hljs-comment">//n的绝对值表示v的长度，取正表示加密，取负表示解密</span><br>    <span class="hljs-comment">// v为要加密的数据是两个32位无符号整数</span><br>    <span class="hljs-comment">// k为加密解密密钥，为4个32位无符号整数，即密钥长度为128位</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;加密前原始数据：%u %u\n&quot;</span>,v[<span class="hljs-number">0</span>],v[<span class="hljs-number">1</span>]);<br>    btea(v, n, k);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;加密后的数据：%u %u\n&quot;</span>,v[<span class="hljs-number">0</span>],v[<span class="hljs-number">1</span>]);<br>    btea(v, -n, k);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;解密后的数据：%u %u\n&quot;</span>,v[<span class="hljs-number">0</span>],v[<span class="hljs-number">1</span>]);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>​反编译的代码，需要仔细看，一行行分析。</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __fastcall <span class="hljs-title function_">main_0</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  __int64 i; <span class="hljs-comment">// rcx</span><br>  <span class="hljs-type">int</span> result; <span class="hljs-comment">// eax</span><br>  _DWORD *v5; <span class="hljs-comment">// rdi</span><br>  HANDLE CurrentProcess; <span class="hljs-comment">// rax</span><br>  __int64 v7; <span class="hljs-comment">// [rsp-20h] [rbp-468h] BYREF</span><br>  _DWORD v8[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [rsp+0h] [rbp-448h] BYREF</span><br>  _BYTE v9[<span class="hljs-number">64</span>]; <span class="hljs-comment">// [rsp+8h] [rbp-440h] BYREF</span><br>  _BYTE *v10; <span class="hljs-comment">// [rsp+48h] [rbp-400h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v11; <span class="hljs-comment">// [rsp+64h] [rbp-3E4h]</span><br>  <span class="hljs-type">int</span> v12; <span class="hljs-comment">// [rsp+84h] [rbp-3C4h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v13; <span class="hljs-comment">// [rsp+A4h] [rbp-3A4h]</span><br>  <span class="hljs-type">int</span> v14; <span class="hljs-comment">// [rsp+C4h] [rbp-384h]</span><br>  <span class="hljs-type">int</span> v15; <span class="hljs-comment">// [rsp+E4h] [rbp-364h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> k; <span class="hljs-comment">// [rsp+104h] [rbp-344h]</span><br>  <span class="hljs-type">int</span> v17; <span class="hljs-comment">// [rsp+124h] [rbp-324h]</span><br>  <span class="hljs-type">int</span> v18; <span class="hljs-comment">// [rsp+144h] [rbp-304h]</span><br>  <span class="hljs-type">int</span> v19; <span class="hljs-comment">// [rsp+164h] [rbp-2E4h]</span><br>  _DWORD v20[<span class="hljs-number">11</span>]; <span class="hljs-comment">// [rsp+188h] [rbp-2C0h] BYREF</span><br>  <span class="hljs-type">unsigned</span> __int16 v21; <span class="hljs-comment">// [rsp+1B4h] [rbp-294h]</span><br>  BOOL v22; <span class="hljs-comment">// [rsp+1D4h] [rbp-274h] BYREF</span><br>  <span class="hljs-type">unsigned</span> __int64 j; <span class="hljs-comment">// [rsp+1F8h] [rbp-250h]</span><br>  <span class="hljs-type">unsigned</span> __int64 v24; <span class="hljs-comment">// [rsp+218h] [rbp-230h]</span><br>  _DWORD v25[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+238h] [rbp-210h]</span><br>  <span class="hljs-type">unsigned</span> __int64 m; <span class="hljs-comment">// [rsp+278h] [rbp-1D0h]</span><br>  <span class="hljs-type">int</span> v27; <span class="hljs-comment">// [rsp+404h] [rbp-44h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v28; <span class="hljs-comment">// [rsp+408h] [rbp-40h]</span><br>  <span class="hljs-type">int</span> v29; <span class="hljs-comment">// [rsp+40Ch] [rbp-3Ch]</span><br>  __int64 v30; <span class="hljs-comment">// [rsp+410h] [rbp-38h]</span><br>  <span class="hljs-type">int</span> v31; <span class="hljs-comment">// [rsp+418h] [rbp-30h]</span><br>  <span class="hljs-type">unsigned</span> __int64 v32; <span class="hljs-comment">// [rsp+420h] [rbp-28h]</span><br><br>  v5 = v8;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">174LL</span>; i; --i )<br>    *v5++ = <span class="hljs-number">0xCCCCCCCC</span>;<br>  v32 = (<span class="hljs-type">unsigned</span> __int64)v8 ^ <span class="hljs-number">0x1401D9000L</span>L;<br>  j___CheckForDebuggerJustMyCode(<span class="hljs-number">0x1401ED101L</span>L);<br>  <span class="hljs-built_in">memset</span>(v9, <span class="hljs-number">0</span>, <span class="hljs-number">0x20u</span>LL);<br>  sub_140087C02(<span class="hljs-number">0x1401A1190L</span>L);<br>  <span class="hljs-keyword">if</span> ( !IsDebuggerPresent() )<br>  &#123;<br>    sub_1400868E3();<br>    v10 = v9;<br>    <span class="hljs-built_in">memset</span>(v20, <span class="hljs-number">0</span>, <span class="hljs-number">0x10u</span>LL);<br>    v21 = <span class="hljs-number">8</span>;<br>    v27 = <span class="hljs-number">8</span>;<br>    v18 = <span class="hljs-number">12</span>;<br>    v13 = <span class="hljs-number">0</span>;<br>    v14 = <span class="hljs-number">0x61C88646</span>;<br>    v19 = <span class="hljs-number">0x95664B48</span>;<br>    v17 = <span class="hljs-number">7</span>;<span class="hljs-comment">//循环轮数改为了7</span><br>    v22 = <span class="hljs-number">0</span>;<br>    CurrentProcess = GetCurrentProcess();<br>    CheckRemoteDebuggerPresent(CurrentProcess, &amp;v22);<br>    <span class="hljs-keyword">if</span> ( !v22 )<br>    &#123;<br>      j_srand(<span class="hljs-number">0xAABBu</span>);<br>      <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0LL</span>; j &lt; <span class="hljs-number">4</span>; ++j )<br>        v20[j] = j_rand();<span class="hljs-comment">//密钥是128位，4*32</span><br>      <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>      &#123;<br>        v27 = v17--;<br>        v28 = v27 != <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">if</span> ( !v28 )<br>          <span class="hljs-keyword">break</span>;<br>        v13 += v14;<span class="hljs-comment">//delta是v14，sum是v13</span><br>        v15 = (v13 &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span>;<span class="hljs-comment">//参数e</span><br>        <span class="hljs-keyword">for</span> ( k = <span class="hljs-number">0</span>; k &lt; v21; ++k )<span class="hljs-comment">//对应的是明文长度，明文每32位为一个元素，主要就是计算MX的过程</span><br>        &#123;<br>          v24 = __rdtsc();<span class="hljs-comment">//获取CPU的时间戳计数</span><br>          v11 = *(_DWORD *)&amp;v10[<span class="hljs-number">4</span> * ((k + <span class="hljs-number">1</span>) % v21)];<span class="hljs-comment">//取到v[p+1]</span><br>          v27 = (<span class="hljs-number">4</span> * v11) ^ (*(_DWORD *)&amp;v10[<span class="hljs-number">4</span> * ((k + v21 - <span class="hljs-number">1</span>) % v21)] &gt;&gt; <span class="hljs-number">5</span>);<span class="hljs-comment">//v[p+1]&lt;&lt;2 ^ v[p-1]&gt;&gt;5</span><br>          v28 = k + v21 - <span class="hljs-number">1</span>;<span class="hljs-comment">//p-1</span><br>          v29 = ((<span class="hljs-number">16</span> * *(_DWORD *)&amp;v10[<span class="hljs-number">4</span> * (v28 % v21)]) ^ (v11 &gt;&gt; <span class="hljs-number">3</span>)) + v27;<span class="hljs-comment">//v[p-1]&lt;&lt;4 ^ v[p+1]&gt;&gt;3 + v27</span><br>          v30 = ((<span class="hljs-type">unsigned</span> __int8)v15 ^ (<span class="hljs-type">unsigned</span> __int8)k) &amp; <span class="hljs-number">3</span>;<span class="hljs-comment">//(e^p)&amp;3 </span><br>            <span class="hljs-comment">//key[(p&amp;3)^e] ^  v[p-1]    +   (sum^v[p+1])   + v[p]</span><br>          v31 = (((*(_DWORD *)&amp;v10[<span class="hljs-number">4</span> * (v28 % v21)] ^ v20[v30]) + (v11 ^ v13)) ^ v29) + *(_DWORD *)&amp;v10[<span class="hljs-number">4</span> * k];<br>          *(_DWORD *)&amp;v10[<span class="hljs-number">4</span> * k] = v31;<span class="hljs-comment">//v[p] = ...</span><br>          v12 = v31;<br>          <span class="hljs-keyword">if</span> ( __rdtsc() - v24 &gt; <span class="hljs-number">0x83C0</span> )<span class="hljs-comment">//基于时间的反调试</span><br>            <span class="hljs-keyword">goto</span> LABEL_21;<br>        &#125;<br>      &#125;<br>      v25[<span class="hljs-number">0</span>] = <span class="hljs-number">0xA9934E2F</span>;<br>      v25[<span class="hljs-number">1</span>] = <span class="hljs-number">0x30B90FA</span>;<br>      v25[<span class="hljs-number">2</span>] = <span class="hljs-number">0xDCBF1D3</span>;<br>      v25[<span class="hljs-number">3</span>] = <span class="hljs-number">0x328B5BDE</span>;<br>      v25[<span class="hljs-number">4</span>] = <span class="hljs-number">0x44FAB4E</span>;<br>      v25[<span class="hljs-number">5</span>] = <span class="hljs-number">0x1DCF0051</span>;<br>      v25[<span class="hljs-number">6</span>] = <span class="hljs-number">0x85EBBE55</span>;<br>      v25[<span class="hljs-number">7</span>] = <span class="hljs-number">0x93AA773A</span>;<br>      <span class="hljs-keyword">for</span> ( m = <span class="hljs-number">0LL</span>; m &lt; <span class="hljs-number">4</span>; ++m )<br>      &#123;<br>        <span class="hljs-keyword">if</span> ( v25[m] != v8[m + <span class="hljs-number">2</span>] )<span class="hljs-comment">//验证flag</span><br>        &#123;<br>          sub_140087C02(<span class="hljs-number">0x1401A11A8L</span>L);<br>          j_system(byte_1401A11A0);<br>          <span class="hljs-keyword">goto</span> LABEL_21;<br>        &#125;<br>      &#125;<br>      sub_140087C02(<span class="hljs-number">0x1401A11C0L</span>L);<br>      j_system(byte_1401A11A0);<br>    &#125;<br>  &#125;<br>LABEL_21:<br>  j__RTC_CheckStackVars(&amp;v7, (_RTC_framedesc *)&amp;unk_1401A1140);<br>  j___security_check_cookie((<span class="hljs-type">unsigned</span> __int64)v8 ^ v32);<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><p>​改参数的xxTea，加解密逻辑一样。</p><figure class="highlight c++"><table><tr><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//大佬的解密脚本</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> DELTA 0x61C88646</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MX (((z &gt;&gt; 5 ^ y <span class="hljs-string">&lt;&lt; 2) + (y &gt;</span>&gt; 3 ^ z &lt;&lt; 4)) ^ ((sum ^ y) + (key[(p &amp; 3) ^ e] ^ z)))</span><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">xxtea</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> *v, <span class="hljs-type">int</span> n, <span class="hljs-type">uint32_t</span> <span class="hljs-type">const</span> key[<span class="hljs-number">4</span>])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">uint32_t</span> y, z, sum;<br>    <span class="hljs-type">unsigned</span> p, rounds, e;<br>    <span class="hljs-keyword">if</span> (n &gt; <span class="hljs-number">1</span>) <span class="hljs-comment">/* Coding Part */</span><br>    &#123;<br>        rounds = <span class="hljs-number">7</span>;<br>        sum = <span class="hljs-number">0</span>;<br>        z = v[n - <span class="hljs-number">1</span>];<br>        <span class="hljs-keyword">do</span><br>        &#123;<br>            sum += DELTA;<br>            e = (sum &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span>;<br>            <span class="hljs-keyword">for</span> (p = <span class="hljs-number">0</span>; p &lt; n - <span class="hljs-number">1</span>; p++)<br>            &#123;<br>                y = v[p + <span class="hljs-number">1</span>];<br>                z = v[p] += MX;<br>                <span class="hljs-keyword">if</span> (z == <span class="hljs-number">0xA4F41487</span>)<br>                    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;11\n&quot;</span>);<br>                <span class="hljs-keyword">if</span> (y == <span class="hljs-number">0xA4F41487</span>)<br>                    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;11\n&quot;</span>);<br>            &#125;<br>            y = v[<span class="hljs-number">0</span>];<br>            z = v[n - <span class="hljs-number">1</span>] += MX;<br><br>        &#125; <span class="hljs-keyword">while</span> (--rounds);<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (n &lt; <span class="hljs-number">-1</span>) <span class="hljs-comment">/* Decoding Part */</span><br>    &#123;<br>        n = -n;<br>        rounds = <span class="hljs-number">7</span>;<br>        sum = rounds * DELTA;<br>        y = v[<span class="hljs-number">0</span>];<br>        <span class="hljs-keyword">do</span><br>        &#123;<br>            e = (sum &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span>;<br>            <span class="hljs-keyword">for</span> (p = n - <span class="hljs-number">1</span>; p &gt; <span class="hljs-number">0</span>; p--)<br>            &#123;<br>                z = v[p - <span class="hljs-number">1</span>];<br>                y = v[p] -= MX;<br>            &#125;<br>            z = v[n - <span class="hljs-number">1</span>];<br>            y = v[<span class="hljs-number">0</span>] -= MX;<br>            sum -= DELTA;<br>        &#125; <span class="hljs-keyword">while</span> (--rounds);<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">srand</span>(<span class="hljs-number">0xAABB</span>);<br>    <span class="hljs-type">uint32_t</span> key[<span class="hljs-number">4</span>]&#123;&#125;;<br>    <span class="hljs-type">uint32_t</span> Enc[]&#123;<br>        <span class="hljs-number">0xa9934e2f</span>, <span class="hljs-number">0x30b90fa</span>, <span class="hljs-number">0xdcbf1d3</span>, <span class="hljs-number">0x328b5bde</span>,<br>        <span class="hljs-number">0x44fab4e</span>, <span class="hljs-number">0x1dcf0051</span>, <span class="hljs-number">0x85ebbe55</span>, <span class="hljs-number">0x93aa773a</span>&#125;;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++)<br>    &#123;<br>        key[i] = <span class="hljs-built_in">rand</span>();<br>    &#125;<br>    <span class="hljs-built_in">xxtea</span>(Enc, <span class="hljs-number">-8</span>, key);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%.32s\n&quot;</span>, Enc);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="Summer"><a href="#Summer" class="headerlink" title="Summer"></a>Summer</h1><h3 id="复现WP-1"><a href="#复现WP-1" class="headerlink" title="复现WP"></a>复现WP</h3><p>​Haskell语言编写，不看了，去找大佬的WP学习吧，太雷人了，我要快点结束这一part。经典题以后再做也没事，现在就吸取一下经验。</p><h1 id="MDriver（无解，我也不看了）"><a href="#MDriver（无解，我也不看了）" class="headerlink" title="MDriver（无解，我也不看了）"></a>MDriver（无解，我也不看了）</h1>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;p&gt;​	复现了4、5个题后，就感觉难度有点太大了，好几个题都涉及到没学过的技术，由于我的Windows基础很差，我的知识一直很琐碎，做题的时候感</summary>
      
    
    
    
    <category term="CTF" scheme="http://bumak.github.io/categories/CTF/"/>
    
    
    <category term="Reverse" scheme="http://bumak.github.io/tags/Reverse/"/>
    
    <category term="复现WP" scheme="http://bumak.github.io/tags/%E5%A4%8D%E7%8E%B0WP/"/>
    
  </entry>
  
  <entry>
    <title>DSBCTF2024</title>
    <link href="http://bumak.github.io/2025/06/29/DSBCTF2024/DSBCTF/"/>
    <id>http://bumak.github.io/2025/06/29/DSBCTF2024/DSBCTF/</id>
    <published>2025-06-29T08:50:00.000Z</published>
    <updated>2025-07-10T07:37:26.851Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>​比赛是CTFSHOW平台的DSBCTF2024，<a href="https://ctf-show.feishu.cn/docx/R6udd58bxoQGQMxFphncZq8rn5e">官方WP</a>如示。</p><h2 id="easyRE"><a href="#easyRE" class="headerlink" title="easyRE"></a>easyRE</h2><p>​<code>jar</code>程序，第一次见到，好好学习一下。<a href="https://www.skfwe.cn/p/%E9%80%86%E5%90%91-jar-e.g-dvt/">有个入门文章</a>，看看。</p><p>​第一步使用JD-GUI打开jar程序，看到Application类，里面有个长段的base64，解码得到程序主要逻辑函数。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/DSBCTF2024/image-20250612163448413.png" alt="image-20250612163448413"></p><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> javax.crypto.Cipher;<br><span class="hljs-keyword">import</span> javax.crypto.spec.SecretKeySpec;<br><span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;<br><span class="hljs-keyword">import</span> java.security.SecureRandom;<br><span class="hljs-keyword">import</span> java.util.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">D8yDSBCTF</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">P3WSSK</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;AES/ECB/PKCS5Padding&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">C89SYS__</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">C7yyfggl</span> <span class="hljs-operator">=</span> C89SYS__.toUpperCase();<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">N9SSCRT</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;0123456789&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">D9UUSACR</span> <span class="hljs-operator">=</span> C89SYS__ + C7yyfggl + N9SSCRT;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">SecureRandom</span> <span class="hljs-variable">rf3ffc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecureRandom</span>();<br>    <span class="hljs-keyword">public</span>  <span class="hljs-keyword">void</span> <span class="hljs-title function_">start</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span>  b3f7a__0x337f2a(a98fac77f__3c2a(<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">4</span>)).get(<span class="hljs-number">1</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">e3yfbbglsk</span> <span class="hljs-operator">=</span> b3f7a__0x337f2a(a98fac77f__3c2a(<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">4</span>)).get(<span class="hljs-number">0</span>);<br>        <span class="hljs-type">Scanner</span> <span class="hljs-variable">scanner</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br>        System.out.println(<span class="hljs-string">&quot;please input password:&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">i3clscwyt</span> <span class="hljs-operator">=</span> scanner.nextLine();<br>        <span class="hljs-keyword">if</span> (e3c7go_to(i3clscwyt,key).equals(e3yfbbglsk)) &#123;<br>            System.out.println(<span class="hljs-string">&quot;Login Successful&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;Login Failed&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">private</span>  List&lt;String&gt; <span class="hljs-title function_">b3f7a__0x337f2a</span><span class="hljs-params">(String a783c_7fxf__)</span> &#123;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">f37xcrxedrd_</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;jvjeTQVGcDGPgFeC+E90Pz6wYzjcBK49YDx2W+6YFTjk/wma7Oa5J3O2ns8OptbxyNgIvYJf/J4BRJOat0LY2A==&quot;</span>;<br>        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">c0fybbg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>        List&lt;String&gt; l2crsys = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;String&gt;();<br>        <span class="hljs-type">char</span>[] f117xc = f37xcrxedrd_.toCharArray();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">char</span> c : f117xc) &#123;<br>            c0fybbg.append((<span class="hljs-type">char</span>)(((c &gt;&gt;&gt; <span class="hljs-number">4</span> ^ (c &lt;&lt; <span class="hljs-number">4</span>) ^ (c &gt;&gt;&gt; <span class="hljs-number">4</span>))) &gt;&gt; <span class="hljs-number">4</span>));<br>        &#125;<br>        l2crsys.add(c0fybbg.substring(<span class="hljs-number">0</span>,c0fybbg.length()-<span class="hljs-number">24</span>));<br>        l2crsys.add(c0fybbg.substring(l2crsys.get(<span class="hljs-number">0</span>).length(),c0fybbg.length()));<br>        <span class="hljs-keyword">return</span> l2crsys;<br>    &#125;<br>    <span class="hljs-keyword">public</span>  String <span class="hljs-title function_">a98fac77f__3c2a</span><span class="hljs-params">(<span class="hljs-type">int</span> length)</span> &#123;<br>        <span class="hljs-keyword">if</span> (length &lt; <span class="hljs-number">1</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;Length must be positive&quot;</span>);<br><br>        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">s7cyscrs</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(length);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; length; i++) &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">randomIndex</span> <span class="hljs-operator">=</span> rf3ffc.nextInt(D9UUSACR.length());<br>            s7cyscrs.append(D9UUSACR.charAt(randomIndex));<br>        &#125;<br>        <span class="hljs-keyword">return</span> s7cyscrs.toString();<br>    &#125;<br>    <span class="hljs-keyword">public</span>  String <span class="hljs-title function_">e3c7go_to</span><span class="hljs-params">(String coysc21k, String k89csbbv)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">while</span> (k89csbbv.getBytes(StandardCharsets.UTF_8).length &lt; <span class="hljs-number">16</span>) &#123;<br>            k89csbbv += k89csbbv;<br>        &#125;<br>        <span class="hljs-type">byte</span>[] keyBytes = k89csbbv.substring(<span class="hljs-number">0</span>, <span class="hljs-number">16</span>).getBytes(StandardCharsets.UTF_8);<br>        <span class="hljs-type">SecretKeySpec</span> <span class="hljs-variable">s88vfy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecretKeySpec</span>(keyBytes, <span class="hljs-string">&quot;AES&quot;</span>);<br>        <span class="hljs-type">Cipher</span> <span class="hljs-variable">c1ppy</span> <span class="hljs-operator">=</span> Cipher.getInstance(P3WSSK);<br>        c1ppy.init(Cipher.ENCRYPT_MODE, s88vfy);<br>        <span class="hljs-type">byte</span>[] encryptedBytes = c1ppy.doFinal(coysc21k.getBytes(StandardCharsets.UTF_8));<br>        <span class="hljs-keyword">return</span> Base64.getEncoder().encodeToString(encryptedBytes);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>​幸好学过一点点JAVA语法，并且有Chatgpt的辅助，我很顺利的理解了函数逻辑。<code>a98fac77f__3c2a</code>是生成指定长度的随机字符串，字符表就是<code>D9UUSACR</code>；<code>b3f7a__0x337f2a</code>就是对<code>f37xcrxedrd_</code>字符串进行分割，后面24位为数组第二个元素，前面的字符串为数组第一个元素，也就是密文；<code>e3c7go_to</code>加密方式就是将key取前16位，然后对输入进行AES加密，对应模式如<code>P3WSSK</code>，最后转base64表示。</p><p>​所以和随机数一点关系没有，只是个迷惑项，赛博厨子一把梭。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/DSBCTF2024/image-20250612171208129.png" alt="image-20250612171208129"></p><h2 id="送单身的自己一束（64朵）花"><a href="#送单身的自己一束（64朵）花" class="headerlink" title="送单身的自己一束（64朵）花"></a>送单身的自己一束（64朵）花</h2><p>​熟悉的exe黑框框程序，国际惯例先查壳，无壳白茶。<strong>(ゝ∀･)</strong></p><p>​程序表面看上去比较简单，很容易追踪到主要逻辑，但是就是加密过程看的很难受，函数里面套好几个函数，还都没有正经名称，功能分析太麻烦了。<strong>(╥﹏╥)</strong></p><p>​太难了，动调都看不出来，真的是无语住了。我好像不太适合天天做题了，都做不出来，完全都没思路，和我的能力都不在一个水平上啊。</p><p>​</p><p>​还是慢慢来吧，我定了一个策略：碰到一个题后，如果是新题型（新语言或者是新技术），一定尽量自己先写一个demo出来看一看熟悉一下其逆向，然后会事半功倍。</p><p>​看到check里面的长度比较，密文长度是<strong>0x38</strong>，而且我们输入字符串长度39个时为0x34，40对应0x38，42对应0x38，43对应0x3C。根据这个特征，我们推断出，其中很可能有base64的变换。</p><p>​<strong>小伙籽，如果无法找到哪些是用户代码，就动调吧，别怕，这题大多数是系统代码。</strong>😂</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/DSBCTF2024/image-20250626161812242.png" alt="image-20250626161812242"></p><p>​<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/DSBCTF2024/image-20250626162116531.png" alt="image-20250626162116531"></p><p>​我们的输入长度就是40、41和42了，密文是<code>[121, 84, 114, 67, 35, 83, 42, 76, 36, 84, 74, 116, 122, 119, 86, 65, 120, 82, 65, 77, 36, 120, 106, 80, 122, 119, 78, 67, 120, 82, 110, 70, 37, 104, 114, 86, 120, 81, 121, 77, 36, 120, 106, 94, 114, 67, 77, 77, 36, 83, 118, 79, 35, 84, 81, 97]</code>，即<strong>yTrC#S*L$TJtzwVAxRAM$xjPzwNCxRnF%hrVxQyM$xj^rCMM$SvO#TQa</strong>。</p><p>​替换表为<strong>abcdefghijklmnopqrstuvwxyz!@#$%^&amp;*()ABCDEFGHIJKLMNOPQRSTUVWXYZ&lt;&gt;a</strong>。</p><p>​看了半天就一个换表的base64加密，中间一堆不知道是啥的东西，有自动补**\0**结束符的，有验证下标的。我直接被吓退了！</p><p>​有点搞自己心态了。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/DSBCTF2024/image-20250626161332933.png" alt="image-20250626161332933"></p><p>​原来开头还有一个简单的花指令啊。</p><h2 id="破解飞机大战"><a href="#破解飞机大战" class="headerlink" title="破解飞机大战"></a>破解飞机大战</h2><p>​有一个新颖的反调试技术，当在调试时，a1&#x3D;1，会除以0，导致程序崩溃；没有调试时，a1&#x3D;0, 计算 (a1 - 1) &#x3D; -1，转换为无符号后是很大的数（0xFFFFFFFF），0 除以任何非零数都是 0 → 返回 0，程序正常运行。</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __usercall sub_4120A0@&lt;eax&gt;(<span class="hljs-type">unsigned</span> __int64 a1@&lt;edx:eax&gt;)<br>&#123;<br>  LODWORD(a1) = NtCurrentPeb()-&gt;BeingDebugged;<br>  LODWORD(a1) = a1 / (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)(a1 - <span class="hljs-number">1</span>);<br>  <span class="hljs-keyword">return</span> a1;<br>&#125;<br></code></pre></td></tr></table></figure><p>​全部手动nop也太麻烦了，学习WP中直接NOP掉这个函数的方法。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">debugfun = <span class="hljs-string">b&quot;\x64\xA1\x30\x00\x00\x00\x0F\xB6\x40\x02\x89\xC3\x83\xEB\x01\xF7\xF3&quot;</span><span class="hljs-comment">#这个函数所有的字节</span><br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;a.exe&quot;</span>, <span class="hljs-string">&quot;rb&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    data = f.read()<br><br><span class="hljs-comment"># 替换并接住返回值</span><br>patched_data = data.replace(debugfun, <span class="hljs-string">b&quot;\x90&quot;</span> * <span class="hljs-built_in">len</span>(debugfun))<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;b.exe&quot;</span>, <span class="hljs-string">&quot;wb&quot;</span>) <span class="hljs-keyword">as</span> f2:<br>    f2.write(patched_data)<br></code></pre></td></tr></table></figure><p>​IDA打开后，正常从**_main**函数开始分析，先看到三个函数，<strong>sub_416900</strong>应该是初始化部分。</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">sub_416900</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// ebx</span><br>  <span class="hljs-type">int</span> result; <span class="hljs-comment">// eax</span><br><br>  result = dword_432038;<span class="hljs-comment">//静态变量防止重复执行</span><br>  <span class="hljs-keyword">if</span> ( !dword_432038 )<br>  &#123;<br>    dword_432038 = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; dword_418B30[i + <span class="hljs-number">1</span>]; ++i )<br>      ;<br>    <span class="hljs-keyword">for</span> ( ; i; --i )<br>      ((<span class="hljs-type">void</span> (*)(<span class="hljs-type">void</span>))dword_418B30[i])();<span class="hljs-comment">//倒序遍历函数指针数组并调用</span><br>    result = sub_4014C0(sub_416870);<span class="hljs-comment">//调用注册类函数</span><br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><hr><blockquote><p><code>RegisterClassA</code> 是 Windows API 提供的一个函数，用于<strong>向操作系统注册一个窗口类（Window Class）</strong>，以便后续调用 <code>CreateWindow</code> 或 <code>CreateWindowEx</code> 创建该类的窗口。</p></blockquote><blockquote><p>🧠 为什么这么做？它的用途是什么？</p><p>这是所谓的 <strong>函数指针传递</strong>，目的是：</p><ul><li><strong>延迟调用</strong>：我先告诉你该调用哪个函数，以后再执行；</li><li><strong>回调机制（callback）</strong>：我把你告诉我的函数记下来，等事件触发时自动调用；</li><li><strong>模块化设计</strong>：让程序的某个部分（比如初始化、清理、响应某个状态）能被“灵活替换”。</li></ul></blockquote><p>例如：</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">callLater</span><span class="hljs-params">(<span class="hljs-type">void</span> (*func)(<span class="hljs-type">void</span>))</span> &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;准备调用你给我的函数！\n&quot;</span>);<br>    func();  <span class="hljs-comment">// 调用传入的函数</span><br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">sayHello</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;你好，我是你传入的函数！\n&quot;</span>);<br>&#125;<br><br>callLater(sayHello);<br></code></pre></td></tr></table></figure><hr><p>​看到<strong>sub_415291</strong>，明显的win32窗口程序代码，其作用就是创建主窗口，加载资源（图片），设置控件，初始化一些逻辑组件。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/DSBCTF2024/image-20250629145153137.png" alt="image-20250629145153137"></p><p>​<strong>sub_41677B</strong>函数是Windows消息循环处，是程序的“主循环”。<strong>sub_415D40</strong>函数进入看到几百行函数调用，绝大多数都是被nop掉的反调试函数，不过也几个其他关键函数，太懒了，就不要一个个翻了。</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">sub_41677B</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">int</span> result; <span class="hljs-comment">// eax</span><br><br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    result = dword_42F98C;<span class="hljs-comment">//运行控制开关变量</span><br>    <span class="hljs-keyword">if</span> ( !dword_42F98C )<br>      <span class="hljs-keyword">break</span>;<br>    result = sub_414BC5();<br>    <span class="hljs-keyword">if</span> ( result &gt; <span class="hljs-number">9999</span> )<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">if</span> ( PeekMessageA(&amp;Msg, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1u</span>) )<span class="hljs-comment">//查询消息（非阻塞）</span><br>    &#123;<br>      TranslateMessage(&amp;Msg);<span class="hljs-comment">//处理按键等</span><br>      sub_415BEA();<br>      sub_41574F();<br>      DispatchMessageA(&amp;Msg);<span class="hljs-comment">//分发给窗口过程</span><br>    &#125;<br>    sub_415D40();<span class="hljs-comment">//自定义每帧逻辑</span><br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><p>​根据小游戏的提示，得分为10000即可通关，可见<strong>sub_414BC5</strong>函数是返回得分了，进去看看。</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs C"><span class="hljs-type">int</span> <span class="hljs-title function_">sub_414BC5</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">12345</span> - dword_42F99C;<span class="hljs-comment">//该静态变量本身初始化为12345，保证起始得分为0.</span><br>&#125;<br></code></pre></td></tr></table></figure><p>​但是通过交叉引用，可以发现有其他函数在调用它查询分数，跟过去看看<strong>sub_415C43</strong>，查看交叉引用，发现该函数刚好在消息循环的<strong>sub_415D40</strong>函数里面，可以猜测这是通关后逻辑的代码。</p><p>​它在干嘛呢？先读取用户输入密钥，然后对加密代码进行异或解密，然后通过<code>VirtualProtect</code> 将这块内存区域的保护属性改成 <code>0x40</code>，也就是 <code>PAGE_EXECUTE_READWRITE</code>，允许代码执行，最后调用解密后的函数。密钥是多少呢？根据函数结尾是<strong>retn</strong>指令（<strong>C3</strong>）的特征，查看到最后一个加密字节是<strong>0Fh</strong>，我们得出密钥是<strong>204</strong>。</p><p>​由于主循环里面每当到10000了程序就直接退出了，根本无法到这一块，所以我们IDA手动改变一下跳转，让这个函数执行一下。</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">sub_415C43</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">void</span> *v1; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v2; <span class="hljs-comment">// [esp+4h] [ebp-34h]</span><br>  <span class="hljs-type">int</span> v3; <span class="hljs-comment">// [esp+8h] [ebp-30h]</span><br>  <span class="hljs-type">int</span> v4; <span class="hljs-comment">// [esp+Ch] [ebp-2Ch]</span><br>  <span class="hljs-type">int</span> v5; <span class="hljs-comment">// [esp+10h] [ebp-28h]</span><br>  DWORD flOldProtect; <span class="hljs-comment">// [esp+14h] [ebp-24h] BYREF</span><br>  <span class="hljs-type">int</span> v7[<span class="hljs-number">3</span>]; <span class="hljs-comment">// [esp+18h] [ebp-20h] BYREF</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// [esp+28h] [ebp-10h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+2Ch] [ebp-Ch]</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// [esp+30h] [ebp-8h]</span><br>  <span class="hljs-type">int</span> v11; <span class="hljs-comment">// [esp+34h] [ebp-4h]</span><br>  <span class="hljs-type">int</span> savedregs; <span class="hljs-comment">// [esp+38h] [ebp+0h]</span><br><br>  <span class="hljs-keyword">if</span> ( sub_414BC5() == <span class="hljs-number">10000</span> )<br>  &#123;<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, v7);<br>    HIBYTE(v8) = v7[<span class="hljs-number">0</span>];<br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">0x16917</span>; ++i )<br>      *((_BYTE *)sub_419060 + i) ^= HIBYTE(v8);<br>    VirtualProtect(sub_419060, <span class="hljs-number">0x16918u</span>, <span class="hljs-number">0x40u</span>, &amp;flOldProtect);<br>    v1 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x100000u</span>);<br>    sub_419060(v1, v2, v3, v4, v5, flOldProtect, v7[<span class="hljs-number">0</span>], v7[<span class="hljs-number">1</span>], v7[<span class="hljs-number">2</span>], v1, v8, i, v10, v11, savedregs);<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>​执行完之后就出现了一个<strong>res.jpg</strong>图片，得到<strong>ctfshow{162dfd79-b4bf-455a-9065-16105e421687}</strong>。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/DSBCTF2024/res.jpg" alt="res.jpg"></p><h2 id="没时间好好爱你，所以选择单身"><a href="#没时间好好爱你，所以选择单身" class="headerlink" title="没时间好好爱你，所以选择单身"></a>没时间好好爱你，所以选择单身</h2><p>​国际惯例，先查壳。无壳，64位程序。</p><p>​IDA究极好读代码，第一个迷宫<strong>sddssdsssdd</strong>，第二个是做数独（开始还看不出来），看到第三个绷不住了，又tm考魔方，我这魔方就过不去了呗。<strong>RRuFFRRFFUUFFRRFFuRR</strong>。（可以去<a href="https://rubiks-cube-solver.com/">网站</a>查）</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/DSBCTF2024/image-20250629164104513.png" alt="image-20250629164104513"></p><p>​最后的答案是<strong>sddssdsssdd513749862RRuFFRRFFUUFFRRFFuRR</strong>。</p><p>​打开压缩包里面的txt文件，看到最下面的<strong>ctfshow{After_all_I’m_t0o_busy_to h@ve_t1me_to_l0ve_y0u_we11}</strong>。</p><blockquote><p>​这里不得不补一点魔方的基础知识了，国际比赛标准魔方是：<strong>上面白色，前面绿色，下面黄色，后面蓝色，右面红色，左面橙色</strong>。</p><p>​魔方选择符号，<strong>R表示右面顺时针</strong>，<strong>F表示前面顺时针</strong>，<strong>U表示上面顺时针</strong>，<strong>r(R’)表示右面逆时针</strong>，<strong>f(F’)表示前面逆时针</strong>，<strong>u(U’)表示上面逆时针</strong>。</p></blockquote><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/DSBCTF2024/image-20250629162655820.png" alt="image-20250629162655820"></p><p>​可以看一个“F”对应的代码，先保存前面的数组数据，然后进行重新赋值。但是，这个代码高低有点问题啊，因为它只修改了前面，没有给周围的四个面更新，不能表示完整的F操作啊，所以说这个函数应该只能说是起一个“提示”的作用。（反正输入正确与否都是一样的提示信息，它也没检查）</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c">__int64 __fastcall <span class="hljs-title function_">rotateFaceClockwise</span><span class="hljs-params">(<span class="hljs-type">int</span> a1)</span><span class="hljs-comment">//a1可能值为0、1、2，因为FRU操作主要</span><br>&#123;<br>  __int64 result; <span class="hljs-comment">// rax</span><br>  _DWORD v2[<span class="hljs-number">12</span>]; <span class="hljs-comment">// [rsp+0h] [rbp-40h]</span><br>  <span class="hljs-type">int</span> m; <span class="hljs-comment">// [rsp+30h] [rbp-10h]</span><br>  <span class="hljs-type">int</span> k; <span class="hljs-comment">// [rsp+34h] [rbp-Ch]</span><br>  <span class="hljs-type">int</span> j; <span class="hljs-comment">// [rsp+38h] [rbp-8h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+3Ch] [rbp-4h]</span><br><br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">2</span>; ++i )<br>  &#123;<br>    <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt;= <span class="hljs-number">2</span>; ++j )<br>    &#123;<br>      result = j + <span class="hljs-number">3LL</span> * i;<br>      v2[result] = cube[<span class="hljs-number">9</span> * a1 + <span class="hljs-number">3</span> * i + j];<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">for</span> ( k = <span class="hljs-number">0</span>; k &lt;= <span class="hljs-number">2</span>; ++k )<br>  &#123;<br>    <span class="hljs-keyword">for</span> ( m = <span class="hljs-number">0</span>; m &lt;= <span class="hljs-number">2</span>; ++m )<br>    &#123;<br>      result = m + <span class="hljs-number">9LL</span> * a1 + <span class="hljs-number">3LL</span> * k;<br>      cube[result] = v2[<span class="hljs-number">3</span> * (<span class="hljs-number">2</span> - m) + k];<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;​	比赛是CTFSHOW平台的DSBCTF2024，&lt;a href=&quot;https://ctf-show.feishu.cn/docx/R6u</summary>
      
    
    
    
    <category term="CTF" scheme="http://bumak.github.io/categories/CTF/"/>
    
    
    <category term="Reverse" scheme="http://bumak.github.io/tags/Reverse/"/>
    
    <category term="复现WP" scheme="http://bumak.github.io/tags/%E5%A4%8D%E7%8E%B0WP/"/>
    
  </entry>
  
  <entry>
    <title>XYCTF2024</title>
    <link href="http://bumak.github.io/2025/06/29/XYCTF2024/XYCTF2024/"/>
    <id>http://bumak.github.io/2025/06/29/XYCTF2024/XYCTF2024/</id>
    <published>2025-06-29T02:25:00.000Z</published>
    <updated>2025-07-10T07:31:47.583Z</updated>
    
    <content type="html"><![CDATA[<h1 id="聪明的信使"><a href="#聪明的信使" class="headerlink" title="聪明的信使"></a>聪明的信使</h1><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">enc = <span class="hljs-string">&quot;oujp&#123;H0d_TwXf_Lahyc0_14_e3ah_Rvy0ac@wc!&#125;&quot;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(enc)):<br>    <span class="hljs-keyword">if</span> enc[i].isalpha():<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">ord</span>(enc[i]) &gt;= <span class="hljs-number">97</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">ord</span>(enc[i]) &lt;= <span class="hljs-number">122</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>((<span class="hljs-built_in">ord</span>(enc[i]) - <span class="hljs-number">97</span> - <span class="hljs-number">9</span>) % <span class="hljs-number">26</span> + <span class="hljs-number">97</span>), end=<span class="hljs-string">&quot;&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>((<span class="hljs-built_in">ord</span>(enc[i]) - <span class="hljs-number">65</span> - <span class="hljs-number">9</span>) % <span class="hljs-number">26</span> + <span class="hljs-number">65</span>), end=<span class="hljs-string">&quot;&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(enc[i], end=<span class="hljs-string">&quot;&quot;</span>)<br></code></pre></td></tr></table></figure><h1 id="easy-language"><a href="#easy-language" class="headerlink" title="easy language"></a>easy language</h1><p>​自己分析不出来，WP说还是得下插件。</p><p>​今天晚上最大的收获：下载好了<code>IDA PRO 7.5</code>绿色版本，免安装的，下载即用，还能适配易语言反编译器插件，还配置好了设置中文函数名的配置文件问题和DLL文件问题（用大佬的），都能用，太适配了，没有奇怪的环境问题，我太爱了，还顺带遇到一个分享IDA“皮肤”的大佬，我的IDA又升级了，太爽了！</p><p>​IDA9.0也下载了一个反制控制流平坦化的插件，也太棒了！</p><p>​简单记录一下我的分析，先根据易语言插件反编译的函数名找到真正的输入框所在的逻辑函数。这里先是通过读取组件的属性来获取文本框的内容，然后使用AES-ECB加密一次，</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2024/image-20250604094838934.png" alt="image-20250604094838934"></p><p>​在SUB_403E67函数中调用了SUB_403EE7函数，进行了似于base64的移位、与或操作。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2024/image-20250604095033633.png" alt="image-20250604095033633"></p><p>​回到原函数，后面进行了字符比对和提示信息输出。虽然代码没有过多的混淆，但是还是太难看了，WP上都是猜出来的。我只能先就这样了，取密文base64和AES-ECB解密即可，去找字符串即可。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2024/image-20250604095318810.png" alt="image-20250604095318810"></p><p>​赛博厨子解密如下。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2024/image-20250604100537143.png" alt="image-20250604100537143"></p><h1 id="喵喵喵的flag碎了一地"><a href="#喵喵喵的flag碎了一地" class="headerlink" title="喵喵喵的flag碎了一地"></a>喵喵喵的flag碎了一地</h1><p><code>flag&#123;My_fl@g_h4s_br0ken_4parT_Bu7_Y0u_c@n_f1x_1t!&#125;</code></p><h1 id="给阿姨倒一杯卡布奇诺"><a href="#给阿姨倒一杯卡布奇诺" class="headerlink" title="给阿姨倒一杯卡布奇诺"></a>给阿姨倒一杯卡布奇诺</h1><p>​逻辑很清晰，没什么新知识，就是又重新熟悉了一般tea的逆向算法。</p><p>​至于老问题，IDA，大小端的问题，我的认识是：先做，都试一遍。</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><br><span class="hljs-comment">//魔改tea</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">detea</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> *v, <span class="hljs-type">uint32_t</span> *k, <span class="hljs-type">int</span> i)</span>;<br><span class="hljs-comment">//uint32_t data1 = 0x7472795f;</span><br><span class="hljs-type">uint32_t</span> data1 = <span class="hljs-number">0x5F797274</span>;<br><span class="hljs-type">uint32_t</span> data2 = <span class="hljs-number">0x64726168</span>;<br><span class="hljs-comment">//uint32_t data2 = 0x68617264;</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">uint32_t</span> enc[<span class="hljs-number">8</span>] = &#123;<span class="hljs-number">0x9B28ED45</span>, <span class="hljs-number">0x145EC6E9</span>, <span class="hljs-number">0x5B27A6C3</span>, <span class="hljs-number">0xE59E75D5</span>, <span class="hljs-number">0xE82C2500</span>,<span class="hljs-number">0xA4211D92</span>,<span class="hljs-number">0xCD8A4B62</span>,<span class="hljs-number">0xA668F440</span>&#125;;<br>    <span class="hljs-comment">//uint32_t enc[8] = &#123;0x45ed289b, 0xe9c65e14, 0xc3a6275b, 0xd5759ee5,0x00252ce8,0x921d21a4,0x624b8acd,0x40f468a6&#125;;</span><br>    <span class="hljs-type">char</span> key[<span class="hljs-number">16</span>] = <span class="hljs-string">&quot;give_you_cup_tea&quot;</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">6</span>; i&gt;=<span class="hljs-number">0</span>; i=i<span class="hljs-number">-2</span>)<br>    &#123;<br>        detea(enc, (<span class="hljs-type">uint32_t</span>*)key, i);<br>    &#125;<br><br>    <span class="hljs-type">char</span> *flag = (<span class="hljs-type">char</span>*)enc;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">32</span>; i++)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>, flag[i]);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">detea</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> *v, <span class="hljs-type">uint32_t</span> *k, <span class="hljs-type">int</span> i)</span><br>&#123;<br>    <span class="hljs-type">uint32_t</span> v0 = v[i], v1 = v[i+<span class="hljs-number">1</span>];<br>    <span class="hljs-type">uint32_t</span> delta = <span class="hljs-number">0x6E75316C</span>;<br>    <span class="hljs-type">uint32_t</span> sum = delta * <span class="hljs-number">32</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i =<span class="hljs-number">31</span>; i &gt;= <span class="hljs-number">0</span>; i--)<br>    &#123;<br>        v1 -= ((v0 &gt;&gt; <span class="hljs-number">5</span>) + k[<span class="hljs-number">3</span>]) ^ (v0 + sum) ^ ((v0 &lt;&lt; <span class="hljs-number">4</span>) + k[<span class="hljs-number">2</span>]) ^ (sum + i);<br>        v0 -= ((v1 &gt;&gt; <span class="hljs-number">5</span>) + k[<span class="hljs-number">1</span>]) ^ (v1 + sum) ^ ((v1 &lt;&lt; <span class="hljs-number">4</span>) + k[<span class="hljs-number">0</span>]) ^ (sum + i);<br>        sum = sum - delta;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(i != <span class="hljs-number">0</span>)<br>    &#123;<br>        v0 ^= v[i<span class="hljs-number">-2</span>];<br>        v1 ^= v[i<span class="hljs-number">-1</span>];<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        v0 ^= data1;<br>        v1 ^= data2;<br>    &#125;<br>    v[i] = v0;<br>    v[i+<span class="hljs-number">1</span>] = v1;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="你是真的大学生吗？"><a href="#你是真的大学生吗？" class="headerlink" title="你是真的大学生吗？"></a>你是真的大学生吗？</h1><p>​第一次见这种东西，记录一下。这个代码是一个使用 <strong>8086实模式</strong> 和 <strong>MS-DOS中断</strong> 编写的可执行程序，结构上很典型。</p><p>文件极小，只有1kb不到，第一次看这种还没很适应，有点靠注释和猜。IDA反编译源码如下。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs assembly">dseg:0000 ;<br>dseg:0000 ; +-------------------------------------------------------------------------+<br>dseg:0000 ; |      This file was generated by The Interactive Disassembler (IDA)      |<br>dseg:0000 ; |           Copyright (c) 2024 Hex-Rays, &lt;support@hex-rays.com&gt;           |<br>dseg:0000 ; |                      License info: 48-FCB4-5471-8F                      |<br>dseg:0000 ; |                                 TOM_RUS                                 |<br>dseg:0000 ; +-------------------------------------------------------------------------+<br>dseg:0000 ;<br>dseg:0000 ; Input SHA256 : DE9713F39D770A61E966FDA9C0A9DDF6C3EF5B4037FF5AD4C7ABB962123AFEA3<br>dseg:0000 ; Input MD5    : B64AACBF6ED401B5AE4EB32A63A8E65F<br>dseg:0000 ; Input CRC32  : DF414641<br>dseg:0000 ; Compiler     : Visual C++ (guessed)<br>dseg:0000<br>dseg:0000 ; File Name   : F:\StudyFiles\CTF\Review_CTF\XYCTF2024\RE\你是真的大学生吗？.EXE<br>dseg:0000 ; Format      : MS-DOS executable (EXE)<br>dseg:0000 ; Base Address: 1000h Range: 10000h-100AEh Loaded length: AEh<br>dseg:0000 ; Entry Point : 1005:0<br>dseg:0000<br>dseg:0000                 .686p<br>dseg:0000                 .mmx<br>dseg:0000                 .model large<br>dseg:0000<br>dseg:0000 ; ===========================================================================<br>dseg:0000<br>dseg:0000 ; Segment type: Pure data<br>dseg:0000 dseg            segment para stack &#x27;DATA&#x27; use16<br>dseg:0000                 assume cs:dseg<br>dseg:0000 unk_10000       db  0Dh                 ; DATA XREF: start+5↓o<br>dseg:0001                 db  0Ah<br>dseg:0002                 db  69h ; i<br>dseg:0003                 db  6Eh ; n<br>dseg:0004                 db  70h ; p<br>dseg:0005                 db  75h ; u<br>dseg:0006                 db  74h ; t<br>dseg:0007                 db  20h<br>dseg:0008                 db  73h ; s<br>dseg:0009                 db  74h ; t<br>dseg:000A                 db  72h ; r<br>dseg:000B                 db  69h ; i<br>dseg:000C                 db  6Eh ; n<br>dseg:000D                 db  67h ; g<br>dseg:000E                 db  3Ah ; :<br>dseg:000F                 db  24h ; $<br>dseg:0010 unk_10010       db  0Dh                 ; DATA XREF: start+15↓o<br>dseg:0011                 db  0Ah<br>dseg:0012                 db  24h ; $<br>dseg:0013 unk_10013       db  0Dh                 ; DATA XREF: start+52↓o<br>dseg:0014                 db  0Ah<br>dseg:0015                 db  59h ; Y<br>dseg:0016                 db  65h ; e<br>dseg:0017                 db  73h ; s<br>dseg:0018                 db  24h ; $<br>dseg:0019 unk_10019       db  76h ; v             ; DATA XREF: start+3D↓o<br>dseg:001A                 db  0Eh<br>dseg:001B                 db  77h ; w<br>dseg:001C                 db  14h<br>dseg:001D                 db  60h ; `<br>dseg:001E                 db    6<br>dseg:001F                 db  7Dh ; &#125;<br>dseg:0020                 db    4<br>dseg:0021                 db  6Bh ; k<br>dseg:0022                 db  1Eh<br>dseg:0023                 db  41h ; A<br>dseg:0024                 db  2Ah ; *<br>dseg:0025                 db  44h ; D<br>dseg:0026                 db  2Bh ; +<br>dseg:0027                 db  5Ch ; \<br>dseg:0028                 db    3<br>dseg:0029                 db  3Bh ; ;<br>dseg:002A                 db  0Bh<br>dseg:002B                 db  33h ; 3<br>dseg:002C                 db    5<br>dseg:002D unk_1002D       db  15h                 ; DATA XREF: start+D↓o<br>dseg:002E byte_1002E      db 0                    ; DATA XREF: start+21↓r<br>dseg:002F unk_1002F       db    0                 ; DATA XREF: start+39↓o<br>dseg:0030                 db    0<br>dseg:0031                 db    0<br>dseg:0032                 db    0<br>dseg:0033                 db    0<br>dseg:0034                 db    0<br>dseg:0035                 db    0<br>dseg:0036                 db    0<br>dseg:0037                 db    0<br>dseg:0038                 db    0<br>dseg:0039                 db    0<br>dseg:003A                 db    0<br>dseg:003B                 db    0<br>dseg:003C                 db    0<br>dseg:003D                 db    0<br>dseg:003E                 db    0<br>dseg:003F                 db    0<br>dseg:0040                 db    0<br>dseg:0041                 db    0<br>dseg:0042                 db    0<br>dseg:0043                 db    0<br>dseg:0044                 db    0<br>dseg:0045                 db    0<br>dseg:0046                 db    0<br>dseg:0047                 db    0<br>dseg:0048                 db    0<br>dseg:0049                 db    0<br>dseg:004A                 db    0<br>dseg:004B                 db    0<br>dseg:004C                 db    0<br>dseg:004D                 db    0<br>dseg:004E                 db    0<br>dseg:004F                 db    0<br>dseg:004F dseg            ends<br>dseg:004F<br>seg001:0000 ; ===========================================================================<br>seg001:0000<br>seg001:0000 ; Segment type: Pure code<br>seg001:0000 seg001          segment byte public &#x27;CODE&#x27; use16<br>seg001:0000                 assume cs:seg001<br>seg001:0000                 assume es:nothing, ss:dseg, ds:nothing, fs:nothing, gs:nothing<br>seg001:0000<br>seg001:0000 ; =============== S U B R O U T I N E =======================================<br>seg001:0000<br>seg001:0000 ; Attributes: noreturn<br>seg001:0000<br>seg001:0000                 public start<br>seg001:0000 start           proc near<br>seg001:0000                 mov     ax, seg dseg<br>seg001:0003                 mov     ds, ax<br>seg001:0005                 assume ds:dseg<br>seg001:0005                 lea     dx, unk_10000<br>seg001:0009                 mov     ah, 9<br>seg001:000B                 int     21h             ; DOS - PRINT STRING<br>seg001:000B                                         ; DS:DX -&gt; string terminated by &quot;$&quot;<br>seg001:000D                 lea     dx, unk_1002D<br>seg001:0011                 mov     ah, 0Ah<br>seg001:0013                 int     21h             ; DOS - BUFFERED KEYBOARD INPUT<br>seg001:0013                                         ; DS:DX -&gt; buffer<br>seg001:0015                 lea     dx, unk_10010<br>seg001:0019                 mov     ah, 9<br>seg001:001B                 int     21h             ; DOS - PRINT STRING<br>seg001:001B                                         ; DS:DX -&gt; string terminated by &quot;$&quot;<br>seg001:001D                 xor     cx, cx<br>seg001:001F                 xor     ax, ax<br>seg001:0021                 mov     cl, byte_1002E<br>seg001:0025                 mov     si, 2Fh ; &#x27;/&#x27;<br>seg001:0028                 mov     al, [si]<br>seg001:002A                 add     si, cx<br>seg001:002C<br>seg001:002C loc_1007C:                              ; CODE XREF: start+37↓j<br>seg001:002C                 sub     si, 1<br>seg001:002F                 xor     [si], al<br>seg001:0031                 mov     al, [si]<br>seg001:0033                 dec     cx<br>seg001:0034                 cmp     cx, 0<br>seg001:0037                 jnz     short loc_1007C<br>seg001:0039                 lea     si, unk_1002F<br>seg001:003D                 lea     di, unk_10019<br>seg001:0041<br>seg001:0041 loc_10091:                              ; CODE XREF: start+50↓j<br>seg001:0041                 mov     al, [si]<br>seg001:0043                 mov     bl, [di]<br>seg001:0045                 add     si, 1<br>seg001:0048                 inc     di<br>seg001:0049                 cmp     al, bl<br>seg001:004B                 jnz     short loc_100AA<br>seg001:004D                 cmp     cx, 0<br>seg001:0050                 jnz     short loc_10091<br>seg001:0052                 lea     dx, unk_10013<br>seg001:0056                 mov     ah, 9<br>seg001:0058                 int     21h             ; DOS - PRINT STRING<br>seg001:0058                                         ; DS:DX -&gt; string terminated by &quot;$&quot;<br>seg001:005A<br>seg001:005A loc_100AA:                              ; CODE XREF: start+4B↑j<br>seg001:005A                 mov     ah, 4Ch<br>seg001:005C                 int     21h             ; DOS - 2+ - QUIT WITH EXIT CODE (EXIT)<br>seg001:005C start           endp                    ; AL = exit code<br>seg001:005C<br>seg001:005C seg001          ends<br>seg001:005C<br>seg001:005C<br>seg001:005C                 end start<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">data = [<span class="hljs-number">0x76</span>,<span class="hljs-number">0xe</span>,<span class="hljs-number">0x77</span>,<span class="hljs-number">0x14</span>,<span class="hljs-number">0x60</span>,<span class="hljs-number">0x6</span>,<span class="hljs-number">0x7d</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x6b</span>,<span class="hljs-number">0x1e</span>,<span class="hljs-number">0x41</span>,<span class="hljs-number">0x2a</span>,<span class="hljs-number">0x44</span>,<span class="hljs-number">0x2b</span>,<span class="hljs-number">0x5c</span>,<span class="hljs-number">0x3</span>,<span class="hljs-number">0x3b</span>,<span class="hljs-number">0xb</span>,<span class="hljs-number">0x33</span>,<span class="hljs-number">0x5</span>,<span class="hljs-number">0x15</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(data),<span class="hljs-number">0</span>):<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(data[i] ^ data[i+<span class="hljs-number">1</span>]), end=<span class="hljs-string">&#x27;&#x27;</span>)<br></code></pre></td></tr></table></figure><h1 id="砸核桃"><a href="#砸核桃" class="headerlink" title="砸核桃"></a>砸核桃</h1><p>​新壳，NsPacK3.x，国产壳，北斗，通常是病毒使用的壳。还以为网上能找到现成的脱壳工具，经过只有一个08年的老东西，还用不了了。看WP也是手动脱壳，我也手撕吧。还以为能和获得新工具了，哎，这也是个压缩壳，堆栈平衡同样适用。</p><p>​32位程序，很明显的<code>pushfd</code>、<code>pushad</code>、<code>popfd</code>、<code>popad</code>指令。</p><p>​然后就是最基础的异或加密，直接看脚本。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">xor = <span class="hljs-string">&quot;this_is_not_flag&quot;</span><br>enc = [<span class="hljs-number">0x12</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x8</span>,<span class="hljs-number">0x14</span>,<span class="hljs-number">0x24</span>,<span class="hljs-number">0x5c</span>,<span class="hljs-number">0x4a</span>,<span class="hljs-number">0x3d</span>,<span class="hljs-number">0x56</span>,<span class="hljs-number">0xa</span>,<span class="hljs-number">0x10</span>,<span class="hljs-number">0x67</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x41</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x1</span>,<span class="hljs-number">0x46</span>,<span class="hljs-number">0x5a</span>,<span class="hljs-number">0x44</span>,<span class="hljs-number">0x42</span>,<span class="hljs-number">0x6e</span>,<span class="hljs-number">0xc</span>,<span class="hljs-number">0x44</span>,<span class="hljs-number">0x72</span>,<span class="hljs-number">0xc</span>,<span class="hljs-number">0xd</span>,<span class="hljs-number">0x40</span>,<span class="hljs-number">0x3e</span>,<span class="hljs-number">0x4b</span>,<span class="hljs-number">0x5f</span>,<span class="hljs-number">0x2</span>,<span class="hljs-number">0x1</span>,<span class="hljs-number">0x4c</span>,<span class="hljs-number">0x5e</span>,<span class="hljs-number">0x5b</span>,<span class="hljs-number">0x17</span>,<span class="hljs-number">0x6e</span>,<span class="hljs-number">0xc</span>,<span class="hljs-number">0x16</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x5b</span>,<span class="hljs-number">0x12</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(enc)):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(enc[i] ^ <span class="hljs-built_in">ord</span>(xor[i % <span class="hljs-built_in">len</span>(xor)])), end=<span class="hljs-string">&#x27;&#x27;</span>)<br></code></pre></td></tr></table></figure><h1 id="DebugMe（APK）"><a href="#DebugMe（APK）" class="headerlink" title="DebugMe（APK）"></a>DebugMe（APK）</h1><p>​apk逆向，先放一边。</p><p>​JADX打开，没有可以看的代码，不知道怎么回事，很多乱码。我之前的文件都能显示，工具没有问题，那就是有防护手段了。不会，不想去搜了，直接看WP学习。</p><p>​先找资源下载JEB，付费软件，得破解版。</p><p>​下载好了，使用和JADX差不多，生成的项目文件都是和原文件保存在一起，这一点特别好，不需要我们自己去设置路径了，也不容易C盘爆了。</p><p>​需要修改mainfest中的可调式属性。使用<code>apktool d DebugMe.apk -o out</code>解包，修改好后，使用命令<code>apktool b out -o target_debug.apk</code>重新打包。但是好像没有这么简单。</p><p>​最后成功了，记录一下环境配置的过程。</p><p>​首先，要使用MT管理器直接在模拟器中修改<code>Android.mainfest.xml</code>文件，添加<code>android:debuggable=&quot;true&quot;</code>，修改之后保存文件，然后使用MT自动打包成新的APK。</p><p>​将新的APK通过模拟器的共享文件夹传回到电脑上，使用JEB打开反编译。之后就是开始调试APK了，注意：先要将<code>adb</code>添加到环境变量里面，JEB就是通过adb来找到模拟器设备的。然后使用 <code>adb devices</code>命令查看设备，然后使用命令<code>adb shell am start -D -n com.xyctf.ezapk/.MainActivity</code>启动待调试的进程，其中-n后面是待调试的包名等等。</p><p>​再在JEB中打开调试器，选择好对应的模拟器和进程，就可以成功调试了。正常调试注意加断点再连接程序。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2024/image-20250603173505598.png" alt="image-20250603173505598"></p><p>​<code>XYCTF&#123;d3bugg3r_15_v3ry_u53ful&#125;</code></p><h1 id="舔狗四部曲–简爱"><a href="#舔狗四部曲–简爱" class="headerlink" title="舔狗四部曲–简爱"></a>舔狗四部曲–简爱</h1><p>​一开始吧，DIE分析是ELF程序，就直接IDA打开。（但实际上是.o文件，使用gcc链接，当然IDA反编译出来代码都差不多）。</p><p>​最后是对src数组和s数组进行比较，但是很奇怪的是，src数据就是没有变化，这里是对s数组加密两次后再使用howtolove函数加密，所以正常的逆向逻辑也应该是三次逆向函数解密。<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2024/image-20250602201458975.png" alt="image-20250602201458975"></p><p>​但是，看WP可以分析知，程序的源码就是对密文和输入的，都进行了加密，然后调用howtolove，然后才比对，比对对象是<code>user_input_int</code>和<code>plaintext_int</code>。而howtolove加密的是<code>loveletter</code>，也就是说比对就是假比对，那一层encipher加密完全没有必要，就相当于在输入字符串和假flag进行明文比对。这个程序中的比对就不是正常的，我们不能按照正常的逻辑取预期我们输入正确flag就会输出正确的提示信息。不难猜出，作者想要告诉我们，howtolove函数才是加密的逻辑。</p><p>​算了，不想多说了，我怀疑源码就是错的版本，怎么能这样验证啊。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2024/image-20250602201907424.png" alt="image-20250602201907424"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2024/image-20250602201956024.png" alt="image-20250602201956024"></p><p>​分析半天，一调试就发现，dest是tm指向src的副本，v14是指向和s同样内容的，但是v14是指向s的副本的，后面的s才是真正对s数组进行加密的，所以实际上最后比对就是src数组和howtolove(s)得到的数组。</p><p>​狗日的反编译一点看不出来，看着就是对指针进行操作，指向的就是同一个数组啊，再也不信反编译的伪代码了。</p><p>​当然，后面问AI又想到一些：memcpy函数一般是对两个不同地址的数组进行复制操作，如果v14和s指针相同的话，那处理的就是同一块内存了，那复制还有什么意义呢！这里可能能get到一些异常之处，开始没有这个理解。</p><p>​下面自己写的代码附上。</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span> </span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">re_howtolove</span><span class="hljs-params">(<span class="hljs-type">char</span> *a1)</span><br>&#123;<br>    <span class="hljs-type">int</span> v2[<span class="hljs-number">1802</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br>    <span class="hljs-comment">//memset(v2, 0, sizeof(v2));</span><br>    v2[<span class="hljs-number">32</span>] = <span class="hljs-number">2</span>;<br>    v2[<span class="hljs-number">65</span>] = <span class="hljs-number">2</span>;<br>    v2[<span class="hljs-number">66</span>] = <span class="hljs-number">4</span>;<br>    v2[<span class="hljs-number">98</span>] = <span class="hljs-number">2</span>;<br>    v2[<span class="hljs-number">99</span>] = <span class="hljs-number">5</span>;<br>    v2[<span class="hljs-number">185</span>] = <span class="hljs-number">2</span>;<br>    v2[<span class="hljs-number">186</span>] = <span class="hljs-number">2</span>;<br>    v2[<span class="hljs-number">187</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">188</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">189</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">190</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">191</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">192</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">193</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">194</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">195</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">196</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">197</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">198</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">199</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">200</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">201</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">202</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">203</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">204</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">205</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">206</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">207</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">208</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">209</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">210</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">211</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">212</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">213</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">214</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">215</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">216</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">217</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">218</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">219</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">220</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">221</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">222</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">223</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">224</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">225</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">226</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">227</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">228</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">229</span>] = <span class="hljs-number">2</span>;<br>    v2[<span class="hljs-number">232</span>] = <span class="hljs-number">2</span>;<br>    v2[<span class="hljs-number">256</span>] = <span class="hljs-number">2</span>;<br>    v2[<span class="hljs-number">257</span>] = <span class="hljs-number">5</span>;<br>    v2[<span class="hljs-number">303</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">304</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">305</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">306</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">307</span>] = <span class="hljs-number">2</span>;<br>    v2[<span class="hljs-number">308</span>] = <span class="hljs-number">5</span>;<br>    v2[<span class="hljs-number">328</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">329</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">330</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">331</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">332</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">333</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">334</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">335</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">336</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">337</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">338</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">339</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">340</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">341</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">342</span>] = <span class="hljs-number">2</span>;<br>    v2[<span class="hljs-number">353</span>] = <span class="hljs-number">2</span>;<br>    v2[<span class="hljs-number">354</span>] = <span class="hljs-number">5</span>;<br>    v2[<span class="hljs-number">430</span>] = <span class="hljs-number">2</span>;<br>    v2[<span class="hljs-number">431</span>] = <span class="hljs-number">2</span>;<br>    v2[<span class="hljs-number">432</span>] = <span class="hljs-number">5</span>;<br>    v2[<span class="hljs-number">523</span>] = <span class="hljs-number">2</span>;<br>    v2[<span class="hljs-number">524</span>] = <span class="hljs-number">5</span>;<br>    v2[<span class="hljs-number">564</span>] = <span class="hljs-number">2</span>;<br>    v2[<span class="hljs-number">565</span>] = <span class="hljs-number">5</span>;<br>    v2[<span class="hljs-number">627</span>] = <span class="hljs-number">2</span>;<br>    v2[<span class="hljs-number">628</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">629</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">630</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">631</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">632</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">633</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">634</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">635</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">636</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">637</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">638</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">639</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">640</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">641</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">642</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">643</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">644</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">645</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">646</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">647</span>] = <span class="hljs-number">2</span>;<br>    v2[<span class="hljs-number">648</span>] = <span class="hljs-number">4</span>;<br>    v2[<span class="hljs-number">649</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">650</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">651</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">652</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">653</span>] = <span class="hljs-number">2</span>;<br>    v2[<span class="hljs-number">680</span>] = <span class="hljs-number">2</span>;<br>    v2[<span class="hljs-number">687</span>] = <span class="hljs-number">2</span>;<br>    v2[<span class="hljs-number">688</span>] = <span class="hljs-number">4</span>;<br>    v2[<span class="hljs-number">698</span>] = <span class="hljs-number">2</span>;<br>    v2[<span class="hljs-number">766</span>] = <span class="hljs-number">2</span>;<br>    v2[<span class="hljs-number">767</span>] = <span class="hljs-number">5</span>;<br>    v2[<span class="hljs-number">818</span>] = <span class="hljs-number">2</span>;<br>    v2[<span class="hljs-number">819</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">820</span>] = <span class="hljs-number">2</span>;<br>    v2[<span class="hljs-number">827</span>] = <span class="hljs-number">2</span>;<br>    v2[<span class="hljs-number">828</span>] = <span class="hljs-number">5</span>;<br>    v2[<span class="hljs-number">846</span>] = <span class="hljs-number">2</span>;<br>    v2[<span class="hljs-number">847</span>] = <span class="hljs-number">5</span>;<br>    v2[<span class="hljs-number">890</span>] = <span class="hljs-number">2</span>;<br>    v2[<span class="hljs-number">891</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">892</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">893</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">894</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">895</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">896</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">897</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">898</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">899</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">900</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">901</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">902</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">903</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">904</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">905</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">906</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">907</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">908</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">909</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">910</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">911</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">912</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">913</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">914</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">915</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">916</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">917</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">918</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">919</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">920</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">921</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">922</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">923</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">924</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">925</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">926</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">927</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">928</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">929</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">930</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">931</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">932</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">933</span>] = <span class="hljs-number">2</span>;<br>    v2[<span class="hljs-number">934</span>] = <span class="hljs-number">5</span>;<br>    v2[<span class="hljs-number">989</span>] = <span class="hljs-number">2</span>;<br>    v2[<span class="hljs-number">994</span>] = <span class="hljs-number">2</span>;<br>    v2[<span class="hljs-number">995</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">996</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">997</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">998</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">999</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">1000</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">1001</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">1002</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">1003</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">1013</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">1014</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">1015</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">1016</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">1017</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">1018</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">1019</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">1020</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">1021</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">1022</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">1023</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">1024</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">1025</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">1026</span>] = <span class="hljs-number">1</span>;<br>    v2[<span class="hljs-number">1027</span>] = <span class="hljs-number">2</span>;<br>    v2[<span class="hljs-number">1028</span>] = <span class="hljs-number">3</span>;<br><br>    <span class="hljs-type">int</span> v3 =<span class="hljs-number">1027</span>,v4 =<span class="hljs-number">31</span>;<br>    <br>    <span class="hljs-comment">// for(; v3&gt;=0; --v3)</span><br>    <span class="hljs-comment">// &#123;</span><br>    <span class="hljs-comment">//     switch(v2[v3])</span><br>    <span class="hljs-comment">//     &#123;</span><br>    <span class="hljs-comment">//         case 0:</span><br>    <span class="hljs-comment">//             --crypted[v4];</span><br>    <span class="hljs-comment">//             break;</span><br>    <span class="hljs-comment">//         case 1:</span><br>    <span class="hljs-comment">//             ++crypted[v4];</span><br>    <span class="hljs-comment">//             break;</span><br>    <span class="hljs-comment">//         case 2:</span><br>    <span class="hljs-comment">//             v4--;</span><br>    <span class="hljs-comment">//             break;</span><br>    <span class="hljs-comment">//         case 4:</span><br>    <span class="hljs-comment">//             crypted[v4] -= crypted[v4+1] + 70 ;这里就是错误之处，这个错误语句等价于-(crypted[v4+1]+70)，是错误的啊，我们要的实际上是-crypted[v4+1]-70。</span><br>    <span class="hljs-comment">//             break;</span><br>    <span class="hljs-comment">//         case 5:</span><br>    <span class="hljs-comment">//             crypted[v4] += crypted[v4+1] - 70 ;这里同理。</span><br>    <span class="hljs-comment">//             break;</span><br>    <span class="hljs-comment">//         default:</span><br>    <span class="hljs-comment">//             break;</span><br>    <span class="hljs-comment">//     &#125;</span><br>    <span class="hljs-comment">// &#125;</span><br>    <br>    <span class="hljs-keyword">for</span>(; v3&gt;=<span class="hljs-number">0</span>; --v3)<br>    &#123;<br>        <span class="hljs-keyword">switch</span>(v2[v3])<br>        &#123;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<br>                --a1[v4];<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>                ++a1[v4];<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>                v4--;<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:<br>                a1[v4] = a1[v4] - a1[v4+<span class="hljs-number">1</span>] + <span class="hljs-number">70</span> ;<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:<br>                a1[v4] = a1[v4] + a1[v4+<span class="hljs-number">1</span>] - <span class="hljs-number">70</span> ;<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">default</span>:<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//无用的tea</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">detea</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> *v, <span class="hljs-type">uint32_t</span> *k)</span><br>&#123;<br>    <span class="hljs-type">int</span> rounds = <span class="hljs-number">52</span>;<br>    <span class="hljs-type">uint32_t</span> v0 = v[<span class="hljs-number">0</span>];<br>    <span class="hljs-type">uint32_t</span> v1 = v[<span class="hljs-number">1</span>];<br>    <span class="hljs-type">uint32_t</span> delta = <span class="hljs-number">0x9E3779B9</span>;<br>    <span class="hljs-type">uint32_t</span> sum = delta * rounds;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;rounds;i++)<br>    &#123;<br>        v1 -= (((v0 &gt;&gt; <span class="hljs-number">4</span>)^(v0&lt;&lt;<span class="hljs-number">5</span>)) + v0) ^ (k[(sum &gt;&gt; <span class="hljs-number">11</span>) &amp; <span class="hljs-number">3</span>] + sum);<br>        sum -= delta;<br>        v0 -= (((v1 &gt;&gt; <span class="hljs-number">4</span>)^(v1&lt;&lt;<span class="hljs-number">5</span>)) + v1) ^ (k[sum &amp; <span class="hljs-number">3</span>] + sum);<br>    &#125;<br>    v[<span class="hljs-number">0</span>] = v0;<br>    v[<span class="hljs-number">1</span>] = v1;<br>&#125;<br><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">char</span> crypted[<span class="hljs-number">32</span>] = <span class="hljs-string">&quot;flag&#123;Love_is_not_one_sided_Love&#125;&quot;</span>;<br>    re_howtolove(crypted);<br>    <span class="hljs-comment">//uint32_t key[4] = &#123;0x12345678,0x9ABCDEF0,0x9AB111F0,0x9A323EF0&#125;;</span><br>    <span class="hljs-comment">//detea((uint32_t *)crypted, key);</span><br>    <span class="hljs-comment">//detea((uint32_t *)crypted, key);</span><br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">32</span>;i++)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>,crypted[i]);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="何须相思煮余年"><a href="#何须相思煮余年" class="headerlink" title="何须相思煮余年"></a>何须相思煮余年</h1><p>​给了个纯文本，6，看着应该是机器码和密文。结果跪了，32、64位都不行。</p><p>​看WP使用了一个python库，来进行反汇编，是x86-32的。</p><p>​下面是反汇编的代码。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> capstone <span class="hljs-keyword">import</span> *<br><br>code = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">0x55  0x8b  0xec  0x81  0xec  0xa8  0x0  0x0  0x0  0xa1  0x0  0x40  0x41  0x0  0x33  0xc5  0x89  0x45  0xfc  0x68  0x9c  0x0  0x0  0x0  0x6a  0x0  0x8d  0x85  0x60  0xff  0xff  0xff  0x50  0xe8  0x7a  0xc  0x0  0x0  0x83  0xc4  0xc  0xc7  0x85  0x58  0xff  0xff  0xff  0x27  0x0  0x0  0x0  0xc7  0x85  0x5c  0xff  0xff  0xff  0x0  0x0  0x0  0x0  0xeb  0xf  0x8b  0x8d  0x5c  0xff  0xff  0xff  0x83  0xc1  0x1  0x89  0x8d  0x5c  0xff  0xff  0xff  0x83  0xbd  0x5c  0xff  0xff  0xff  0x27  0xf  0x8d  0xed  0x0  0x0  0x0  0x8b  0x95  0x5c  0xff  0xff  0xff  0x81  0xe2  0x3  0x0  0x0  0x80  0x79  0x5  0x4a  0x83  0xca  0xfc  0x42  0x85  0xd2  0x75  0x25  0x8b  0x85  0x5c  0xff  0xff  0xff  0x8b  0x8c  0x85  0x60  0xff  0xff  0xff  0x3  0x8d  0x5c  0xff  0xff  0xff  0x8b  0x95  0x5c  0xff  0xff  0xff  0x89  0x8c  0x95  0x60  0xff  0xff  0xff  0xe9  0xac  0x0  0x0  0x0  0x8b  0x85  0x5c  0xff  0xff  0xff  0x25  0x3  0x0  0x0  0x80  0x79  0x5  0x48  0x83  0xc8  0xfc  0x40  0x83  0xf8  0x1  0x75  0x22  0x8b  0x8d  0x5c  0xff  0xff  0xff  0x8b  0x94  0x8d  0x60  0xff  0xff  0xff  0x2b  0x95  0x5c  0xff  0xff  0xff  0x8b  0x85  0x5c  0xff  0xff  0xff  0x89  0x94  0x85  0x60  0xff  0xff  0xff  0xeb  0x73  0x8b  0x8d  0x5c  0xff  0xff  0xff  0x81  0xe1  0x3  0x0  0x0  0x80  0x79  0x5  0x49  0x83  0xc9  0xfc  0x41  0x83  0xf9  0x2  0x75  0x23  0x8b  0x95  0x5c  0xff  0xff  0xff  0x8b  0x84  0x95  0x60  0xff  0xff  0xff  0xf  0xaf  0x85  0x5c  0xff  0xff  0xff  0x8b  0x8d  0x5c  0xff  0xff  0xff  0x89  0x84  0x8d  0x60  0xff  0xff  0xff  0xeb  0x38  0x8b  0x95  0x5c  0xff  0xff  0xff  0x81  0xe2  0x3  0x0  0x0  0x80  0x79  0x5  0x4a  0x83  0xca  0xfc  0x42  0x83  0xfa  0x3  0x75  0x20  0x8b  0x85  0x5c  0xff  0xff  0xff  0x8b  0x8c  0x85  0x60  0xff  0xff  0xff  0x33  0x8d  0x5c  0xff  0xff  0xff  0x8b  0x95  0x5c  0xff  0xff  0xff  0x89  0x8c  0x95  0x60  0xff  0xff  0xff  0xe9  0xf7  0xfe  0xff  0xff  0x33  0xc0  0x8b  0x4d  0xfc  0x33  0xcd  0xe8  0x4  0x0  0x0  0x0  0x8b  0xe5  0x5d  0xc3</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br>opcode = []<br>code = code.split()<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(code), <span class="hljs-number">1</span>):<br>    opcode.append(<span class="hljs-built_in">int</span>(code[i][<span class="hljs-number">2</span>:], <span class="hljs-number">16</span>))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(opcode[i]), end=<span class="hljs-string">&#x27; &#x27;</span>)<br><br><br>opcode = <span class="hljs-built_in">bytes</span>(opcode)<br><br>BaseAddr = <span class="hljs-number">0</span><br><br>md = Cs(CS_ARCH_X86, CS_MODE_32)<br><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> md.disasm(opcode, <span class="hljs-number">0</span>):<br>    addr = x.address + BaseAddr<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(addr)[<span class="hljs-number">2</span>:],x.mnemonic,x.op_str)<br></code></pre></td></tr></table></figure><p>​这个题还是一点难度的，需要擅长汇编代码，或者擅长chatgpt（哈哈）。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs assembly">1 mov ebp, esp<br>3 sub esp, 0xa8<br>9 mov eax, dword ptr [0x414000]<br>e xor eax, ebp<br>10 mov dword ptr [ebp - 4], eax<br>13 push 0x9c<br>18 push 0<br>1a lea eax, [ebp - 0xa0]<br>20 push eax<br>21 call 0xca0<br>26 add esp, 0xc<br>29 mov dword ptr [ebp - 0xa8], 0x27<br>33 mov dword ptr [ebp - 0xa4], 0<br>3d jmp 0x4e<br>3f mov ecx, dword ptr [ebp - 0xa4]<br>45 add ecx, 1<br>48 mov dword ptr [ebp - 0xa4], ecx;i++<br>4e cmp dword ptr [ebp - 0xa4], 0x27;i&lt;0x27<br>55 jge 0x148<br>5b mov edx, dword ptr [ebp - 0xa4]<br>61 and edx, 0x80000003;取符号位和最低2位<br>67 jns 0x6e;结果非负跳转<br>69 dec edx<br>6a or edx, 0xfffffffc<br>6d inc edx<br>6e test edx, edx;按位与，但不保存结果，只设置标志位Z<br>70 jne 0x97;edx!=0跳转<br>72 mov eax, dword ptr [ebp - 0xa4]<br>78 mov ecx, dword ptr [ebp + eax*4 - 0xa0];数组取值，设数组是s<br>7f add ecx, dword ptr [ebp - 0xa4];s[i]+i<br>85 mov edx, dword ptr [ebp - 0xa4]<br>8b mov dword ptr [ebp + edx*4 - 0xa0], ecx    ;s[i]=s[i]+i<br>92 jmp 0x143<br>97 mov eax, dword ptr [ebp - 0xa4]<br>9d and eax, 0x80000003<br>a2 jns 0xa9;符号位为0跳转<br>a4 dec eax<br>a5 or eax, 0xfffffffc<br>a8 inc eax<br>a9 cmp eax, 1<br>ac jne 0xd0<br>ae mov ecx, dword ptr [ebp - 0xa4]<br>b4 mov edx, dword ptr [ebp + ecx*4 - 0xa0]<br>bb sub edx, dword ptr [ebp - 0xa4];s[i]-i<br>c1 mov eax, dword ptr [ebp - 0xa4]<br>c7 mov dword ptr [ebp + eax*4 - 0xa0], edx;s[i]=s[i]-i<br>ce jmp 0x143<br>d0 mov ecx, dword ptr [ebp - 0xa4]<br>d6 and ecx, 0x80000003<br>dc jns 0xe3<br>de dec ecx<br>df or ecx, 0xfffffffc<br>e2 inc ecx<br>e3 cmp ecx, 2<br>e6 jne 0x10b<br>e8 mov edx, dword ptr [ebp - 0xa4]<br>ee mov eax, dword ptr [ebp + edx*4 - 0xa0]<br>f5 imul eax, dword ptr [ebp - 0xa4];s[i] * i<br>fc mov ecx, dword ptr [ebp - 0xa4]<br>102 mov dword ptr [ebp + ecx*4 - 0xa0], eax<br>109 jmp 0x143<br>10b mov edx, dword ptr [ebp - 0xa4]<br>111 and edx, 0x80000003<br>117 jns 0x11e<br>119 dec edx<br>11a or edx, 0xfffffffc<br>11d inc edx<br>11e cmp edx, 3<br>121 jne 0x143<br>123 mov eax, dword ptr [ebp - 0xa4]<br>129 mov ecx, dword ptr [ebp + eax*4 - 0xa0]<br>130 xor ecx, dword ptr [ebp - 0xa4];s[i] ^ i<br>136 mov edx, dword ptr [ebp - 0xa4]<br>13c mov dword ptr [ebp + edx*4 - 0xa0], ecx<br>143 jmp 0x3f<br>148 xor eax, eax<br>14a mov ecx, dword ptr [ebp - 4]<br>14d xor ecx, ebp<br>14f call 0x158<br>154 mov esp, ebp<br>156 pop ebp<br>157 ret <br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">enc = [<span class="hljs-number">88</span>,<span class="hljs-number">88</span>,<span class="hljs-number">134</span>,<span class="hljs-number">87</span>,<span class="hljs-number">74</span>,<span class="hljs-number">118</span>,<span class="hljs-number">318</span>,<span class="hljs-number">101</span>,<span class="hljs-number">59</span>,<span class="hljs-number">92</span>,<span class="hljs-number">480</span>,<span class="hljs-number">60</span>,<span class="hljs-number">65</span>,<span class="hljs-number">41</span>,<span class="hljs-number">770</span>,<span class="hljs-number">110</span>,<span class="hljs-number">73</span>,<span class="hljs-number">31</span>,<span class="hljs-number">918</span>,<span class="hljs-number">39</span>,<span class="hljs-number">120</span>,<span class="hljs-number">27</span>,<span class="hljs-number">1188</span>,<span class="hljs-number">47</span>,<span class="hljs-number">77</span>,<span class="hljs-number">24</span>,<span class="hljs-number">1352</span>,<span class="hljs-number">44</span>,<span class="hljs-number">81</span>,<span class="hljs-number">23</span>,<span class="hljs-number">1680</span>,<span class="hljs-number">46</span>,<span class="hljs-number">85</span>,<span class="hljs-number">15</span>,<span class="hljs-number">1870</span>,<span class="hljs-number">66</span>,<span class="hljs-number">91</span>,<span class="hljs-number">16</span>,<span class="hljs-number">4750</span>]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(enc)):<br>    <span class="hljs-keyword">if</span> i % <span class="hljs-number">4</span> == <span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(enc[i]-i), end=<span class="hljs-string">&#x27;&#x27;</span>)<br>        <span class="hljs-keyword">continue</span><br>    <span class="hljs-keyword">if</span> i % <span class="hljs-number">4</span> == <span class="hljs-number">1</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(enc[i]+i), end=<span class="hljs-string">&#x27;&#x27;</span>)<br>        <span class="hljs-keyword">continue</span><br>    <span class="hljs-keyword">if</span> i % <span class="hljs-number">4</span> == <span class="hljs-number">2</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(enc[i]//i), end=<span class="hljs-string">&#x27;&#x27;</span>)<span class="hljs-comment">#需要是整除，向下取整</span><br>        <span class="hljs-keyword">continue</span><br>    <span class="hljs-keyword">if</span> i % <span class="hljs-number">4</span> == <span class="hljs-number">3</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(enc[i]^i), end=<span class="hljs-string">&#x27;&#x27;</span>)<br>        <span class="hljs-keyword">continue</span><br></code></pre></td></tr></table></figure><h1 id="ez-enc"><a href="#ez-enc" class="headerlink" title="ez_enc"></a>ez_enc</h1><p>​</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">enc = [<span class="hljs-number">0x27</span>,<span class="hljs-number">0x24</span>,<span class="hljs-number">0x17</span>,<span class="hljs-number">0xb</span>,<span class="hljs-number">0x50</span>,<span class="hljs-number">0x3</span>,<span class="hljs-number">0xc8</span>,<span class="hljs-number">0xc</span>,<span class="hljs-number">0x1f</span>,<span class="hljs-number">0x17</span>,<span class="hljs-number">0x36</span>,<span class="hljs-number">0x55</span>,<span class="hljs-number">0xcb</span>,<span class="hljs-number">0x2d</span>,<span class="hljs-number">0xe9</span>,<span class="hljs-number">0x32</span>,<span class="hljs-number">0xe</span>,<span class="hljs-number">0x11</span>,<span class="hljs-number">0x26</span>,<span class="hljs-number">0x2</span>,<span class="hljs-number">0xc</span>,<span class="hljs-number">0x7</span>,<span class="hljs-number">0xfc</span>,<span class="hljs-number">0x27</span>,<span class="hljs-number">0x3d</span>,<span class="hljs-number">0x2d</span>,<span class="hljs-number">0xed</span>,<span class="hljs-number">0x35</span>,<span class="hljs-number">0x59</span>,<span class="hljs-number">0xeb</span>,<span class="hljs-number">0x3c</span>,<span class="hljs-number">0x3e</span>,<span class="hljs-number">0xe4</span>,<span class="hljs-number">0x7d</span>]<br><br>key = <span class="hljs-string">&quot;IMouto&quot;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(enc)-<span class="hljs-number">2</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>):<br>    enc[i] = enc[i] ^ <span class="hljs-built_in">ord</span>(key[i%<span class="hljs-number">6</span>])<br>    enc[i] = enc[i] - enc[i+<span class="hljs-number">1</span>]<br><br>    <span class="hljs-comment">#用上一个字符求出来的tmp必满足在0到20之间的限制</span><br>    tmp = enc[i-<span class="hljs-number">1</span>] ^ <span class="hljs-built_in">ord</span>(key[(i-<span class="hljs-number">1</span>)%<span class="hljs-number">6</span>])<br>    tmp = tmp - enc[i]<br>    enc[i] += tmp // <span class="hljs-number">20</span> * <span class="hljs-number">20</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;f&quot;</span>, end=<span class="hljs-string">&quot;&quot;</span>)<span class="hljs-comment">#第一个就不用算了</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-built_in">len</span>(enc)):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(enc[i]), end=<span class="hljs-string">&quot;&quot;</span>)<br></code></pre></td></tr></table></figure><h1 id="baby-unity"><a href="#baby-unity" class="headerlink" title="baby unity"></a>baby unity</h1><p>​游戏是unity做的输入验证文本框？哈，这么搞是吧，小游戏都不给玩，不会逆，直接学WP。</p><p>​GameAssembly.dll和baby unity.exe都被upx压缩了一下，师傅说单纯为了减少附件的大小，哈，还得先去壳。</p><p>​先使用Il2CppDumper.exe恢复符号信息，先选.dll文件，再选.bat文件。然后使用IDA打开DLL文件，使用python脚本ida_with_struct_py3.py加载刚刚得到的script.json和il2cpp.h文件。</p><p>​再使用dnSpy去查看Assembly-CSharp.dll文件，看其中可疑的类名、方法名，但是里面是没办法看源码的，所以要回到IDA中查看反编译的源码，由于恢复了符号信息，所以我们使用IDA直接搜索函数名就行了。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2024/image-20250605150220575.png" alt="image-20250605150220575"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2024/image-20250605150236561.png" alt="image-20250605150236561"></p><p>​看到IDA，我们换个主题颜色，之前的有点看腻了。看到明显的base64和异或0xF，比较奇怪的是密文居然是在注释里，难不成这个8字节保存的是一个指针，指向其他文件中的字符串，这里能看到是因为恢复了符号信息，这里自动把字符串取出放在这里了？</p><p>​之后赛博厨子解密就好。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2024/image-20250605151110999.png" alt="image-20250605151110999"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2024/image-20250605151155177.png" alt="image-20250605151155177"></p><h1 id="ez-unity（未做，环境不行）"><a href="#ez-unity（未做，环境不行）" class="headerlink" title="ez unity（未做，环境不行）"></a>ez unity（未做，环境不行）</h1><p>​这种il2cpp的unity逆向完全没有接触过，现在都是实行WP学习大法，配环境就花了好长时间，下面记录一下我踩的坑。</p><p>​首先将能够生成hook.js脚本的方法，先通过pip下载好frida和frida-tools工具，然后通过<code>npm i frida-il2cpp-bridge</code>命令下载下来框架，然后配置package.json文件，具体内容根据需要配置（当然去抄），<a href="https://blog.csdn.net/weixin_44292683/article/details/132125663">详细的教程</a>文章就是这个，就是其中的方法2。</p><p>​在一切准备就绪后，我执行第一个注入命令就报错了，我反复更换文件，更换frida环境到16.2.1和17.1.0，也重下了题目附件，在虚拟机CTFOS和本机上都试过了，但是都是报出同样一个错误，我完全不理解是为什么。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2024/image-20250606202411829.png" alt="image-20250606202411829"></p><p>​后面使用教程的第一种方法编译frida-il2cpp-bridge项目后，也是没能解决问题。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2024/image-20250606204030666.png" alt="image-20250606204030666"></p><p>​</p><h1 id="ezmath"><a href="#ezmath" class="headerlink" title="ezmath"></a>ezmath</h1><p>​python逆向，一个二次多项式求解问题，学习z3求解器。解包出来，是以这种形式来表示乘积的：<code>sum( (lambda .0: [ flag[23] for _ in .0 ])(range(flag[23])) )</code>。</p><p>​强行使用z3破解，耗时很长，我等了十几分钟都没结果，不知道还要算多久，直接看WP，有一个很巧妙的思路，因为这个二次多项式&#x3D;0，而且式子中每个二次项的系数都是1，我们知道(x_i - ord(flag[i]))**2 &#x3D; 0，那么所有的这些式子展开就会得到该题的的式子，也就是说，附件中给出的二次多项式就是将二次平方项展开的结果。这样就有一个规律了，所有的一次项系数除以2就是对应的常数值（对应flag的ASCII码值）。</p><p>​应该说这是一个数学推导技巧，在数学题中也会使用的技巧。初中生都会，大学生想不到一点。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">flag = (lambda .0: [ ord(i) for i in .0 ])(input(&#x27;flag:&#x27;))</span><br><span class="hljs-string">if len(flag) == 32 and (((((((((((((((((((((sum((lambda .0: [ flag[23] for _ in .0 ])(range(flag[23]))) + sum((lambda .0: [ flag[12] for _ in .0 ])(range(flag[12]))) + sum((lambda .0: [ flag[1] for _ in .0 ])(range(flag[1]))) - sum((lambda .0: [ flag[24] for _ in .0 ])(range(222)))) + sum((lambda .0: [ flag[22] for _ in .0 ])(range(flag[22]))) + sum((lambda .0: [ flag[31] for _ in .0 ])(range(flag[31]))) + sum((lambda .0: [ flag[26] for _ in .0 ])(range(flag[26]))) - sum((lambda .0: [ flag[9] for _ in .0 ])(range(178))) - sum((lambda .0: [ flag[29] for _ in .0 ])(range(232)))) + sum((lambda .0: [ flag[17] for _ in .0 ])(range(flag[17]))) - sum((lambda .0: [ flag[23] for _ in .0 ])(range(150))) - sum((lambda .0: [ flag[6] for _ in .0 ])(range(226))) - sum((lambda .0: [ flag[7] for _ in .0 ])(range(110)))) + sum((lambda .0: [ flag[19] for _ in .0 ])(range(flag[19]))) + sum((lambda .0: [ flag[2] for _ in .0 ])(range(flag[2]))) - sum((lambda .0: [ flag[0] for _ in .0 ])(range(176)))) + sum((lambda .0: [ flag[10] for _ in .0 ])(range(flag[10]))) - sum((lambda .0: [ flag[12] for _ in .0 ])(range(198)))) + sum((lambda .0: [ flag[24] for _ in .0 ])(range(flag[24]))) + sum((lambda .0: [ flag[9] for _ in .0 ])(range(flag[9]))) - sum((lambda .0: [ flag[3] for _ in .0 ])(range(168)))) + sum((lambda .0: [ flag[8] for _ in .0 ])(range(flag[8]))) - sum((lambda .0: [ flag[2] for _ in .0 ])(range(134)))) + sum((lambda .0: [ flag[14] for _ in .0 ])(range(flag[14]))) - sum((lambda .0: [ flag[13] for _ in .0 ])(range(170)))) + sum((lambda .0: [ flag[4] for _ in .0 ])(range(flag[4]))) - sum((lambda .0: [ flag[10] for _ in .0 ])(range(142)))) + sum((lambda .0: [ flag[27] for _ in .0 ])(range(flag[27]))) + sum((lambda .0: [ flag[15] for _ in .0 ])(range(flag[15]))) - sum((lambda .0: [ flag[15] for _ in .0 ])(range(224)))) + sum((lambda .0: [ flag[16] for _ in .0 ])(range(flag[16]))) - sum((lambda .0: [ flag[11] for _ in .0 ])(range(230))) - sum((lambda .0: [ flag[1] for _ in .0 ])(range(178)))) + sum((lambda .0: [ flag[28] for _ in .0 ])(range(flag[28]))) - sum((lambda .0: [ flag[5] for _ in .0 ])(range(246))) - sum((lambda .0: [ flag[17] for _ in .0 ])(range(168)))) + sum((lambda .0: [ flag[30] for _ in .0 ])(range(flag[30]))) - sum((lambda .0: [ flag[21] for _ in .0 ])(range(220))) - sum((lambda .0: [ flag[22] for _ in .0 ])(range(212))) - sum((lambda .0: [ flag[16] for _ in .0 ])(range(232)))) + sum((lambda .0: [ flag[25] for _ in .0 ])(range(flag[25]))) - sum((lambda .0: [ flag[4] for _ in .0 ])(range(140))) - sum((lambda .0: [ flag[31] for _ in .0 ])(range(250))) - sum((lambda .0: [ flag[28] for _ in .0 ])(range(150)))) + sum((lambda .0: [ flag[11] for _ in .0 ])(range(flag[11]))) + sum((lambda .0: [ flag[13] for _ in .0 ])(range(flag[13]))) - sum((lambda .0: [ flag[14] for _ in .0 ])(range(234)))) + sum((lambda .0: [ flag[7] for _ in .0 ])(range(flag[7]))) - sum((lambda .0: [ flag[8] for _ in .0 ])(range(174)))) + sum((lambda .0: [ flag[3] for _ in .0 ])(range(flag[3]))) - sum((lambda .0: [ flag[25] for _ in .0 ])(range(242)))) + sum((lambda .0: [ flag[29] for _ in .0 ])(range(flag[29]))) + sum((lambda .0: [ flag[5] for _ in .0 ])(range(flag[5]))) - sum((lambda .0: [ flag[30] for _ in .0 ])(range(142))) - sum((lambda .0: [ flag[26] for _ in .0 ])(range(170))) - sum((lambda .0: [ flag[19] for _ in .0 ])(range(176)))) + sum((lambda .0: [ flag[0] for _ in .0 ])(range(flag[0]))) - sum((lambda .0: [ flag[27] for _ in .0 ])(range(168)))) + sum((lambda .0: [ flag[20] for _ in .0 ])(range(flag[20]))) - sum((lambda .0: [ flag[20] for _ in .0 ])(range(212)))) + sum((lambda .0: [ flag[21] for _ in .0 ])(range(flag[21]))) + sum((lambda .0: [ flag[6] for _ in .0 ])(range(flag[6]))) + sum((lambda .0: [ flag[18] for _ in .0 ])(range(flag[18]))) - sum((lambda .0: [ flag[18] for _ in .0 ])(range(178)))) + 297412 == 0:</span><br><span class="hljs-string">    print(&#x27;yes&#x27;)</span><br><span class="hljs-string">    return None</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-comment">#正则表达式中，]不需要转义啊。</span><br>pattern = <span class="hljs-string">r&quot;sum\(\(lambda .0: \[ flag\[(\d+)] for _ in .0 ]\)\(range\((\d+)\)\)\)&quot;</span><br><br>matches = re.findall(pattern, <span class="hljs-built_in">str</span>)<br><br>flag = [<span class="hljs-number">0</span>] * <span class="hljs-number">32</span><br><br><span class="hljs-keyword">for</span> <span class="hljs-keyword">match</span> <span class="hljs-keyword">in</span> matches:<br>    flag[<span class="hljs-built_in">int</span>(<span class="hljs-keyword">match</span>[<span class="hljs-number">0</span>])] = <span class="hljs-built_in">int</span>(<span class="hljs-keyword">match</span>[<span class="hljs-number">1</span>])//<span class="hljs-number">2</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(flag[i]), end=<span class="hljs-string">&#x27;&#x27;</span>)<br></code></pre></td></tr></table></figure><h1 id="舔狗四部曲–相逢已是上上签"><a href="#舔狗四部曲–相逢已是上上签" class="headerlink" title="舔狗四部曲–相逢已是上上签"></a>舔狗四部曲–相逢已是上上签</h1><p>​又是8086+DOS系列，IDA直接打开还不行。算了，乱七八糟的，直接看WP。</p><p>​有标志位被修改了，如下图，正常情况下，上面的红框应该是下面的PE头的地址，这里被改了，要改回0x100，也就是0001。之后就能IDA正常识别了。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2024/image-20250601115228908.png" alt="image-20250601115228908"></p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#z3破解key</span><br><span class="hljs-keyword">from</span> z3 <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># 定义变量，假设是整数</span><br>byte = [Int(<span class="hljs-string">f&#x27;byte_<span class="hljs-subst">&#123;i&#125;</span>&#x27;</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">6</span>)]<br><br>s = Solver()<br><br><span class="hljs-comment"># 变量范围假设：比如字节可打印字符范围(32~126)，或者0~255</span><br><span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> byte:<br>    s.add(b &gt;= <span class="hljs-number">32</span>, b &lt;= <span class="hljs-number">126</span>)<br><br><span class="hljs-comment"># 添加方程</span><br>s.add(<br>    <span class="hljs-number">532</span> * byte[<span class="hljs-number">5</span>] + <span class="hljs-number">829</span> * byte[<span class="hljs-number">4</span>] + <span class="hljs-number">258</span> * byte[<span class="hljs-number">3</span>] + <span class="hljs-number">811</span> * byte[<span class="hljs-number">2</span>] + <span class="hljs-number">997</span> * byte[<span class="hljs-number">1</span>] + <span class="hljs-number">593</span> * byte[<span class="hljs-number">0</span>] == <span class="hljs-number">292512</span>,<br>    <span class="hljs-number">576</span> * byte[<span class="hljs-number">5</span>] + <span class="hljs-number">695</span> * byte[<span class="hljs-number">4</span>] + <span class="hljs-number">602</span> * byte[<span class="hljs-number">3</span>] + <span class="hljs-number">328</span> * byte[<span class="hljs-number">2</span>] + <span class="hljs-number">686</span> * byte[<span class="hljs-number">1</span>] + <span class="hljs-number">605</span> * byte[<span class="hljs-number">0</span>] == <span class="hljs-number">254496</span>,<br>    <span class="hljs-number">580</span> * byte[<span class="hljs-number">5</span>] + <span class="hljs-number">448</span> * byte[<span class="hljs-number">4</span>] + <span class="hljs-number">756</span> * byte[<span class="hljs-number">3</span>] + <span class="hljs-number">449</span> * byte[<span class="hljs-number">2</span>] + <span class="hljs-number">512</span> * byte[<span class="hljs-number">1</span>] + <span class="hljs-number">373</span> * byte[<span class="hljs-number">0</span>] == <span class="hljs-number">222479</span>,<br>    <span class="hljs-number">597</span> * byte[<span class="hljs-number">5</span>] + <span class="hljs-number">855</span> * byte[<span class="hljs-number">4</span>] + <span class="hljs-number">971</span> * byte[<span class="hljs-number">3</span>] + <span class="hljs-number">422</span> * byte[<span class="hljs-number">2</span>] + <span class="hljs-number">635</span> * byte[<span class="hljs-number">1</span>] + <span class="hljs-number">560</span> * byte[<span class="hljs-number">0</span>] == <span class="hljs-number">295184</span>,<br>    <span class="hljs-number">524</span> * byte[<span class="hljs-number">5</span>] + <span class="hljs-number">324</span> * byte[<span class="hljs-number">4</span>] + <span class="hljs-number">925</span> * byte[<span class="hljs-number">3</span>] + <span class="hljs-number">388</span> * byte[<span class="hljs-number">2</span>] + <span class="hljs-number">507</span> * byte[<span class="hljs-number">1</span>] + <span class="hljs-number">717</span> * byte[<span class="hljs-number">0</span>] == <span class="hljs-number">251887</span>,<br>    <span class="hljs-number">414</span> * byte[<span class="hljs-number">5</span>] + <span class="hljs-number">495</span> * byte[<span class="hljs-number">4</span>] + <span class="hljs-number">518</span> * byte[<span class="hljs-number">3</span>] + <span class="hljs-number">884</span> * byte[<span class="hljs-number">2</span>] + <span class="hljs-number">368</span> * byte[<span class="hljs-number">1</span>] + <span class="hljs-number">312</span> * byte[<span class="hljs-number">0</span>] == <span class="hljs-number">211260</span><br>)<br><br><span class="hljs-keyword">if</span> s.check() == sat:<br>    model = s.model()<br>    solution = [model[b].as_long() <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> byte]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">6</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(solution[i]), end=<span class="hljs-string">&#x27;&#x27;</span>)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;No solution found.&quot;</span>)<br><span class="hljs-comment">#XYCTF!</span><br></code></pre></td></tr></table></figure><p>​这个币题有怪东西，脚本绝对有怪东西。今天就让我碰上了，真tm晦气。。</p><p>​下面是我照着WP改了一点能跑的脚本。</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//xxtea解密</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdint.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> DELTA 0x9E3779B9</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MX (((z ^ key[e ^ (p &amp; 5)]) + (y ^ sum)) ^ (((z <span class="hljs-string">&lt;&lt; 4) ^(y &gt;</span>&gt; 3)) + ((y <span class="hljs-string">&lt;&lt; 2) ^ (z &gt;</span>&gt; 5))))</span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">dexxtea</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> *v, <span class="hljs-type">int</span> n, <span class="hljs-type">char</span> *key)</span><br>&#123;<br>    <span class="hljs-type">uint32_t</span> e = <span class="hljs-number">0</span>;<br>    <span class="hljs-type">uint32_t</span> rounds = <span class="hljs-number">6</span> + <span class="hljs-number">52</span> / n;<br>    <span class="hljs-type">uint32_t</span> sum = DELTA * rounds;<br>    <span class="hljs-type">uint32_t</span> y = <span class="hljs-number">0</span>, z = <span class="hljs-number">0</span>;<br>    <span class="hljs-type">uint32_t</span> p;<br>    <span class="hljs-keyword">do</span>&#123;<br>        e = (sum &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">5</span>;<br>        <span class="hljs-keyword">for</span>(p=n<span class="hljs-number">-1</span>; p&gt;<span class="hljs-number">0</span>; p--)<br>        &#123;<br>            y = v[(p+<span class="hljs-number">1</span>)%n];     <span class="hljs-comment">//保存加密位的后一位</span><br>            z = v[(p<span class="hljs-number">-1</span>)%n];         <span class="hljs-comment">//保存加密位的前一位</span><br>            v[p] -= MX;<br>        &#125;<br>        y = v[(p+<span class="hljs-number">1</span>)%n];     <span class="hljs-comment">//保存加密位的后一位</span><br>        z = v[(p<span class="hljs-number">-1</span>)%n];         <span class="hljs-comment">//保存加密位的前一位</span><br>        v[p] -= MX;<br>        sum -= DELTA;<br>    &#125;<span class="hljs-keyword">while</span>(--rounds);<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">uint32_t</span> enc[<span class="hljs-number">8</span>] = &#123;<span class="hljs-number">0x66697271</span>,<span class="hljs-number">0x896E2285</span>,<span class="hljs-number">0xC5188C1B</span>,<span class="hljs-number">0x72BCFD03</span>,<span class="hljs-number">0x538011CA</span>,<span class="hljs-number">0x4DA146AC</span>,<span class="hljs-number">0x86630D6B</span>,<span class="hljs-number">0xF89797F0</span>&#125;;<br>    <span class="hljs-type">char</span> *key = <span class="hljs-string">&quot;XYCTF!&quot;</span>;<br>    dexxtea(enc, <span class="hljs-number">8</span>, key);<br>    <span class="hljs-type">char</span> *flag = (<span class="hljs-type">char</span>*)enc;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i &lt; <span class="hljs-number">32</span>;i++)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>,flag[i]);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>​第一个问题，看这个循环体的内容，上面能跑，下面就是错的。差别就在于p&#x3D;0的情况，是放在循环体内部，还是放在循环体外部了。结果详细信息分析，我得到一种可能解释：因为p是无符号32位整数，永远大于等于0，所以下面的情况应该是无限循环，在编译器优化的情况后，这个地方应该被识别出是无限循环，直接中断程序了，在for循环里面插入printf根本不输出啊。</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">do</span>&#123;<br>        e = (sum &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">5</span>;<br>        <span class="hljs-keyword">for</span>(p=n<span class="hljs-number">-1</span>; p&gt;<span class="hljs-number">0</span>; p--)<br>        &#123;<br>            y = v[(p+<span class="hljs-number">1</span>)%n];     <span class="hljs-comment">//保存加密位的后一位</span><br>            z = v[(p<span class="hljs-number">-1</span>)%n];         <span class="hljs-comment">//保存加密位的前一位</span><br>            v[p] -= MX;<br>        &#125;<br>        y = v[(p+<span class="hljs-number">1</span>)%n];     <span class="hljs-comment">//保存加密位的后一位</span><br>        z = v[(p<span class="hljs-number">-1</span>)%n];         <span class="hljs-comment">//保存加密位的前一位</span><br>        v[p] -= MX;<br>        sum -= DELTA;<br>&#125;<span class="hljs-keyword">while</span>(--rounds);<br>    <br>    <br><span class="hljs-keyword">do</span>&#123;<br>        e = (sum &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">5</span>;<br>        <span class="hljs-keyword">for</span>(p=n<span class="hljs-number">-1</span>; p&gt;=<span class="hljs-number">0</span>; p--)<br>        &#123;<br>            y = v[(p+<span class="hljs-number">1</span>)%n];     <span class="hljs-comment">//保存加密位的后一位</span><br>            z = v[(p<span class="hljs-number">-1</span>)%n];         <span class="hljs-comment">//保存加密位的前一位</span><br>            v[p] -= MX;<br>        &#125;<br>        sum -= DELTA;<br>&#125;<span class="hljs-keyword">while</span>(--rounds);<br></code></pre></td></tr></table></figure><p>​第二个问题来了，按照第一个能跑的版本，我将p的类型改为int型，为什么就又不行了？</p><p>​第二个问题也有了答案：看到这个参数z的代码<code>z = v[(p-1)%n];</code> 。无论p是有符号32位整数，还是无符号，<code>p-1（p=0）</code>在机器内的表示都是<code>FFFFFFFF</code>，通过格式化字符<code>%x</code>输出都是这样的。而分别通过<code>%d %u</code>输出，却是<code>-1</code>和<code>4294967295</code>。再看，<code>(p-1)%8</code>在通过<code>%08x</code>输出的时候却分别是<code>ffffffff</code> <code>00000007</code>，也就是说在有符号数中<code>-1%8=-1</code>。无符号数<code>FFFFFFFF</code>（<code>4294967295</code>）模8是等于7的。所以会导致z的取值时的索引值不一样。</p><p>​</p><p>​综上，总结出无符号数当索引值，要特殊处理等于0的情况；有符号数的模运算中，负数模正数还是负数。</p><h1 id="Trustme（APK）"><a href="#Trustme（APK）" class="headerlink" title="Trustme（APK）"></a>Trustme（APK）</h1><p>​又是apk，放一边。还是学习WP。</p><p>​这个倒是挺正常，可以使用JADX打开分析。MainActivity中有假的判断，对其进行解密出来得到用户名。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">rc4</span>(<span class="hljs-params">data: <span class="hljs-built_in">bytes</span>, key: <span class="hljs-built_in">bytes</span></span>) -&gt; <span class="hljs-built_in">bytes</span>:<br>    S = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>))<br>    j = <span class="hljs-number">0</span><br>    out = []<br><br>    <span class="hljs-comment"># KSA: Key Scheduling Algorithm</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>        j = (j + S[i] + key[i % <span class="hljs-built_in">len</span>(key)]) % <span class="hljs-number">256</span><br>        S[i], S[j] = S[j], S[i]<br><br>    <span class="hljs-comment"># PRGA: Pseudo-Random Generation Algorithm</span><br>    i = j = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> data:<br>        i = (i + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span><br>        j = (j + S[i]) % <span class="hljs-number">256</span><br>        S[i], S[j] = S[j], S[i]<br>        out.append(char ^ S[(S[i] + S[j]) % <span class="hljs-number">256</span>])<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(out)<br><br><span class="hljs-comment"># 输入密文（十六进制）和密钥</span><br>cipher_hex = <span class="hljs-string">&quot;5a3c46e0228b444decc7651c8a7ca93ba4cb35a46f7eb589bef4&quot;</span><br>cipher_bytes = <span class="hljs-built_in">bytes</span>.fromhex(cipher_hex)<br>key = <span class="hljs-string">b&quot;XYCTF&quot;</span><br><br><span class="hljs-comment"># 解密</span><br>plaintext_bytes = rc4(cipher_bytes, key)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;原文密码是:&quot;</span>, plaintext_bytes.decode())<br><span class="hljs-comment">#原文密码是: The Real username is admin</span><br></code></pre></td></tr></table></figure><p>​但是没有其他信息了，我们翻看到Proxy类，看到其中创建了一个新的shell.apk，是对class.dex中的数据进行提取操作的。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> struct<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">data: <span class="hljs-built_in">bytes</span></span>) -&gt; <span class="hljs-built_in">bytes</span>:<br>    <span class="hljs-comment"># 对每个字节异或 0xFF</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(b ^ <span class="hljs-number">0xFF</span> <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> data)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">split_payload_from_dex</span>(<span class="hljs-params">bArr: <span class="hljs-built_in">bytes</span>, apkFileName: <span class="hljs-built_in">str</span></span>):<br>    <span class="hljs-comment"># 取 dex 末尾4个字节，读取payload长度（int，4字节）</span><br>    readInt = struct.unpack(<span class="hljs-string">&quot;&gt;I&quot;</span>, bArr[-<span class="hljs-number">4</span>:])[<span class="hljs-number">0</span>]  <span class="hljs-comment"># 大端，跟Java默认DataInputStream.readInt一样</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Payload length: <span class="hljs-subst">&#123;readInt&#125;</span>&quot;</span>)<br><br>    <span class="hljs-comment"># 取出payload数据</span><br>    payload_encrypted = bArr[-<span class="hljs-number">4</span> - readInt : -<span class="hljs-number">4</span>]<br><br>    <span class="hljs-comment"># 解密</span><br>    payload_decrypted = decrypt(payload_encrypted)<br><br>    <span class="hljs-comment"># 写入解密后的 APK 文件</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(apkFileName, <span class="hljs-string">&quot;wb&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        f.write(payload_decrypted)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Decrypted payload saved to <span class="hljs-subst">&#123;apkFileName&#125;</span>&quot;</span>)<br><br><span class="hljs-comment"># 示例调用</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-comment"># 假设 dex.bin 是你整个 dex 文件</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">r&quot;F:\StudyFiles\CTF\Review_CTF\XYCTF2024\RE\Trustme\classes.dex&quot;</span>, <span class="hljs-string">&quot;rb&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        dex_bytes = f.read()<br><br>    split_payload_from_dex(dex_bytes, <span class="hljs-string">&quot;shell.apk&quot;</span>)<br></code></pre></td></tr></table></figure><p>​得到shell.apk后，看到了密文比对的逻辑，就是使用sql语句验证用户名和密码是否正确。但是，apk解压后得到的&#x2F;assets&#x2F;mydb.db文件是无法正常读取的，仔细读源码，看到MoveSQLiteUtil类中有创建db文件的方法，是对mydb.db文件异或0xff解密得到的。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">r&quot;F:\StudyFiles\CTF\Review_CTF\XYCTF2024\RE\Trustme\assets\mydb.db&quot;</span>, <span class="hljs-string">&quot;rb&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    data = f.read()<br>    new_data = <span class="hljs-built_in">bytearray</span>(data)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(data)):<br>        new_data[i] = data[i] ^ <span class="hljs-number">0xff</span><br><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">r&quot;F:\StudyFiles\CTF\Review_CTF\XYCTF2024\RE\Trustme\assets\mydb_decrypted.db&quot;</span>, <span class="hljs-string">&quot;wb&quot;</span>) <span class="hljs-keyword">as</span> f2:<br>        f2.write(new_data)<br></code></pre></td></tr></table></figure><p>​打开解密文件，就看到了flag。</p><p>​这题还有SQL注入漏洞，密码为<code>&#39; or 1=1 --</code>就能得到flag。</p><h1 id="馒头"><a href="#馒头" class="headerlink" title="馒头"></a>馒头</h1><p>​无壳，IDA打开，代码很清晰，考察的是<code>哈夫曼树</code>数据结构，好久之前学的数据结构了，现在都忘了，重新温习一下。看不懂啊，真的难。这题就认真分析一遍，完整写思路，当作是学习新知识了。</p><p>​通过学习，知道了IDA中通过<code>add type</code>自定义结构体，然后通过<code>Y</code>键修改反编译的函数参数类型为自定义的结构体指针，这样IDA就能自动识别了。</p><p>​先看结构初始化函数，这里哈夫曼树是通过<code>数组</code>保存的啊，而a1就是这个指向这个数组的指针，这个数组中的每个元素都是一个结构体，这里并不是指针数组，而是结构体数组。<code>(*a1)[i]</code>就是第i个节点，而其index就是其在原字符串中的下标。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2024/image-20250603135741772.png" alt="image-20250603135741772"></p><p>​看到create函数是构建哈夫曼树的。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2024/image-20250603140500857.png" alt="image-20250603140500857"></p><p>​看到check函数，这里很巧妙的对左叶子节点进行了值和下标的比对，而对右叶子节点只进行了下标的比对，这样就不必把所有flag的字符值全保存在变量中，显的太简单。同时也可以标注字符在flag中的位置。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2024/image-20250603140650890.png" alt="image-20250603140650890"></p><p>​理清逻辑后，我开始是手动解密，就像是下面这样，在手动操作的过程中我找到了规律。</p><p>​就是可打印字符的数字在32到126之间，那么从1到24的数字一定是表示下标的，并且由于哈夫曼树是满二叉树，即除叶子节点外的其他节点都有两个孩子节点。</p><p>​我举个例子，假设A有两个子节点，且都是叶子节点，左右孩子分别为B、C。那么扫描到A的时候，根据程序就会判断一下B的权值（字符值），然后递归进入到B节点，这时候又会比较一次下标值，然后从叶子节点B返回，接着到右叶子节点C，继续比较下标，然后返回到A的兄弟节点去比对。</p><p>​所以我们就可以根据循环数组的值，检测到下标，就可以利用前几位的权值计算出原字符串中该下标对于的ASCII码值是多少。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">data = [<span class="hljs-number">2270</span>, <span class="hljs-number">917</span>, <span class="hljs-number">446</span>, <span class="hljs-number">217</span>, <span class="hljs-number">106</span>, <span class="hljs-number">51</span>, <span class="hljs-number">20</span>, <span class="hljs-number">15</span>, <span class="hljs-number">17</span>, <span class="hljs-number">229</span>, <span class="hljs-number">114</span>, <span class="hljs-number">16</span>, <span class="hljs-number">11</span>, <span class="hljs-number">471</span>, <span class="hljs-number">233</span>, <span class="hljs-number">116</span>, <span class="hljs-number">14</span>, <span class="hljs-number">13</span>, <span class="hljs-number">238</span>, <span class="hljs-number">118</span>, <span class="hljs-number">12</span>, <span class="hljs-number">7</span>, <span class="hljs-number">1353</span>, <span class="hljs-number">557</span>, <span class="hljs-number">248</span>, <span class="hljs-number">123</span>, <span class="hljs-number">6</span>, <span class="hljs-number">24</span>, <span class="hljs-number">309</span>, <span class="hljs-number">137</span>, <span class="hljs-number">67</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">172</span>, <span class="hljs-number">84</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">796</span>, <span class="hljs-number">383</span>, <span class="hljs-number">186</span>, <span class="hljs-number">89</span>, <span class="hljs-number">2</span>, <span class="hljs-number">8</span>, <span class="hljs-number">197</span>, <span class="hljs-number">97</span>, <span class="hljs-number">48</span>, <span class="hljs-number">23</span>, <span class="hljs-number">10</span>, <span class="hljs-number">21</span>, <span class="hljs-number">413</span>, <span class="hljs-number">203</span>, <span class="hljs-number">101</span>, <span class="hljs-number">22</span>, <span class="hljs-number">9</span>, <span class="hljs-number">210</span>, <span class="hljs-number">104</span>, <span class="hljs-number">19</span>, <span class="hljs-number">18</span>]<br><br>flag = [<span class="hljs-number">0</span>] * <span class="hljs-number">25</span><br>flag[<span class="hljs-number">20</span>] = <span class="hljs-number">51</span><br>flag[<span class="hljs-number">15</span>] = <span class="hljs-number">106</span> -<span class="hljs-number">51</span><br>flag[<span class="hljs-number">17</span>] = <span class="hljs-number">217</span> - <span class="hljs-number">106</span><br>flag[<span class="hljs-number">16</span>] = <span class="hljs-number">114</span><br>flag[<span class="hljs-number">11</span>] = <span class="hljs-number">229</span> - <span class="hljs-number">114</span><br>flag[<span class="hljs-number">14</span>] = <span class="hljs-number">116</span><br>flag[<span class="hljs-number">13</span>] = <span class="hljs-number">233</span> - <span class="hljs-number">116</span><br>flag[<span class="hljs-number">12</span>] = <span class="hljs-number">118</span><br>flag[<span class="hljs-number">7</span>] = <span class="hljs-number">238</span> - <span class="hljs-number">118</span><br>flag[<span class="hljs-number">6</span>] = <span class="hljs-number">123</span><br>flag[<span class="hljs-number">24</span>] = <span class="hljs-number">248</span> - <span class="hljs-number">123</span><br>flag[<span class="hljs-number">3</span>] = <span class="hljs-number">67</span><br>flag[<span class="hljs-number">5</span>] = <span class="hljs-number">137</span> - <span class="hljs-number">67</span><br>flag[<span class="hljs-number">4</span>] = <span class="hljs-number">84</span><br>flag[<span class="hljs-number">1</span>] = <span class="hljs-number">172</span> - <span class="hljs-number">84</span><br>flag[<span class="hljs-number">2</span>] = <span class="hljs-number">89</span><br>flag[<span class="hljs-number">8</span>] = <span class="hljs-number">186</span> - <span class="hljs-number">89</span><br>flag[<span class="hljs-number">23</span>] = <span class="hljs-number">48</span><br>flag[<span class="hljs-number">10</span>] = <span class="hljs-number">97</span> - <span class="hljs-number">48</span><br>flag[<span class="hljs-number">21</span>] = <span class="hljs-number">197</span> - <span class="hljs-number">97</span><br>flag[<span class="hljs-number">22</span>] = <span class="hljs-number">101</span><br>flag[<span class="hljs-number">9</span>] = <span class="hljs-number">203</span> - <span class="hljs-number">101</span><br>flag[<span class="hljs-number">19</span>] = <span class="hljs-number">104</span><br>flag[<span class="hljs-number">18</span>] = <span class="hljs-number">210</span> - <span class="hljs-number">104</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">25</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(flag[i]), end=<span class="hljs-string">&#x27;&#x27;</span>)<br></code></pre></td></tr></table></figure><p>​下面是自动处理的脚本。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">data = [<span class="hljs-number">2270</span>, <span class="hljs-number">917</span>, <span class="hljs-number">446</span>, <span class="hljs-number">217</span>, <span class="hljs-number">106</span>, <span class="hljs-number">51</span>, <span class="hljs-number">20</span>, <span class="hljs-number">15</span>, <span class="hljs-number">17</span>, <span class="hljs-number">229</span>, <span class="hljs-number">114</span>, <span class="hljs-number">16</span>, <span class="hljs-number">11</span>, <span class="hljs-number">471</span>, <span class="hljs-number">233</span>, <span class="hljs-number">116</span>, <span class="hljs-number">14</span>, <span class="hljs-number">13</span>, <span class="hljs-number">238</span>, <span class="hljs-number">118</span>, <span class="hljs-number">12</span>, <span class="hljs-number">7</span>, <span class="hljs-number">1353</span>, <span class="hljs-number">557</span>, <span class="hljs-number">248</span>, <span class="hljs-number">123</span>, <span class="hljs-number">6</span>, <span class="hljs-number">24</span>, <span class="hljs-number">309</span>, <span class="hljs-number">137</span>, <span class="hljs-number">67</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">172</span>, <span class="hljs-number">84</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">796</span>, <span class="hljs-number">383</span>, <span class="hljs-number">186</span>, <span class="hljs-number">89</span>, <span class="hljs-number">2</span>, <span class="hljs-number">8</span>, <span class="hljs-number">197</span>, <span class="hljs-number">97</span>, <span class="hljs-number">48</span>, <span class="hljs-number">23</span>, <span class="hljs-number">10</span>, <span class="hljs-number">21</span>, <span class="hljs-number">413</span>, <span class="hljs-number">203</span>, <span class="hljs-number">101</span>, <span class="hljs-number">22</span>, <span class="hljs-number">9</span>, <span class="hljs-number">210</span>, <span class="hljs-number">104</span>, <span class="hljs-number">19</span>, <span class="hljs-number">18</span>]<br>flag = [<span class="hljs-number">0</span>] * <span class="hljs-number">25</span><br>i = <span class="hljs-number">0</span><br><span class="hljs-keyword">while</span> i &lt; <span class="hljs-built_in">len</span>(data):<br>    <span class="hljs-keyword">if</span> data[i] &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> data[i] &lt; <span class="hljs-number">25</span>:<br>        n = <span class="hljs-number">1</span><br>        tmp = i<br>        <span class="hljs-keyword">while</span> i &lt; <span class="hljs-built_in">len</span>(data) <span class="hljs-keyword">and</span> data[i] &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> data[i] &lt; <span class="hljs-number">25</span>:<br>            <span class="hljs-keyword">if</span> n == <span class="hljs-number">1</span>:<br>                flag[data[i]] = data[tmp-n]<br>            <span class="hljs-keyword">else</span>:<br>                flag[data[i]] = data[tmp-n] - data[tmp-n+<span class="hljs-number">1</span>]<br>            i += <span class="hljs-number">1</span><br>            n += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">else</span>:<br>        i += <span class="hljs-number">1</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">25</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(flag[i]), end=<span class="hljs-string">&#x27;&#x27;</span>)<br></code></pre></td></tr></table></figure><h1 id="What’s-this"><a href="#What’s-this" class="headerlink" title="What’s this"></a>What’s this</h1><p>​新东西，第一次碰见，文件头是<code>1B 4C 75 61 51</code>。节约时间，学习WP。</p><p>​Chatgpt的解释是：<code>1B 4C 75 61 51</code> 是一个 <strong>Lua字节码文件（编译后的Lua文件）的文件头</strong>，即不是普通的 <code>.lua</code> 源代码文件，而是已经编译成Lua虚拟机可执行的二进制文件。所以我们要反编译，看源代码。</p><p>​WP中给出了在线工具，我们上网站反编译好了。也是有幸接触到了一下LUA脚本，这是游戏开发非常流行的语言。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br>flag = <span class="hljs-string">&quot;==AeuFEcwxGPuJ0PBNzbC16ctFnPB5DPzI0bwx6bu9GQ2F1XOR1U&quot;</span><br>flag = flag.replace(<span class="hljs-string">&quot;6&quot;</span>, <span class="hljs-string">&quot;W&quot;</span>)<br>flag = flag.replace(<span class="hljs-string">&quot;4&quot;</span>, <span class="hljs-string">&quot;H&quot;</span>)<br>flag = flag.replace(<span class="hljs-string">&quot;3&quot;</span>, <span class="hljs-string">&quot;g&quot;</span>)<br>flag = flag[::-<span class="hljs-number">1</span>]<br>flag = base64.b64decode(flag).decode()<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(flag)):<br>    tmp = <span class="hljs-built_in">ord</span>(flag[i]) - <span class="hljs-number">3</span><br>    tmp = (tmp ^ <span class="hljs-number">8</span>) % <span class="hljs-number">256</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(tmp), end=<span class="hljs-string">&quot;&quot;</span>)<br></code></pre></td></tr></table></figure><h1 id="ez-rand"><a href="#ez-rand" class="headerlink" title="ez_rand"></a>ez_rand</h1><p>​又是垃圾题，思路很简单，爆破就行了，对应好参数类型。</p><p>​sb的WP中，直接rand()%255，无语了。tm的，我又一直爆破不出来，明明是照着变量类型抄的。连算式都是照着抄的。</p><p>​麻痹的，改了一下异或值的计算就好了，还忘了之前错的是什么样子的了，现在怎么改都是对的。真的是玄学，错误消失了，完全找不到之前错的是什么样子的了。</p><p>​无语逆天了，再也不想碰这个煞笔C语言了。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2024/image-20250601171908123.png" alt="image-20250601171908123"></p><figure class="highlight c++"><table><tr><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//别人的脚本</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cstdio&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cstdlib&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;ctime&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> cipher[<span class="hljs-number">50</span>] = &#123;<span class="hljs-number">0x5D</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0xEA</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0xFC</span>, <span class="hljs-number">0x34</span>,<span class="hljs-number">0xB2</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0x6E</span>, <span class="hljs-number">0xFB</span>, <span class="hljs-number">0xB4</span>, <span class="hljs-number">0xE8</span>, <span class="hljs-number">0xF2</span>, <span class="hljs-number">0xA9</span>, <span class="hljs-number">0x91</span>,<span class="hljs-number">0x12</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0xDB</span>, <span class="hljs-number">0x8E</span>, <span class="hljs-number">0xE9</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x4D</span>&#125;;<br><span class="hljs-type">int</span> v7;<br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">cmp</span><span class="hljs-params">(<span class="hljs-type">char</span> s[])</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">if</span>(<span class="hljs-built_in">strstr</span>(s,<span class="hljs-string">&quot;XYCTF&quot;</span>)||<span class="hljs-built_in">strstr</span>(s,<span class="hljs-string">&quot;flag&quot;</span>))<br>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br><span class="hljs-type">char</span> ans[<span class="hljs-number">50</span>];<br><span class="hljs-type">int</span> _round=<span class="hljs-number">-5</span>;<br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">for</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v4=<span class="hljs-number">0</span>;v4&lt;<span class="hljs-number">65536</span>;v4++)<br>&#123;<br><span class="hljs-built_in">srand</span>(v4);<br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">29</span>;i++)<br>&#123;<br>v7=<span class="hljs-built_in">rand</span>();<br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> temp=((<span class="hljs-number">2155905153</span>*<span class="hljs-number">1LL</span>*v7)&gt;&gt;<span class="hljs-number">32</span>);<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> num=v7+(<span class="hljs-type">int</span>)((temp&amp;<span class="hljs-number">0x80000000</span>)!=<span class="hljs-number">0</span>)+((<span class="hljs-type">int</span>)temp&gt;&gt;<span class="hljs-number">7</span>);<br>ans[i]=num^cipher[i];<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-built_in">cmp</span>(ans))<br>&#123;<br>_round=v4;<br><span class="hljs-keyword">break</span>;<br>&#125;<br>&#125;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s %d&quot;</span>,ans,_round);<br><span class="hljs-comment">//XYCTF&#123;R@nd_1s_S0_S0_S0_easy!&#125; 21308</span><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="舔狗四部曲–记忆的时光机"><a href="#舔狗四部曲–记忆的时光机" class="headerlink" title="舔狗四部曲–记忆的时光机"></a>舔狗四部曲–记忆的时光机</h1><p>​ok，高级的反编译，类似花指令一样的反编译方式。方法为先把要跳转的地址保存到寄存器上，然后通过寄存器跳转；或者搞个<code>endbr64</code>指令，影响反编译。</p><p>​直接学习WP。说是可以通过跳转表，修复反编译，但是没演示具体操作，对小白太不友好了。其他人也都是看汇编或者动调的，那就干吧，动调看看。</p><p>​首先一个cmp，长度检验，0x30，48位。然后每一位加密后和密文比对，48个字符全部相同就是成功。</p><p>​enc函数，首先有个xor变化值（i+6，i从0开始的），再xor固定值0x66，再减6，然后xor密文的对应位。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">enc = [<span class="hljs-number">105</span>, <span class="hljs-number">88</span>, <span class="hljs-number">97</span>, <span class="hljs-number">99</span>, <span class="hljs-number">103</span>, <span class="hljs-number">76</span>, <span class="hljs-number">77</span>, <span class="hljs-number">50</span>, <span class="hljs-number">152</span>, <span class="hljs-number">32</span>, <span class="hljs-number">77</span>, <span class="hljs-number">81</span>, <span class="hljs-number">123</span>, <span class="hljs-number">37</span>, <span class="hljs-number">117</span>, <span class="hljs-number">81</span>, <span class="hljs-number">163</span>, <span class="hljs-number">88</span>, <span class="hljs-number">96</span>, <span class="hljs-number">114</span>, <span class="hljs-number">66</span>, <span class="hljs-number">98</span>, <span class="hljs-number">103</span>, <span class="hljs-number">102</span>, <span class="hljs-number">55</span>, <span class="hljs-number">108</span>, <span class="hljs-number">48</span>, <span class="hljs-number">70</span>, <span class="hljs-number">102</span>, <span class="hljs-number">79</span>, <span class="hljs-number">93</span>, <span class="hljs-number">3</span>, <span class="hljs-number">93</span>, <span class="hljs-number">164</span>, <span class="hljs-number">102</span>, <span class="hljs-number">1</span>, <span class="hljs-number">67</span>, <span class="hljs-number">104</span>, <span class="hljs-number">125</span>, <span class="hljs-number">124</span>, <span class="hljs-number">85</span>, <span class="hljs-number">79</span>, <span class="hljs-number">122</span>, <span class="hljs-number">63</span>, <span class="hljs-number">108</span>, <span class="hljs-number">18</span>, <span class="hljs-number">33</span>, <span class="hljs-number">9</span>]<br>key = <span class="hljs-string">&quot;i_have_get_shell_but_where_is_you_my_dear_baby!!&quot;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(enc)):<br>    tmp = (enc[i] ^ <span class="hljs-built_in">ord</span>(key[i])) % <span class="hljs-number">256</span><br>    tmp = (tmp + <span class="hljs-number">6</span>) % <span class="hljs-number">256</span><br>    tmp = (tmp ^ <span class="hljs-number">0x66</span>) % <span class="hljs-number">256</span><br>    tmp = (tmp ^ (i+<span class="hljs-number">6</span>)) % <span class="hljs-number">256</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(tmp), end=<span class="hljs-string">&#x27;&#x27;</span>)<br></code></pre></td></tr></table></figure><p>​这题会动调其实很简单，只是反编译做做样子，有点吓人罢了。</p><h1 id="ez-cube"><a href="#ez-cube" class="headerlink" title="ez_cube"></a>ez_cube</h1><p>​IDA打开，真是个做魔方的题，还得有点空间想象力才行。初始状态如下。</p><p>​WP给出的在线网站，没办法做到限制旋转，就无法按照题目中的方式解出。可以使用python写一个求解脚本，只使用四种目标旋转，限制步数，BFS就是很可行的。</p><p>​但是我不想在这样一个非专业逆向的题目耗这么多时间，所以直接过了。附上别人的脚本。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2024/image-20250601205219843.png" alt="image-20250601205219843"></p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> tqdm<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">f</span>(<span class="hljs-params">x</span>):<br>A=[<span class="hljs-string">&quot;R&quot;</span>]*<span class="hljs-number">9</span><br>B=[<span class="hljs-string">&quot;B&quot;</span>]*<span class="hljs-number">9</span><br>C=[<span class="hljs-string">&quot;G&quot;</span>]*<span class="hljs-number">9</span><br>D=[<span class="hljs-string">&quot;O&quot;</span>]*<span class="hljs-number">9</span><br>E=[<span class="hljs-string">&quot;Y&quot;</span>]*<span class="hljs-number">9</span><br>F=[<span class="hljs-string">&quot;W&quot;</span>]*<span class="hljs-number">9</span><br>B[<span class="hljs-number">1</span>]=<span class="hljs-string">&#x27;R&#x27;</span><br>A[<span class="hljs-number">1</span>]=<span class="hljs-string">&#x27;G&#x27;</span><br>C[<span class="hljs-number">1</span>]=<span class="hljs-string">&#x27;B&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> x:<br><span class="hljs-keyword">if</span> i==<span class="hljs-string">&#x27;R&#x27;</span>:<br>v0 = A[<span class="hljs-number">2</span>]<br>v1 = A[<span class="hljs-number">5</span>]<br>v2 = A[<span class="hljs-number">8</span>]<br>A[<span class="hljs-number">2</span>] = F[<span class="hljs-number">2</span>]<br>A[<span class="hljs-number">5</span>] = F[<span class="hljs-number">5</span>]<br>A[<span class="hljs-number">8</span>] = F[<span class="hljs-number">8</span>]<br>F[<span class="hljs-number">2</span>] = D[<span class="hljs-number">6</span>]<br>F[<span class="hljs-number">5</span>] = D[<span class="hljs-number">3</span>]<br>F[<span class="hljs-number">8</span>] = D[<span class="hljs-number">0</span>]<br>D[<span class="hljs-number">0</span>] = E[<span class="hljs-number">8</span>]<br>D[<span class="hljs-number">3</span>] = E[<span class="hljs-number">5</span>]<br>D[<span class="hljs-number">6</span>] = E[<span class="hljs-number">2</span>]<br>E[<span class="hljs-number">2</span>] = v0<br>E[<span class="hljs-number">5</span>] = v1<br>E[<span class="hljs-number">8</span>] = v2<br>v3 = C[<span class="hljs-number">1</span>]<br>C[<span class="hljs-number">1</span>] = C[<span class="hljs-number">3</span>]<br>C[<span class="hljs-number">3</span>] = C[<span class="hljs-number">7</span>]<br>C[<span class="hljs-number">7</span>] = C[<span class="hljs-number">5</span>]<br>C[<span class="hljs-number">5</span>] = v3<br>v4 = C[<span class="hljs-number">0</span>]<br>C[<span class="hljs-number">0</span>] = C[<span class="hljs-number">6</span>]<br>C[<span class="hljs-number">6</span>] = C[<span class="hljs-number">8</span>]<br>C[<span class="hljs-number">8</span>] = C[<span class="hljs-number">2</span>]<br>C[<span class="hljs-number">2</span>] = v4<br><span class="hljs-keyword">if</span> i==<span class="hljs-string">&#x27;U&#x27;</span>:<br>v0 = A[<span class="hljs-number">0</span>]<br>v1 = A[<span class="hljs-number">1</span>]<br>v2 = A[<span class="hljs-number">2</span>]<br>A[<span class="hljs-number">0</span>] = C[<span class="hljs-number">0</span>]<br>A[<span class="hljs-number">1</span>] = C[<span class="hljs-number">1</span>]<br>A[<span class="hljs-number">2</span>] = C[<span class="hljs-number">2</span>]<br>C[<span class="hljs-number">0</span>] = D[<span class="hljs-number">0</span>]<br>C[<span class="hljs-number">1</span>] = D[<span class="hljs-number">1</span>]<br>C[<span class="hljs-number">2</span>] = D[<span class="hljs-number">2</span>]<br>D[<span class="hljs-number">0</span>] = B[<span class="hljs-number">0</span>]<br>D[<span class="hljs-number">1</span>] = B[<span class="hljs-number">1</span>]<br>D[<span class="hljs-number">2</span>] = B[<span class="hljs-number">2</span>]<br>B[<span class="hljs-number">0</span>] = v0<br>B[<span class="hljs-number">1</span>] = v1<br>B[<span class="hljs-number">2</span>] = v2<br>v3 = E[<span class="hljs-number">1</span>]<br>E[<span class="hljs-number">1</span>] = E[<span class="hljs-number">3</span>]<br>E[<span class="hljs-number">3</span>] = E[<span class="hljs-number">7</span>]<br>E[<span class="hljs-number">7</span>] = E[<span class="hljs-number">5</span>]<br>E[<span class="hljs-number">5</span>] = v3<br>v4 = E[<span class="hljs-number">0</span>]<br>E[<span class="hljs-number">0</span>] = E[<span class="hljs-number">6</span>]<br>E[<span class="hljs-number">6</span>] = E[<span class="hljs-number">8</span>]<br>E[<span class="hljs-number">8</span>] = E[<span class="hljs-number">2</span>]<br>E[<span class="hljs-number">2</span>] = v4<br><span class="hljs-keyword">if</span> i==<span class="hljs-string">&#x27;r&#x27;</span>:<br>v0 = A[<span class="hljs-number">2</span>]<br>v1 = A[<span class="hljs-number">5</span>]<br>v2 = A[<span class="hljs-number">8</span>]<br>A[<span class="hljs-number">2</span>] = E[<span class="hljs-number">2</span>]<br>A[<span class="hljs-number">5</span>] = E[<span class="hljs-number">5</span>]<br>A[<span class="hljs-number">8</span>] = E[<span class="hljs-number">8</span>]<br>E[<span class="hljs-number">2</span>] = D[<span class="hljs-number">6</span>]<br>E[<span class="hljs-number">5</span>] = D[<span class="hljs-number">3</span>]<br>E[<span class="hljs-number">8</span>] = D[<span class="hljs-number">0</span>]<br>D[<span class="hljs-number">0</span>] = F[<span class="hljs-number">8</span>]<br>D[<span class="hljs-number">3</span>] = F[<span class="hljs-number">5</span>]<br>D[<span class="hljs-number">6</span>] = F[<span class="hljs-number">2</span>]<br>F[<span class="hljs-number">2</span>] = v0<br>F[<span class="hljs-number">5</span>] = v1<br>F[<span class="hljs-number">8</span>] = v2<br>v3 = C[<span class="hljs-number">1</span>]<br>C[<span class="hljs-number">1</span>] = C[<span class="hljs-number">5</span>]<br>C[<span class="hljs-number">5</span>] = C[<span class="hljs-number">7</span>]<br>C[<span class="hljs-number">7</span>] = C[<span class="hljs-number">3</span>]<br>C[<span class="hljs-number">3</span>] = v3<br>v4 = C[<span class="hljs-number">0</span>]<br>C[<span class="hljs-number">0</span>] = C[<span class="hljs-number">2</span>]<br>C[<span class="hljs-number">2</span>] = C[<span class="hljs-number">8</span>]<br>C[<span class="hljs-number">8</span>] = C[<span class="hljs-number">6</span>]<br>C[<span class="hljs-number">6</span>] = v4<br><span class="hljs-keyword">if</span> i==<span class="hljs-string">&#x27;u&#x27;</span>:<br>v0 = A[<span class="hljs-number">0</span>]<br>v1 = A[<span class="hljs-number">1</span>]<br>v2 = A[<span class="hljs-number">2</span>]<br>A[<span class="hljs-number">0</span>] = B[<span class="hljs-number">0</span>]<br>A[<span class="hljs-number">1</span>] = B[<span class="hljs-number">1</span>]<br>A[<span class="hljs-number">2</span>] = B[<span class="hljs-number">2</span>]<br>B[<span class="hljs-number">0</span>] = D[<span class="hljs-number">0</span>]<br>B[<span class="hljs-number">1</span>] = D[<span class="hljs-number">1</span>]<br>B[<span class="hljs-number">2</span>] = D[<span class="hljs-number">2</span>]<br>D[<span class="hljs-number">0</span>] = C[<span class="hljs-number">0</span>]<br>D[<span class="hljs-number">1</span>] = C[<span class="hljs-number">1</span>]<br>D[<span class="hljs-number">2</span>] = C[<span class="hljs-number">2</span>]<br>C[<span class="hljs-number">0</span>] = v0<br>C[<span class="hljs-number">1</span>] = v1<br>C[<span class="hljs-number">2</span>] = v2<br>v3 = E[<span class="hljs-number">1</span>]<br>E[<span class="hljs-number">1</span>] = E[<span class="hljs-number">5</span>]<br>E[<span class="hljs-number">5</span>] = E[<span class="hljs-number">7</span>]<br>E[<span class="hljs-number">7</span>] = E[<span class="hljs-number">3</span>]<br>E[<span class="hljs-number">3</span>] = v3<br>v4 = E[<span class="hljs-number">0</span>]<br>E[<span class="hljs-number">0</span>] = E[<span class="hljs-number">2</span>]<br>E[<span class="hljs-number">2</span>] = E[<span class="hljs-number">8</span>]<br>E[<span class="hljs-number">8</span>] = E[<span class="hljs-number">6</span>]<br>E[<span class="hljs-number">6</span>] = v4<br><span class="hljs-keyword">if</span> A==[<span class="hljs-string">&quot;R&quot;</span>]*<span class="hljs-number">9</span> <span class="hljs-keyword">and</span> B==[<span class="hljs-string">&quot;B&quot;</span>]*<span class="hljs-number">9</span> <span class="hljs-keyword">and</span> C==[<span class="hljs-string">&quot;G&quot;</span>]*<span class="hljs-number">9</span> <span class="hljs-keyword">and</span> D==[<span class="hljs-string">&quot;O&quot;</span>]*<span class="hljs-number">9</span> <span class="hljs-keyword">and</span> E==[<span class="hljs-string">&quot;Y&quot;</span>]*<span class="hljs-number">9</span> <span class="hljs-keyword">and</span> F==[<span class="hljs-string">&quot;W&quot;</span>]*<span class="hljs-number">9</span>:<br><span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br><span class="hljs-keyword">else</span>:<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br><br>    <br>flag=[]<br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">13</span>):<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tqdm.tqdm(<span class="hljs-built_in">list</span>(product(<span class="hljs-string">&#x27;RUru&#x27;</span>,repeat=j))):<br>x=<span class="hljs-string">&#x27;&#x27;</span>.join(i)<br><span class="hljs-keyword">if</span> f(x):<br>flag.append(x)<br>[<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;flag&#123;%s&#125;&quot;</span>%x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> flag]<br></code></pre></td></tr></table></figure><h1 id="今夕是何年"><a href="#今夕是何年" class="headerlink" title="今夕是何年"></a>今夕是何年</h1><p>​IDA打开，哇，都反编译不了，第一次碰见这种，查壳还没有壳，又是RUST语言写的。</p><p>​学习WP，原来这是LoongArch架构的ELF二进制文件，我们需要一个LoongArch架构的环境来运行这个程序。</p><p>​按照WP的命令在kali上面下载好了qemu-user，命令为<code>sudo apt install qemu-user</code>。然后就可以直接运行main程序了。为什么这么便捷啊？</p><blockquote><p>背后的机制：<code>binfmt_misc</code></p><ul><li>Linux 有个内核功能叫做 <strong><code>binfmt_misc</code></strong>，它能让系统识别不同格式的可执行文件。</li><li>当你运行一个非本机架构的可执行文件时，内核通过 <code>binfmt_misc</code> 找到对应的解释器（比如 <code>qemu-arm</code>），自动调用它来运行程序。</li><li>这样你就感觉“直接运行，不用额外命令”，其实是系统帮你自动转发了。</li></ul></blockquote><p>​幸好有教程，不然我去网上找又得花大把时间，错误率还高，各种环境问题。</p><h1 id="Findme"><a href="#Findme" class="headerlink" title="Findme"></a>Findme</h1><p>​给了三个二进制文件，不知道是什么东西，DIE也查不出来。新东西，还是直接看WP。6，原来是有隐藏的，我还以为这几个文件是一样的东西，结果一看，文件<code>Doraemon1</code> <code>Doraemon2</code>确实比较迷，但是<code>Doraemon4</code>就是exe文件文件啊， 文件头就能看出来，还去掉了后缀名。</p><p>​先看exe程序，先是一个RC4类的KSA，初始化S盒并用密钥打乱，密钥为：<code>Find_Doraemon</code>。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2024/image-20250602111610021.png" alt="image-20250602111610021"></p><p>​然后是PRGA，伪随机数流加密。对Doraemon3文件读取字符，异或加密后写入Doraemon1文件，并且跟着若干个随机数。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2024/image-20250602111920780.png" alt="image-20250602111920780"></p><p>​所以我们对Doraemon1文件进行读取逆向处理就行，先造出S盒，然后再次异或即可，并且使用S盒中的数进行伪随机生成，去掉中间的若干字符后，到达下一个加密字符，直至文件读取完。</p><p>​我现在写代码的能力有点差，经常有遗忘的点，改起来花很多时间。还得练。</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span>  </span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><br>FILE *fp = <span class="hljs-literal">NULL</span>;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">KSA</span><span class="hljs-params">(<span class="hljs-type">uint8_t</span> *S, <span class="hljs-type">uint8_t</span> *K)</span><br>&#123;<br>    <span class="hljs-type">uint32_t</span> i;<br>    <span class="hljs-type">int</span> j = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>( i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">512</span>;i++)<br>    &#123;<br>        S[i] = -(<span class="hljs-type">char</span>)i;<br>    &#125;<br>    i = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span>(i&lt;<span class="hljs-number">512</span>)<br>    &#123;<br>        j = (K[i%<span class="hljs-number">13</span>] + S[i] + j) % <span class="hljs-number">512</span>;<br>        <span class="hljs-type">uint8_t</span> temp = S[i];<br>        S[i] = S[j];<br>        S[j] = temp;<br>        i++;<br>    &#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">PRGA</span><span class="hljs-params">(<span class="hljs-type">uint8_t</span> *S)</span><br>&#123;<br>    <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>, j = <span class="hljs-number">0</span>, v8=<span class="hljs-number">0</span> , v9 = <span class="hljs-number">0</span> ;<br>    <span class="hljs-type">uint8_t</span> temp, k;<br>    <span class="hljs-type">uint8_t</span> b;<br>    fp = fopen(<span class="hljs-string">&quot;F:\\StudyFiles\\CTF\\Review_CTF\\XYCTF2024\\RE\\Findme\\Doraemon1&quot;</span>, <span class="hljs-string">&quot;rb&quot;</span>);<br>    FILE *stream = fopen(<span class="hljs-string">&quot;./Doraemon3&quot;</span>,<span class="hljs-string">&quot;wb&quot;</span>);<br>    <span class="hljs-keyword">if</span> (fp == <span class="hljs-literal">NULL</span>) &#123;<br>        perror(<span class="hljs-string">&quot;Error opening file&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span>(stream == <span class="hljs-literal">NULL</span>) &#123;<br>        perror(<span class="hljs-string">&quot;Error opening file&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>    <span class="hljs-keyword">while</span>(!feof(fp))<br>    &#123;<br>        i = (i + <span class="hljs-number">1</span>) % <span class="hljs-number">512</span>;<br>        j = (S[i] + j) % <span class="hljs-number">512</span>;<br>        temp = S[i];<br>        S[i] = S[j];<br>        S[j] = temp;<br>        k = S[(<span class="hljs-type">uint8_t</span>)((S[i] + S[j]) % <span class="hljs-number">512</span>)];<br>        b = fgetc(fp);<br>        fputc(b^k, stream);<br>        srand(S[v8 %<span class="hljs-number">512</span>]);<br>        v9 = rand() % <span class="hljs-number">4</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> t=<span class="hljs-number">0</span>; t&lt;v9; t++)<br>        &#123;<br>            rand();<br>            fgetc(fp);<br>        &#125;<br>        v8++;<br>    &#125;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">char</span> *key = <span class="hljs-string">&quot;Find_Doraemon&quot;</span>;<br>    <span class="hljs-type">uint8_t</span> S[<span class="hljs-number">512</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br><br>    KSA(S, (<span class="hljs-type">uint8_t</span> *)key);<br>    PRGA(S);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>​得到3文件后，查看源码，是对2文件进行解密，但是要输入密钥。哈哈，完啦，没有直接的提示，又是脑洞，我没想到。看了WP才知道是<code>Doraemon</code>，看来我做题太多了，都有点迟钝了。</p><p>​得到的解密文件是一个gif图片，打开就得到了flag。</p><h1 id="舔狗四部曲–我的白月光"><a href="#舔狗四部曲–我的白月光" class="headerlink" title="舔狗四部曲–我的白月光"></a>舔狗四部曲–我的白月光</h1><p>​这个我真找不到了，动调和时光机一样的逻辑，一样的flag。但肯定不是这样的，但也没有debug检测，直接运行程序也是那样子的啊。有点迷了。</p><p>​看WP吧，草，原来是平台附件错了……。新的附件是chall.exe。</p><p>​运行程序得到第一段flag：<code>flag&#123;L0v3_</code>。</p><p>​这题C++写的，反编译有点不好看，主要是难以找到入手点，还是学习WP吧，增长经验。</p><p>​通过在提示信息前下断点，捕获到断点前面一直在操作的内存数据，提取出来得到这样的字符串，就有了第二段flag。</p><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">data = [<span class="hljs-number">112</span>, <span class="hljs-number">108</span>, <span class="hljs-number">101</span>, <span class="hljs-number">97</span>, <span class="hljs-number">115</span>, <span class="hljs-number">101</span>, <span class="hljs-number">32</span>, <span class="hljs-number">100</span>, <span class="hljs-number">111</span>, <span class="hljs-number">32</span>, <span class="hljs-number">110</span>, <span class="hljs-number">111</span>, <span class="hljs-number">116</span>, <span class="hljs-number">32</span>, <span class="hljs-number">116</span>, <span class="hljs-number">114</span>, <span class="hljs-number">121</span>, <span class="hljs-number">32</span>, <span class="hljs-number">116</span>, <span class="hljs-number">111</span>, <span class="hljs-number">32</span>, <span class="hljs-number">102</span>, <span class="hljs-number">105</span>, <span class="hljs-number">110</span>, <span class="hljs-number">100</span>, <span class="hljs-number">32</span>, <span class="hljs-number">104</span>, <span class="hljs-number">101</span>, <span class="hljs-number">114</span>, <span class="hljs-number">32</span>, <span class="hljs-number">115</span>, <span class="hljs-number">104</span>, <span class="hljs-number">101</span>, <span class="hljs-number">32</span>, <span class="hljs-number">100</span>, <span class="hljs-number">111</span>, <span class="hljs-number">32</span>, <span class="hljs-number">110</span>, <span class="hljs-number">111</span>, <span class="hljs-number">116</span>, <span class="hljs-number">32</span>, <span class="hljs-number">98</span>, <span class="hljs-number">101</span>, <span class="hljs-number">108</span>, <span class="hljs-number">111</span>, <span class="hljs-number">110</span>, <span class="hljs-number">103</span>, <span class="hljs-number">32</span>, <span class="hljs-number">116</span>, <span class="hljs-number">111</span>, <span class="hljs-number">32</span>, <span class="hljs-number">97</span>, <span class="hljs-number">103</span>, <span class="hljs-number">111</span>, <span class="hljs-number">32</span>, <span class="hljs-number">109</span>, <span class="hljs-number">101</span>, <span class="hljs-number">109</span>, <span class="hljs-number">111</span>, <span class="hljs-number">114</span>, <span class="hljs-number">105</span>, <span class="hljs-number">101</span>, <span class="hljs-number">115</span>, <span class="hljs-number">32</span>, <span class="hljs-number">105</span>, <span class="hljs-number">32</span>, <span class="hljs-number">119</span>, <span class="hljs-number">105</span>, <span class="hljs-number">108</span>, <span class="hljs-number">108</span>, <span class="hljs-number">32</span>, <span class="hljs-number">103</span>, <span class="hljs-number">105</span>, <span class="hljs-number">118</span>, <span class="hljs-number">101</span>, <span class="hljs-number">32</span>, <span class="hljs-number">121</span>, <span class="hljs-number">111</span>, <span class="hljs-number">117</span>, <span class="hljs-number">32</span>, <span class="hljs-number">115</span>, <span class="hljs-number">111</span>, <span class="hljs-number">109</span>, <span class="hljs-number">101</span>, <span class="hljs-number">32</span>, <span class="hljs-number">102</span>, <span class="hljs-number">108</span>, <span class="hljs-number">97</span>, <span class="hljs-number">103</span>, <span class="hljs-number">115</span>, <span class="hljs-number">58</span>, <span class="hljs-number">105</span>, <span class="hljs-number">56</span>, <span class="hljs-number">95</span>, <span class="hljs-number">97</span>, <span class="hljs-number">95</span>, <span class="hljs-number">107</span>, <span class="hljs-number">51</span>, <span class="hljs-number">121</span>, <span class="hljs-number">95</span>, <span class="hljs-number">97</span>, <span class="hljs-number">110</span>, <span class="hljs-number">100</span>, <span class="hljs-number">32</span>, <span class="hljs-number">110</span>, <span class="hljs-number">111</span>, <span class="hljs-number">119</span>, <span class="hljs-number">32</span>, <span class="hljs-number">103</span>, <span class="hljs-number">111</span>, <span class="hljs-number">32</span>, <span class="hljs-number">98</span>, <span class="hljs-number">97</span>, <span class="hljs-number">99</span>, <span class="hljs-number">107</span>, <span class="hljs-number">32</span>, <span class="hljs-number">112</span>, <span class="hljs-number">108</span>, <span class="hljs-number">101</span>, <span class="hljs-number">97</span>, <span class="hljs-number">115</span>, <span class="hljs-number">101</span>, <span class="hljs-number">33</span>]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(data)):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(data[i]), end=<span class="hljs-string">&#x27;&#x27;</span>)<br></code></pre></td></tr></table></figure><p><code>please do not try to find her she do not belong to ago memories i will give you some flags:i8_a_k3y_and now go back please!</code></p><p>​程序这个地方原本是Hook掉了Message函数，导致我们一直在循环看弹窗。要把这里nop掉。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2024/image-20250602165959876.png" alt="image-20250602165959876"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2024/image-20250602170024249.png" alt="image-20250602170024249"></p><p>​然后调试的时候，这里v24很大，导致我们循环半天，要手动改标志位跳出。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2024/image-20250602170144586.png" alt="image-20250602170144586"></p><p>​再看下面1290函数是加密部分，加密数据是程序写好的（当然是错的），所以没有用户输入的地方。下面就是字符串比对，然后弹出提示信息。所以可以猜出这个就是密文，我们要对加密算法逆向。<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2024/image-20250602170236930.png" alt="image-20250602170236930"></p><p>​加密函数里面有一个自定义的base64（反编译根本看不出来啊，只能靠看汇编和动态调试看），其算法是对于三位一组的ABC，其密文分别是base[A&amp;0x3f]、base[((B&amp;0xf)&lt;&lt;2)|(A&gt;&gt;6)&amp;3]、base[(B&gt;&gt;4)&amp;0xf | (C&amp;3)&lt;&lt;4]、base[(C&gt;&gt;2)0x3f]。</p><blockquote><p>​相当于对原字符ABC，其都有八位。加密时是：</p><p>第一位对应：A[6] A[5] A[4] A[3] A[2] A[1]</p><p>第二位对应：B[4] B[3] B[2] B[1] A[8] A[7]</p><p>第三位对应：C[2] C[1] B[8] B[7] B[6] B[5]</p><p>第四位对应：C[8] C[7] C[6] C[5] C[4] C[3]</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">decode_custom_base64</span>(<span class="hljs-params">data: <span class="hljs-built_in">str</span>, base: <span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span>) -&gt; <span class="hljs-built_in">bytes</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    自定义 Base64 解码函数，返回解码后的字节串。</span><br><span class="hljs-string"></span><br><span class="hljs-string">    规则对应：</span><br><span class="hljs-string">    - 输入4个字符一组，映射到3个字节ABC</span><br><span class="hljs-string">    - 解码算法根据你给出的对应关系逆向实现</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    decoded_bytes = <span class="hljs-built_in">bytearray</span>()<br>    base_index = &#123;ch: i <span class="hljs-keyword">for</span> i, ch <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(base)&#125;<br><br>    length = <span class="hljs-built_in">len</span>(data)<br>    i = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> i &lt; length:<br>        <span class="hljs-comment"># 取4个字符，填充为&#x27;=&#x27;后面补0</span><br>        chunk = data[i:i+<span class="hljs-number">4</span>]<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(chunk) &lt; <span class="hljs-number">4</span>:<br>            chunk += <span class="hljs-string">&#x27;=&#x27;</span> * (<span class="hljs-number">4</span> - <span class="hljs-built_in">len</span>(chunk))<br><br>        vals = []<br>        <span class="hljs-keyword">for</span> ch <span class="hljs-keyword">in</span> chunk:<br>            <span class="hljs-keyword">if</span> ch == <span class="hljs-string">&#x27;=&#x27;</span>:<br>                vals.append(<span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">else</span>:<br>                vals.append(base_index[ch])<br><br>        <span class="hljs-comment"># 根据编码规则，逆推 ABC 三字节：</span><br>        <span class="hljs-comment"># 设编码字符对应的6位数分别是v0,v1,v2,v3</span><br>        v0, v1, v2, v3 = vals<br><br>        <span class="hljs-comment"># 解码公式（反推你给出的编码方式）：</span><br>        A = (v0 &amp; <span class="hljs-number">0x3F</span>) | ((v1 &amp; <span class="hljs-number">0x03</span>) &lt;&lt; <span class="hljs-number">6</span>)<br>        B = ((v1 &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">0x0F</span>) | ((v2 &amp; <span class="hljs-number">0x0F</span>) &lt;&lt; <span class="hljs-number">4</span>)<br>        C = ((v2 &gt;&gt; <span class="hljs-number">4</span>) &amp; <span class="hljs-number">0x03</span>) | ((v3 &amp; <span class="hljs-number">0x3F</span>) &lt;&lt; <span class="hljs-number">2</span>)<br><br>        decoded_bytes.append(A)<br>        <span class="hljs-keyword">if</span> chunk[<span class="hljs-number">2</span>] != <span class="hljs-string">&#x27;=&#x27;</span>:<br>            decoded_bytes.append(B)<br>        <span class="hljs-keyword">if</span> chunk[<span class="hljs-number">3</span>] != <span class="hljs-string">&#x27;=&#x27;</span>:<br>            decoded_bytes.append(C)<br><br>        i += <span class="hljs-number">4</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(decoded_bytes)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decode_custom_base64_to_str</span>(<span class="hljs-params">data: <span class="hljs-built_in">str</span>, base: <span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    调用自定义解码函数，将结果转换为字符串。</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    decoded_bytes = decode_custom_base64(data, base)<br>    <span class="hljs-keyword">return</span> decoded_bytes.decode(encoding, errors=<span class="hljs-string">&#x27;ignore&#x27;</span>)<br><br><br><span class="hljs-comment"># 示例</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    custom_base = <span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span><br>    encoded = <span class="hljs-string">&quot;1YmNkZTN2QmNmdjM3kTNmZTZ2UzN2YTN3ITNmZzN2YWNmZDN2YmNlZTN1YmN2YTO2UmNxYzY2M2N5UjZ3QjN4YTM2UmNidTO2Y2N1UjZ3gjN5YTM2Y2N3YTM2UmN3cDN2YmNlZzN3gzN1YTN3QG=&quot;</span>  <br>    decoded = decode_custom_base64_to_str(encoded, custom_base)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(decoded), <span class="hljs-number">2</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(decoded[i:i+<span class="hljs-number">2</span>], <span class="hljs-number">16</span>)), end=<span class="hljs-string">&#x27;&#x27;</span>)<br>        <br>   <span class="hljs-comment">#_memory_never_go_done_finally_thankyou_xiaowangtongxue&#125;</span><br></code></pre></td></tr></table></figure><p>合在一起就是flag{L0v3_i8_a_k3y_and_memory_never_go_done_finally_thankyou_xiaowangtongxue}</p><p>​最后动调看一看故事最后的结局，看一看作者最后的感悟。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/XYCTF2024/image-20250602170833655.png" alt="image-20250602170833655"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;聪明的信使&quot;&gt;&lt;a href=&quot;#聪明的信使&quot; class=&quot;headerlink&quot; title=&quot;聪明的信使&quot;&gt;&lt;/a&gt;聪明的信使&lt;/h1&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;</summary>
      
    
    
    
    <category term="CTF" scheme="http://bumak.github.io/categories/CTF/"/>
    
    
    <category term="Reverse" scheme="http://bumak.github.io/tags/Reverse/"/>
    
    <category term="复现WP" scheme="http://bumak.github.io/tags/%E5%A4%8D%E7%8E%B0WP/"/>
    
  </entry>
  
  <entry>
    <title>初识Unicorn</title>
    <link href="http://bumak.github.io/2025/06/29/XYCTF2025/%E5%88%9D%E8%AF%86Unicorn/"/>
    <id>http://bumak.github.io/2025/06/29/XYCTF2025/%E5%88%9D%E8%AF%86Unicorn/</id>
    <published>2025-06-29T02:13:21.120Z</published>
    <updated>2025-07-01T06:16:05.943Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Unicorn框架"><a href="#Unicorn框架" class="headerlink" title="Unicorn框架"></a>Unicorn框架</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>​环境搭建教程可以看XYCTF2025中的ezVM，只有ubuntu虚拟机版本的，有python语言、C++语言和C语言版本。</p><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>​<strong>unicorn</strong>是一个跨平台、轻量级的CPU指令集仿真框架，用于模仿CPU指令执行过程，不需要真实硬件或完整操作系统支持。Unicorn 是由著名的逆向工具 QEMU 的代码衍生而来，但封装成了一个简单的库，支持多语言调用，重点在于模拟 CPU 执行而不是完整系统虚拟化。</p><p>​支持框架。</p><table><thead><tr><th>架构名称</th><th>说明</th></tr></thead><tbody><tr><td>x86</td><td>32位架构</td></tr><tr><td>x86_64</td><td>64位架构（amd64）</td></tr><tr><td>ARM</td><td>32位 ARM 架构</td></tr><tr><td>ARM64</td><td>64位 ARM 架构（AArch64）</td></tr><tr><td>MIPS</td><td>包括 MIPS32 和 MIPS64</td></tr><tr><td>PowerPC</td><td>Power 架构的一部分</td></tr><tr><td>SPARC</td><td>较少使用，但支持</td></tr><tr><td>RISC-V</td><td>较新的开源架构</td></tr></tbody></table><p>​</p><blockquote><p>​Unicorn 主要包括以下模块：</p><ol><li><strong>内存管理（Memory Map）</strong>：映射程序运行所需的地址空间</li><li><strong>寄存器接口</strong>：设置或读取虚拟 CPU 的寄存器值</li><li><strong>仿真器接口（Emulator）</strong>：控制执行开始&#x2F;停止&#x2F;步进等</li><li><strong>钩子机制（Hooks）</strong>：用户可插入回调，拦截指令、内存、异常事件</li><li><strong>错误处理与状态码</strong></li></ol></blockquote><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//使用流程，以C、C++为例</span><br>uc_engine *uc;<br>uc_open(UC_ARCH_X86, UC_MODE_32, &amp;uc);<br>uc_mem_map(uc, addr, size, UC_PROT_ALL);<br>uc_mem_write(uc, addr, code, code_size);<br>uc_reg_write(uc, UC_X86_REG_EIP, &amp;addr);<br>uc_emu_start(uc, addr, addr + code_size, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>uc_reg_read(uc, UC_X86_REG_EAX, &amp;result);<br>uc_close(uc);<br><br><br><br>uc_open(...)         <span class="hljs-comment">// 初始化引擎</span><br>uc_mem_map(...)      <span class="hljs-comment">// 分配模拟内存</span><br>uc_mem_write(...)    <span class="hljs-comment">// 写入指令或数据</span><br>uc_reg_write(...)    <span class="hljs-comment">// 设置寄存器状态</span><br>uc_emu_start(...)    <span class="hljs-comment">// 启动模拟执行</span><br>uc_reg_read(...)     <span class="hljs-comment">// 读取寄存器结果</span><br>uc_close(...)        <span class="hljs-comment">// 关闭引擎释放资源</span><br></code></pre></td></tr></table></figure><h3 id="主要函数"><a href="#主要函数" class="headerlink" title="主要函数"></a>主要函数</h3><p>​<code>uc_err uc_open(uc_arch arch, uc_mode mode, uc_engine **uc);</code></p><p>​<strong>功能</strong>：初始化Unicorn引擎。</p><p>​<strong>参数</strong>：arch——架构类型，mode——模式，如32位、64位，uc——输出参数，指向新创建的引擎句柄。</p><p>​<strong>返回值</strong>：错误码（<code>UC_ERR_OK</code> 表示成功）</p><p>​</p><p>​<code>uc_err uc_close(uc_engine *uc);</code></p><p>​<strong>功能</strong>：关闭并且释放Unicorn资源。</p><p>​<strong>参数</strong>：引擎句柄。</p><p>​<strong>返回值</strong>：错误码。</p><p>​</p><p>​<code>uc_err uc_mem_map(uc_engine *uc, uint64_t address, size_t size, uint32_t perms);</code></p><p>​<strong>功能</strong>：给模拟器分配一块内存。</p><p>​<strong>参数</strong>：address——虚拟内存起始地址，size——映射大小，perms——内存权限标志，如<strong>UC_PROT_READ | UC_PROT_WRITE | UC_PROT_EXEC</strong>。</p><p>​<strong>返回值</strong>：错误码。</p><p>​<strong>注解</strong>：模拟器执行代码和读写数据的内存都需要先映射。</p><p>​<code>uc_err uc_mem_write(uc_engine *uc, uint64_t address, const void *buffer, size_t size);</code></p><p>​<strong>功能</strong>：往模拟内存写数据（代码或变量）。</p><p>​<strong>参数</strong>：addess——写入内存的起始地址，buffer——数据缓冲区，待写入数据的地址，size——数据长度。</p><p>​<strong>注解</strong>：常用来写入机器码或模拟数据。</p><p>​<code>uc_err uc_mem_read(uc_engine *uc, uint64_t address, void *buffer, size_t size);</code></p><p>​<strong>功能</strong>：从模拟内存读取数据。</p><p>​<strong>参数</strong>：同 uc_mem_write，但 buffer 用来存放读出的数据</p><p>​<strong>注解</strong>：执行后读取内存中状态，或者获得计算结果。</p><p>​<code>uc_err uc_reg_write(uc_engine *uc, int regid, const void *value);</code></p><p>​<strong>功能</strong>：设置模拟 CPU 寄存器的值。</p><p>​<strong>参数</strong>：regid——寄存器 ID，如 <code>UC_X86_REG_EAX</code>，value——指向包含寄存器值的变量的指针（传待传数据的地址）。</p><p>​<strong>注解</strong>：启动执行前设置寄存器状态，如程序计数器（PC）、堆栈指针（SP）等。</p><p>​<code>uc_err uc_reg_read(uc_engine *uc, int regid, void *value);</code></p><p>​<strong>功能</strong>：读取模拟 CPU 寄存器的值。</p><p>​<strong>参数</strong>：类似 <code>uc_reg_write</code>，将寄存器值写入 <code>value</code> 指向的变量。</p><p>​<strong>注解</strong>：执行完毕后读取寄存器状态，查看结果或下一步执行地址。</p><p>​<code>uc_err uc_emu_start(uc_engine *uc, uint64_t begin, uint64_t until, uint64_t timeout, uint64_t count);</code></p><p>​<strong>功能</strong>：启动仿真执行，从 <code>begin</code> 地址开始执行，直到 <code>until</code> 停止</p><p>​<strong>参数</strong>：begin——代码入口地址。until——结束地址（可设置为0表示无限执行直到出错）。timeout——超时时间（微秒），0 表示不限制。count——最大执行指令数，0 表示不限制。</p><p>​<strong>注解</strong>：这是执行指令的核心函数。</p><p>​Hook 注册函数<strong>uc_hook_add</strong>：添加钩子，拦截指令执行、内存读写、异常等事件。</p><p>​<code>hook_code_callback</code> 是用户自定义函数，会在指定范围内每条指令执行时调用。</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c">uc_hook trace;<br>uc_hook_add(uc, &amp;trace, UC_HOOK_CODE, hook_code_callback, <span class="hljs-literal">NULL</span>, ADDRESS, ADDRESS + size);<br></code></pre></td></tr></table></figure><p>​错误码说明：<code>UC_ERR_OK</code> &#x3D; 0，成功，其它如 <code>UC_ERR_WRITE_UNMAPPED</code>、<code>UC_ERR_READ_UNMAPPED</code> 表示内存访问错误</p><p>使用 <code>uc_strerror(err)</code> 可获取错误信息字符串。</p><h2 id="简单使用示例"><a href="#简单使用示例" class="headerlink" title="简单使用示例"></a>简单使用示例</h2><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">先导入环境变量，不想每次都操作可以写入家目录的.bashrc中。<br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$LD_LIBRARY_PATH</span>:/home/ubuntu/desk/unicorn/build<br><br>编译命令示例如下，自行修改源文件路径、include路径和build路径。（注意，最好不要用中文路径，若有报错可以检查这个点）<br><br>gcc -o <span class="hljs-built_in">test</span> /home/ubuntu/desk/test.cpp -I /home/ubuntu/unicorn/include/ -L /home/ubuntu/unicorn/build -l unicorn<br></code></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unicorn/unicorn.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ADDRESS 0x1000</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> DATA_ADDR 0x2000<span class="hljs-comment">//最好定义为变量类型，uint32_t</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> CODE_SIZE 0x1000</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_LEN 64</span><br><br><span class="hljs-comment">// x86 32位代码，实现异或加密：</span><br><span class="hljs-comment">// esi 指向输入，ecx 长度</span><br><span class="hljs-comment">// 遍历输入字节，对每字节异或0x55</span><br><span class="hljs-comment">// 返回时修改内存中内容为加密结果</span><br><span class="hljs-type">const</span> <span class="hljs-type">uint8_t</span> CODE[] = &#123;<br>    <span class="hljs-number">0x31</span>, <span class="hljs-number">0xC0</span>,             <span class="hljs-comment">// xor eax, eax</span><br>    <span class="hljs-number">0x31</span>, <span class="hljs-number">0xD2</span>,             <span class="hljs-comment">// xor edx, edx</span><br>    <span class="hljs-comment">// loop_start:</span><br>    <span class="hljs-number">0x8A</span>, <span class="hljs-number">0x06</span>,             <span class="hljs-comment">// mov al, byte ptr [esi]</span><br>    <span class="hljs-number">0x80</span>, <span class="hljs-number">0xF0</span>, <span class="hljs-number">0x55</span>,       <span class="hljs-comment">// xor al, 0x55</span><br>    <span class="hljs-number">0x88</span>, <span class="hljs-number">0x06</span>,             <span class="hljs-comment">// mov byte ptr [esi], al</span><br>    <span class="hljs-number">0x46</span>,                   <span class="hljs-comment">// inc esi</span><br>    <span class="hljs-number">0x42</span>,                   <span class="hljs-comment">// inc edx</span><br>    <span class="hljs-number">0x49</span>,                   <span class="hljs-comment">// dec ecx</span><br>    <span class="hljs-number">0x75</span>, <span class="hljs-number">0xF5</span>,             <span class="hljs-comment">// jne loop_start</span><br>    <span class="hljs-number">0xC3</span>                    <span class="hljs-comment">// ret</span><br>&#125;;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>    uc_engine *uc;<br>    uc_err err;<br><br>    <span class="hljs-type">char</span> input[MAX_LEN];<br>    <span class="hljs-type">const</span> <span class="hljs-type">char</span> encrypted_flag[] = &#123;<br>        <span class="hljs-string">&#x27;C&#x27;</span> ^ <span class="hljs-number">0x55</span>, <span class="hljs-string">&#x27;T&#x27;</span> ^ <span class="hljs-number">0x55</span>, <span class="hljs-string">&#x27;F&#x27;</span> ^ <span class="hljs-number">0x55</span>, <span class="hljs-string">&#x27;&#123;&#x27;</span> ^ <span class="hljs-number">0x55</span>, <span class="hljs-string">&#x27;s&#x27;</span> ^ <span class="hljs-number">0x55</span>, <span class="hljs-string">&#x27;e&#x27;</span> ^ <span class="hljs-number">0x55</span>,<br>        <span class="hljs-string">&#x27;c&#x27;</span> ^ <span class="hljs-number">0x55</span>, <span class="hljs-string">&#x27;r&#x27;</span> ^ <span class="hljs-number">0x55</span>, <span class="hljs-string">&#x27;e&#x27;</span> ^ <span class="hljs-number">0x55</span>, <span class="hljs-string">&#x27;t&#x27;</span> ^ <span class="hljs-number">0x55</span>, <span class="hljs-string">&#x27;_&#x27;</span> ^ <span class="hljs-number">0x55</span>, <span class="hljs-string">&#x27;f&#x27;</span> ^ <span class="hljs-number">0x55</span>,<br>        <span class="hljs-string">&#x27;l&#x27;</span> ^ <span class="hljs-number">0x55</span>, <span class="hljs-string">&#x27;a&#x27;</span> ^ <span class="hljs-number">0x55</span>, <span class="hljs-string">&#x27;g&#x27;</span> ^ <span class="hljs-number">0x55</span>, <span class="hljs-string">&#x27;&#125;&#x27;</span> ^ <span class="hljs-number">0x55</span>, <span class="hljs-string">&#x27;\0&#x27;</span><br>    &#125;;<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Enter flag: &quot;</span>);<br>    <span class="hljs-keyword">if</span> (!fgets(input, <span class="hljs-keyword">sizeof</span>(input), <span class="hljs-built_in">stdin</span>)) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Input error\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br>    <span class="hljs-type">size_t</span> len = <span class="hljs-built_in">strlen</span>(input);<br>    <span class="hljs-keyword">if</span> (len &gt; <span class="hljs-number">0</span> &amp;&amp; input[len - <span class="hljs-number">1</span>] == <span class="hljs-string">&#x27;\n&#x27;</span>) &#123;<br>        input[len - <span class="hljs-number">1</span>] = <span class="hljs-string">&#x27;\0&#x27;</span>;<br>        len--;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (len != <span class="hljs-built_in">strlen</span>(encrypted_flag)) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Flag verification failed.\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 初始化 Unicorn</span><br>    err = uc_open(UC_ARCH_X86, UC_MODE_32, &amp;uc);<br>    <span class="hljs-keyword">if</span> (err) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Failed to initialize Unicorn engine: %u\n&quot;</span>, err);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 分配内存，写入代码和数据</span><br>    uc_mem_map(uc, ADDRESS, CODE_SIZE, UC_PROT_ALL);<br>    uc_mem_write(uc, ADDRESS, CODE, <span class="hljs-keyword">sizeof</span>(CODE));<br><br>    uc_mem_map(uc, DATA_ADDR, CODE_SIZE, UC_PROT_ALL);<br>    uc_mem_write(uc, DATA_ADDR, input, len);<br><br>    <span class="hljs-comment">// 设置寄存器</span><br>    uc_reg_write(uc, UC_X86_REG_ESI, DATA_ADDR);<span class="hljs-comment">//最好传入指针&amp;DATA_ADDR，前提是改为变量类型了</span><br>    uc_reg_write(uc, UC_X86_REG_ECX, len);<span class="hljs-comment">//最好传入&amp;len</span><br><br>    <span class="hljs-comment">// 执行代码（加密）</span><br>    err = uc_emu_start(uc, ADDRESS, ADDRESS + <span class="hljs-keyword">sizeof</span>(CODE), <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">if</span> (err) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Failed to emulate code: %u\n&quot;</span>, err);<br>        uc_close(uc);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 读取加密后的数据</span><br>    <span class="hljs-type">char</span> encrypted_input[MAX_LEN] = &#123;<span class="hljs-number">0</span>&#125;;<br>    uc_mem_read(uc, DATA_ADDR, encrypted_input, len);<br><br>    <span class="hljs-comment">// 比对</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">memcmp</span>(encrypted_input, encrypted_flag, len) == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Flag verified successfully!\n&quot;</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Flag verification failed.\n&quot;</span>);<br>    &#125;<br><br>    uc_close(uc);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="相关文章链接"><a href="#相关文章链接" class="headerlink" title="相关文章链接"></a>相关文章链接</h2><p>​<a href="https://www.cnblogs.com/Here-is-SG/p/17080180.html">博客园</a>、<a href="https://github.com/unicorn-engine/unicorn">Unicorn项目</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Unicorn框架&quot;&gt;&lt;a href=&quot;#Unicorn框架&quot; class=&quot;headerlink&quot; title=&quot;Unicorn框架&quot;&gt;&lt;/a&gt;Unicorn框架&lt;/h1&gt;&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; </summary>
      
    
    
    
    <category term="Reverse" scheme="http://bumak.github.io/categories/Reverse/"/>
    
    
    <category term="Reverse" scheme="http://bumak.github.io/tags/Reverse/"/>
    
    <category term="技术学习" scheme="http://bumak.github.io/tags/%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>OpenGL初学习</title>
    <link href="http://bumak.github.io/2025/06/25/OpenGL%E5%AD%A6%E4%B9%A0/OpenGL%E5%AD%A6%E4%B9%A0/"/>
    <id>http://bumak.github.io/2025/06/25/OpenGL%E5%AD%A6%E4%B9%A0/OpenGL%E5%AD%A6%E4%B9%A0/</id>
    <published>2025-06-25T08:15:47.399Z</published>
    <updated>2025-06-26T06:36:48.738Z</updated>
    
    <content type="html"><![CDATA[<h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><p>​学习OpenGL的核心模式，<a href="https://blog.csdn.net/ssunshining/article/details/123767340">VS2022+GLFW+GLAD环境搭建教程</a>，需要注意的是文章中下载的GLFW是编译好的，我们可以跳过CMake编译的那一步，直接去找include文件和lib文件。</p><p>​还有学习资源，<a href="https://learnopengl-cn.github.io/">知识点学习</a>。</p><hr><h3 id="基础知识（知识点学习）"><a href="#基础知识（知识点学习）" class="headerlink" title="基础知识（知识点学习）"></a>基础知识（知识点学习）</h3><blockquote><h3 id="🔷-OpenGL-是什么？"><a href="#🔷-OpenGL-是什么？" class="headerlink" title="🔷 OpenGL 是什么？"></a>🔷 OpenGL 是什么？</h3><blockquote><p>OpenGL（Open Graphics Library）是一个画图的标准工具库，用来绘制图形，比如 3D 模型、场景、特效等等。</p></blockquote><ul><li>它不负责创建窗口，也不能处理鼠标&#x2F;键盘，只专注“画图”。</li><li>想象你是画家，OpenGL 就是你的画笔和颜料。</li></ul><hr><h3 id="🔶-GLFW-是什么？"><a href="#🔶-GLFW-是什么？" class="headerlink" title="🔶 GLFW 是什么？"></a>🔶 GLFW 是什么？</h3><blockquote><p>GLFW 是一个专门用来创建窗口、处理用户输入（键盘鼠标）和设置 OpenGL 的库。</p></blockquote><ul><li>它帮你打开一个窗口、设置 OpenGL 的版本，并响应鼠标&#x2F;键盘事件。</li><li>没有 GLFW（或类似的库），你连“打开画布”都做不到。</li></ul><hr><h3 id="🔸-GLAD-是什么？"><a href="#🔸-GLAD-是什么？" class="headerlink" title="🔸 GLAD 是什么？"></a>🔸 GLAD 是什么？</h3><blockquote><p>GLAD 是一个 OpenGL 的“加载器”，帮你把 OpenGL 的函数都准备好。</p></blockquote><ul><li>因为 OpenGL 的函数不是自动提供的，需要手动“加载”才能使用。</li><li>GLAD 就像一个工具箱打开器，确保你能正确使用所有画图工具。</li></ul><hr><h2 id="🧠-记忆小口诀："><a href="#🧠-记忆小口诀：" class="headerlink" title="🧠 记忆小口诀："></a>🧠 记忆小口诀：</h2><p><strong>GLFW 开窗口，GLAD 开工具，OpenGL 开画图。</strong></p></blockquote><p>​</p><blockquote><h2 id="OpenGL-的坐标系（标准化设备坐标-NDC）"><a href="#OpenGL-的坐标系（标准化设备坐标-NDC）" class="headerlink" title="OpenGL 的坐标系（标准化设备坐标 NDC）"></a>OpenGL 的坐标系（标准化设备坐标 NDC）</h2><ol><li><strong>坐标范围：</strong><br> OpenGL 在渲染管线最后一步，会把顶点坐标变换到一个叫做 <strong>标准化设备坐标</strong>（NDC，Normalized Device Coordinates）的空间里。<ul><li>X轴范围：从 <strong>-1 到 1</strong>（左到右）</li><li>Y轴范围：从 <strong>-1 到 1</strong>（下到上）</li><li>Z轴范围：从 <strong>-1 到 1</strong>（近到远，深度）</li></ul></li><li><strong>坐标轴方向：</strong><ul><li>X轴：负方向指向左，正方向指向右</li><li>Y轴：负方向指向下，正方向指向上</li><li>Z轴：负方向指向屏幕外（观察者方向），正方向指向屏幕内</li></ul></li><li><strong>二维绘图时，Z轴通常为0</strong></li><li><strong>原点在显示窗口的中心点</strong></li></ol></blockquote><p>​VBO是什么？顶点缓冲对象，用来管理内存。看下面的代码，就是使用<strong>glGenBuffers</strong>函数生成一个带有缓冲ID的VBO对象。</p><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java">unsigned <span class="hljs-type">int</span> VBO;<br>glGenBuffers(<span class="hljs-number">1</span>, &amp;VBO);<br></code></pre></td></tr></table></figure><blockquote><p>🧠 为什么 VBO 是一个 <code>unsigned int</code> 变量？</p><p>——因为在 OpenGL 的内部设计中，每一个“对象”（比如缓冲区对象、纹理对象、着色器对象）都会被分配一个唯一的数字 ID，这个 ID 就是一个整数。OpenGL 并不直接返回一个“指针”或者“结构体”，它只返回一个整数值，然后你以后只要用这个数字来引用这个对象就行了。</p><p>❓那 VBO 本身是缓冲区吗？</p><p>——不是。VBO只是一个整数变量，用来存这个缓冲区的ID，真正的“缓冲区对象”是在OpenGL内部创建和管理的，你只能通过这个ID来间接使用它。</p></blockquote><p>​VAO是什么？顶点数组对象，帮你把一堆“顶点属性设置”的状态保存起来，下次想用的时候一绑上，OpenGL 就知道你的顶点数据长什么样，不用你每次都重新设置。</p><blockquote><h2 id="为什么要有-VAO？"><a href="#为什么要有-VAO？" class="headerlink" title="为什么要有 VAO？"></a>为什么要有 VAO？</h2><p>你画一个图形，顶点数据除了顶点坐标外，还可能有颜色、法线、纹理坐标等，每种数据都要告诉 OpenGL 怎么读取。</p><p>举个例子：</p><ul><li>你的顶点坐标数据在缓冲区里的起始地址是0，大小是3个float</li><li>颜色数据在缓冲区里的起始地址是12字节，大小是3个float</li></ul><p>每次绘制之前，你得告诉 OpenGL 这些数据在哪，格式是什么。</p><p>如果没有 VAO，你每次绘图都要重复这些繁琐的设置，非常麻烦。</p><hr><h2 id="VAO的作用就是帮你记住这些设置"><a href="#VAO的作用就是帮你记住这些设置" class="headerlink" title="VAO的作用就是帮你记住这些设置"></a>VAO的作用就是帮你记住这些设置</h2><p>你先创建一个 VAO，绑定它：</p><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java">unsigned <span class="hljs-type">int</span> VAO;<br>glGenVertexArrays(<span class="hljs-number">1</span>, &amp;VAO);<br>glBindVertexArray(VAO);<br></code></pre></td></tr></table></figure><p>然后你做各种顶点属性设置：</p><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java">glBindBuffer(GL_ARRAY_BUFFER, VBO);<br>glVertexAttribPointer(...);<br>glEnableVertexAttribArray(...);<br></code></pre></td></tr></table></figure><p>这些设置都会被 VAO 记录。</p><p>以后你只要：</p><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java">glBindVertexArray(VAO);<br></code></pre></td></tr></table></figure><p>OpenGL就自动知道所有顶点属性设置，你可以直接画图了。</p><hr><h2 id="简单比喻"><a href="#简单比喻" class="headerlink" title="简单比喻"></a>简单比喻</h2><ul><li><strong>没有 VAO</strong>：每次画画都要重新告诉画笔颜色、粗细、位置，麻烦又容易出错。</li><li><strong>有了 VAO</strong>：把画笔的设置存好，下次直接拿出来用，画画快又方便。</li></ul></blockquote><hr><h3 id="示例代码讲解（注释版）"><a href="#示例代码讲解（注释版）" class="headerlink" title="示例代码讲解（注释版）"></a>示例代码讲解（注释版）</h3><figure class="highlight c++"><table><tr><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;glad/glad.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;GLFW/glfw3.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-comment">//回调函数声明，当窗口大小改变就会调用</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">framebuffer_size_callback</span><span class="hljs-params">(GLFWwindow* window, <span class="hljs-type">int</span> width, <span class="hljs-type">int</span> height)</span></span>;<br><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">glfwInit</span>();<br>    <span class="hljs-comment">//告诉GLFW我们使用OpenGL3.3 Core Profile</span><br>    <span class="hljs-built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="hljs-number">3</span>);<br>    <span class="hljs-built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="hljs-number">3</span>);<br>    <span class="hljs-built_in">glfwWindowHint</span>(GLFW_OPENGL_PROFILE, GLFW_OPENGL_CORE_PROFILE);<br>    <span class="hljs-comment">//glfwWindowHint(GLFW_OPENGL_FORWARD_COMPAT, GL_TRUE);</span><br><br>    GLFWwindow* window = <span class="hljs-built_in">glfwCreateWindow</span>(<span class="hljs-number">800</span>, <span class="hljs-number">600</span>, <span class="hljs-string">&quot;LearnOpenGL&quot;</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);<span class="hljs-comment">//创建窗口</span><br>    <br>    <span class="hljs-keyword">if</span> (window == <span class="hljs-literal">NULL</span>)<span class="hljs-comment">//检查窗口创建状态</span><br>    &#123;<br>        std::cout &lt;&lt; <span class="hljs-string">&quot;Failed to create GLFW window&quot;</span> &lt;&lt; std::endl;<br>        <span class="hljs-built_in">glfwTerminate</span>();<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br>    <span class="hljs-built_in">glfwMakeContextCurrent</span>(window);<span class="hljs-comment">//把OpenGL上下文设置为这个窗口</span><br><br>    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">gladLoadGLLoader</span>((GLADloadproc)glfwGetProcAddress))<span class="hljs-comment">//初始化GLAD</span><br>    &#123;<br>        std::cout &lt;&lt; <span class="hljs-string">&quot;Failed to initialize GLAD&quot;</span> &lt;&lt; std::endl;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br><br>    <span class="hljs-built_in">glViewport</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">800</span>, <span class="hljs-number">600</span>);<span class="hljs-comment">//设置视口</span><br><br>    <span class="hljs-built_in">glfwSetFramebufferSizeCallback</span>(window, framebuffer_size_callback);<span class="hljs-comment">//注册窗口大小变化的回调函数</span><br><br>    <span class="hljs-keyword">while</span> (!<span class="hljs-built_in">glfwWindowShouldClose</span>(window)) <span class="hljs-comment">// 只要窗口没被关闭，就一直循环</span><br>    &#123;<br>        <span class="hljs-built_in">glfwSwapBuffers</span>(window);<span class="hljs-comment">// 交换颜色缓冲（把渲染的图像显示到屏幕上）</span><br>        <span class="hljs-built_in">glfwPollEvents</span>();<span class="hljs-comment">// 处理键盘鼠标等事件</span><br>    &#125;<br>    <span class="hljs-built_in">glfwTerminate</span>();<span class="hljs-comment">// 清理并退出 GLFW</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">framebuffer_size_callback</span><span class="hljs-params">(GLFWwindow* window, <span class="hljs-type">int</span> width, <span class="hljs-type">int</span> height)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">glViewport</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, width, height);<span class="hljs-comment">// 根据新的窗口大小重新设置视口</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="作业一"><a href="#作业一" class="headerlink" title="作业一"></a>作业一</h3><ul><li><strong>绘制渐变色的三角形</strong></li></ul><figure class="highlight c++"><table><tr><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;glad/glad.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;GLFW/glfw3.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-comment">// 窗口大小变化时调整视口</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">framebuffer_size_callback</span><span class="hljs-params">(GLFWwindow* window, <span class="hljs-type">int</span> width, <span class="hljs-type">int</span> height)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">glViewport</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, width, height);<br>&#125;<br><br><span class="hljs-comment">// 检查着色器编译错误</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">checkCompileErrors</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> shader, std::string type)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> success;<br>    <span class="hljs-type">char</span> infoLog[<span class="hljs-number">1024</span>];<br>    <span class="hljs-keyword">if</span> (type != <span class="hljs-string">&quot;PROGRAM&quot;</span>)<br>    &#123;<br>        <span class="hljs-built_in">glGetShaderiv</span>(shader, GL_COMPILE_STATUS, &amp;success);<br>        <span class="hljs-keyword">if</span> (!success)<br>        &#123;<br>            <span class="hljs-built_in">glGetShaderInfoLog</span>(shader, <span class="hljs-number">1024</span>, <span class="hljs-literal">NULL</span>, infoLog);<br>            std::cout &lt;&lt; <span class="hljs-string">&quot;ERROR::SHADER_COMPILATION_ERROR of type: &quot;</span> &lt;&lt; type &lt;&lt; <span class="hljs-string">&quot;\n&quot;</span><br>                &lt;&lt; infoLog &lt;&lt; <span class="hljs-string">&quot;\n -- --------------------------------------------------- -- &quot;</span> &lt;&lt; std::endl;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        <span class="hljs-built_in">glGetProgramiv</span>(shader, GL_LINK_STATUS, &amp;success);<br>        <span class="hljs-keyword">if</span> (!success)<br>        &#123;<br>            <span class="hljs-built_in">glGetProgramInfoLog</span>(shader, <span class="hljs-number">1024</span>, <span class="hljs-literal">NULL</span>, infoLog);<br>            std::cout &lt;&lt; <span class="hljs-string">&quot;ERROR::PROGRAM_LINKING_ERROR of type: &quot;</span> &lt;&lt; type &lt;&lt; <span class="hljs-string">&quot;\n&quot;</span><br>                &lt;&lt; infoLog &lt;&lt; <span class="hljs-string">&quot;\n -- --------------------------------------------------- -- &quot;</span> &lt;&lt; std::endl;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">// 1. 初始化 GLFW</span><br>    <span class="hljs-built_in">glfwInit</span>();<br>    <span class="hljs-built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="hljs-number">3</span>); <span class="hljs-comment">// OpenGL 3.x</span><br>    <span class="hljs-built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="hljs-number">3</span>); <span class="hljs-comment">// OpenGL x.3</span><br>    <span class="hljs-built_in">glfwWindowHint</span>(GLFW_OPENGL_PROFILE, GLFW_OPENGL_CORE_PROFILE); <span class="hljs-comment">// 核心模式</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> __APPLE__</span><br>    <span class="hljs-built_in">glfwWindowHint</span>(GLFW_OPENGL_FORWARD_COMPAT, GL_TRUE); <span class="hljs-comment">// MacOS 需要这句</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br>    <span class="hljs-comment">// 2. 创建窗口</span><br>    GLFWwindow* window = <span class="hljs-built_in">glfwCreateWindow</span>(<span class="hljs-number">800</span>, <span class="hljs-number">600</span>, <span class="hljs-string">&quot;Colored Triangle&quot;</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);<br>    <span class="hljs-keyword">if</span> (window == <span class="hljs-literal">NULL</span>)<br>    &#123;<br>        std::cout &lt;&lt; <span class="hljs-string">&quot;Failed to create GLFW window\n&quot;</span>;<br>        <span class="hljs-built_in">glfwTerminate</span>();<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br>    <span class="hljs-built_in">glfwMakeContextCurrent</span>(window);<br><br>    <span class="hljs-comment">// 3. 初始化 GLAD</span><br>    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">gladLoadGLLoader</span>((GLADloadproc)glfwGetProcAddress))<br>    &#123;<br>        std::cout &lt;&lt; <span class="hljs-string">&quot;Failed to initialize GLAD\n&quot;</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 4. 设置视口和窗口大小回调</span><br>    <span class="hljs-built_in">glViewport</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">800</span>, <span class="hljs-number">600</span>);<br>    <span class="hljs-built_in">glfwSetFramebufferSizeCallback</span>(window, framebuffer_size_callback);<br><br>    <span class="hljs-comment">// 5. 定义顶点数据（位置 + 颜色）</span><br>    <span class="hljs-type">float</span> vertices[] = &#123;<br>        <span class="hljs-comment">// 位置           // 颜色(R, G, B)</span><br>         <span class="hljs-number">0.0f</span>,  <span class="hljs-number">0.5f</span>, <span class="hljs-number">0.0f</span>,  <span class="hljs-number">0.0f</span>, <span class="hljs-number">0.0f</span>, <span class="hljs-number">1.0f</span>,  <span class="hljs-comment">// 顶点1 蓝色</span><br>        <span class="hljs-number">-0.5f</span>, <span class="hljs-number">-0.5f</span>, <span class="hljs-number">0.0f</span>,  <span class="hljs-number">0.0f</span>, <span class="hljs-number">1.0f</span>, <span class="hljs-number">0.0f</span>,  <span class="hljs-comment">// 顶点2 绿色</span><br>         <span class="hljs-number">0.5f</span>, <span class="hljs-number">-0.5f</span>, <span class="hljs-number">0.0f</span>,  <span class="hljs-number">1.0f</span>, <span class="hljs-number">0.0f</span>, <span class="hljs-number">0.0f</span>   <span class="hljs-comment">// 顶点3 红色</span><br>    &#125;;<br><br>    <span class="hljs-comment">// 6. 编写顶点着色器源码</span><br>    <span class="hljs-type">const</span> <span class="hljs-type">char</span>* vertexShaderSource = <span class="hljs-string">R&quot;glsl(</span><br><span class="hljs-string">        #version 330 core</span><br><span class="hljs-string">        layout (location = 0) in vec3 aPos;   // 位置属性</span><br><span class="hljs-string">        layout (location = 1) in vec3 aColor; // 颜色属性</span><br><span class="hljs-string"></span><br><span class="hljs-string">        out vec3 ourColor; // 输出给片元着色器的颜色变量</span><br><span class="hljs-string"></span><br><span class="hljs-string">        void main()</span><br><span class="hljs-string">        &#123;</span><br><span class="hljs-string">            gl_Position = vec4(aPos, 1.0); // 设置顶点位置</span><br><span class="hljs-string">            ourColor = aColor;              // 传递颜色到片元着色器</span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string">    )glsl&quot;</span>;<br><br>    <span class="hljs-comment">// 7. 编写片元着色器源码</span><br>    <span class="hljs-type">const</span> <span class="hljs-type">char</span>* fragmentShaderSource = <span class="hljs-string">R&quot;glsl(</span><br><span class="hljs-string">        #version 330 core</span><br><span class="hljs-string">        in vec3 ourColor;       // 从顶点着色器传来的颜色</span><br><span class="hljs-string"></span><br><span class="hljs-string">        out vec4 FragColor;     // 输出颜色</span><br><span class="hljs-string"></span><br><span class="hljs-string">        void main()</span><br><span class="hljs-string">        &#123;</span><br><span class="hljs-string">            FragColor = vec4(ourColor, 1.0); // 设置片元颜色，alpha为1（不透明）</span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string">    )glsl&quot;</span>;<br><br>    <span class="hljs-comment">// 8. 编译顶点着色器</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> vertexShader = <span class="hljs-built_in">glCreateShader</span>(GL_VERTEX_SHADER);<br>    <span class="hljs-built_in">glShaderSource</span>(vertexShader, <span class="hljs-number">1</span>, &amp;vertexShaderSource, <span class="hljs-literal">NULL</span>);<br>    <span class="hljs-built_in">glCompileShader</span>(vertexShader);<br>    <span class="hljs-built_in">checkCompileErrors</span>(vertexShader, <span class="hljs-string">&quot;VERTEX&quot;</span>);<br><br>    <span class="hljs-comment">// 9. 编译片元着色器</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> fragmentShader = <span class="hljs-built_in">glCreateShader</span>(GL_FRAGMENT_SHADER);<br>    <span class="hljs-built_in">glShaderSource</span>(fragmentShader, <span class="hljs-number">1</span>, &amp;fragmentShaderSource, <span class="hljs-literal">NULL</span>);<br>    <span class="hljs-built_in">glCompileShader</span>(fragmentShader);<br>    <span class="hljs-built_in">checkCompileErrors</span>(fragmentShader, <span class="hljs-string">&quot;FRAGMENT&quot;</span>);<br><br>    <span class="hljs-comment">// 10. 链接着色器程序</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> shaderProgram = <span class="hljs-built_in">glCreateProgram</span>();<br>    <span class="hljs-built_in">glAttachShader</span>(shaderProgram, vertexShader);<br>    <span class="hljs-built_in">glAttachShader</span>(shaderProgram, fragmentShader);<br>    <span class="hljs-built_in">glLinkProgram</span>(shaderProgram);<br>    <span class="hljs-built_in">checkCompileErrors</span>(shaderProgram, <span class="hljs-string">&quot;PROGRAM&quot;</span>);<br><br>    <span class="hljs-comment">// 11. 删除着色器对象，已经链接到程序里了</span><br>    <span class="hljs-built_in">glDeleteShader</span>(vertexShader);<br>    <span class="hljs-built_in">glDeleteShader</span>(fragmentShader);<br><br>    <span class="hljs-comment">// 12. 创建顶点缓冲和顶点数组对象</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> VBO, VAO;<br>    <span class="hljs-built_in">glGenVertexArrays</span>(<span class="hljs-number">1</span>, &amp;VAO);<br>    <span class="hljs-built_in">glGenBuffers</span>(<span class="hljs-number">1</span>, &amp;VBO);<br><br>    <span class="hljs-comment">// 绑定 VAO</span><br>    <span class="hljs-built_in">glBindVertexArray</span>(VAO);<br><br>    <span class="hljs-comment">// 绑定并填充 VBO</span><br>    <span class="hljs-built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, VBO);<br>    <span class="hljs-built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="hljs-built_in">sizeof</span>(vertices), vertices, GL_STATIC_DRAW);<br><br>    <span class="hljs-comment">// 位置属性</span><br>    <span class="hljs-built_in">glVertexAttribPointer</span>(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>, GL_FLOAT, GL_FALSE, <span class="hljs-number">6</span> * <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">float</span>), (<span class="hljs-type">void</span>*)<span class="hljs-number">0</span>);<br>    <span class="hljs-built_in">glEnableVertexAttribArray</span>(<span class="hljs-number">0</span>);<br><br>    <span class="hljs-comment">// 颜色属性</span><br>    <span class="hljs-built_in">glVertexAttribPointer</span>(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, GL_FLOAT, GL_FALSE, <span class="hljs-number">6</span> * <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">float</span>), (<span class="hljs-type">void</span>*)(<span class="hljs-number">3</span> * <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">float</span>)));<br>    <span class="hljs-built_in">glEnableVertexAttribArray</span>(<span class="hljs-number">1</span>);<br><br>    <span class="hljs-comment">// 解绑</span><br>    <span class="hljs-built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, <span class="hljs-number">0</span>);<br>    <span class="hljs-built_in">glBindVertexArray</span>(<span class="hljs-number">0</span>);<br><br>    <span class="hljs-comment">// 13. 渲染循环</span><br>    <span class="hljs-keyword">while</span> (!<span class="hljs-built_in">glfwWindowShouldClose</span>(window))<br>    &#123;<br>        <span class="hljs-comment">// 处理输入（这里没写输入，后续可以加）</span><br><br>        <span class="hljs-comment">// 清屏，设置背景颜色</span><br>        <span class="hljs-built_in">glClearColor</span>(<span class="hljs-number">0.2f</span>, <span class="hljs-number">0.3f</span>, <span class="hljs-number">0.3f</span>, <span class="hljs-number">1.0f</span>);<br>        <span class="hljs-built_in">glClear</span>(GL_COLOR_BUFFER_BIT);<br><br>        <span class="hljs-comment">// 使用着色器程序</span><br>        <span class="hljs-built_in">glUseProgram</span>(shaderProgram);<br><br>        <span class="hljs-comment">// 绑定 VAO</span><br>        <span class="hljs-built_in">glBindVertexArray</span>(VAO);<br><br>        <span class="hljs-comment">// 绘制三角形</span><br>        <span class="hljs-built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>);<br><br>        <span class="hljs-comment">// 交换缓冲区和轮询事件</span><br>        <span class="hljs-built_in">glfwSwapBuffers</span>(window);<br>        <span class="hljs-built_in">glfwPollEvents</span>();<br>    &#125;<br><br>    <span class="hljs-comment">// 14. 释放资源</span><br>    <span class="hljs-built_in">glDeleteVertexArrays</span>(<span class="hljs-number">1</span>, &amp;VAO);<br>    <span class="hljs-built_in">glDeleteBuffers</span>(<span class="hljs-number">1</span>, &amp;VBO);<br>    <span class="hljs-built_in">glDeleteProgram</span>(shaderProgram);<br><br>    <span class="hljs-comment">// 15. 退出 GLFW</span><br>    <span class="hljs-built_in">glfwTerminate</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/OpenGL/image-20250625101600766.png" alt="image-20250625101600766"></p><h3 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h3><ul><li>添加更多顶点到数据中，使用glDrawArrays，尝试绘制两个彼此相连的三角形。</li></ul><p>​相较于上面的代码，只需修改两处即可：添加顶点（坐标和颜色属性）、绘制6个顶点。</p><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-type">float</span> vertices[] = &#123;<br>-<span class="hljs-number">0.9f</span>, -<span class="hljs-number">0.5f</span>, <span class="hljs-number">0.0f</span>, <span class="hljs-number">0.0f</span>, <span class="hljs-number">0.0f</span>, <span class="hljs-number">1.0f</span>,<br>-<span class="hljs-number">0.0f</span>, -<span class="hljs-number">0.5f</span>, <span class="hljs-number">0.0f</span>, <span class="hljs-number">0.0f</span>, <span class="hljs-number">1.0f</span>, <span class="hljs-number">0.0f</span>,<br>-<span class="hljs-number">0.45f</span>, <span class="hljs-number">0.5f</span>, <span class="hljs-number">0.0f</span>, <span class="hljs-number">1.0f</span>, <span class="hljs-number">0.0f</span>, <span class="hljs-number">0.0f</span>,<br> <span class="hljs-number">0.0f</span>, -<span class="hljs-number">0.5f</span>, <span class="hljs-number">0.0f</span>, <span class="hljs-number">0.0f</span>, <span class="hljs-number">0.0f</span>, <span class="hljs-number">1.0f</span>, <br> <span class="hljs-number">0.9f</span>, -<span class="hljs-number">0.5f</span>, <span class="hljs-number">0.0f</span>, <span class="hljs-number">0.0f</span>, <span class="hljs-number">1.0f</span>, <span class="hljs-number">0.0f</span>,<br> <span class="hljs-number">0.45f</span>, <span class="hljs-number">0.5f</span>, <span class="hljs-number">0.0f</span>, <span class="hljs-number">1.0f</span>, <span class="hljs-number">0.0f</span>, <span class="hljs-number">0.0f</span><br>&#125;;<br><br>glDrawArrays(GL_TRIANGLES, <span class="hljs-number">0</span>, <span class="hljs-number">6</span>);<span class="hljs-comment">//用顶点数组从第 0 个顶点开始，按三角形方式，绘制 6个顶点组成的两个三角形。</span><br></code></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/OpenGL/image-20250626135154793.png" alt="image-20250626135154793"></p><ul><li>创建相同的两个三角形，但对它们的数据使用不同的VAO和VBO。</li></ul><p>​其他部分不变，改动如下：创建时使用数组存储多个VAO和VBO、两个三角形顶点数据分为不同数组存储、分开绑定并且传输数据解析数据、分开绘制。</p><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java">unsigned <span class="hljs-type">int</span> VBOs[<span class="hljs-number">2</span>], VAOs[<span class="hljs-number">2</span>];<br>glGenVertexArrays(<span class="hljs-number">2</span>, VAOs); <span class="hljs-comment">// we can also generate multiple VAOs or buffers at the same time</span><br>glGenBuffers(<span class="hljs-number">2</span>, VBOs);<br><br><span class="hljs-type">float</span> firstTriangle[] = &#123;<br>    -<span class="hljs-number">0.9f</span>, -<span class="hljs-number">0.5f</span>, <span class="hljs-number">0.0f</span>,  <span class="hljs-comment">// left </span><br>    -<span class="hljs-number">0.0f</span>, -<span class="hljs-number">0.5f</span>, <span class="hljs-number">0.0f</span>,  <span class="hljs-comment">// right</span><br>    -<span class="hljs-number">0.45f</span>, <span class="hljs-number">0.5f</span>, <span class="hljs-number">0.0f</span>,  <span class="hljs-comment">// top </span><br>&#125;;<br><span class="hljs-type">float</span> secondTriangle[] = &#123;<br>     <span class="hljs-number">0.0f</span>, -<span class="hljs-number">0.5f</span>, <span class="hljs-number">0.0f</span>,  <span class="hljs-comment">// left</span><br>     <span class="hljs-number">0.9f</span>, -<span class="hljs-number">0.5f</span>, <span class="hljs-number">0.0f</span>,  <span class="hljs-comment">// right</span><br>     <span class="hljs-number">0.45f</span>, <span class="hljs-number">0.5f</span>, <span class="hljs-number">0.0f</span>   <span class="hljs-comment">// top </span><br>&#125;;<br><br>glBindVertexArray(VAOs[<span class="hljs-number">0</span>]);<br>glBindBuffer(GL_ARRAY_BUFFER, VBOs[<span class="hljs-number">0</span>]);<br>glBufferData(GL_ARRAY_BUFFER, sizeof(firstTriangle), firstTriangle, GL_STATIC_DRAW);<br>glVertexAttribPointer(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>, GL_FLOAT, GL_FALSE, <span class="hljs-number">3</span> * sizeof(<span class="hljs-type">float</span>), (<span class="hljs-keyword">void</span>*)<span class="hljs-number">0</span>);<span class="hljs-comment">// Vertex attributes stay the same</span><br>glEnableVertexAttribArray(<span class="hljs-number">0</span>);<br><br>glBindVertexArray(VAOs[<span class="hljs-number">1</span>]);<span class="hljs-comment">// 绑定新的VAO</span><br>glBindBuffer(GL_ARRAY_BUFFER, VBOs[<span class="hljs-number">1</span>]);<span class="hljs-comment">//绑定新的VBO</span><br>glBufferData(GL_ARRAY_BUFFER, sizeof(secondTriangle), secondTriangle, GL_STATIC_DRAW); <span class="hljs-comment">//传输数据到VBO代表的缓冲区</span><br>glVertexAttribPointer(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>, GL_FLOAT, GL_FALSE, <span class="hljs-number">0</span>, (<span class="hljs-keyword">void</span>*)<span class="hljs-number">0</span>); <span class="hljs-comment">//指定读取方式</span><br>glEnableVertexAttribArray(<span class="hljs-number">0</span>);<span class="hljs-comment">//启用顶点属性</span><br><br>glBindVertexArray(VAOs[<span class="hljs-number">0</span>]);<br>glDrawArrays(GL_TRIANGLES, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>);<br>        <span class="hljs-comment">// then we draw the second triangle using the data from the second VAO</span><br>glBindVertexArray(VAOs[<span class="hljs-number">1</span>]);<br>glDrawArrays(GL_TRIANGLES, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>);<br></code></pre></td></tr></table></figure><p>​<strong>glVertexAttribPointer</strong>函数的参数蛮多，建议边看LearnOpenGL项目。</p><ul><li>创建两个着色器程序，第二个程序使用一个不同的片段着色器，输出黄色；再次绘制这两个三角形，让其中一个输出为黄色。</li></ul><p>​</p><p>​在上面的基础上，创建两个<strong>shaderProgram</strong>、<strong>fragmentshader</strong>，然后编译好三个着色器（包括一个共用的顶点着色器），之后分组链接到<strong>shaderProgram</strong>中，最后<strong>while</strong>循环中，分别使用<strong>glUseProgram</strong>函数指定渲染程序进行绘画。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;环境搭建&quot;&gt;&lt;a href=&quot;#环境搭建&quot; class=&quot;headerlink&quot; title=&quot;环境搭建&quot;&gt;&lt;/a&gt;环境搭建&lt;/h3&gt;&lt;p&gt;​	学习OpenGL的核心模式，&lt;a href=&quot;https://blog.csdn.net/ssunshining/art</summary>
      
    
    
    
    <category term="开发" scheme="http://bumak.github.io/categories/%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="OpenGL" scheme="http://bumak.github.io/tags/OpenGL/"/>
    
  </entry>
  
  <entry>
    <title>阅读APP项目学习——4</title>
    <link href="http://bumak.github.io/2025/06/24/%E9%98%85%E8%AF%BBAPP%E5%AD%A6%E4%B9%A0/%E5%AE%89%E5%8D%93%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A04/"/>
    <id>http://bumak.github.io/2025/06/24/%E9%98%85%E8%AF%BBAPP%E5%AD%A6%E4%B9%A0/%E5%AE%89%E5%8D%93%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A04/</id>
    <published>2025-06-24T01:35:00.000Z</published>
    <updated>2025-06-24T02:58:44.647Z</updated>
    
    <content type="html"><![CDATA[<h3 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h3><p>​</p><p>​<strong>BaseFragment</strong>抽象类，是一个基础的Fragment类实现，继承自 <code>RxFragment</code>（这是一个支持 RxJava 生命周期管理的 Fragment），由于该父类实现了IView的方法，所以可以不再实现。</p><p>​<strong>BaseFragment<T extends IPresenter></strong>：这是一个泛型类，泛型参数 <code>T</code> 必须是 <strong>IPresenter</strong> 接口的子类。说明这个 Fragment 会和某个 Presenter 关联，符合 MVP 架构设计模式。</p><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> View view;<span class="hljs-comment">//保存当前Fragment的根布局视图</span><br><span class="hljs-keyword">protected</span> Bundle savedInstanceState;<span class="hljs-comment">//保存 Fragment 状态数据</span><br><span class="hljs-meta">@Nullable</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> View <span class="hljs-title function_">onCreateView</span><span class="hljs-params">(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState)</span> &#123;<br><span class="hljs-built_in">this</span>.savedInstanceState = savedInstanceState;<br>initSDK();<br>view = createView(inflater, container);<br>initData();<br>bindView();<br>bindEvent();<br>firstRequest();<br><span class="hljs-keyword">return</span> view;<br>&#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 事件触发绑定</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">bindEvent</span><span class="hljs-params">()</span> &#123;<br><br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 控件绑定</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">bindView</span><span class="hljs-params">()</span> &#123;<br><br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 数据初始化</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initData</span><span class="hljs-params">()</span> &#123;<br><br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 首次逻辑操作</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">firstRequest</span><span class="hljs-params">()</span> &#123;<br><br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 加载布局</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> View <span class="hljs-title function_">createView</span><span class="hljs-params">(LayoutInflater inflater, ViewGroup container)</span>;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 第三方SDK初始化</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initSDK</span><span class="hljs-params">()</span> &#123;<br><br>    &#125;<br></code></pre></td></tr></table></figure><p>​<code>onCreateView</code> 是 Fragment 创建视图时调用的回调方法（生命周期方法），它负责加载并返回 Fragment 的布局视图。</p><p>​<strong>BaseModelImpl</strong>类用来创建网络请求客户端的基础模型类，它主要负责配置并生成 Retrofit 实例，方便其他模块调用网络接口。使用OkHttp的<strong>OkHttpClient.Builder</strong>来创建客户端，设置了连接超时、写超时、读超时，和一个自定义的网络拦截器，用于请求失败后的重试逻辑。</p><p>​<strong>getRetrofitObject</strong>方法用来创建一个Retrofit实例，传入基础的URL。</p><p>​<strong>getRetrofitString</strong>和上面的方法类似，用来处理不同编码（<code>encode</code>）的字符串转换。</p><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseModelImpl</span> &#123;<br><br>    <span class="hljs-keyword">protected</span> OkHttpClient.<span class="hljs-type">Builder</span> <span class="hljs-variable">clientBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OkHttpClient</span>.Builder()<br>            .connectTimeout(<span class="hljs-number">10</span>, TimeUnit.SECONDS)<br>            .writeTimeout(<span class="hljs-number">10</span>, TimeUnit.SECONDS)<br>            .readTimeout(<span class="hljs-number">10</span>, TimeUnit.SECONDS)<br>            .addNetworkInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RetryIntercepter</span>(<span class="hljs-number">1</span>));<br><br>    <span class="hljs-keyword">protected</span> Retrofit <span class="hljs-title function_">getRetrofitObject</span><span class="hljs-params">(String url)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Retrofit</span>.Builder().baseUrl(url)<br>                <span class="hljs-comment">//增加返回值为字符串的支持(以实体类返回)</span><br>                .addConverterFactory(ScalarsConverterFactory.create())<br>                <span class="hljs-comment">//增加返回值为Oservable&lt;T&gt;的支持</span><br>                .addCallAdapterFactory(RxJava2CallAdapterFactory.create())<br>                .client(clientBuilder.build())<br>                .build();<br>    &#125;<br><br>    <span class="hljs-keyword">protected</span> Retrofit <span class="hljs-title function_">getRetrofitString</span><span class="hljs-params">(String url, String encode)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Retrofit</span>.Builder().baseUrl(url)<br>                <span class="hljs-comment">//增加返回值为字符串的支持(以实体类返回)</span><br>                .addConverterFactory(EncodoConverter.create(encode))<br>                <span class="hljs-comment">//增加返回值为Oservable&lt;T&gt;的支持</span><br>                .addCallAdapterFactory(RxJava2CallAdapterFactory.create())<br>                .client(clientBuilder.build())<br>                .build();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><ol><li>Retrofit 是什么？</li></ol><ul><li>Retrofit 是由 Square 公司开发的一个 <strong>Android 和 Java</strong> 平台上的网络请求库。</li><li>它帮助你很方便地调用网络上的 <strong>HTTP 接口</strong>（API），从服务器拿数据。</li><li>它帮你把网络请求和响应变得“像调用本地方法”一样简单。</li></ul></blockquote><p>​<strong>BasePresenterImpl</strong>抽象类实现了attachView功能，并且通过模板T来进行类型转换，是一个Presenter基类。</p><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BasePresenterImpl</span>&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IView</span>&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IPresenter</span>&#123;<br>    <span class="hljs-keyword">protected</span> T mView;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">attachView</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> IView iView)</span> &#123;<br>        mView = (T) iView;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>​<strong>RetryIntercepter</strong>类是一个自定义的 <strong>OkHttp 拦截器</strong>，其中<code>Request</code> 代表这次网络请求的详细信息，比如请求的地址、请求方法（GET、POST）、请求头、请求体等等。</p><blockquote><h2 id="为什么要这样写？"><a href="#为什么要这样写？" class="headerlink" title="为什么要这样写？"></a>为什么要这样写？</h2><p>拦截器就是“请求和响应之间的中间人”，它能：</p><ul><li><strong>拿到请求</strong>（<code>chain.request()</code>）</li><li><strong>对请求做点事</strong>（比如加个头，改改参数，或者打印日志）</li><li><strong>发出请求</strong>（<code>chain.proceed(request)</code>）</li><li><strong>拿到响应</strong>，还可以对响应做点事（比如判断失败重试）</li></ul></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RetryIntercepter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interceptor</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> maxRetry;<span class="hljs-comment">//最大重试次数</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">retryNum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<span class="hljs-comment">//假如设置为3次重试的话，则最大可能请求4次（默认1次+3次重试）</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RetryIntercepter</span><span class="hljs-params">(<span class="hljs-type">int</span> maxRetry)</span> &#123;<br>        <span class="hljs-built_in">this</span>.maxRetry = maxRetry;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Response <span class="hljs-title function_">intercept</span><span class="hljs-params">(Chain chain)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> chain.request();<br>        <span class="hljs-type">Response</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> chain.proceed(request);<br>        <span class="hljs-keyword">while</span> (!response.isSuccessful() &amp;&amp; retryNum &lt; maxRetry) &#123;<br>            retryNum++;<br>            response = chain.proceed(request);<br>        &#125;<br>        <span class="hljs-keyword">return</span> response;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>​basemvplib分析完了，下一步要分析monky包。先大体通过AI预测一波各个文件夹的含义和其中类的作用。</p><blockquote><p>​<strong>base</strong>文件夹项目是基础代码，比如基类（BaseActivity、BaseFragment、BasePresenter等），公共抽象层，用来复用和统一规范。</p><p>​<strong>bean</strong>文件夹存放数据模型类（实体类），用来表示业务数据，比如书籍信息、用户信息等。通常和数据库表结构或者接口返回数据对应。</p><p>​<strong>cache</strong>缓存相关的代码，负责数据缓存逻辑。</p><p>​<strong>common</strong>配置的是访问小说网站的API接口。</p><p>​<strong>dao</strong>是 Data Access Object（数据访问对象） 的缩写，数据访问层，封装数据库操作（增删改查），通常对应实体bean，有专门的接口或类处理数据存取。</p><p>​<strong>listener</strong>定义获取章节列表的回调通知。</p><p>​<strong>model</strong>业务逻辑层，处理具体的数据操作和业务规则。</p><p>​<strong>presenter</strong>这里是 Presenter 层，负责连接 View 和 Model，实现业务逻辑，处理界面和数据的交互。</p><p>​<strong>service</strong>一般放后台服务相关代码，比如 Android 的 Service 类，做持续后台任务，或者封装网络请求、系统服务操作等。</p><p>​<strong>utils</strong>工具类包，存放各种辅助类和静态方法。</p><p>​<strong>view</strong>自定义的视图类，或者跟界面相关的类（不包括特殊控件），一般用来封装界面逻辑或复用界面组件。</p><p>​<strong>widget</strong>自定义控件或者 UI 组件，比如自定义按钮、列表、动画控件等，扩展系统控件功能。</p></blockquote><p>​<strong>BitIntentDataManager</strong>管理 Intent 传递的数据，封装 Intent 数据处理逻辑，方便 Activity&#x2F;Fragment 之间传参。</p><p>​<strong>ErrorAnalyContentManager</strong>错误内容分析管理器，可能是日志收集、错误信息处理或者错误报告生成相关的类。</p><p>​<strong>MApplication</strong>自定义的 Application 类，应用入口，初始化全局变量、SDK、单例等。</p><p>​<strong>ProxyManager</strong>代理管理器，可能用来实现某种代理模式，动态代理对象，或者负责网络代理、请求代理等功能。</p><p>​<strong>ReadBookControl</strong>读书控制器，负责书籍阅读相关的业务逻辑，比如翻页、字体大小、阅读进度管理等。</p><p>​改天再系统分析吧，下面在AI问到了一套比较系统的分析流程。</p><blockquote><h2 id="🧭-一套系统的-MVP-项目分析流程（从-UI-到数据）"><a href="#🧭-一套系统的-MVP-项目分析流程（从-UI-到数据）" class="headerlink" title="🧭 一套系统的 MVP 项目分析流程（从 UI 到数据）"></a>🧭 一套系统的 MVP 项目分析流程（从 UI 到数据）</h2><hr><h3 id="✅-第一阶段：搞清楚结构和页面入口"><a href="#✅-第一阶段：搞清楚结构和页面入口" class="headerlink" title="✅ 第一阶段：搞清楚结构和页面入口"></a>✅ <strong>第一阶段：搞清楚结构和页面入口</strong></h3><h4 id="步骤-1：打开项目，看-包结构"><a href="#步骤-1：打开项目，看-包结构" class="headerlink" title="步骤 1：打开项目，看 包结构"></a>步骤 1：打开项目，看 <code>包结构</code></h4><ul><li>看包名下有哪些模块（你前面提到的 <code>view/</code>, <code>presenter/</code>, <code>model/</code>, <code>dao/</code> 等等）。</li><li>了解项目是不是使用了 MVP&#x2F;MVVM 架构（从 <code>presenter/</code> 和 <code>model/</code> 目录可以看出）。</li></ul><h4 id="步骤-2：找“首页-Activity”或主入口页面"><a href="#步骤-2：找“首页-Activity”或主入口页面" class="headerlink" title="步骤 2：找“首页 Activity”或主入口页面"></a>步骤 2：找“首页 Activity”或主入口页面</h4><ul><li>找 <code>MainActivity</code>, <code>LauncherActivity</code>, <code>SplashActivity</code> 等。</li><li>它一般会是你启动 App 后看到的第一个页面。</li></ul><hr><h3 id="✅-第二阶段：从-View-层入手分析一个页面"><a href="#✅-第二阶段：从-View-层入手分析一个页面" class="headerlink" title="✅ 第二阶段：从 View 层入手分析一个页面"></a>✅ <strong>第二阶段：从 View 层入手分析一个页面</strong></h3><h4 id="步骤-3：从-Activity-或-Fragment-开始看"><a href="#步骤-3：从-Activity-或-Fragment-开始看" class="headerlink" title="步骤 3：从 Activity 或 Fragment 开始看"></a>步骤 3：从 <code>Activity</code> 或 <code>Fragment</code> 开始看</h4><ul><li><p>关注 <code>onCreate()</code> 或 <code>onCreateView()</code> 方法。</p></li><li><p>看它绑定了哪个 Presenter，例如：</p><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java">presenter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReadBookPresenter</span>();<br>presenter.attachView(<span class="hljs-built_in">this</span>);<br></code></pre></td></tr></table></figure></li><li><p>查看哪些用户操作（按钮点击、滑动等）触发了哪些逻辑：</p><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java">button.setOnClickListener(v -&gt; presenter.doSomething());<br></code></pre></td></tr></table></figure></li></ul><h4 id="步骤-4：查找绑定的-View-和自定义控件"><a href="#步骤-4：查找绑定的-View-和自定义控件" class="headerlink" title="步骤 4：查找绑定的 View 和自定义控件"></a>步骤 4：查找绑定的 View 和自定义控件</h4><ul><li>查看 XML 布局文件和 <code>findViewById()</code> 绑定了哪些控件。</li><li>如果发现有 <code>PageWidget</code>、<code>ReadSettingView</code> 这类自定义控件：<ul><li>先了解它的大致作用（比如翻页、显示文字）</li><li>再决定是否深入看它的绘图或手势逻辑（很多时候可以略过）</li></ul></li></ul><hr><h3 id="✅-第三阶段：深入-Presenter-层，分析业务逻辑"><a href="#✅-第三阶段：深入-Presenter-层，分析业务逻辑" class="headerlink" title="✅ 第三阶段：深入 Presenter 层，分析业务逻辑"></a>✅ <strong>第三阶段：深入 Presenter 层，分析业务逻辑</strong></h3><h4 id="步骤-5：打开对应的-Presenter-类"><a href="#步骤-5：打开对应的-Presenter-类" class="headerlink" title="步骤 5：打开对应的 Presenter 类"></a>步骤 5：打开对应的 <code>Presenter</code> 类</h4><ul><li>看这个 Presenter 的方法有哪些？</li><li>你在 View 层点击按钮时，是调用的哪个方法？</li></ul><p>示例：</p><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loadBook</span><span class="hljs-params">()</span> &#123;<br>    model.getBookData(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Callback</span>() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">success</span><span class="hljs-params">(BookShelfBean bean)</span> &#123;<br>            view.showContent(bean);<br>        &#125;<br>    &#125;);<br>&#125;<br><br></code></pre></td></tr></table></figure><ul><li>Presenter 是 <strong>核心逻辑中枢</strong>，连接 View 和 Model。</li></ul><hr><h3 id="✅-第四阶段：查看-Model-层，数据从哪来？"><a href="#✅-第四阶段：查看-Model-层，数据从哪来？" class="headerlink" title="✅ 第四阶段：查看 Model 层，数据从哪来？"></a>✅ <strong>第四阶段：查看 Model 层，数据从哪来？</strong></h3><h4 id="步骤-6：打开-Model-或-ModelImpl-类"><a href="#步骤-6：打开-Model-或-ModelImpl-类" class="headerlink" title="步骤 6：打开 Model 或 ModelImpl 类"></a>步骤 6：打开 <code>Model</code> 或 <code>ModelImpl</code> 类</h4><ul><li><p>看它是从 <strong>哪里拿数据</strong> 的：</p><ul><li>网络请求？（比如用 Retrofit）</li><li>数据库？（比如用 Dao、GreenDAO）</li><li>缓存？（比如用 CacheManager）</li></ul></li><li><p>查看具体的数据来源，比如：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">RetrofitHelper.getApi().getChapters(bookId);<br></code></pre></td></tr></table></figure></li></ul><hr><h3 id="✅-第五阶段：往下看数据支撑层（可选）"><a href="#✅-第五阶段：往下看数据支撑层（可选）" class="headerlink" title="✅ 第五阶段：往下看数据支撑层（可选）"></a>✅ <strong>第五阶段：往下看数据支撑层（可选）</strong></h3><h4 id="步骤-7：查看-Bean、Dao、Utils-工具类"><a href="#步骤-7：查看-Bean、Dao、Utils-工具类" class="headerlink" title="步骤 7：查看 Bean、Dao、Utils 工具类"></a>步骤 7：查看 Bean、Dao、Utils 工具类</h4><ul><li><code>bean/</code>：定义了哪些数据结构，比如 <code>BookShelfBean</code>, <code>ChapterBean</code>？</li><li><code>dao/</code>：你可以看看 <code>BookShelfBeanDao</code> 是如何存&#x2F;取书的数据的。</li><li><code>utils/</code>：只在你看到用到的时候再深入看，比如处理日期、文件、网络状态等。</li></ul><hr><h3 id="✅-第六阶段：查找回调机制与事件流"><a href="#✅-第六阶段：查找回调机制与事件流" class="headerlink" title="✅ 第六阶段：查找回调机制与事件流"></a>✅ <strong>第六阶段：查找回调机制与事件流</strong></h3><ul><li>项目中可能会有一些回调接口（像你之前提到的 <code>OnGetChapterListListener</code>）</li><li>分析它们是怎么传值、触发逻辑的。</li></ul></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;正文&quot;&gt;&lt;a href=&quot;#正文&quot; class=&quot;headerlink&quot; title=&quot;正文&quot;&gt;&lt;/a&gt;正文&lt;/h3&gt;&lt;p&gt;​	&lt;/p&gt;
&lt;p&gt;​	&lt;strong&gt;BaseFragment&lt;/strong&gt;抽象类，是一个基础的Fragment类实现，继承自 &lt;co</summary>
      
    
    
    
    <category term="开发" scheme="http://bumak.github.io/categories/%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="安卓开发学习" scheme="http://bumak.github.io/tags/%E5%AE%89%E5%8D%93%E5%BC%80%E5%8F%91%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>阅读APP项目学习——3</title>
    <link href="http://bumak.github.io/2025/06/23/%E9%98%85%E8%AF%BBAPP%E5%AD%A6%E4%B9%A0/%E5%AE%89%E5%8D%93%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A03/"/>
    <id>http://bumak.github.io/2025/06/23/%E9%98%85%E8%AF%BBAPP%E5%AD%A6%E4%B9%A0/%E5%AE%89%E5%8D%93%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A03/</id>
    <published>2025-06-23T04:52:54.775Z</published>
    <updated>2025-06-23T04:51:59.729Z</updated>
    
    <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>​分析复杂一点的功能，需要熟悉面向对象的编程思想，熟悉更加基础的代码，我感觉有点力不从心，十分难以下手，考虑要不要从基础类一点点学习，分析其作用、为什么要这样写之类的问题，能学到很多知识点，这样是不是会更加有利于我的开发经验学习，毕竟“轮子”的代码都还没搞明白为什么这么写，直接去解析在此基础上的其他功能会让我有点不脚踏实地的感觉。</p><p>​另外，因为错误的操作，把资源文件给搞乱了，又得新建项目重新copy了，有点烦。</p><p>​</p><h3 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h3><p>​先从basemvplib的文件开始吧，IView和IPresenter的基础思想已经学习过了，再从<strong>AppActivityManager</strong>、<strong>BaseApplication</strong>、<strong>EncodoConverter</strong>这三个类开始吧。</p><p>​</p><p>​<strong>AppActivityManager</strong>类是管理项目中所有Activity的工具类，方便在应用中统一控制 Activity 生命周期，比如批量关闭某类 Activity 或检测 Activity 是否在栈中。</p><p>​<code>private static List&lt;WeakReference&lt;Activity&gt;&gt; activities;</code>使用弱引用存储Activity，当 Activity 被系统回收时，弱引用不会阻止它的回收，避免强引用导致内存泄漏。</p><p>​通过双重检查实现线程安全的单例模式，保证AppActivityManager在整个应用中只有一个实例。</p><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> AppActivityManager <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-literal">null</span> == instance)&#123;<br>            <span class="hljs-keyword">synchronized</span> (AppActivityManager.class)&#123;<br>                <span class="hljs-keyword">if</span>(<span class="hljs-literal">null</span> == instance)&#123;<br>                    instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AppActivityManager</span>();<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> instance;<br>    &#125;<br><br></code></pre></td></tr></table></figure><p>​提供了add、remove方法，其中有两种移除方式：提供Activity实例和Activity类名。</p><p>​提供了finish方法，可以关闭指定的Activity实例或关闭指定类型的Activity。</p><p>​提供isExist方法，能够判断某个Activity类是否存在。</p><blockquote><h3 id="简单理解："><a href="#简单理解：" class="headerlink" title="简单理解："></a>简单理解：</h3><ul><li><strong>Application.onCreate()</strong><br> 是整个应用程序的“启动入口”，在应用一启动时调用，只调用一次。<br> 你可以在这里做一些<strong>全局初始化</strong>，比如初始化数据库、网络库、第三方SDK等，所有页面都能用。</li><li><strong>Activity.onCreate()</strong><br> 是某个具体页面（Activity）创建时调用。每打开一个新页面，就会调用它。<br> 你可以在这里做这个页面专属的初始化，比如加载布局、设置按钮事件等。</li></ul></blockquote><p>​<strong>BaseApplication</strong>是一个自定义的Application类，是安卓应用的入口类，是应用启动时创建的全局入口，用来做全局初始化和管理。这是一个基础框架类，只实现了onCreate方法，调用父类的方法。</p><p>​<strong>EncodoConverter</strong>继承了 <code>retrofit2.Converter.Factory</code>，用于创建数据转换器；有一个私有字段 <code>encode</code>，默认编码是 <code>&quot;utf-8&quot;</code>，也可以自定义传入编码；提供了两个静态方法 <code>create()</code> 用于创建该转换器实例，可以用默认编码，也可以用自定义编码；重写了 <code>responseBodyConverter()</code> 方法，返回一个 <code>Converter&lt;ResponseBody, String&gt;</code>，这个转换器就是把响应体数据读取为指定编码的字符串。</p><p>​这段代码就是给 Retrofit 定制一个响应体的编码转换器，让它可以用指定编码把服务器返回的字节流转成字符串。</p><p>​<strong>Retrofit</strong> 是一个用于 Android 和 Java 的网络请求库，它帮你很方便地向服务器发送 HTTP 请求，获取数据，然后自动把服务器返回的 JSON 或 XML 转换成你定义的 Java 对象，省去了你自己写很多解析代码。</p><p>​再看<strong>BaseActivity</strong>类，它是所有Activity的基类，统一封装生命周期方法和Presenter管理，使用了泛型<T extends IPresenter> 表示传入的 Presenter 类型，实现了IView。</p><p>​页面初始化流程，不需要的方法可以不实现。</p><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 生命周期 onCreate，Activity 启动时调用。</span><br><span class="hljs-comment"> * 这里统一调用了一系列初始化方法，下面会解释每个方法作用。</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>    <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>    <span class="hljs-built_in">this</span>.savedInstanceState = savedInstanceState;<br><br>    <span class="hljs-comment">// 获取是否使用转场动画</span><br>    <span class="hljs-keyword">if</span>(getIntent()!=<span class="hljs-literal">null</span>)&#123;<br>        startShareAnim = getIntent().getBooleanExtra(start_share_ele,<span class="hljs-literal">false</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// 添加到全局Activity管理器中（方便统一关闭、管理Activity）</span><br>    AppActivityManager.getInstance().add(<span class="hljs-built_in">this</span>);<br><br>    <span class="hljs-comment">// 第一步：初始化第三方SDK（可选）</span><br>    initSDK();<br><br>    <span class="hljs-comment">// 第二步：设置布局，比如 setContentView(R.layout.xxx)</span><br>    onCreateActivity();<br><br>    <span class="hljs-comment">//第三步：创建 Presenter 对象</span><br>    mPresenter = initInjector();<br><br>    <span class="hljs-comment">// 第四步：将当前View绑定到Presenter上（用于通知刷新）</span><br>    attachView();<br><br>    <span class="hljs-comment">// 第五步：初始化数据（如适配器、变量等）</span><br>    initData();<br><br>    <span class="hljs-comment">// 第六步：绑定控件（findViewById）</span><br>    bindView();<br><br>    <span class="hljs-comment">// 第七步：绑定事件（点击、刷新等逻辑）</span><br>    bindEvent();<br><br>    <span class="hljs-comment">// 第八步：发起首次请求，比如网络加载书架</span><br>    firstRequest();<br>&#125;<br></code></pre></td></tr></table></figure><p>​还写好了页面的跳转功能，也就是启动新Activity并带动画效果的方法，有多种，适配多种情况下的使用需求。</p><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-comment">////////////////////////////////启动Activity转场动画/////////////////////////////////////////////</span><br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startActivityForResultByAnim</span><span class="hljs-params">(Intent intent, <span class="hljs-type">int</span> requestCode, <span class="hljs-type">int</span> animIn, <span class="hljs-type">int</span> animExit)</span> &#123;<br>        startActivityForResult(intent, requestCode);<br>        overridePendingTransition(animIn, animExit);<br>    &#125;<br><br><br><br>    <span class="hljs-comment">//protected代表它的子类可以调用</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startActivityByAnim</span><span class="hljs-params">(Intent intent, <span class="hljs-type">int</span> animIn, <span class="hljs-type">int</span> animExit)</span> &#123;<br>        startActivity(intent);<br>        overridePendingTransition(animIn, animExit);<br>    &#125;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startActivityForResultByAnim</span><span class="hljs-params">(Intent intent, <span class="hljs-type">int</span> requestCode, <span class="hljs-meta">@NonNull</span> View view, <span class="hljs-meta">@NonNull</span> String transitionName, <span class="hljs-type">int</span> animIn, <span class="hljs-type">int</span> animExit)</span> &#123;<br>        <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) &#123;<br>            startActivityForResult(intent, requestCode, ActivityOptions.makeSceneTransitionAnimation(<span class="hljs-built_in">this</span>, view, transitionName).toBundle());<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            startActivityForResultByAnim(intent, requestCode, animIn, animExit);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startActivityByAnim</span><span class="hljs-params">(Intent intent, <span class="hljs-meta">@NonNull</span> View view, <span class="hljs-meta">@NonNull</span> String transitionName, <span class="hljs-type">int</span> animIn, <span class="hljs-type">int</span> animExit)</span> &#123;<br>        <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) &#123;<br>            intent.putExtra(start_share_ele,<span class="hljs-literal">true</span>);<br>            startActivity(intent, ActivityOptions.makeSceneTransitionAnimation(<span class="hljs-built_in">this</span>, view, transitionName).toBundle());<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            startActivityByAnim(intent, animIn, animExit);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Context <span class="hljs-title function_">getContext</span><span class="hljs-params">()</span>&#123;<span class="hljs-comment">//实现的IView方法</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Boolean <span class="hljs-title function_">getStart_share_ele</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> startShareAnim;<br>    &#125;<br></code></pre></td></tr></table></figure><p>​什么是“共享元素动画”？简单说，就是两个页面**“共用一个东西”<strong>，这个东西在切换页面时会</strong>动起来，看起来很自然、酷炫**。更加详细的讲解可以百度。</p><p>​后面还有<strong>BaseFragment</strong>、<strong>BaseModelImpl</strong>、<strong>BasePresenterImpl</strong>、<strong>RetryIntercepter</strong>类，改天再解析，今天学习任务结束！</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h3&gt;&lt;p&gt;​	分析复杂一点的功能，需要熟悉面向对象的编程思想，熟悉更加基础的代码，我感觉有点力不从心，十分难以下手，考虑要不要从基础类一点点学习，分析</summary>
      
    
    
    
    <category term="开发" scheme="http://bumak.github.io/categories/%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="安卓开发学习" scheme="http://bumak.github.io/tags/%E5%AE%89%E5%8D%93%E5%BC%80%E5%8F%91%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>阅读APP项目学习——2</title>
    <link href="http://bumak.github.io/2025/06/22/%E9%98%85%E8%AF%BBAPP%E5%AD%A6%E4%B9%A0/%E5%AE%89%E5%8D%93%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A02/"/>
    <id>http://bumak.github.io/2025/06/22/%E9%98%85%E8%AF%BBAPP%E5%AD%A6%E4%B9%A0/%E5%AE%89%E5%8D%93%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A02/</id>
    <published>2025-06-22T04:39:16.235Z</published>
    <updated>2025-06-23T01:58:48.011Z</updated>
    
    <content type="html"><![CDATA[<p>​欢迎页开始后，就进入主体<strong>MainActivity</strong>中，查看源码可以发现，其使用了众多自定义的其他类。</p><p>​</p><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>​先大体通过AI分析一波，看看这个主页面在干什么。</p><ul><li><p>页面初始化和布局设置：继承自 <strong>MBaseActivity<IMainPresenter></strong>，采用 MVP 架构设计（视图层 <strong>MainActivity</strong> 负责UI，<strong>IMainPresenter</strong> 负责业务逻辑）。初始化页面上的控件，如应用logo、几个功能按钮（打赏、设置、书库、添加书籍、下载）、刷新列表控件（<strong>RefreshRecyclerView</strong>）等。</p></li><li><p>显示书架列表：使用<strong>RefreshRecyclerView</strong>来展示书架内容，使用自定义的<strong>BookShelfAdapter</strong>作为列表的适配器，再通过布局管理器<strong>LinearLayoutManager</strong>来控制<strong>RecyclerView</strong>布局。</p></li><li><p>刷新和加载数据：绑定刷新监听器（<strong>OnRefreshWithProcessListener</strong>）来实现下拉刷新书架数据，刷新时调用**mPresenter.queryBookShelf(true)**请求最新数据。同时处理刷新完成和刷新错误的回调，并更新UI和进度条。</p></li><li><p>事件处理：给首页的各个按钮绑定点击事件：设置按钮弹出代理设置窗口；下载按钮弹出下载列表窗口；书库按钮跳转到书库界面（<strong>LibraryActivity</strong>）；添加书籍按钮跳转到导入书籍界面；打赏按钮预留了点击事件，具体逻辑没写。给书架列表的每个书籍绑定了点击事件：点击跳转到阅读界面；长按跳转到书籍详情界面，并带动画效果。书架中点击“去选书”会跳转到书库。</p></li><li><p>管理警告信息弹窗：页面上有一个警告信息区域（<strong>flWarn</strong>），可以通过关闭按钮隐藏。</p></li><li><p>处理系统按键事件：捕获返回键，实现“连续两次按返回键退出应用”的交互逻辑。</p></li><li><p>生命周期管理：在 <strong>onDestroy</strong> 里做资源销毁，比如关闭弹窗。</p></li></ul><blockquote><p>​上面比较陌生的概念有“适配器”，这是什么东西啊？</p><p>​举个简单的例子：你想在家里的书架上摆书，RecyclerView就是书架，适配器就是按顺序拿书，一本一本摆放书籍的人，书本的数据就是你手里的书。没有适配器，你的书架就不知道摆哪些书，也不知道怎么摆。</p></blockquote><h3 id="逻辑解读"><a href="#逻辑解读" class="headerlink" title="逻辑解读"></a>逻辑解读</h3><p>​</p><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//成员变量声明</span><br>    <span class="hljs-keyword">private</span> ImageView ivLogo;           <span class="hljs-comment">//应用logo图标</span><br>    <span class="hljs-keyword">private</span> ImageButton ibMoney;        <span class="hljs-comment">//打赏按钮</span><br>    <span class="hljs-keyword">private</span> ImageButton ibSettings;     <span class="hljs-comment">//设置按钮</span><br>    <span class="hljs-keyword">private</span> ImageButton ibLibrary;      <span class="hljs-comment">//书库按钮</span><br>    <span class="hljs-keyword">private</span> ImageButton ibAdd;          <span class="hljs-comment">//添加书籍按钮</span><br>    <span class="hljs-keyword">private</span> ImageButton ibDownload;     <span class="hljs-comment">//下载按钮</span><br><br>    <span class="hljs-keyword">private</span> RefreshRecyclerView rfRvShelf;<br>    <span class="hljs-keyword">private</span> BookShelfAdapter bookShelfAdapter;<br><br>    <span class="hljs-keyword">private</span> FrameLayout flWarn;         <span class="hljs-comment">//警告信息布局（弹出框）</span><br>    <span class="hljs-keyword">private</span> ImageView ivWarnClose;      <span class="hljs-comment">//关闭警告按钮</span><br><br>    <span class="hljs-keyword">private</span> DownloadListPop downloadListPop;        <span class="hljs-comment">//下载列表弹窗对象</span><br>    <span class="hljs-keyword">private</span> ProxyPop proxyPop;          <span class="hljs-comment">//代理设置弹窗对象</span><br></code></pre></td></tr></table></figure><p>​ImageView是安卓里面用来显示图片的控件，就是一个”图片框“，专门用来在界面上展示图片，比如应用图标、照片、按钮图标等等，只负责显示图片，不响应点击事件（当然，你可以给它加点击事件，让它像按钮一样用）。</p><p>​ImageButton就是有图片的按钮。</p><p>​其他就是自定义的组件了。</p><p>​</p><p>​看到具体的方法，<strong>initInjector</strong>是在初始化一个Presenter对象，然后返回一个<strong>MainPresenterImpl</strong>实例，负责与界面业务逻辑交互。</p><p>​<strong>onCreateActivity</strong>设置界面的布局文件。</p><p>​<strong>initData</strong>初始化数据，创建书架适配器实例。</p><p>​<strong>dispatchTouchEvent</strong>处理触摸事件，调用父类的方法，套壳函数。</p><p>​<strong>bindView</strong>绑定界面控件（找控件、实例化），找到布局里的各种控件（按钮、列表、弹窗等），并关联到变量，给书架列表 <code>RecyclerView</code> 设置适配器和布局管理器。</p><p>​<strong>bindEvent</strong>绑定各种事件监听器。</p><p>​<strong>bindRvShelfEvent</strong>给书架的刷新控件绑定刷新监听。</p><p>​<strong>firstRequest</strong>首次加载数据，应用打开时调用。</p><p>​<strong>refreshBookShelf</strong>将新的书籍列表数据传给适配器，更新显示。</p><p>​<strong>activityRefreshView</strong>触发书架刷新动作，让刷新控件开始刷新动画并调用刷新逻辑。</p><p>​<strong>refreshFinish</strong>刷新结束，隐藏刷新动画。</p><p>​<strong>refreshError</strong>刷新错误时调用。</p><p>​<strong>refreshRecyclerViewItemAdd</strong>刷新时进度条+1。</p><p>​<strong>setRecyclerMaxProgress</strong>设置刷新进度条的最大值。</p><p>​<strong>onKeyDown</strong>按键事件处理，用户按返回键时，调用 <code>exit()</code> 方法，实现“再按一次退出程序”的逻辑。</p><p>​<strong>onDestroy</strong>资源销毁时调用，清理一些弹窗的资源，防止内存泄漏。</p><p>​<strong>exit</strong>退出程序的逻辑，如果2秒内第二次按返回键，则退出程序，否则提示“再按一次退出程序”。</p><h3 id="前端页面复现"><a href="#前端页面复现" class="headerlink" title="前端页面复现"></a>前端页面复现</h3><p>​看到XML文件，里面使用到一个自定义的组件<strong>com.monke.monkeybook.widget.refreshview.RefreshRecyclerView</strong>，</p><p>下图中的空白区域就是这个组件的位置。当然也包括一个作者自己开源的沉浸框，需要引用依赖。</p><p>​里面的布局很清晰明了，沉浸框包裹最外层，然后一个垂直方向的线性布局来隔分上下页面，里面再由水平的线性布局来展示顶部，下面就是书架区。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.gif&quot;" data-lazy-src="/pictures/novelReader_app/image-20250622115453885.png" alt="image-20250622115453885"></p><p>​需要导入对应的drawable里面的XML文件、layout里面的其他XML文件、values里面的XML文件。然后写入<strong>RefreshRecyclerView</strong>类、<strong>RefreshProgressBar</strong>类、<strong>RefreshRecyclerViewAdapter</strong>抽象类、<strong>OnRefreshWithProgressListener</strong>接口、<strong>OnLoadMoreListener</strong>接口、<strong>BaseRefreshListener</strong>接口，还有<strong>BookContentView</strong>类，因为这个类又引出一堆其他的类和接口。太麻烦了。</p><p>​先放着BookContentView不管吧，还有其他几个<strong>BitIntentDataManager</strong>、<strong>MApplication</strong>、<strong>ReadBookControl</strong>都有点问题啊！这样分析也太麻烦了。不能按照这个逻辑搞下去。</p><h3 id="具体功能流程分析"><a href="#具体功能流程分析" class="headerlink" title="具体功能流程分析"></a>具体功能流程分析</h3><p>​先从最简单的退出功能来说吧，不然都没法读下去了。</p><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">onKeyDown</span><span class="hljs-params">(<span class="hljs-type">int</span> keyCode, KeyEvent event)</span> &#123;<br>       <span class="hljs-keyword">if</span> (keyCode == KeyEvent.KEYCODE_BACK) &#123;<br>           exit();<br>           <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>       &#125;<br>       <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.onKeyDown(keyCode, event);<br>   &#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-type">long</span> <span class="hljs-variable">exitTime</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exit</span><span class="hljs-params">()</span> &#123;<br>       <span class="hljs-keyword">if</span> ((System.currentTimeMillis() - exitTime) &gt; <span class="hljs-number">2000</span>) &#123;<br>           Toast.makeText(getApplicationContext(), <span class="hljs-string">&quot;再按一次退出程序&quot;</span>,<br>                   Toast.LENGTH_SHORT).show();<br>           exitTime = System.currentTimeMillis();<br>       &#125; <span class="hljs-keyword">else</span> &#123;<br>           finish();<br>           System.exit(<span class="hljs-number">0</span>);<br>       &#125;<br>   &#125;<br></code></pre></td></tr></table></figure><p>​当用户摁下”返回键“，触发onKeyDown方法，会调用exit方法，导致退出程序。keyCode表示当前被按下的按键的代码（编号），KeyEvent.KEYCODE_BACK是安卓系统定义的常量，代表”返回键“的按键代码。System.currentTimeMillis方法返回一个”long“类型的数字，表示从“1970年1月1日午夜”（称为“Unix纪元”）开始，到当前时刻所经过的毫秒数。</p><p>​第一次摁下”返回键“会设置exitTime为当前时间，然后需要在两秒内再摁一次，才进入else里面。</p><p>​finish方法，<strong>只是告诉系统“关闭这个Activity”，但它是异步的，不会立即停止当前方法的执行</strong>。<code>finish()</code> 会请求系统去销毁Activity（触发生命周期<code>onPause() -&gt; onStop() -&gt; onDestroy()</code>），但是这个过程是在系统消息队列中排队执行的，并不会马上跳出当前方法或终止线程，但是这个过程是在系统消息队列中排队执行的，并不会马上跳出当前方法或终止线程。</p><h3 id="AI总结主页面功能"><a href="#AI总结主页面功能" class="headerlink" title="AI总结主页面功能"></a>AI总结主页面功能</h3><p>​后面就根据这些功能，开始进行分块讲解，包括代码跟踪讲解，这样会更加让我专注于功能的实现。</p><blockquote><h3 id="1-界面初始化和视图绑定"><a href="#1-界面初始化和视图绑定" class="headerlink" title="1. 界面初始化和视图绑定"></a>1. 界面初始化和视图绑定</h3><ul><li><strong>加载界面布局</strong>（<code>setContentView</code>），让页面显示出来</li><li><strong>查找并绑定控件</strong>，比如logo图标、按钮、书架列表等</li><li><strong>初始化书架适配器</strong>，管理书籍列表的显示</li></ul><h3 id="2-数据展示和刷新"><a href="#2-数据展示和刷新" class="headerlink" title="2. 数据展示和刷新"></a>2. 数据展示和刷新</h3><ul><li><strong>展示书架列表数据</strong>，把数据加载到书架适配器里，显示在列表中</li><li><strong>支持下拉刷新</strong>，用户下拉列表时，重新请求数据，刷新书架内容</li><li><strong>刷新进度反馈</strong>，通过进度条显示刷新进度，提高用户体验</li></ul><h3 id="3-用户交互处理"><a href="#3-用户交互处理" class="headerlink" title="3. 用户交互处理"></a>3. 用户交互处理</h3><ul><li><strong>按钮点击事件</strong><ul><li>点击“设置”按钮弹出代理设置窗口</li><li>点击“下载”按钮弹出下载列表</li><li>点击“打赏”按钮触发打赏操作（这里没实现具体逻辑）</li><li>点击“书库”按钮进入书库页面</li><li>点击“添加书籍”按钮进入导入书籍页面</li></ul></li><li><strong>书架书籍点击</strong><ul><li>点击书籍跳转到阅读页面，打开书籍</li><li>长按书籍跳转到书籍详情页面，带动画效果</li></ul></li></ul><h3 id="4-弹窗与提示"><a href="#4-弹窗与提示" class="headerlink" title="4. 弹窗与提示"></a>4. 弹窗与提示</h3><ul><li>弹出代理设置和下载列表弹窗，方便用户操作</li><li>警告信息框的显示和关闭，提醒用户重要信息</li></ul><h3 id="5-生命周期与退出"><a href="#5-生命周期与退出" class="headerlink" title="5. 生命周期与退出"></a>5. 生命周期与退出</h3><ul><li>监听手机返回键，防止误操作退出</li><li>实现“双击返回键退出程序”的逻辑，提高用户体验</li><li>退出时释放资源，防止内存泄漏</li></ul><p>​</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;​	欢迎页开始后，就进入主体&lt;strong&gt;MainActivity&lt;/strong&gt;中，查看源码可以发现，其使用了众多自定义的其他类。&lt;/p&gt;
&lt;p&gt;​	&lt;/p&gt;
&lt;h3 id=&quot;概述&quot;&gt;&lt;a href=&quot;#概述&quot; class=&quot;headerlink&quot; title=&quot;概述</summary>
      
    
    
    
    <category term="开发" scheme="http://bumak.github.io/categories/%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="安卓开发学习" scheme="http://bumak.github.io/tags/%E5%AE%89%E5%8D%93%E5%BC%80%E5%8F%91%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
</feed>
